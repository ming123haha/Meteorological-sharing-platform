{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport { someMap as e } from \"../../../../../core/MapUtils.js\";\nimport { isSome as t, isNone as r } from \"../../../../../core/maybe.js\";\nimport s from \"../../../../../core/PooledArray.js\";\nimport { m as i, a, t as o } from \"../../../../../chunks/mat4.js\";\nimport { c as n } from \"../../../../../chunks/mat4f64.js\";\nimport { glLayout as d } from \"../../../support/buffer/glUtil.js\";\nimport { GLMaterials as h } from \"../../lib/GLMaterials.js\";\nimport { RenderOccludedFlag as l } from \"../../lib/Material.js\";\nimport { ModelDirty as m } from \"../../lib/ModelDirtyTypes.js\";\nimport { RenderPass as f } from \"../../lib/RenderPass.js\";\nimport { assert as c, setMatrixTranslation3 as u } from \"../../lib/Util.js\";\nimport { DrawParameters as g } from \"../DrawParameters.js\";\nimport { WaterMaterial as _ } from \"../WaterMaterial.js\";\nimport { sortInstancesByRange as p, BufferRange as b, Instance as w, addOrMerge as y } from \"./Instance.js\";\nimport { MergedGeometryBuffer as C } from \"./MergedGeometryBuffer.js\";\nimport { MergedGeometryBufferPool as H } from \"./MergedGeometryBufferPool.js\";\nimport { calculateTransformRelativeToOrigin as v } from \"./utils.js\";\n\nclass A {\n  constructor(e, t, r) {\n    this._rctx = e, this._materialRepository = t, this._material = r, this.type = \"MergedRenderer\", this._dataByOrigin = new Map(), this._renderCommandData = new s(), this._hasHighlights = !1, this._hasOccludees = !1, this._glMaterials = new h(this._material, this._materialRepository), this._bufferWriter = r.createBufferWriter(), this._bufferPool = new H(e, r.vertexAttributeLocations, d(this._bufferWriter.vertexBufferLayout));\n  }\n\n  dispose() {\n    this._glMaterials.destroy(), this._dataByOrigin.forEach(e => e.buffer.dispose()), this._dataByOrigin.clear(), this._bufferPool.dispose();\n  }\n\n  get isEmpty() {\n    return 0 === this._dataByOrigin.size;\n  }\n\n  get hasHighlights() {\n    return this._hasHighlights;\n  }\n\n  get hasOccludees() {\n    return this._hasOccludees;\n  }\n\n  get hasWater() {\n    return !this.isEmpty && this._material instanceof _;\n  }\n\n  get rendersOccluded() {\n    return !this.isEmpty && this._material.renderOccluded !== l.Occlude;\n  }\n\n  modify(e) {\n    this._updateGeometries(e.updates), this._addAndRemoveGeometries(e.adds, e.removes), this._updateRenderCommands();\n  }\n\n  _addAndRemoveGeometries(e, t) {\n    const r = this._bufferWriter,\n          s = r.vertexBufferLayout.stride / 4,\n          i = this._dataByOrigin,\n          a = R(e, t);\n    a.forEach((e, t) => {\n      a.delete(t);\n      const o = e.toAdd.reduce((e, t) => e + r.elementCount(t.data), 0);\n      let n = i.get(t);\n      if (null == n) c(0 === e.toRemove.length), n = new D(e.origin, new C(this._bufferPool, o * s)), i.set(t, n);else if (0 === e.toAdd.length && n.instances.size === e.toRemove.length) return n.buffer.dispose(), void i.delete(t);\n      let d = 0;\n      n.instances.forEach(e => d += e.to - e.from);\n      const h = e.toRemove.reduce((e, t) => e + r.elementCount(t.data), 0),\n            l = n.buffer.size,\n            m = (d + o - h) * s,\n            f = T;\n\n      if (m < l / 2 ? this._removeAndRebuild(n, e.toRemove, s, m, f) : e.toRemove.length > 0 && this._remove(n, e.toRemove, s, f), e.toAdd.length > 0) {\n        const t = L;\n        u(t, -e.origin[0], -e.origin[1], -e.origin[2]), this._add(n, e.toAdd, s, t, f);\n      }\n\n      const g = n.buffer.vao.vertexBuffers.geometry;\n      B(f), f.forAll(({\n        from: e,\n        to: t\n      }) => {\n        if (e < t) {\n          const r = n.buffer.array,\n                s = 4,\n                i = e * s,\n                a = t * s;\n          g.setSubData(r, i, i, a);\n        }\n      }), f.clear(), n.drawCommandsDirty = !0;\n    });\n  }\n\n  _updateGeometries(e) {\n    const t = this._bufferWriter,\n          r = t.vertexBufferLayout.stride / 4;\n\n    for (const s of e) {\n      const e = s.renderGeometry,\n            i = this._dataByOrigin.get(e.origin.id),\n            a = i && i.instances.get(e.id);\n\n      if (!a) return;\n      const o = s.updateType;\n\n      if (o & m.State.VISIBILITIES && (a.isVisible = e.instanceParameters.visible), o & (m.State.HIGHLIGHTS | m.State.VISIBILITIES)) {\n        const t = e.instanceParameters.visible;\n        a.hasHighlights = !!e.instanceParameters.highlights && t;\n      }\n\n      if (o & m.State.OCCLUDEES && (a.hasOccludees = !!e.instanceParameters.occludees), o & (m.State.VERTEXATTRS | m.State.TRANSFORMATION)) {\n        const {\n          array: s,\n          vao: o\n        } = i.buffer;\n        v(e, P, j), t.write({\n          transformation: P,\n          invTranspTransformation: j\n        }, e.data, t.vertexBufferLayout.createView(s.buffer), a.from), c(a.from + t.elementCount(e.data) === a.to, \"material VBO layout has changed\"), o.vertexBuffers.geometry.setSubData(s, a.from * r * 4, a.from * r * 4, a.to * r * 4);\n      }\n\n      i.drawCommandsDirty = !0;\n    }\n  }\n\n  _updateRenderCommands() {\n    this._hasHighlights = !1, this._hasOccludees = !1, this._dataByOrigin.forEach(t => {\n      t.hasHiddenInstances = !1, t.hasHighlights = !1, t.hasOccludees = !1, e(t.instances, e => (e.isVisible ? (e.hasHighlights && (this._hasHighlights = !0, t.hasHighlights = !0), e.hasOccludees && (this._hasOccludees = !0, t.hasOccludees = !0)) : t.hasHiddenInstances = !0, t.hasHiddenInstances && t.hasHighlights && t.hasOccludees));\n    });\n\n    const t = e => {\n      if (e.drawCommandsDefault = null, e.drawCommandsHighlight = null, e.drawCommandsOccludees = null, e.drawCommandsShadowHighlightRest = null, 0 === e.instances.size) return;\n\n      if (!I(e)) {\n        const t = this._bufferWriter.vertexBufferLayout.stride,\n              r = 4 * e.buffer.size / t;\n        return void (e.drawCommandsDefault = [{\n          first: 0,\n          count: r\n        }]);\n      }\n\n      const t = p(e.instances);\n      e.drawCommandsDefault = [], e.drawCommandsHighlight = [], e.drawCommandsOccludees = [], e.drawCommandsShadowHighlightRest = [];\n\n      for (const r of t) r.isVisible && (r.hasOccludees ? y(e.drawCommandsOccludees, r) : y(e.drawCommandsDefault, r), r.hasHighlights ? y(e.drawCommandsHighlight, r) : y(e.drawCommandsShadowHighlightRest, r));\n    };\n\n    this._dataByOrigin.forEach(e => {\n      e.drawCommandsDirty && (t(e), e.drawCommandsDirty = !1);\n    });\n  }\n\n  updateAnimation(e) {\n    return this._material.update(e);\n  }\n\n  requiresSlot(e, t) {\n    return null == e || this._material.requiresSlot(e, t);\n  }\n\n  render(e, s) {\n    if (!this.requiresSlot(s.slot, e)) return !1;\n    const i = e === f.MATERIAL_HIGHLIGHT || e === f.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT;\n    if (i && !this._hasHighlights) return !1;\n    const a = e === f.MATERIAL_DEPTH_SHADOWMAP_DEFAULT,\n          o = !(i || a);\n    if (this._dataByOrigin.forEach(e => {\n      if (i && !e.hasHighlights) return;\n      const r = (i ? e.drawCommandsHighlight : a && I(e) ? e.drawCommandsShadowHighlightRest : e.drawCommandsDefault) || null,\n            s = o && e.drawCommandsOccludees || null;\n      (t(r) || t(s)) && this._renderCommandData.push(new M(e.origin, e.buffer, r, s));\n    }), 0 === this._renderCommandData.length) return !1;\n\n    const n = this._rctx,\n          d = this._glMaterials.load(n, e);\n\n    if (r(d)) return this._renderCommandData.clear(), !1;\n    const h = d.beginSlot(s);\n    return n.bindTechnique(h, this._material.parameters, s, !1), this._renderCommandData.forAll(e => {\n      h.bindDraw(e, s);\n      const {\n        buffer: r,\n        renderCommands: i,\n        occludeeCommands: a\n      } = e;\n      h.ensureAttributeLocations(r.vao), n.bindVAO(r.vao);\n      const o = h.primitiveType;\n      t(i) && this._renderCommands(n, o, i), t(a) && (h.bindPipelineState(n, s.slot, !0), this._renderCommands(n, o, a), h.bindPipelineState(n, s.slot, !1));\n    }), this._renderCommandData.clear(), !0;\n  }\n\n  _renderCommands(e, t, r) {\n    for (let s = 0; s < r.length; s++) e.drawArrays(t, r[s].first, r[s].count);\n  }\n\n  _removeAndRebuild(e, t, r, s, i) {\n    for (const h of t) e.instances.delete(h.id);\n\n    const a = p(e.instances);\n    e.instances.clear();\n    const o = e.buffer.size,\n          n = e.buffer.alloc(s);\n    let d = 0;\n\n    for (const h of a) {\n      const t = h.from * r,\n            s = h.to * r;\n      n.copy(d, t, s), h.from = d / r, d += s - t, h.to = d / r, e.instances.set(h.id, h);\n    }\n\n    i.push(new b(0, n.hasNewBuffer ? e.buffer.array.length : o)), n.dispose(), e.buffer.erase(d, i.back().to), e.holes.clear();\n  }\n\n  _remove(e, t, r, s) {\n    for (const i of t) {\n      const t = i.id,\n            a = e.instances.get(t),\n            o = a.from * r,\n            n = a.to * r;\n      e.buffer.erase(o, n), e.holes.push(new b(a.from, a.to)), e.instances.delete(t), s.push(new b(o, n));\n    }\n\n    B(e.holes);\n  }\n\n  _add(e, s, n, d, h) {\n    if (0 === s.length) return;\n    const l = this._bufferWriter;\n    let m = l.vertexBufferLayout.createView(e.buffer.array.buffer);\n    const f = e.holes.length > 0;\n    let u = Number.MAX_SAFE_INTEGER,\n        g = Number.MIN_SAFE_INTEGER;\n\n    for (const _ of s) {\n      const s = t(_.transformation) ? i(P, d, _.transformation) : d;\n      a(j, s);\n      const p = o(j, j),\n            y = l.elementCount(_.data),\n            C = y * n;\n      let H = E(e.holes, y);\n      r(H) && (H = e.buffer.size / n, e.buffer.grow(C), m = l.vertexBufferLayout.createView(e.buffer.array.buffer)), l.write({\n        transformation: s,\n        invTranspTransformation: p\n      }, _.data, m, H);\n      const v = _.instanceParameters.visible,\n            A = !!_.instanceParameters.highlights && v,\n            O = !!_.instanceParameters.occludees,\n            R = new w(_.id, H, H + y, v, A, O);\n      c(null == e.instances.get(_.id)), e.instances.set(_.id, R), f ? h.push(new b(R.from * n, R.to * n)) : (u = Math.min(R.from, u), g = Math.max(R.to, g));\n    }\n\n    f || h.push(new b(u * n, g * n));\n  }\n\n  get test() {\n    return {\n      material: this._material,\n      glMaterials: this._glMaterials,\n      dataByOrigin: this._dataByOrigin\n    };\n  }\n\n}\n\nclass O {\n  constructor(e) {\n    this.origin = e, this.toAdd = new Array(), this.toRemove = new Array();\n  }\n\n}\n\nfunction R(e, t) {\n  const r = new Map();\n\n  for (const s of e) S(r, s, !0);\n\n  for (const s of t) S(r, s, !1);\n\n  return r;\n}\n\nfunction S(e, t, s) {\n  const i = t.origin;\n  if (r(i)) return;\n  let a = e.get(i.id);\n  null == a && (a = new O(i.vec3), e.set(i.id, a)), s ? a.toAdd.push(t) : a.toRemove.push(t);\n}\n\nfunction I(e) {\n  return e.hasOccludees || e.hasHighlights || e.hasHiddenInstances;\n}\n\nfunction E(e, t) {\n  let r;\n  if (!e.some(e => !(e.to - e.from < t) && (r = e, !0))) return null;\n  const s = r.from;\n  return r.from += t, r.from >= r.to && e.removeUnordered(r), s;\n}\n\nfunction B(e) {\n  const t = new Map();\n  e.forAll(e => t.set(e.from, e));\n  let r = !0;\n\n  for (; r;) r = !1, e.forEach(s => {\n    const i = t.get(s.to);\n    i && (s.to = i.to, t.delete(i.from), e.removeUnordered(i), r = !0);\n  });\n}\n\nclass D {\n  constructor(e, t) {\n    this.origin = e, this.buffer = t, this.instances = new Map(), this.holes = new s({\n      deallocator: null\n    }), this.hasHiddenInstances = !1, this.hasHighlights = !1, this.hasOccludees = !1, this.drawCommandsDirty = !1;\n  }\n\n}\n\nclass M extends g {\n  constructor(e, t, r, s) {\n    super(e), this.buffer = t, this.renderCommands = r, this.occludeeCommands = s;\n  }\n\n}\n\nconst T = new s({\n  deallocator: null\n}),\n      L = n(),\n      P = n(),\n      j = n();\nexport { A as MergedRenderer };","map":{"version":3,"names":["someMap","e","isSome","t","isNone","r","s","m","i","a","o","c","n","glLayout","d","GLMaterials","h","RenderOccludedFlag","l","ModelDirty","RenderPass","f","assert","setMatrixTranslation3","u","DrawParameters","g","WaterMaterial","_","sortInstancesByRange","p","BufferRange","b","Instance","w","addOrMerge","y","MergedGeometryBuffer","C","MergedGeometryBufferPool","H","calculateTransformRelativeToOrigin","v","A","constructor","_rctx","_materialRepository","_material","type","_dataByOrigin","Map","_renderCommandData","_hasHighlights","_hasOccludees","_glMaterials","_bufferWriter","createBufferWriter","_bufferPool","vertexAttributeLocations","vertexBufferLayout","dispose","destroy","forEach","buffer","clear","isEmpty","size","hasHighlights","hasOccludees","hasWater","rendersOccluded","renderOccluded","Occlude","modify","_updateGeometries","updates","_addAndRemoveGeometries","adds","removes","_updateRenderCommands","stride","R","delete","toAdd","reduce","elementCount","data","get","toRemove","length","D","origin","set","instances","to","from","T","_removeAndRebuild","_remove","L","_add","vao","vertexBuffers","geometry","B","forAll","array","setSubData","drawCommandsDirty","renderGeometry","id","updateType","State","VISIBILITIES","isVisible","instanceParameters","visible","HIGHLIGHTS","highlights","OCCLUDEES","occludees","VERTEXATTRS","TRANSFORMATION","P","j","write","transformation","invTranspTransformation","createView","hasHiddenInstances","drawCommandsDefault","drawCommandsHighlight","drawCommandsOccludees","drawCommandsShadowHighlightRest","I","first","count","updateAnimation","update","requiresSlot","render","slot","MATERIAL_HIGHLIGHT","MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT","MATERIAL_DEPTH_SHADOWMAP_DEFAULT","push","M","load","beginSlot","bindTechnique","parameters","bindDraw","renderCommands","occludeeCommands","ensureAttributeLocations","bindVAO","primitiveType","_renderCommands","bindPipelineState","drawArrays","alloc","copy","hasNewBuffer","erase","back","holes","Number","MAX_SAFE_INTEGER","MIN_SAFE_INTEGER","E","grow","O","Math","min","max","test","material","glMaterials","dataByOrigin","Array","S","vec3","some","removeUnordered","deallocator","MergedRenderer"],"sources":["C:/Users/hp/Desktop/eco-friendly atmosphere/Atmosphere/eco-friendly/node_modules/@arcgis/core/views/3d/webgl-engine/materials/renderers/MergedRenderer.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport{someMap as e}from\"../../../../../core/MapUtils.js\";import{isSome as t,isNone as r}from\"../../../../../core/maybe.js\";import s from\"../../../../../core/PooledArray.js\";import{m as i,a,t as o}from\"../../../../../chunks/mat4.js\";import{c as n}from\"../../../../../chunks/mat4f64.js\";import{glLayout as d}from\"../../../support/buffer/glUtil.js\";import{GLMaterials as h}from\"../../lib/GLMaterials.js\";import{RenderOccludedFlag as l}from\"../../lib/Material.js\";import{ModelDirty as m}from\"../../lib/ModelDirtyTypes.js\";import{RenderPass as f}from\"../../lib/RenderPass.js\";import{assert as c,setMatrixTranslation3 as u}from\"../../lib/Util.js\";import{DrawParameters as g}from\"../DrawParameters.js\";import{WaterMaterial as _}from\"../WaterMaterial.js\";import{sortInstancesByRange as p,BufferRange as b,Instance as w,addOrMerge as y}from\"./Instance.js\";import{MergedGeometryBuffer as C}from\"./MergedGeometryBuffer.js\";import{MergedGeometryBufferPool as H}from\"./MergedGeometryBufferPool.js\";import{calculateTransformRelativeToOrigin as v}from\"./utils.js\";class A{constructor(e,t,r){this._rctx=e,this._materialRepository=t,this._material=r,this.type=\"MergedRenderer\",this._dataByOrigin=new Map,this._renderCommandData=new s,this._hasHighlights=!1,this._hasOccludees=!1,this._glMaterials=new h(this._material,this._materialRepository),this._bufferWriter=r.createBufferWriter(),this._bufferPool=new H(e,r.vertexAttributeLocations,d(this._bufferWriter.vertexBufferLayout))}dispose(){this._glMaterials.destroy(),this._dataByOrigin.forEach((e=>e.buffer.dispose())),this._dataByOrigin.clear(),this._bufferPool.dispose()}get isEmpty(){return 0===this._dataByOrigin.size}get hasHighlights(){return this._hasHighlights}get hasOccludees(){return this._hasOccludees}get hasWater(){return!this.isEmpty&&this._material instanceof _}get rendersOccluded(){return!this.isEmpty&&this._material.renderOccluded!==l.Occlude}modify(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateRenderCommands()}_addAndRemoveGeometries(e,t){const r=this._bufferWriter,s=r.vertexBufferLayout.stride/4,i=this._dataByOrigin,a=R(e,t);a.forEach(((e,t)=>{a.delete(t);const o=e.toAdd.reduce(((e,t)=>e+r.elementCount(t.data)),0);let n=i.get(t);if(null==n)c(0===e.toRemove.length),n=new D(e.origin,new C(this._bufferPool,o*s)),i.set(t,n);else if(0===e.toAdd.length&&n.instances.size===e.toRemove.length)return n.buffer.dispose(),void i.delete(t);let d=0;n.instances.forEach((e=>d+=e.to-e.from));const h=e.toRemove.reduce(((e,t)=>e+r.elementCount(t.data)),0),l=n.buffer.size,m=(d+o-h)*s,f=T;if(m<l/2?this._removeAndRebuild(n,e.toRemove,s,m,f):e.toRemove.length>0&&this._remove(n,e.toRemove,s,f),e.toAdd.length>0){const t=L;u(t,-e.origin[0],-e.origin[1],-e.origin[2]),this._add(n,e.toAdd,s,t,f)}const g=n.buffer.vao.vertexBuffers.geometry;B(f),f.forAll((({from:e,to:t})=>{if(e<t){const r=n.buffer.array,s=4,i=e*s,a=t*s;g.setSubData(r,i,i,a)}})),f.clear(),n.drawCommandsDirty=!0}))}_updateGeometries(e){const t=this._bufferWriter,r=t.vertexBufferLayout.stride/4;for(const s of e){const e=s.renderGeometry,i=this._dataByOrigin.get(e.origin.id),a=i&&i.instances.get(e.id);if(!a)return;const o=s.updateType;if(o&m.State.VISIBILITIES&&(a.isVisible=e.instanceParameters.visible),o&(m.State.HIGHLIGHTS|m.State.VISIBILITIES)){const t=e.instanceParameters.visible;a.hasHighlights=!!e.instanceParameters.highlights&&t}if(o&m.State.OCCLUDEES&&(a.hasOccludees=!!e.instanceParameters.occludees),o&(m.State.VERTEXATTRS|m.State.TRANSFORMATION)){const{array:s,vao:o}=i.buffer;v(e,P,j),t.write({transformation:P,invTranspTransformation:j},e.data,t.vertexBufferLayout.createView(s.buffer),a.from),c(a.from+t.elementCount(e.data)===a.to,\"material VBO layout has changed\"),o.vertexBuffers.geometry.setSubData(s,a.from*r*4,a.from*r*4,a.to*r*4)}i.drawCommandsDirty=!0}}_updateRenderCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach((t=>{t.hasHiddenInstances=!1,t.hasHighlights=!1,t.hasOccludees=!1,e(t.instances,(e=>(e.isVisible?(e.hasHighlights&&(this._hasHighlights=!0,t.hasHighlights=!0),e.hasOccludees&&(this._hasOccludees=!0,t.hasOccludees=!0)):t.hasHiddenInstances=!0,t.hasHiddenInstances&&t.hasHighlights&&t.hasOccludees)))}));const t=e=>{if(e.drawCommandsDefault=null,e.drawCommandsHighlight=null,e.drawCommandsOccludees=null,e.drawCommandsShadowHighlightRest=null,0===e.instances.size)return;if(!I(e)){const t=this._bufferWriter.vertexBufferLayout.stride,r=4*e.buffer.size/t;return void(e.drawCommandsDefault=[{first:0,count:r}])}const t=p(e.instances);e.drawCommandsDefault=[],e.drawCommandsHighlight=[],e.drawCommandsOccludees=[],e.drawCommandsShadowHighlightRest=[];for(const r of t)r.isVisible&&(r.hasOccludees?y(e.drawCommandsOccludees,r):y(e.drawCommandsDefault,r),r.hasHighlights?y(e.drawCommandsHighlight,r):y(e.drawCommandsShadowHighlightRest,r))};this._dataByOrigin.forEach((e=>{e.drawCommandsDirty&&(t(e),e.drawCommandsDirty=!1)}))}updateAnimation(e){return this._material.update(e)}requiresSlot(e,t){return null==e||this._material.requiresSlot(e,t)}render(e,s){if(!this.requiresSlot(s.slot,e))return!1;const i=e===f.MATERIAL_HIGHLIGHT||e===f.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT;if(i&&!this._hasHighlights)return!1;const a=e===f.MATERIAL_DEPTH_SHADOWMAP_DEFAULT,o=!(i||a);if(this._dataByOrigin.forEach((e=>{if(i&&!e.hasHighlights)return;const r=(i?e.drawCommandsHighlight:a&&I(e)?e.drawCommandsShadowHighlightRest:e.drawCommandsDefault)||null,s=o&&e.drawCommandsOccludees||null;(t(r)||t(s))&&this._renderCommandData.push(new M(e.origin,e.buffer,r,s))})),0===this._renderCommandData.length)return!1;const n=this._rctx,d=this._glMaterials.load(n,e);if(r(d))return this._renderCommandData.clear(),!1;const h=d.beginSlot(s);return n.bindTechnique(h,this._material.parameters,s,!1),this._renderCommandData.forAll((e=>{h.bindDraw(e,s);const{buffer:r,renderCommands:i,occludeeCommands:a}=e;h.ensureAttributeLocations(r.vao),n.bindVAO(r.vao);const o=h.primitiveType;t(i)&&this._renderCommands(n,o,i),t(a)&&(h.bindPipelineState(n,s.slot,!0),this._renderCommands(n,o,a),h.bindPipelineState(n,s.slot,!1))})),this._renderCommandData.clear(),!0}_renderCommands(e,t,r){for(let s=0;s<r.length;s++)e.drawArrays(t,r[s].first,r[s].count)}_removeAndRebuild(e,t,r,s,i){for(const h of t)e.instances.delete(h.id);const a=p(e.instances);e.instances.clear();const o=e.buffer.size,n=e.buffer.alloc(s);let d=0;for(const h of a){const t=h.from*r,s=h.to*r;n.copy(d,t,s),h.from=d/r,d+=s-t,h.to=d/r,e.instances.set(h.id,h)}i.push(new b(0,n.hasNewBuffer?e.buffer.array.length:o)),n.dispose(),e.buffer.erase(d,i.back().to),e.holes.clear()}_remove(e,t,r,s){for(const i of t){const t=i.id,a=e.instances.get(t),o=a.from*r,n=a.to*r;e.buffer.erase(o,n),e.holes.push(new b(a.from,a.to)),e.instances.delete(t),s.push(new b(o,n))}B(e.holes)}_add(e,s,n,d,h){if(0===s.length)return;const l=this._bufferWriter;let m=l.vertexBufferLayout.createView(e.buffer.array.buffer);const f=e.holes.length>0;let u=Number.MAX_SAFE_INTEGER,g=Number.MIN_SAFE_INTEGER;for(const _ of s){const s=t(_.transformation)?i(P,d,_.transformation):d;a(j,s);const p=o(j,j),y=l.elementCount(_.data),C=y*n;let H=E(e.holes,y);r(H)&&(H=e.buffer.size/n,e.buffer.grow(C),m=l.vertexBufferLayout.createView(e.buffer.array.buffer)),l.write({transformation:s,invTranspTransformation:p},_.data,m,H);const v=_.instanceParameters.visible,A=!!_.instanceParameters.highlights&&v,O=!!_.instanceParameters.occludees,R=new w(_.id,H,H+y,v,A,O);c(null==e.instances.get(_.id)),e.instances.set(_.id,R),f?h.push(new b(R.from*n,R.to*n)):(u=Math.min(R.from,u),g=Math.max(R.to,g))}f||h.push(new b(u*n,g*n))}get test(){return{material:this._material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}}class O{constructor(e){this.origin=e,this.toAdd=new Array,this.toRemove=new Array}}function R(e,t){const r=new Map;for(const s of e)S(r,s,!0);for(const s of t)S(r,s,!1);return r}function S(e,t,s){const i=t.origin;if(r(i))return;let a=e.get(i.id);null==a&&(a=new O(i.vec3),e.set(i.id,a)),s?a.toAdd.push(t):a.toRemove.push(t)}function I(e){return e.hasOccludees||e.hasHighlights||e.hasHiddenInstances}function E(e,t){let r;if(!e.some((e=>!(e.to-e.from<t)&&(r=e,!0))))return null;const s=r.from;return r.from+=t,r.from>=r.to&&e.removeUnordered(r),s}function B(e){const t=new Map;e.forAll((e=>t.set(e.from,e)));let r=!0;for(;r;)r=!1,e.forEach((s=>{const i=t.get(s.to);i&&(s.to=i.to,t.delete(i.from),e.removeUnordered(i),r=!0)}))}class D{constructor(e,t){this.origin=e,this.buffer=t,this.instances=new Map,this.holes=new s({deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!1}}class M extends g{constructor(e,t,r,s){super(e),this.buffer=t,this.renderCommands=r,this.occludeeCommands=s}}const T=new s({deallocator:null}),L=n(),P=n(),j=n();export{A as MergedRenderer};\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA,SAAOA,OAAO,IAAIC,CAAlB,QAAwB,iCAAxB;AAA0D,SAAOC,MAAM,IAAIC,CAAjB,EAAmBC,MAAM,IAAIC,CAA7B,QAAmC,8BAAnC;AAAkE,OAAOC,CAAP,MAAa,oCAAb;AAAkD,SAAOC,CAAC,IAAIC,CAAZ,EAAcC,CAAd,EAAgBN,CAAC,IAAIO,CAArB,QAA2B,+BAA3B;AAA2D,SAAOC,CAAC,IAAIC,CAAZ,QAAkB,kCAAlB;AAAqD,SAAOC,QAAQ,IAAIC,CAAnB,QAAyB,mCAAzB;AAA6D,SAAOC,WAAW,IAAIC,CAAtB,QAA4B,0BAA5B;AAAuD,SAAOC,kBAAkB,IAAIC,CAA7B,QAAmC,uBAAnC;AAA2D,SAAOC,UAAU,IAAIZ,CAArB,QAA2B,8BAA3B;AAA0D,SAAOa,UAAU,IAAIC,CAArB,QAA2B,yBAA3B;AAAqD,SAAOC,MAAM,IAAIX,CAAjB,EAAmBY,qBAAqB,IAAIC,CAA5C,QAAkD,mBAAlD;AAAsE,SAAOC,cAAc,IAAIC,CAAzB,QAA+B,sBAA/B;AAAsD,SAAOC,aAAa,IAAIC,CAAxB,QAA8B,qBAA9B;AAAoD,SAAOC,oBAAoB,IAAIC,CAA/B,EAAiCC,WAAW,IAAIC,CAAhD,EAAkDC,QAAQ,IAAIC,CAA9D,EAAgEC,UAAU,IAAIC,CAA9E,QAAoF,eAApF;AAAoG,SAAOC,oBAAoB,IAAIC,CAA/B,QAAqC,2BAArC;AAAiE,SAAOC,wBAAwB,IAAIC,CAAnC,QAAyC,+BAAzC;AAAyE,SAAOC,kCAAkC,IAAIC,CAA7C,QAAmD,YAAnD;;AAAgE,MAAMC,CAAN,CAAO;EAACC,WAAW,CAAC3C,CAAD,EAAGE,CAAH,EAAKE,CAAL,EAAO;IAAC,KAAKwC,KAAL,GAAW5C,CAAX,EAAa,KAAK6C,mBAAL,GAAyB3C,CAAtC,EAAwC,KAAK4C,SAAL,GAAe1C,CAAvD,EAAyD,KAAK2C,IAAL,GAAU,gBAAnE,EAAoF,KAAKC,aAAL,GAAmB,IAAIC,GAAJ,EAAvG,EAA+G,KAAKC,kBAAL,GAAwB,IAAI7C,CAAJ,EAAvI,EAA6I,KAAK8C,cAAL,GAAoB,CAAC,CAAlK,EAAoK,KAAKC,aAAL,GAAmB,CAAC,CAAxL,EAA0L,KAAKC,YAAL,GAAkB,IAAItC,CAAJ,CAAM,KAAK+B,SAAX,EAAqB,KAAKD,mBAA1B,CAA5M,EAA2P,KAAKS,aAAL,GAAmBlD,CAAC,CAACmD,kBAAF,EAA9Q,EAAqS,KAAKC,WAAL,GAAiB,IAAIjB,CAAJ,CAAMvC,CAAN,EAAQI,CAAC,CAACqD,wBAAV,EAAmC5C,CAAC,CAAC,KAAKyC,aAAL,CAAmBI,kBAApB,CAApC,CAAtT;EAAmY;;EAAAC,OAAO,GAAE;IAAC,KAAKN,YAAL,CAAkBO,OAAlB,IAA4B,KAAKZ,aAAL,CAAmBa,OAAnB,CAA4B7D,CAAC,IAAEA,CAAC,CAAC8D,MAAF,CAASH,OAAT,EAA/B,CAA5B,EAAgF,KAAKX,aAAL,CAAmBe,KAAnB,EAAhF,EAA2G,KAAKP,WAAL,CAAiBG,OAAjB,EAA3G;EAAsI;;EAAW,IAAPK,OAAO,GAAE;IAAC,OAAO,MAAI,KAAKhB,aAAL,CAAmBiB,IAA9B;EAAmC;;EAAiB,IAAbC,aAAa,GAAE;IAAC,OAAO,KAAKf,cAAZ;EAA2B;;EAAgB,IAAZgB,YAAY,GAAE;IAAC,OAAO,KAAKf,aAAZ;EAA0B;;EAAY,IAARgB,QAAQ,GAAE;IAAC,OAAM,CAAC,KAAKJ,OAAN,IAAe,KAAKlB,SAAL,YAA0BnB,CAA/C;EAAiD;;EAAmB,IAAf0C,eAAe,GAAE;IAAC,OAAM,CAAC,KAAKL,OAAN,IAAe,KAAKlB,SAAL,CAAewB,cAAf,KAAgCrD,CAAC,CAACsD,OAAvD;EAA+D;;EAAAC,MAAM,CAACxE,CAAD,EAAG;IAAC,KAAKyE,iBAAL,CAAuBzE,CAAC,CAAC0E,OAAzB,GAAkC,KAAKC,uBAAL,CAA6B3E,CAAC,CAAC4E,IAA/B,EAAoC5E,CAAC,CAAC6E,OAAtC,CAAlC,EAAiF,KAAKC,qBAAL,EAAjF;EAA8G;;EAAAH,uBAAuB,CAAC3E,CAAD,EAAGE,CAAH,EAAK;IAAC,MAAME,CAAC,GAAC,KAAKkD,aAAb;IAAA,MAA2BjD,CAAC,GAACD,CAAC,CAACsD,kBAAF,CAAqBqB,MAArB,GAA4B,CAAzD;IAAA,MAA2DxE,CAAC,GAAC,KAAKyC,aAAlE;IAAA,MAAgFxC,CAAC,GAACwE,CAAC,CAAChF,CAAD,EAAGE,CAAH,CAAnF;IAAyFM,CAAC,CAACqD,OAAF,CAAW,CAAC7D,CAAD,EAAGE,CAAH,KAAO;MAACM,CAAC,CAACyE,MAAF,CAAS/E,CAAT;MAAY,MAAMO,CAAC,GAACT,CAAC,CAACkF,KAAF,CAAQC,MAAR,CAAgB,CAACnF,CAAD,EAAGE,CAAH,KAAOF,CAAC,GAACI,CAAC,CAACgF,YAAF,CAAelF,CAAC,CAACmF,IAAjB,CAAzB,EAAiD,CAAjD,CAAR;MAA4D,IAAI1E,CAAC,GAACJ,CAAC,CAAC+E,GAAF,CAAMpF,CAAN,CAAN;MAAe,IAAG,QAAMS,CAAT,EAAWD,CAAC,CAAC,MAAIV,CAAC,CAACuF,QAAF,CAAWC,MAAhB,CAAD,EAAyB7E,CAAC,GAAC,IAAI8E,CAAJ,CAAMzF,CAAC,CAAC0F,MAAR,EAAe,IAAIrD,CAAJ,CAAM,KAAKmB,WAAX,EAAuB/C,CAAC,GAACJ,CAAzB,CAAf,CAA3B,EAAuEE,CAAC,CAACoF,GAAF,CAAMzF,CAAN,EAAQS,CAAR,CAAvE,CAAX,KAAkG,IAAG,MAAIX,CAAC,CAACkF,KAAF,CAAQM,MAAZ,IAAoB7E,CAAC,CAACiF,SAAF,CAAY3B,IAAZ,KAAmBjE,CAAC,CAACuF,QAAF,CAAWC,MAArD,EAA4D,OAAO7E,CAAC,CAACmD,MAAF,CAASH,OAAT,IAAmB,KAAKpD,CAAC,CAAC0E,MAAF,CAAS/E,CAAT,CAA/B;MAA2C,IAAIW,CAAC,GAAC,CAAN;MAAQF,CAAC,CAACiF,SAAF,CAAY/B,OAAZ,CAAqB7D,CAAC,IAAEa,CAAC,IAAEb,CAAC,CAAC6F,EAAF,GAAK7F,CAAC,CAAC8F,IAAlC;MAAyC,MAAM/E,CAAC,GAACf,CAAC,CAACuF,QAAF,CAAWJ,MAAX,CAAmB,CAACnF,CAAD,EAAGE,CAAH,KAAOF,CAAC,GAACI,CAAC,CAACgF,YAAF,CAAelF,CAAC,CAACmF,IAAjB,CAA5B,EAAoD,CAApD,CAAR;MAAA,MAA+DpE,CAAC,GAACN,CAAC,CAACmD,MAAF,CAASG,IAA1E;MAAA,MAA+E3D,CAAC,GAAC,CAACO,CAAC,GAACJ,CAAF,GAAIM,CAAL,IAAQV,CAAzF;MAAA,MAA2Fe,CAAC,GAAC2E,CAA7F;;MAA+F,IAAGzF,CAAC,GAACW,CAAC,GAAC,CAAJ,GAAM,KAAK+E,iBAAL,CAAuBrF,CAAvB,EAAyBX,CAAC,CAACuF,QAA3B,EAAoClF,CAApC,EAAsCC,CAAtC,EAAwCc,CAAxC,CAAN,GAAiDpB,CAAC,CAACuF,QAAF,CAAWC,MAAX,GAAkB,CAAlB,IAAqB,KAAKS,OAAL,CAAatF,CAAb,EAAeX,CAAC,CAACuF,QAAjB,EAA0BlF,CAA1B,EAA4Be,CAA5B,CAAtE,EAAqGpB,CAAC,CAACkF,KAAF,CAAQM,MAAR,GAAe,CAAvH,EAAyH;QAAC,MAAMtF,CAAC,GAACgG,CAAR;QAAU3E,CAAC,CAACrB,CAAD,EAAG,CAACF,CAAC,CAAC0F,MAAF,CAAS,CAAT,CAAJ,EAAgB,CAAC1F,CAAC,CAAC0F,MAAF,CAAS,CAAT,CAAjB,EAA6B,CAAC1F,CAAC,CAAC0F,MAAF,CAAS,CAAT,CAA9B,CAAD,EAA4C,KAAKS,IAAL,CAAUxF,CAAV,EAAYX,CAAC,CAACkF,KAAd,EAAoB7E,CAApB,EAAsBH,CAAtB,EAAwBkB,CAAxB,CAA5C;MAAuE;;MAAA,MAAMK,CAAC,GAACd,CAAC,CAACmD,MAAF,CAASsC,GAAT,CAAaC,aAAb,CAA2BC,QAAnC;MAA4CC,CAAC,CAACnF,CAAD,CAAD,EAAKA,CAAC,CAACoF,MAAF,CAAU,CAAC;QAACV,IAAI,EAAC9F,CAAN;QAAQ6F,EAAE,EAAC3F;MAAX,CAAD,KAAiB;QAAC,IAAGF,CAAC,GAACE,CAAL,EAAO;UAAC,MAAME,CAAC,GAACO,CAAC,CAACmD,MAAF,CAAS2C,KAAjB;UAAA,MAAuBpG,CAAC,GAAC,CAAzB;UAAA,MAA2BE,CAAC,GAACP,CAAC,GAACK,CAA/B;UAAA,MAAiCG,CAAC,GAACN,CAAC,GAACG,CAArC;UAAuCoB,CAAC,CAACiF,UAAF,CAAatG,CAAb,EAAeG,CAAf,EAAiBA,CAAjB,EAAmBC,CAAnB;QAAsB;MAAC,CAAlG,CAAL,EAA0GY,CAAC,CAAC2C,KAAF,EAA1G,EAAoHpD,CAAC,CAACgG,iBAAF,GAAoB,CAAC,CAAzI;IAA2I,CAAr0B;EAAw0B;;EAAAlC,iBAAiB,CAACzE,CAAD,EAAG;IAAC,MAAME,CAAC,GAAC,KAAKoD,aAAb;IAAA,MAA2BlD,CAAC,GAACF,CAAC,CAACwD,kBAAF,CAAqBqB,MAArB,GAA4B,CAAzD;;IAA2D,KAAI,MAAM1E,CAAV,IAAeL,CAAf,EAAiB;MAAC,MAAMA,CAAC,GAACK,CAAC,CAACuG,cAAV;MAAA,MAAyBrG,CAAC,GAAC,KAAKyC,aAAL,CAAmBsC,GAAnB,CAAuBtF,CAAC,CAAC0F,MAAF,CAASmB,EAAhC,CAA3B;MAAA,MAA+DrG,CAAC,GAACD,CAAC,IAAEA,CAAC,CAACqF,SAAF,CAAYN,GAAZ,CAAgBtF,CAAC,CAAC6G,EAAlB,CAApE;;MAA0F,IAAG,CAACrG,CAAJ,EAAM;MAAO,MAAMC,CAAC,GAACJ,CAAC,CAACyG,UAAV;;MAAqB,IAAGrG,CAAC,GAACH,CAAC,CAACyG,KAAF,CAAQC,YAAV,KAAyBxG,CAAC,CAACyG,SAAF,GAAYjH,CAAC,CAACkH,kBAAF,CAAqBC,OAA1D,GAAmE1G,CAAC,IAAEH,CAAC,CAACyG,KAAF,CAAQK,UAAR,GAAmB9G,CAAC,CAACyG,KAAF,CAAQC,YAA7B,CAAvE,EAAkH;QAAC,MAAM9G,CAAC,GAACF,CAAC,CAACkH,kBAAF,CAAqBC,OAA7B;QAAqC3G,CAAC,CAAC0D,aAAF,GAAgB,CAAC,CAAClE,CAAC,CAACkH,kBAAF,CAAqBG,UAAvB,IAAmCnH,CAAnD;MAAqD;;MAAA,IAAGO,CAAC,GAACH,CAAC,CAACyG,KAAF,CAAQO,SAAV,KAAsB9G,CAAC,CAAC2D,YAAF,GAAe,CAAC,CAACnE,CAAC,CAACkH,kBAAF,CAAqBK,SAA5D,GAAuE9G,CAAC,IAAEH,CAAC,CAACyG,KAAF,CAAQS,WAAR,GAAoBlH,CAAC,CAACyG,KAAF,CAAQU,cAA9B,CAA3E,EAAyH;QAAC,MAAK;UAAChB,KAAK,EAACpG,CAAP;UAAS+F,GAAG,EAAC3F;QAAb,IAAgBF,CAAC,CAACuD,MAAvB;QAA8BrB,CAAC,CAACzC,CAAD,EAAG0H,CAAH,EAAKC,CAAL,CAAD,EAASzH,CAAC,CAAC0H,KAAF,CAAQ;UAACC,cAAc,EAACH,CAAhB;UAAkBI,uBAAuB,EAACH;QAA1C,CAAR,EAAqD3H,CAAC,CAACqF,IAAvD,EAA4DnF,CAAC,CAACwD,kBAAF,CAAqBqE,UAArB,CAAgC1H,CAAC,CAACyD,MAAlC,CAA5D,EAAsGtD,CAAC,CAACsF,IAAxG,CAAT,EAAuHpF,CAAC,CAACF,CAAC,CAACsF,IAAF,GAAO5F,CAAC,CAACkF,YAAF,CAAepF,CAAC,CAACqF,IAAjB,CAAP,KAAgC7E,CAAC,CAACqF,EAAnC,EAAsC,iCAAtC,CAAxH,EAAiMpF,CAAC,CAAC4F,aAAF,CAAgBC,QAAhB,CAAyBI,UAAzB,CAAoCrG,CAApC,EAAsCG,CAAC,CAACsF,IAAF,GAAO1F,CAAP,GAAS,CAA/C,EAAiDI,CAAC,CAACsF,IAAF,GAAO1F,CAAP,GAAS,CAA1D,EAA4DI,CAAC,CAACqF,EAAF,GAAKzF,CAAL,GAAO,CAAnE,CAAjM;MAAuQ;;MAAAG,CAAC,CAACoG,iBAAF,GAAoB,CAAC,CAArB;IAAuB;EAAC;;EAAA7B,qBAAqB,GAAE;IAAC,KAAK3B,cAAL,GAAoB,CAAC,CAArB,EAAuB,KAAKC,aAAL,GAAmB,CAAC,CAA3C,EAA6C,KAAKJ,aAAL,CAAmBa,OAAnB,CAA4B3D,CAAC,IAAE;MAACA,CAAC,CAAC8H,kBAAF,GAAqB,CAAC,CAAtB,EAAwB9H,CAAC,CAACgE,aAAF,GAAgB,CAAC,CAAzC,EAA2ChE,CAAC,CAACiE,YAAF,GAAe,CAAC,CAA3D,EAA6DnE,CAAC,CAACE,CAAC,CAAC0F,SAAH,EAAc5F,CAAC,KAAGA,CAAC,CAACiH,SAAF,IAAajH,CAAC,CAACkE,aAAF,KAAkB,KAAKf,cAAL,GAAoB,CAAC,CAArB,EAAuBjD,CAAC,CAACgE,aAAF,GAAgB,CAAC,CAA1D,GAA6DlE,CAAC,CAACmE,YAAF,KAAiB,KAAKf,aAAL,GAAmB,CAAC,CAApB,EAAsBlD,CAAC,CAACiE,YAAF,GAAe,CAAC,CAAvD,CAA1E,IAAqIjE,CAAC,CAAC8H,kBAAF,GAAqB,CAAC,CAA3J,EAA6J9H,CAAC,CAAC8H,kBAAF,IAAsB9H,CAAC,CAACgE,aAAxB,IAAuChE,CAAC,CAACiE,YAAzM,CAAf,CAA9D;IAAsS,CAAtU,CAA7C;;IAAsX,MAAMjE,CAAC,GAACF,CAAC,IAAE;MAAC,IAAGA,CAAC,CAACiI,mBAAF,GAAsB,IAAtB,EAA2BjI,CAAC,CAACkI,qBAAF,GAAwB,IAAnD,EAAwDlI,CAAC,CAACmI,qBAAF,GAAwB,IAAhF,EAAqFnI,CAAC,CAACoI,+BAAF,GAAkC,IAAvH,EAA4H,MAAIpI,CAAC,CAAC4F,SAAF,CAAY3B,IAA/I,EAAoJ;;MAAO,IAAG,CAACoE,CAAC,CAACrI,CAAD,CAAL,EAAS;QAAC,MAAME,CAAC,GAAC,KAAKoD,aAAL,CAAmBI,kBAAnB,CAAsCqB,MAA9C;QAAA,MAAqD3E,CAAC,GAAC,IAAEJ,CAAC,CAAC8D,MAAF,CAASG,IAAX,GAAgB/D,CAAvE;QAAyE,OAAO,MAAKF,CAAC,CAACiI,mBAAF,GAAsB,CAAC;UAACK,KAAK,EAAC,CAAP;UAASC,KAAK,EAACnI;QAAf,CAAD,CAA3B,CAAP;MAAuD;;MAAA,MAAMF,CAAC,GAAC2B,CAAC,CAAC7B,CAAC,CAAC4F,SAAH,CAAT;MAAuB5F,CAAC,CAACiI,mBAAF,GAAsB,EAAtB,EAAyBjI,CAAC,CAACkI,qBAAF,GAAwB,EAAjD,EAAoDlI,CAAC,CAACmI,qBAAF,GAAwB,EAA5E,EAA+EnI,CAAC,CAACoI,+BAAF,GAAkC,EAAjH;;MAAoH,KAAI,MAAMhI,CAAV,IAAeF,CAAf,EAAiBE,CAAC,CAAC6G,SAAF,KAAc7G,CAAC,CAAC+D,YAAF,GAAehC,CAAC,CAACnC,CAAC,CAACmI,qBAAH,EAAyB/H,CAAzB,CAAhB,GAA4C+B,CAAC,CAACnC,CAAC,CAACiI,mBAAH,EAAuB7H,CAAvB,CAA7C,EAAuEA,CAAC,CAAC8D,aAAF,GAAgB/B,CAAC,CAACnC,CAAC,CAACkI,qBAAH,EAAyB9H,CAAzB,CAAjB,GAA6C+B,CAAC,CAACnC,CAAC,CAACoI,+BAAH,EAAmChI,CAAnC,CAAnI;IAA0K,CAAvnB;;IAAwnB,KAAK4C,aAAL,CAAmBa,OAAnB,CAA4B7D,CAAC,IAAE;MAACA,CAAC,CAAC2G,iBAAF,KAAsBzG,CAAC,CAACF,CAAD,CAAD,EAAKA,CAAC,CAAC2G,iBAAF,GAAoB,CAAC,CAAhD;IAAmD,CAAnF;EAAsF;;EAAA6B,eAAe,CAACxI,CAAD,EAAG;IAAC,OAAO,KAAK8C,SAAL,CAAe2F,MAAf,CAAsBzI,CAAtB,CAAP;EAAgC;;EAAA0I,YAAY,CAAC1I,CAAD,EAAGE,CAAH,EAAK;IAAC,OAAO,QAAMF,CAAN,IAAS,KAAK8C,SAAL,CAAe4F,YAAf,CAA4B1I,CAA5B,EAA8BE,CAA9B,CAAhB;EAAiD;;EAAAyI,MAAM,CAAC3I,CAAD,EAAGK,CAAH,EAAK;IAAC,IAAG,CAAC,KAAKqI,YAAL,CAAkBrI,CAAC,CAACuI,IAApB,EAAyB5I,CAAzB,CAAJ,EAAgC,OAAM,CAAC,CAAP;IAAS,MAAMO,CAAC,GAACP,CAAC,KAAGoB,CAAC,CAACyH,kBAAN,IAA0B7I,CAAC,KAAGoB,CAAC,CAAC0H,kCAAxC;IAA2E,IAAGvI,CAAC,IAAE,CAAC,KAAK4C,cAAZ,EAA2B,OAAM,CAAC,CAAP;IAAS,MAAM3C,CAAC,GAACR,CAAC,KAAGoB,CAAC,CAAC2H,gCAAd;IAAA,MAA+CtI,CAAC,GAAC,EAAEF,CAAC,IAAEC,CAAL,CAAjD;IAAyD,IAAG,KAAKwC,aAAL,CAAmBa,OAAnB,CAA4B7D,CAAC,IAAE;MAAC,IAAGO,CAAC,IAAE,CAACP,CAAC,CAACkE,aAAT,EAAuB;MAAO,MAAM9D,CAAC,GAAC,CAACG,CAAC,GAACP,CAAC,CAACkI,qBAAH,GAAyB1H,CAAC,IAAE6H,CAAC,CAACrI,CAAD,CAAJ,GAAQA,CAAC,CAACoI,+BAAV,GAA0CpI,CAAC,CAACiI,mBAAvE,KAA6F,IAArG;MAAA,MAA0G5H,CAAC,GAACI,CAAC,IAAET,CAAC,CAACmI,qBAAL,IAA4B,IAAxI;MAA6I,CAACjI,CAAC,CAACE,CAAD,CAAD,IAAMF,CAAC,CAACG,CAAD,CAAR,KAAc,KAAK6C,kBAAL,CAAwB8F,IAAxB,CAA6B,IAAIC,CAAJ,CAAMjJ,CAAC,CAAC0F,MAAR,EAAe1F,CAAC,CAAC8D,MAAjB,EAAwB1D,CAAxB,EAA0BC,CAA1B,CAA7B,CAAd;IAAyE,CAApR,GAAuR,MAAI,KAAK6C,kBAAL,CAAwBsC,MAAtT,EAA6T,OAAM,CAAC,CAAP;;IAAS,MAAM7E,CAAC,GAAC,KAAKiC,KAAb;IAAA,MAAmB/B,CAAC,GAAC,KAAKwC,YAAL,CAAkB6F,IAAlB,CAAuBvI,CAAvB,EAAyBX,CAAzB,CAArB;;IAAiD,IAAGI,CAAC,CAACS,CAAD,CAAJ,EAAQ,OAAO,KAAKqC,kBAAL,CAAwBa,KAAxB,IAAgC,CAAC,CAAxC;IAA0C,MAAMhD,CAAC,GAACF,CAAC,CAACsI,SAAF,CAAY9I,CAAZ,CAAR;IAAuB,OAAOM,CAAC,CAACyI,aAAF,CAAgBrI,CAAhB,EAAkB,KAAK+B,SAAL,CAAeuG,UAAjC,EAA4ChJ,CAA5C,EAA8C,CAAC,CAA/C,GAAkD,KAAK6C,kBAAL,CAAwBsD,MAAxB,CAAgCxG,CAAC,IAAE;MAACe,CAAC,CAACuI,QAAF,CAAWtJ,CAAX,EAAaK,CAAb;MAAgB,MAAK;QAACyD,MAAM,EAAC1D,CAAR;QAAUmJ,cAAc,EAAChJ,CAAzB;QAA2BiJ,gBAAgB,EAAChJ;MAA5C,IAA+CR,CAApD;MAAsDe,CAAC,CAAC0I,wBAAF,CAA2BrJ,CAAC,CAACgG,GAA7B,GAAkCzF,CAAC,CAAC+I,OAAF,CAAUtJ,CAAC,CAACgG,GAAZ,CAAlC;MAAmD,MAAM3F,CAAC,GAACM,CAAC,CAAC4I,aAAV;MAAwBzJ,CAAC,CAACK,CAAD,CAAD,IAAM,KAAKqJ,eAAL,CAAqBjJ,CAArB,EAAuBF,CAAvB,EAAyBF,CAAzB,CAAN,EAAkCL,CAAC,CAACM,CAAD,CAAD,KAAOO,CAAC,CAAC8I,iBAAF,CAAoBlJ,CAApB,EAAsBN,CAAC,CAACuI,IAAxB,EAA6B,CAAC,CAA9B,GAAiC,KAAKgB,eAAL,CAAqBjJ,CAArB,EAAuBF,CAAvB,EAAyBD,CAAzB,CAAjC,EAA6DO,CAAC,CAAC8I,iBAAF,CAAoBlJ,CAApB,EAAsBN,CAAC,CAACuI,IAAxB,EAA6B,CAAC,CAA9B,CAApE,CAAlC;IAAwI,CAA7T,CAAlD,EAAkX,KAAK1F,kBAAL,CAAwBa,KAAxB,EAAlX,EAAkZ,CAAC,CAA1Z;EAA4Z;;EAAA6F,eAAe,CAAC5J,CAAD,EAAGE,CAAH,EAAKE,CAAL,EAAO;IAAC,KAAI,IAAIC,CAAC,GAAC,CAAV,EAAYA,CAAC,GAACD,CAAC,CAACoF,MAAhB,EAAuBnF,CAAC,EAAxB,EAA2BL,CAAC,CAAC8J,UAAF,CAAa5J,CAAb,EAAeE,CAAC,CAACC,CAAD,CAAD,CAAKiI,KAApB,EAA0BlI,CAAC,CAACC,CAAD,CAAD,CAAKkI,KAA/B;EAAsC;;EAAAvC,iBAAiB,CAAChG,CAAD,EAAGE,CAAH,EAAKE,CAAL,EAAOC,CAAP,EAASE,CAAT,EAAW;IAAC,KAAI,MAAMQ,CAAV,IAAeb,CAAf,EAAiBF,CAAC,CAAC4F,SAAF,CAAYX,MAAZ,CAAmBlE,CAAC,CAAC8F,EAArB;;IAAyB,MAAMrG,CAAC,GAACqB,CAAC,CAAC7B,CAAC,CAAC4F,SAAH,CAAT;IAAuB5F,CAAC,CAAC4F,SAAF,CAAY7B,KAAZ;IAAoB,MAAMtD,CAAC,GAACT,CAAC,CAAC8D,MAAF,CAASG,IAAjB;IAAA,MAAsBtD,CAAC,GAACX,CAAC,CAAC8D,MAAF,CAASiG,KAAT,CAAe1J,CAAf,CAAxB;IAA0C,IAAIQ,CAAC,GAAC,CAAN;;IAAQ,KAAI,MAAME,CAAV,IAAeP,CAAf,EAAiB;MAAC,MAAMN,CAAC,GAACa,CAAC,CAAC+E,IAAF,GAAO1F,CAAf;MAAA,MAAiBC,CAAC,GAACU,CAAC,CAAC8E,EAAF,GAAKzF,CAAxB;MAA0BO,CAAC,CAACqJ,IAAF,CAAOnJ,CAAP,EAASX,CAAT,EAAWG,CAAX,GAAcU,CAAC,CAAC+E,IAAF,GAAOjF,CAAC,GAACT,CAAvB,EAAyBS,CAAC,IAAER,CAAC,GAACH,CAA9B,EAAgCa,CAAC,CAAC8E,EAAF,GAAKhF,CAAC,GAACT,CAAvC,EAAyCJ,CAAC,CAAC4F,SAAF,CAAYD,GAAZ,CAAgB5E,CAAC,CAAC8F,EAAlB,EAAqB9F,CAArB,CAAzC;IAAiE;;IAAAR,CAAC,CAACyI,IAAF,CAAO,IAAIjH,CAAJ,CAAM,CAAN,EAAQpB,CAAC,CAACsJ,YAAF,GAAejK,CAAC,CAAC8D,MAAF,CAAS2C,KAAT,CAAejB,MAA9B,GAAqC/E,CAA7C,CAAP,GAAwDE,CAAC,CAACgD,OAAF,EAAxD,EAAoE3D,CAAC,CAAC8D,MAAF,CAASoG,KAAT,CAAerJ,CAAf,EAAiBN,CAAC,CAAC4J,IAAF,GAAStE,EAA1B,CAApE,EAAkG7F,CAAC,CAACoK,KAAF,CAAQrG,KAAR,EAAlG;EAAkH;;EAAAkC,OAAO,CAACjG,CAAD,EAAGE,CAAH,EAAKE,CAAL,EAAOC,CAAP,EAAS;IAAC,KAAI,MAAME,CAAV,IAAeL,CAAf,EAAiB;MAAC,MAAMA,CAAC,GAACK,CAAC,CAACsG,EAAV;MAAA,MAAarG,CAAC,GAACR,CAAC,CAAC4F,SAAF,CAAYN,GAAZ,CAAgBpF,CAAhB,CAAf;MAAA,MAAkCO,CAAC,GAACD,CAAC,CAACsF,IAAF,GAAO1F,CAA3C;MAAA,MAA6CO,CAAC,GAACH,CAAC,CAACqF,EAAF,GAAKzF,CAApD;MAAsDJ,CAAC,CAAC8D,MAAF,CAASoG,KAAT,CAAezJ,CAAf,EAAiBE,CAAjB,GAAoBX,CAAC,CAACoK,KAAF,CAAQpB,IAAR,CAAa,IAAIjH,CAAJ,CAAMvB,CAAC,CAACsF,IAAR,EAAatF,CAAC,CAACqF,EAAf,CAAb,CAApB,EAAqD7F,CAAC,CAAC4F,SAAF,CAAYX,MAAZ,CAAmB/E,CAAnB,CAArD,EAA2EG,CAAC,CAAC2I,IAAF,CAAO,IAAIjH,CAAJ,CAAMtB,CAAN,EAAQE,CAAR,CAAP,CAA3E;IAA8F;;IAAA4F,CAAC,CAACvG,CAAC,CAACoK,KAAH,CAAD;EAAW;;EAAAjE,IAAI,CAACnG,CAAD,EAAGK,CAAH,EAAKM,CAAL,EAAOE,CAAP,EAASE,CAAT,EAAW;IAAC,IAAG,MAAIV,CAAC,CAACmF,MAAT,EAAgB;IAAO,MAAMvE,CAAC,GAAC,KAAKqC,aAAb;IAA2B,IAAIhD,CAAC,GAACW,CAAC,CAACyC,kBAAF,CAAqBqE,UAArB,CAAgC/H,CAAC,CAAC8D,MAAF,CAAS2C,KAAT,CAAe3C,MAA/C,CAAN;IAA6D,MAAM1C,CAAC,GAACpB,CAAC,CAACoK,KAAF,CAAQ5E,MAAR,GAAe,CAAvB;IAAyB,IAAIjE,CAAC,GAAC8I,MAAM,CAACC,gBAAb;IAAA,IAA8B7I,CAAC,GAAC4I,MAAM,CAACE,gBAAvC;;IAAwD,KAAI,MAAM5I,CAAV,IAAetB,CAAf,EAAiB;MAAC,MAAMA,CAAC,GAACH,CAAC,CAACyB,CAAC,CAACkG,cAAH,CAAD,GAAoBtH,CAAC,CAACmH,CAAD,EAAG7G,CAAH,EAAKc,CAAC,CAACkG,cAAP,CAArB,GAA4ChH,CAApD;MAAsDL,CAAC,CAACmH,CAAD,EAAGtH,CAAH,CAAD;MAAO,MAAMwB,CAAC,GAACpB,CAAC,CAACkH,CAAD,EAAGA,CAAH,CAAT;MAAA,MAAexF,CAAC,GAAClB,CAAC,CAACmE,YAAF,CAAezD,CAAC,CAAC0D,IAAjB,CAAjB;MAAA,MAAwChD,CAAC,GAACF,CAAC,GAACxB,CAA5C;MAA8C,IAAI4B,CAAC,GAACiI,CAAC,CAACxK,CAAC,CAACoK,KAAH,EAASjI,CAAT,CAAP;MAAmB/B,CAAC,CAACmC,CAAD,CAAD,KAAOA,CAAC,GAACvC,CAAC,CAAC8D,MAAF,CAASG,IAAT,GAActD,CAAhB,EAAkBX,CAAC,CAAC8D,MAAF,CAAS2G,IAAT,CAAcpI,CAAd,CAAlB,EAAmC/B,CAAC,GAACW,CAAC,CAACyC,kBAAF,CAAqBqE,UAArB,CAAgC/H,CAAC,CAAC8D,MAAF,CAAS2C,KAAT,CAAe3C,MAA/C,CAA5C,GAAoG7C,CAAC,CAAC2G,KAAF,CAAQ;QAACC,cAAc,EAACxH,CAAhB;QAAkByH,uBAAuB,EAACjG;MAA1C,CAAR,EAAqDF,CAAC,CAAC0D,IAAvD,EAA4D/E,CAA5D,EAA8DiC,CAA9D,CAApG;MAAqK,MAAME,CAAC,GAACd,CAAC,CAACuF,kBAAF,CAAqBC,OAA7B;MAAA,MAAqCzE,CAAC,GAAC,CAAC,CAACf,CAAC,CAACuF,kBAAF,CAAqBG,UAAvB,IAAmC5E,CAA1E;MAAA,MAA4EiI,CAAC,GAAC,CAAC,CAAC/I,CAAC,CAACuF,kBAAF,CAAqBK,SAArG;MAAA,MAA+GvC,CAAC,GAAC,IAAI/C,CAAJ,CAAMN,CAAC,CAACkF,EAAR,EAAWtE,CAAX,EAAaA,CAAC,GAACJ,CAAf,EAAiBM,CAAjB,EAAmBC,CAAnB,EAAqBgI,CAArB,CAAjH;MAAyIhK,CAAC,CAAC,QAAMV,CAAC,CAAC4F,SAAF,CAAYN,GAAZ,CAAgB3D,CAAC,CAACkF,EAAlB,CAAP,CAAD,EAA+B7G,CAAC,CAAC4F,SAAF,CAAYD,GAAZ,CAAgBhE,CAAC,CAACkF,EAAlB,EAAqB7B,CAArB,CAA/B,EAAuD5D,CAAC,GAACL,CAAC,CAACiI,IAAF,CAAO,IAAIjH,CAAJ,CAAMiD,CAAC,CAACc,IAAF,GAAOnF,CAAb,EAAeqE,CAAC,CAACa,EAAF,GAAKlF,CAApB,CAAP,CAAD,IAAiCY,CAAC,GAACoJ,IAAI,CAACC,GAAL,CAAS5F,CAAC,CAACc,IAAX,EAAgBvE,CAAhB,CAAF,EAAqBE,CAAC,GAACkJ,IAAI,CAACE,GAAL,CAAS7F,CAAC,CAACa,EAAX,EAAcpE,CAAd,CAAxD,CAAxD;IAAkI;;IAAAL,CAAC,IAAEL,CAAC,CAACiI,IAAF,CAAO,IAAIjH,CAAJ,CAAMR,CAAC,GAACZ,CAAR,EAAUc,CAAC,GAACd,CAAZ,CAAP,CAAH;EAA0B;;EAAQ,IAAJmK,IAAI,GAAE;IAAC,OAAM;MAACC,QAAQ,EAAC,KAAKjI,SAAf;MAAyBkI,WAAW,EAAC,KAAK3H,YAA1C;MAAuD4H,YAAY,EAAC,KAAKjI;IAAzE,CAAN;EAA8F;;AAA5hN;;AAA6hN,MAAM0H,CAAN,CAAO;EAAC/H,WAAW,CAAC3C,CAAD,EAAG;IAAC,KAAK0F,MAAL,GAAY1F,CAAZ,EAAc,KAAKkF,KAAL,GAAW,IAAIgG,KAAJ,EAAzB,EAAmC,KAAK3F,QAAL,GAAc,IAAI2F,KAAJ,EAAjD;EAA2D;;AAA3E;;AAA4E,SAASlG,CAAT,CAAWhF,CAAX,EAAaE,CAAb,EAAe;EAAC,MAAME,CAAC,GAAC,IAAI6C,GAAJ,EAAR;;EAAgB,KAAI,MAAM5C,CAAV,IAAeL,CAAf,EAAiBmL,CAAC,CAAC/K,CAAD,EAAGC,CAAH,EAAK,CAAC,CAAN,CAAD;;EAAU,KAAI,MAAMA,CAAV,IAAeH,CAAf,EAAiBiL,CAAC,CAAC/K,CAAD,EAAGC,CAAH,EAAK,CAAC,CAAN,CAAD;;EAAU,OAAOD,CAAP;AAAS;;AAAA,SAAS+K,CAAT,CAAWnL,CAAX,EAAaE,CAAb,EAAeG,CAAf,EAAiB;EAAC,MAAME,CAAC,GAACL,CAAC,CAACwF,MAAV;EAAiB,IAAGtF,CAAC,CAACG,CAAD,CAAJ,EAAQ;EAAO,IAAIC,CAAC,GAACR,CAAC,CAACsF,GAAF,CAAM/E,CAAC,CAACsG,EAAR,CAAN;EAAkB,QAAMrG,CAAN,KAAUA,CAAC,GAAC,IAAIkK,CAAJ,CAAMnK,CAAC,CAAC6K,IAAR,CAAF,EAAgBpL,CAAC,CAAC2F,GAAF,CAAMpF,CAAC,CAACsG,EAAR,EAAWrG,CAAX,CAA1B,GAAyCH,CAAC,GAACG,CAAC,CAAC0E,KAAF,CAAQ8D,IAAR,CAAa9I,CAAb,CAAD,GAAiBM,CAAC,CAAC+E,QAAF,CAAWyD,IAAX,CAAgB9I,CAAhB,CAA3D;AAA8E;;AAAA,SAASmI,CAAT,CAAWrI,CAAX,EAAa;EAAC,OAAOA,CAAC,CAACmE,YAAF,IAAgBnE,CAAC,CAACkE,aAAlB,IAAiClE,CAAC,CAACgI,kBAA1C;AAA6D;;AAAA,SAASwC,CAAT,CAAWxK,CAAX,EAAaE,CAAb,EAAe;EAAC,IAAIE,CAAJ;EAAM,IAAG,CAACJ,CAAC,CAACqL,IAAF,CAAQrL,CAAC,IAAE,EAAEA,CAAC,CAAC6F,EAAF,GAAK7F,CAAC,CAAC8F,IAAP,GAAY5F,CAAd,MAAmBE,CAAC,GAACJ,CAAF,EAAI,CAAC,CAAxB,CAAX,CAAJ,EAA4C,OAAO,IAAP;EAAY,MAAMK,CAAC,GAACD,CAAC,CAAC0F,IAAV;EAAe,OAAO1F,CAAC,CAAC0F,IAAF,IAAQ5F,CAAR,EAAUE,CAAC,CAAC0F,IAAF,IAAQ1F,CAAC,CAACyF,EAAV,IAAc7F,CAAC,CAACsL,eAAF,CAAkBlL,CAAlB,CAAxB,EAA6CC,CAApD;AAAsD;;AAAA,SAASkG,CAAT,CAAWvG,CAAX,EAAa;EAAC,MAAME,CAAC,GAAC,IAAI+C,GAAJ,EAAR;EAAgBjD,CAAC,CAACwG,MAAF,CAAUxG,CAAC,IAAEE,CAAC,CAACyF,GAAF,CAAM3F,CAAC,CAAC8F,IAAR,EAAa9F,CAAb,CAAb;EAA+B,IAAII,CAAC,GAAC,CAAC,CAAP;;EAAS,OAAKA,CAAL,GAAQA,CAAC,GAAC,CAAC,CAAH,EAAKJ,CAAC,CAAC6D,OAAF,CAAWxD,CAAC,IAAE;IAAC,MAAME,CAAC,GAACL,CAAC,CAACoF,GAAF,CAAMjF,CAAC,CAACwF,EAAR,CAAR;IAAoBtF,CAAC,KAAGF,CAAC,CAACwF,EAAF,GAAKtF,CAAC,CAACsF,EAAP,EAAU3F,CAAC,CAAC+E,MAAF,CAAS1E,CAAC,CAACuF,IAAX,CAAV,EAA2B9F,CAAC,CAACsL,eAAF,CAAkB/K,CAAlB,CAA3B,EAAgDH,CAAC,GAAC,CAAC,CAAtD,CAAD;EAA0D,CAA7F,CAAL;AAAqG;;AAAA,MAAMqF,CAAN,CAAO;EAAC9C,WAAW,CAAC3C,CAAD,EAAGE,CAAH,EAAK;IAAC,KAAKwF,MAAL,GAAY1F,CAAZ,EAAc,KAAK8D,MAAL,GAAY5D,CAA1B,EAA4B,KAAK0F,SAAL,GAAe,IAAI3C,GAAJ,EAA3C,EAAmD,KAAKmH,KAAL,GAAW,IAAI/J,CAAJ,CAAM;MAACkL,WAAW,EAAC;IAAb,CAAN,CAA9D,EAAwF,KAAKvD,kBAAL,GAAwB,CAAC,CAAjH,EAAmH,KAAK9D,aAAL,GAAmB,CAAC,CAAvI,EAAyI,KAAKC,YAAL,GAAkB,CAAC,CAA5J,EAA8J,KAAKwC,iBAAL,GAAuB,CAAC,CAAtL;EAAwL;;AAA1M;;AAA2M,MAAMsC,CAAN,SAAgBxH,CAAhB,CAAiB;EAACkB,WAAW,CAAC3C,CAAD,EAAGE,CAAH,EAAKE,CAAL,EAAOC,CAAP,EAAS;IAAC,MAAML,CAAN,GAAS,KAAK8D,MAAL,GAAY5D,CAArB,EAAuB,KAAKqJ,cAAL,GAAoBnJ,CAA3C,EAA6C,KAAKoJ,gBAAL,GAAsBnJ,CAAnE;EAAqE;;AAA3F;;AAA4F,MAAM0F,CAAC,GAAC,IAAI1F,CAAJ,CAAM;EAACkL,WAAW,EAAC;AAAb,CAAN,CAAR;AAAA,MAAkCrF,CAAC,GAACvF,CAAC,EAArC;AAAA,MAAwC+G,CAAC,GAAC/G,CAAC,EAA3C;AAAA,MAA8CgH,CAAC,GAAChH,CAAC,EAAjD;AAAoD,SAAO+B,CAAC,IAAI8I,cAAZ"},"metadata":{},"sourceType":"module"}