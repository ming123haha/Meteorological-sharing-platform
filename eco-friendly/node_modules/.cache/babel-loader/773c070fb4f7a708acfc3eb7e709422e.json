{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport { isSome as e } from \"../../../../core/maybe.js\";\nimport { hasSource as t } from \"./RasterBitmap.js\";\nimport r from \"../webgl/VertexStream.js\";\nimport s from \"../webgl/brushes/WGLBrush.js\";\nimport { BlendFactor as a, CompareFunction as i } from \"../../../webgl/enums.js\";\nimport { setTextures as o, getCommonUniforms as n, setUniforms as h, getColormapUniforms as l, getStretchUniforms as c, getShadedReliefUniforms as d, getUniformLocationInfos as p, getBasicGridUniforms as u } from \"../../../webgl/rasterUtils.js\";\n\nclass m extends s {\n  constructor() {\n    super(...arguments), this._desc = {\n      lut: {\n        vsPath: \"raster/lut\",\n        fsPath: \"raster/lut\",\n        attributes: new Map([[\"a_position\", 0], [\"a_texcoord\", 1]])\n      },\n      stretch: {\n        vsPath: \"raster/stretch\",\n        fsPath: \"raster/stretch\",\n        attributes: new Map([[\"a_position\", 0], [\"a_texcoord\", 1]])\n      },\n      hillshade: {\n        vsPath: \"raster/hillshade\",\n        fsPath: \"raster/hillshade\",\n        attributes: new Map([[\"a_position\", 0], [\"a_texcoord\", 1]])\n      }\n    }, this._rendererUniformInfos = new Map();\n  }\n\n  dispose() {\n    this._quad && this._quad.dispose();\n  }\n\n  prepareState({\n    context: e\n  }) {\n    e.setBlendingEnabled(!0), e.setBlendFunctionSeparate(a.ONE, a.ONE_MINUS_SRC_ALPHA, a.ONE, a.ONE_MINUS_SRC_ALPHA), e.setColorMask(!0, !0, !0, !0), e.setStencilWriteMask(0), e.setStencilTestEnabled(!0);\n  }\n\n  draw(e, r) {\n    if (!t(r) || r.suspended) return;\n    const {\n      timeline: s,\n      context: a,\n      painter: o\n    } = e;\n    s.begin(this.name), a.setStencilFunction(i.EQUAL, r.stencilRef, 255);\n    const n = !a.capabilities.textureFloat?.textureFloatLinear;\n    r.updateTexture(e);\n\n    const h = this._getShaderVariations(r, n),\n          l = o.materialManager.getProgram(this._desc[r.symbolizerParameters.type], h);\n\n    this._drawWithProgram(e, l, r), s.end(this.name);\n  }\n\n  _drawWithProgram({\n    context: t,\n    requestRender: s,\n    allowDelayedRender: a\n  }, i, p, m = 1, f = [0, 0], _ = !1) {\n    if (this._quad || (this._quad = new r(t, [0, 0, 1, 0, 0, 1, 1, 1])), a && e(s) && !i.isCompiled) return void s();\n    const {\n      symbolizerParameters: g,\n      transformGrid: b,\n      width: P,\n      height: w,\n      opacity: S\n    } = p,\n          x = g.type;\n    t.useProgram(i);\n\n    const y = this._getShaderVariations(p),\n          M = this._getUniformInfos(x, t, i, y),\n          {\n      names: U,\n      textures: j\n    } = p.getTextures();\n\n    o(t, i, U, j);\n    const I = u(m, f),\n          E = n(b, [P, w], [p.source.width, p.source.height], S, _);\n\n    if (h(i, M, {\n      u_coordScale: p.coordScale,\n      u_dvsMat3: p.transforms.dvs,\n      ...I,\n      ...E\n    }), g.colormap) {\n      const {\n        colormap: e,\n        colormapOffset: t\n      } = g,\n            r = l(e, t);\n      h(i, M, r);\n    }\n\n    if (\"stretch\" === g.type) {\n      const e = c(g);\n      h(i, M, e);\n    } else if (\"hillshade\" === g.type) {\n      const e = d(g);\n      h(i, M, e);\n    }\n\n    this._quad.draw();\n  }\n\n  _getUniformInfos(e, t, r, s) {\n    const a = s.length > 0 ? e + \"-\" + s.join(\"-\") : e;\n    if (this._rendererUniformInfos.has(a)) return this._rendererUniformInfos.get(a);\n    const i = p(t, r);\n    return this._rendererUniformInfos.set(a, i), i;\n  }\n\n  _getShaderVariations(e, t = !1) {\n    const r = [],\n          {\n      interpolation: s\n    } = e,\n          {\n      type: a,\n      colormap: i\n    } = e.symbolizerParameters;\n    return \"cubic\" === s ? r.push(\"bicubic\") : \"bilinear\" === s && \"stretch\" === a && null != i ? (r.push(\"bilinear\"), r.push(\"nnedge\")) : t && \"bilinear\" === s && r.push(\"bilinear\"), e.isRendereredSource ? r.push(\"noop\") : i && r.push(\"applyColormap\"), e.transformGrid && (r.push(\"applyProjection\"), 1 === e.transformGrid.spacing[0] && r.push(\"lookupProjection\")), r;\n  }\n\n}\n\nexport { m as default };","map":{"version":3,"names":["isSome","e","hasSource","t","r","s","BlendFactor","a","CompareFunction","i","setTextures","o","getCommonUniforms","n","setUniforms","h","getColormapUniforms","l","getStretchUniforms","c","getShadedReliefUniforms","d","getUniformLocationInfos","p","getBasicGridUniforms","u","m","constructor","arguments","_desc","lut","vsPath","fsPath","attributes","Map","stretch","hillshade","_rendererUniformInfos","dispose","_quad","prepareState","context","setBlendingEnabled","setBlendFunctionSeparate","ONE","ONE_MINUS_SRC_ALPHA","setColorMask","setStencilWriteMask","setStencilTestEnabled","draw","suspended","timeline","painter","begin","name","setStencilFunction","EQUAL","stencilRef","capabilities","textureFloat","textureFloatLinear","updateTexture","_getShaderVariations","materialManager","getProgram","symbolizerParameters","type","_drawWithProgram","end","requestRender","allowDelayedRender","f","_","isCompiled","g","transformGrid","b","width","P","height","w","opacity","S","x","useProgram","y","M","_getUniformInfos","names","U","textures","j","getTextures","I","E","source","u_coordScale","coordScale","u_dvsMat3","transforms","dvs","colormap","colormapOffset","length","join","has","get","set","interpolation","push","isRendereredSource","spacing","default"],"sources":["E:/各个学科/论文/毕业论文/Atmosphere/eco-friendly/node_modules/@arcgis/core/views/2d/engine/imagery/BrushRasterBitmap.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{isSome as e}from\"../../../../core/maybe.js\";import{hasSource as t}from\"./RasterBitmap.js\";import r from\"../webgl/VertexStream.js\";import s from\"../webgl/brushes/WGLBrush.js\";import{BlendFactor as a,CompareFunction as i}from\"../../../webgl/enums.js\";import{setTextures as o,getCommonUniforms as n,setUniforms as h,getColormapUniforms as l,getStretchUniforms as c,getShadedReliefUniforms as d,getUniformLocationInfos as p,getBasicGridUniforms as u}from\"../../../webgl/rasterUtils.js\";class m extends s{constructor(){super(...arguments),this._desc={lut:{vsPath:\"raster/lut\",fsPath:\"raster/lut\",attributes:new Map([[\"a_position\",0],[\"a_texcoord\",1]])},stretch:{vsPath:\"raster/stretch\",fsPath:\"raster/stretch\",attributes:new Map([[\"a_position\",0],[\"a_texcoord\",1]])},hillshade:{vsPath:\"raster/hillshade\",fsPath:\"raster/hillshade\",attributes:new Map([[\"a_position\",0],[\"a_texcoord\",1]])}},this._rendererUniformInfos=new Map}dispose(){this._quad&&this._quad.dispose()}prepareState({context:e}){e.setBlendingEnabled(!0),e.setBlendFunctionSeparate(a.ONE,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA),e.setColorMask(!0,!0,!0,!0),e.setStencilWriteMask(0),e.setStencilTestEnabled(!0)}draw(e,r){if(!t(r)||r.suspended)return;const{timeline:s,context:a,painter:o}=e;s.begin(this.name),a.setStencilFunction(i.EQUAL,r.stencilRef,255);const n=!a.capabilities.textureFloat?.textureFloatLinear;r.updateTexture(e);const h=this._getShaderVariations(r,n),l=o.materialManager.getProgram(this._desc[r.symbolizerParameters.type],h);this._drawWithProgram(e,l,r),s.end(this.name)}_drawWithProgram({context:t,requestRender:s,allowDelayedRender:a},i,p,m=1,f=[0,0],_=!1){if(this._quad||(this._quad=new r(t,[0,0,1,0,0,1,1,1])),a&&e(s)&&!i.isCompiled)return void s();const{symbolizerParameters:g,transformGrid:b,width:P,height:w,opacity:S}=p,x=g.type;t.useProgram(i);const y=this._getShaderVariations(p),M=this._getUniformInfos(x,t,i,y),{names:U,textures:j}=p.getTextures();o(t,i,U,j);const I=u(m,f),E=n(b,[P,w],[p.source.width,p.source.height],S,_);if(h(i,M,{u_coordScale:p.coordScale,u_dvsMat3:p.transforms.dvs,...I,...E}),g.colormap){const{colormap:e,colormapOffset:t}=g,r=l(e,t);h(i,M,r)}if(\"stretch\"===g.type){const e=c(g);h(i,M,e)}else if(\"hillshade\"===g.type){const e=d(g);h(i,M,e)}this._quad.draw()}_getUniformInfos(e,t,r,s){const a=s.length>0?e+\"-\"+s.join(\"-\"):e;if(this._rendererUniformInfos.has(a))return this._rendererUniformInfos.get(a);const i=p(t,r);return this._rendererUniformInfos.set(a,i),i}_getShaderVariations(e,t=!1){const r=[],{interpolation:s}=e,{type:a,colormap:i}=e.symbolizerParameters;return\"cubic\"===s?r.push(\"bicubic\"):\"bilinear\"===s&&\"stretch\"===a&&null!=i?(r.push(\"bilinear\"),r.push(\"nnedge\")):t&&\"bilinear\"===s&&r.push(\"bilinear\"),e.isRendereredSource?r.push(\"noop\"):i&&r.push(\"applyColormap\"),e.transformGrid&&(r.push(\"applyProjection\"),1===e.transformGrid.spacing[0]&&r.push(\"lookupProjection\")),r}}export{m as default};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}