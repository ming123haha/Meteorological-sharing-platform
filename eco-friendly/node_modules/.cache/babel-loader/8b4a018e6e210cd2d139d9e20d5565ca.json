{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport { c as e } from \"../../../../../../chunks/vec3f64.js\";\nimport { RgbaFloatEncoding as a } from \"../util/RgbaFloatEncoding.glsl.js\";\nimport { Float4PassUniform as s } from \"../../shaderModules/Float4PassUniform.js\";\nimport { FloatPassUniform as o } from \"../../shaderModules/FloatPassUniform.js\";\nimport { IntegerPassUniform as t } from \"../../shaderModules/IntegerPassUniform.js\";\nimport { NoParameters as i, glsl as r } from \"../../shaderModules/interfaces.js\";\nimport { Matrix4sUniform as d } from \"../../shaderModules/Matrix4sUniform.js\";\nimport { Texture2DPassUniform as l } from \"../../shaderModules/Texture2DPassUniform.js\";\nimport { BindType as p } from \"../../shaderTechnique/BindType.js\";\n\nclass n extends i {\n  constructor() {\n    super(...arguments), this.origin = e();\n  }\n\n}\n\nfunction h(e, a) {\n  a.receiveShadows && (e.fragment.uniforms.add(new d(\"shadowMapMatrix\", p.Pass, (e, a) => a.shadowMap.getShadowMapMatrices(e.origin), 4)), v(e));\n}\n\nfunction c(e, a) {\n  a.receiveShadows && (e.fragment.uniforms.add(new d(\"shadowMapMatrix\", p.Draw, (e, a) => a.shadowMap.getShadowMapMatrices(e.origin), 4)), v(e));\n}\n\nfunction v(e) {\n  const i = e.fragment;\n  i.include(a), i.uniforms.add([new l(\"shadowMapTex\", (e, a) => a.shadowMap.depthTexture), new t(\"numCascades\", (e, a) => a.shadowMap.numCascades), new s(\"cascadeDistances\", (e, a) => a.shadowMap.cascadeDistances), new o(\"depthHalfPixelSz\", (e, a) => .5 / a.shadowMap.textureSize)]), i.code.add(r`int chooseCascade(float depth, out mat4 mat) {\nvec4 distance = cascadeDistances;\nint i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;\nmat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];\nreturn i;\n}\nvec3 lightSpacePosition(vec3 _vpos, mat4 mat) {\nvec4 lv = mat * vec4(_vpos, 1.0);\nlv.xy /= lv.w;\nreturn 0.5 * lv.xyz + vec3(0.5);\n}\nvec2 cascadeCoordinates(int i, vec3 lvpos) {\nreturn vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;\n}\nfloat readShadowMapDepth(vec2 uv, sampler2D _depthTex) {\nreturn rgba2float(texture2D(_depthTex, uv));\n}\nfloat posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {\nreturn readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;\n}\nfloat filterShadow(vec2 uv, vec3 lvpos, float halfPixelSize, sampler2D _depthTex) {\nfloat texSize = 0.5 / halfPixelSize;\nvec2 st = fract((vec2(halfPixelSize) + uv) * texSize);\nfloat s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);\nfloat s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);\nfloat s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);\nfloat s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);\nreturn mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);\n}\nfloat readShadowMap(const in vec3 _vpos, float _linearDepth) {\nmat4 mat;\nint i = chooseCascade(_linearDepth, mat);\nif (i >= numCascades) { return 0.0; }\nvec3 lvpos = lightSpacePosition(_vpos, mat);\nif (lvpos.z >= 1.0) { return 0.0; }\nif (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }\nvec2 uv = cascadeCoordinates(i, lvpos);\nreturn filterShadow(uv, lvpos, depthHalfPixelSz, shadowMapTex);\n}`);\n}\n\nexport { n as ReadShadowMapBindParameters, c as ReadShadowMapDraw, h as ReadShadowMapPass };","map":{"version":3,"names":["c","e","RgbaFloatEncoding","a","Float4PassUniform","s","FloatPassUniform","o","IntegerPassUniform","t","NoParameters","i","glsl","r","Matrix4sUniform","d","Texture2DPassUniform","l","BindType","p","n","constructor","arguments","origin","h","receiveShadows","fragment","uniforms","add","Pass","shadowMap","getShadowMapMatrices","v","Draw","include","depthTexture","numCascades","cascadeDistances","textureSize","code","ReadShadowMapBindParameters","ReadShadowMapDraw","ReadShadowMapPass"],"sources":["C:/Users/hp/Desktop/eco-friendly atmosphere/Atmosphere/eco-friendly/node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport{c as e}from\"../../../../../../chunks/vec3f64.js\";import{RgbaFloatEncoding as a}from\"../util/RgbaFloatEncoding.glsl.js\";import{Float4PassUniform as s}from\"../../shaderModules/Float4PassUniform.js\";import{FloatPassUniform as o}from\"../../shaderModules/FloatPassUniform.js\";import{IntegerPassUniform as t}from\"../../shaderModules/IntegerPassUniform.js\";import{NoParameters as i,glsl as r}from\"../../shaderModules/interfaces.js\";import{Matrix4sUniform as d}from\"../../shaderModules/Matrix4sUniform.js\";import{Texture2DPassUniform as l}from\"../../shaderModules/Texture2DPassUniform.js\";import{BindType as p}from\"../../shaderTechnique/BindType.js\";class n extends i{constructor(){super(...arguments),this.origin=e()}}function h(e,a){a.receiveShadows&&(e.fragment.uniforms.add(new d(\"shadowMapMatrix\",p.Pass,((e,a)=>a.shadowMap.getShadowMapMatrices(e.origin)),4)),v(e))}function c(e,a){a.receiveShadows&&(e.fragment.uniforms.add(new d(\"shadowMapMatrix\",p.Draw,((e,a)=>a.shadowMap.getShadowMapMatrices(e.origin)),4)),v(e))}function v(e){const i=e.fragment;i.include(a),i.uniforms.add([new l(\"shadowMapTex\",((e,a)=>a.shadowMap.depthTexture)),new t(\"numCascades\",((e,a)=>a.shadowMap.numCascades)),new s(\"cascadeDistances\",((e,a)=>a.shadowMap.cascadeDistances)),new o(\"depthHalfPixelSz\",((e,a)=>.5/a.shadowMap.textureSize))]),i.code.add(r`int chooseCascade(float depth, out mat4 mat) {\nvec4 distance = cascadeDistances;\nint i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;\nmat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];\nreturn i;\n}\nvec3 lightSpacePosition(vec3 _vpos, mat4 mat) {\nvec4 lv = mat * vec4(_vpos, 1.0);\nlv.xy /= lv.w;\nreturn 0.5 * lv.xyz + vec3(0.5);\n}\nvec2 cascadeCoordinates(int i, vec3 lvpos) {\nreturn vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;\n}\nfloat readShadowMapDepth(vec2 uv, sampler2D _depthTex) {\nreturn rgba2float(texture2D(_depthTex, uv));\n}\nfloat posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {\nreturn readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;\n}\nfloat filterShadow(vec2 uv, vec3 lvpos, float halfPixelSize, sampler2D _depthTex) {\nfloat texSize = 0.5 / halfPixelSize;\nvec2 st = fract((vec2(halfPixelSize) + uv) * texSize);\nfloat s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);\nfloat s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);\nfloat s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);\nfloat s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);\nreturn mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);\n}\nfloat readShadowMap(const in vec3 _vpos, float _linearDepth) {\nmat4 mat;\nint i = chooseCascade(_linearDepth, mat);\nif (i >= numCascades) { return 0.0; }\nvec3 lvpos = lightSpacePosition(_vpos, mat);\nif (lvpos.z >= 1.0) { return 0.0; }\nif (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }\nvec2 uv = cascadeCoordinates(i, lvpos);\nreturn filterShadow(uv, lvpos, depthHalfPixelSz, shadowMapTex);\n}`)}export{n as ReadShadowMapBindParameters,c as ReadShadowMapDraw,h as ReadShadowMapPass};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}