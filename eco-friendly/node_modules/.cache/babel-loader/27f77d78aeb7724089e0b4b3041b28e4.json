{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport { addFrameTask as e } from \"../../../core/scheduling.js\";\nimport t from \"./GamepadInputDevice.js\";\nimport { extractState as s, stateIdle as i, stateEqual as n } from \"./GamepadState.js\";\n\nclass a {\n  constructor(e, t) {\n    this._element = e, this._input = t, this._hasEventListeners = !1, this._onConnectGamepad = e => {\n      this._connectGamepad(e.gamepad);\n    }, this._onDisconnectGamepad = e => {\n      const t = e.gamepad,\n            i = t.index,\n            n = this._inputDevices[i];\n      n && (this._emitGamepadEvent(t, s(n), !1), this._inputDevices.splice(i, 1), this._latestUpdate.splice(i, 1), this._input.gamepad.devices.remove(n), this.ensurePollingState());\n    }, this._frameTask = null, this._latestUpdate = new Array(), this._inputDevices = new Array(), this._callback = null;\n    const i = (\"getGamepads\" in window.navigator),\n          n = window.isSecureContext;\n    this.supported = i && n, this.supported && (this._forEachGamepad(e => this._connectGamepad(e)), window.addEventListener(\"gamepadconnected\", this._onConnectGamepad), window.addEventListener(\"gamepaddisconnected\", this._onDisconnectGamepad), this.ensurePollingState());\n  }\n\n  destroy() {\n    this.hasEventListeners = !1, this.supported && (window.removeEventListener(\"gamepadconnected\", this._onConnectGamepad), window.removeEventListener(\"gamepaddisconnected\", this._onDisconnectGamepad));\n  }\n\n  set hasEventListeners(e) {\n    this._hasEventListeners !== e && (this._hasEventListeners = e, this.ensurePollingState());\n  }\n\n  get _eventsEnabled() {\n    return this.supported && this._inputDevices.length > 0 && this._hasEventListeners;\n  }\n\n  set onEvent(e) {\n    this._callback = e;\n  }\n\n  _connectGamepad(e) {\n    const s = new t(e);\n    \"unknown\" !== s.deviceType && (this._inputDevices[e.index] = s, this._input.gamepad.devices.add(s)), this.ensurePollingState();\n  }\n\n  ensurePollingState() {\n    this._eventsEnabled ? this._startPolling() : this._stopPolling();\n  }\n\n  _startPolling() {\n    null == this._frameTask && (this._frameTask = e({\n      update: () => this._readGamepadState()\n    }));\n  }\n\n  _stopPolling() {\n    null != this._frameTask && (this._frameTask.remove(), this._frameTask = null, this._latestUpdate = new Array());\n  }\n\n  _readGamepadState() {\n    const e = document.hasFocus(),\n          t = this._element.contains(document.activeElement),\n          a = \"document\" === this._input.gamepad.enabledFocusMode && !e || \"view\" === this._input.gamepad.enabledFocusMode && !t;\n\n    this._forEachGamepad(e => {\n      const t = this._inputDevices[e.index];\n      if (!t) return;\n      const d = this._latestUpdate[e.index],\n            o = s(t),\n            r = a || i(o);\n\n      if (d) {\n        if (d.timestamp === e.timestamp) return;\n        if (!d.active && r) return;\n        if (n(d.state, o)) return;\n      }\n\n      this._emitGamepadEvent(e, o, !r);\n    });\n  }\n\n  _forEachGamepad(e) {\n    const t = window.navigator.getGamepads();\n\n    for (let s = 0; s < t.length; s++) {\n      const i = t[s];\n      this._validate(i) && e(i);\n    }\n  }\n\n  _emitGamepadEvent(e, t, s) {\n    const i = this._latestUpdate[e.index],\n          n = i && i.active;\n    if (!n && !s) return;\n    const a = !n && s ? \"start\" : n && s ? \"update\" : \"end\";\n    this._latestUpdate[e.index] = {\n      timestamp: e.timestamp,\n      state: t,\n      active: s\n    }, this._callback && this._callback({\n      device: this._inputDevices[e.index],\n      state: t,\n      action: a\n    });\n  }\n\n  _validate(e) {\n    if (!e) return !1;\n    if (!e.connected) return !1;\n\n    for (let t = 0; t < e.axes.length; t++) if (isNaN(e.axes[t])) return !1;\n\n    return !0;\n  }\n\n}\n\nexport { a as GamepadSource };","map":{"version":3,"names":["addFrameTask","e","t","extractState","s","stateIdle","i","stateEqual","n","a","constructor","_element","_input","_hasEventListeners","_onConnectGamepad","_connectGamepad","gamepad","_onDisconnectGamepad","index","_inputDevices","_emitGamepadEvent","splice","_latestUpdate","devices","remove","ensurePollingState","_frameTask","Array","_callback","window","navigator","isSecureContext","supported","_forEachGamepad","addEventListener","destroy","hasEventListeners","removeEventListener","_eventsEnabled","length","onEvent","deviceType","add","_startPolling","_stopPolling","update","_readGamepadState","document","hasFocus","contains","activeElement","enabledFocusMode","d","o","r","timestamp","active","state","getGamepads","_validate","device","action","connected","axes","isNaN","GamepadSource"],"sources":["E:/各个学科/论文/毕业论文/Atmosphere/eco-friendly/node_modules/@arcgis/core/views/input/gamepad/GamepadSource.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{addFrameTask as e}from\"../../../core/scheduling.js\";import t from\"./GamepadInputDevice.js\";import{extractState as s,stateIdle as i,stateEqual as n}from\"./GamepadState.js\";class a{constructor(e,t){this._element=e,this._input=t,this._hasEventListeners=!1,this._onConnectGamepad=e=>{this._connectGamepad(e.gamepad)},this._onDisconnectGamepad=e=>{const t=e.gamepad,i=t.index,n=this._inputDevices[i];n&&(this._emitGamepadEvent(t,s(n),!1),this._inputDevices.splice(i,1),this._latestUpdate.splice(i,1),this._input.gamepad.devices.remove(n),this.ensurePollingState())},this._frameTask=null,this._latestUpdate=new Array,this._inputDevices=new Array,this._callback=null;const i=\"getGamepads\"in window.navigator,n=window.isSecureContext;this.supported=i&&n,this.supported&&(this._forEachGamepad((e=>this._connectGamepad(e))),window.addEventListener(\"gamepadconnected\",this._onConnectGamepad),window.addEventListener(\"gamepaddisconnected\",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener(\"gamepadconnected\",this._onConnectGamepad),window.removeEventListener(\"gamepaddisconnected\",this._onDisconnectGamepad))}set hasEventListeners(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&this._inputDevices.length>0&&this._hasEventListeners}set onEvent(e){this._callback=e}_connectGamepad(e){const s=new t(e);\"unknown\"!==s.deviceType&&(this._inputDevices[e.index]=s,this._input.gamepad.devices.add(s)),this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){null==this._frameTask&&(this._frameTask=e({update:()=>this._readGamepadState()}))}_stopPolling(){null!=this._frameTask&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=new Array)}_readGamepadState(){const e=document.hasFocus(),t=this._element.contains(document.activeElement),a=\"document\"===this._input.gamepad.enabledFocusMode&&!e||\"view\"===this._input.gamepad.enabledFocusMode&&!t;this._forEachGamepad((e=>{const t=this._inputDevices[e.index];if(!t)return;const d=this._latestUpdate[e.index],o=s(t),r=a||i(o);if(d){if(d.timestamp===e.timestamp)return;if(!d.active&&r)return;if(n(d.state,o))return}this._emitGamepadEvent(e,o,!r)}))}_forEachGamepad(e){const t=window.navigator.getGamepads();for(let s=0;s<t.length;s++){const i=t[s];this._validate(i)&&e(i)}}_emitGamepadEvent(e,t,s){const i=this._latestUpdate[e.index],n=i&&i.active;if(!n&&!s)return;const a=!n&&s?\"start\":n&&s?\"update\":\"end\";this._latestUpdate[e.index]={timestamp:e.timestamp,state:t,active:s},this._callback&&this._callback({device:this._inputDevices[e.index],state:t,action:a})}_validate(e){if(!e)return!1;if(!e.connected)return!1;for(let t=0;t<e.axes.length;t++)if(isNaN(e.axes[t]))return!1;return!0}}export{a as GamepadSource};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}