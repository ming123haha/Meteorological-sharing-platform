{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport { _ as t } from \"../../../chunks/tslib.es6.js\";\nimport \"../../../geometry.js\";\nimport e from \"../../../core/Error.js\";\nimport { isSome as s } from \"../../../core/maybe.js\";\nimport { eachAlways as r } from \"../../../core/promiseUtils.js\";\nimport { property as i } from \"../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../core/arrayUtils.js\";\nimport \"../../../core/accessorSupport/ensureType.js\";\nimport { subclass as o } from \"../../../core/accessorSupport/decorators/subclass.js\";\nimport a from \"../RasterInfo.js\";\nimport m from \"./BaseRaster.js\";\nimport { split as n } from \"../rasterFunctions/pixelUtils.js\";\nimport { estimateStatisticsHistograms as l } from \"../rasterFunctions/stretchUtils.js\";\nimport p from \"../../../geometry/Extent.js\";\nimport c from \"../../../geometry/SpatialReference.js\";\nlet h = class extends m {\n  constructor() {\n    super(...arguments), this.datasetFormat = \"MEMORY\", this.data = null;\n  }\n\n  async open(t) {\n    await this.init();\n    const e = this.data,\n          {\n      pixelBlock: s,\n      statistics: r,\n      histograms: i,\n      name: o,\n      keyProperties: m,\n      nativeExtent: n,\n      transform: l\n    } = this.data,\n          {\n      width: h,\n      height: f,\n      pixelType: d\n    } = s,\n          u = e.extent ?? new p({\n      xmin: -.5,\n      ymin: .5,\n      xmax: h - .5,\n      ymax: f - .5,\n      spatialReference: new c({\n        wkid: 3857\n      })\n    }),\n          y = e.isPseudoSpatialReference ?? !e.extent,\n          x = {\n      x: u.width / h,\n      y: u.height / f\n    },\n          g = new a({\n      width: h,\n      height: f,\n      pixelType: d,\n      extent: u,\n      nativeExtent: n,\n      transform: l,\n      pixelSize: x,\n      spatialReference: u.spatialReference,\n      bandCount: 3,\n      keyProperties: m || {},\n      statistics: r,\n      isPseudoSpatialReference: y,\n      histograms: i\n    });\n    this.createRemoteDatasetStorageInfo(g, 512, 512), this._set(\"rasterInfo\", g), this.updateTileInfo(), await this._buildInMemoryRaster(s, {\n      width: 512,\n      height: 512\n    }, t), this.datasetName = o, this.url = \"/InMemory/\" + o;\n  }\n\n  fetchRawTile(t, e, s, r = {}) {\n    const i = this._pixelBlockTiles.get(`${t}/${e}/${s}`);\n\n    return Promise.resolve(i);\n  }\n\n  async _buildInMemoryRaster(t, i, o) {\n    const a = this.rasterInfo.storageInfo.maximumPyramidLevel,\n          m = this.rasterJobHandler ? this.rasterJobHandler.split({\n      pixelBlock: t,\n      tileSize: i,\n      maximumPyramidLevel: a\n    }, o) : Promise.resolve(n(t, i, a)),\n          p = s(this.rasterInfo.statistics),\n          c = s(this.rasterInfo.histograms),\n          h = p ? Promise.resolve({\n      statistics: null,\n      histograms: null\n    }) : this.rasterJobHandler ? this.rasterJobHandler.estimateStatisticsHistograms({\n      pixelBlock: t\n    }, o) : Promise.resolve(l(t)),\n          f = await r([m, h]);\n    if (!f[0].value && f[1].value) throw new e(\"inmemory-raster:open\", \"failed to build in memory raster\");\n    this._pixelBlockTiles = f[0].value, p || (this.rasterInfo.statistics = f[1].value?.statistics), c || (this.rasterInfo.histograms = f[1].value?.histograms);\n  }\n\n};\nt([i({\n  type: String,\n  json: {\n    write: !0\n  }\n})], h.prototype, \"datasetFormat\", void 0), t([i()], h.prototype, \"data\", void 0), h = t([o(\"esri.layers.support.rasterDatasets.InMemoryRaster\")], h);\nconst f = h;\nexport { f as default };","map":{"version":3,"names":["_","t","e","isSome","s","eachAlways","r","property","i","subclass","o","a","m","split","n","estimateStatisticsHistograms","l","p","c","h","constructor","arguments","datasetFormat","data","open","init","pixelBlock","statistics","histograms","name","keyProperties","nativeExtent","transform","width","height","f","pixelType","d","u","extent","xmin","ymin","xmax","ymax","spatialReference","wkid","y","isPseudoSpatialReference","x","g","pixelSize","bandCount","createRemoteDatasetStorageInfo","_set","updateTileInfo","_buildInMemoryRaster","datasetName","url","fetchRawTile","_pixelBlockTiles","get","Promise","resolve","rasterInfo","storageInfo","maximumPyramidLevel","rasterJobHandler","tileSize","value","type","String","json","write","prototype","default"],"sources":["E:/各个学科/论文/毕业论文/Atmosphere/eco-friendly/node_modules/@arcgis/core/layers/support/rasterDatasets/InMemoryRaster.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../../chunks/tslib.es6.js\";import\"../../../geometry.js\";import e from\"../../../core/Error.js\";import{isSome as s}from\"../../../core/maybe.js\";import{eachAlways as r}from\"../../../core/promiseUtils.js\";import{property as i}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/arrayUtils.js\";import\"../../../core/accessorSupport/ensureType.js\";import{subclass as o}from\"../../../core/accessorSupport/decorators/subclass.js\";import a from\"../RasterInfo.js\";import m from\"./BaseRaster.js\";import{split as n}from\"../rasterFunctions/pixelUtils.js\";import{estimateStatisticsHistograms as l}from\"../rasterFunctions/stretchUtils.js\";import p from\"../../../geometry/Extent.js\";import c from\"../../../geometry/SpatialReference.js\";let h=class extends m{constructor(){super(...arguments),this.datasetFormat=\"MEMORY\",this.data=null}async open(t){await this.init();const e=this.data,{pixelBlock:s,statistics:r,histograms:i,name:o,keyProperties:m,nativeExtent:n,transform:l}=this.data,{width:h,height:f,pixelType:d}=s,u=e.extent??new p({xmin:-.5,ymin:.5,xmax:h-.5,ymax:f-.5,spatialReference:new c({wkid:3857})}),y=e.isPseudoSpatialReference??!e.extent,x={x:u.width/h,y:u.height/f},g=new a({width:h,height:f,pixelType:d,extent:u,nativeExtent:n,transform:l,pixelSize:x,spatialReference:u.spatialReference,bandCount:3,keyProperties:m||{},statistics:r,isPseudoSpatialReference:y,histograms:i});this.createRemoteDatasetStorageInfo(g,512,512),this._set(\"rasterInfo\",g),this.updateTileInfo(),await this._buildInMemoryRaster(s,{width:512,height:512},t),this.datasetName=o,this.url=\"/InMemory/\"+o}fetchRawTile(t,e,s,r={}){const i=this._pixelBlockTiles.get(`${t}/${e}/${s}`);return Promise.resolve(i)}async _buildInMemoryRaster(t,i,o){const a=this.rasterInfo.storageInfo.maximumPyramidLevel,m=this.rasterJobHandler?this.rasterJobHandler.split({pixelBlock:t,tileSize:i,maximumPyramidLevel:a},o):Promise.resolve(n(t,i,a)),p=s(this.rasterInfo.statistics),c=s(this.rasterInfo.histograms),h=p?Promise.resolve({statistics:null,histograms:null}):this.rasterJobHandler?this.rasterJobHandler.estimateStatisticsHistograms({pixelBlock:t},o):Promise.resolve(l(t)),f=await r([m,h]);if(!f[0].value&&f[1].value)throw new e(\"inmemory-raster:open\",\"failed to build in memory raster\");this._pixelBlockTiles=f[0].value,p||(this.rasterInfo.statistics=f[1].value?.statistics),c||(this.rasterInfo.histograms=f[1].value?.histograms)}};t([i({type:String,json:{write:!0}})],h.prototype,\"datasetFormat\",void 0),t([i()],h.prototype,\"data\",void 0),h=t([o(\"esri.layers.support.rasterDatasets.InMemoryRaster\")],h);const f=h;export{f as default};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}