{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport e from \"../../../../../core/Error.js\";\nimport t from \"../../../../../core/Logger.js\";\nimport { isSome as r } from \"../../../../../core/maybe.js\";\nimport { isAbortError as a, throwIfAborted as s, throwIfNotAbortError as i } from \"../../../../../core/promiseUtils.js\";\nimport { BaseFeatureSource as o } from \"./BaseFeatureSource.js\";\nconst n = t.getLogger(\"esri.views.2d.layers.features.sources.FeatureSource\");\n\nclass d extends o {\n  constructor(e) {\n    super(e);\n  }\n\n  async _fetchDataTile(t) {\n    const r = 6,\n          i = 20,\n          o = this._subscriptions.get(t.key.id);\n\n    let d = !1,\n        c = 0,\n        u = 0;\n\n    const p = (e, r) => {\n      u--, s(o);\n      const a = t.id,\n            i = e.reader,\n            n = e.query;\n\n      if (!i.exceededTransferLimit) {\n        if (d = !0, 0 !== r && !i.hasFeatures) {\n          const e = {\n            id: a,\n            addOrUpdate: i,\n            end: 0 === u,\n            type: \"append\"\n          };\n          return o.add({\n            message: e,\n            query: n\n          }), void this._onMessage(e);\n        }\n\n        const e = {\n          id: a,\n          addOrUpdate: i,\n          end: 0 === u,\n          type: \"append\"\n        };\n        return o.add({\n          message: e,\n          query: n\n        }), void this._onMessage(e);\n      }\n\n      const c = {\n        id: a,\n        addOrUpdate: i,\n        end: d && 0 === u,\n        type: \"append\"\n      };\n      o.add({\n        message: c,\n        query: n\n      }), this._onMessage(c);\n    };\n\n    let h = 0,\n        m = 0;\n\n    for (; !d && m++ < i;) {\n      let i;\n\n      for (let r = 0; r < h + 1; r++) {\n        const r = c++;\n        u++, i = this._fetchDataTilePage(t, r, o).then(e => e && p(e, r)).catch(r => {\n          d = !0, a(r) || (n.error(new e(\"mapview-query-error\", \"Encountered error when fetching tile\", {\n            tile: t,\n            error: r\n          })), this._onMessage({\n            id: t.id,\n            addOrUpdate: null,\n            end: d,\n            type: \"append\"\n          }));\n        });\n      }\n\n      await i, s(o), h = Math.min(h + 2, r);\n    }\n  }\n\n  async _fetchDataTilePage(e, t, a) {\n    s(a);\n    const o = this._queryInfo,\n          n = {\n      start: this.pageSize * t,\n      num: this.pageSize,\n      returnExceededLimitFeatures: !0,\n      quantizationParameters: e.getQuantizationParameters()\n    };\n    r(this.maxRecordCountFactor) && (n.maxRecordCountFactor = this.maxRecordCountFactor);\n    const d = this.createTileQuery(e, n);\n\n    try {\n      const r = a.signal,\n            i = await this._queue.push({\n        tile: e,\n        query: d,\n        signal: r,\n        depth: t\n      });\n      return s(a), i ? o !== this._queryInfo ? this._fetchDataTilePage(e, t, a) : {\n        reader: i,\n        query: d\n      } : null;\n    } catch (c) {\n      return i(c), null;\n    }\n  }\n\n}\n\nexport { d as PagedFeatureSource };","map":{"version":3,"names":["e","t","isSome","r","isAbortError","a","throwIfAborted","s","throwIfNotAbortError","i","BaseFeatureSource","o","n","getLogger","d","constructor","_fetchDataTile","_subscriptions","get","key","id","c","u","p","reader","query","exceededTransferLimit","hasFeatures","addOrUpdate","end","type","add","message","_onMessage","h","m","_fetchDataTilePage","then","catch","error","tile","Math","min","_queryInfo","start","pageSize","num","returnExceededLimitFeatures","quantizationParameters","getQuantizationParameters","maxRecordCountFactor","createTileQuery","signal","_queue","push","depth","PagedFeatureSource"],"sources":["C:/Users/hp/Desktop/eco-friendly atmosphere/Atmosphere/eco-friendly/node_modules/@arcgis/core/views/2d/layers/features/sources/PagedFeatureSource.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport e from\"../../../../../core/Error.js\";import t from\"../../../../../core/Logger.js\";import{isSome as r}from\"../../../../../core/maybe.js\";import{isAbortError as a,throwIfAborted as s,throwIfNotAbortError as i}from\"../../../../../core/promiseUtils.js\";import{BaseFeatureSource as o}from\"./BaseFeatureSource.js\";const n=t.getLogger(\"esri.views.2d.layers.features.sources.FeatureSource\");class d extends o{constructor(e){super(e)}async _fetchDataTile(t){const r=6,i=20,o=this._subscriptions.get(t.key.id);let d=!1,c=0,u=0;const p=(e,r)=>{u--,s(o);const a=t.id,i=e.reader,n=e.query;if(!i.exceededTransferLimit){if(d=!0,0!==r&&!i.hasFeatures){const e={id:a,addOrUpdate:i,end:0===u,type:\"append\"};return o.add({message:e,query:n}),void this._onMessage(e)}const e={id:a,addOrUpdate:i,end:0===u,type:\"append\"};return o.add({message:e,query:n}),void this._onMessage(e)}const c={id:a,addOrUpdate:i,end:d&&0===u,type:\"append\"};o.add({message:c,query:n}),this._onMessage(c)};let h=0,m=0;for(;!d&&m++<i;){let i;for(let r=0;r<h+1;r++){const r=c++;u++,i=this._fetchDataTilePage(t,r,o).then((e=>e&&p(e,r))).catch((r=>{d=!0,a(r)||(n.error(new e(\"mapview-query-error\",\"Encountered error when fetching tile\",{tile:t,error:r})),this._onMessage({id:t.id,addOrUpdate:null,end:d,type:\"append\"}))}))}await i,s(o),h=Math.min(h+2,r)}}async _fetchDataTilePage(e,t,a){s(a);const o=this._queryInfo,n={start:this.pageSize*t,num:this.pageSize,returnExceededLimitFeatures:!0,quantizationParameters:e.getQuantizationParameters()};r(this.maxRecordCountFactor)&&(n.maxRecordCountFactor=this.maxRecordCountFactor);const d=this.createTileQuery(e,n);try{const r=a.signal,i=await this._queue.push({tile:e,query:d,signal:r,depth:t});return s(a),i?o!==this._queryInfo?this._fetchDataTilePage(e,t,a):{reader:i,query:d}:null}catch(c){return i(c),null}}}export{d as PagedFeatureSource};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}