{"ast":null,"code":"import \"core-js/modules/es.error.cause.js\";\n\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../../../chunks/tslib.es6.js\";\nimport { equals as t } from \"../../../../../core/arrayUtils.js\";\nimport { AsyncSequence as i } from \"../../../../../core/AsyncSequence.js\";\nimport { createTask as s } from \"../../../../../core/asyncUtils.js\";\nimport { HandleOwner as r } from \"../../../../../core/HandleOwner.js\";\nimport { makeHandle as o } from \"../../../../../core/handleUtils.js\";\nimport n from \"../../../../../core/Logger.js\";\nimport { isSome as a, isNone as l, unwrap as u } from \"../../../../../core/maybe.js\";\nimport { throwIfAbortError as c } from \"../../../../../core/promiseUtils.js\";\nimport { sync as d } from \"../../../../../core/reactiveUtils.js\";\nimport { property as h } from \"../../../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../../../core/accessorSupport/ensureType.js\";\nimport { subclass as p } from \"../../../../../core/accessorSupport/decorators/subclass.js\";\nimport f from \"../../../../../geometry/Extent.js\";\nimport { toExtent as y } from \"../../../../../geometry/support/aaBoundingRect.js\";\nimport { unquantizeOptimizedFeatureSet as g, convertFromFeatureSet as m } from \"../../../../../layers/graphics/featureConversionUtils.js\";\nimport { isHostedAgolService as _ } from \"../../../../../layers/support/arcgisLayerUrl.js\";\nimport { OptimizedFeatureSetParserContext as b } from \"../../../../../rest/query/operations/pbfOptimizedFeatureSet.js\";\nimport { executeQueryForExtent as F, executeQueryPBF as T, executeQuery as P } from \"../../../../../rest/query/operations/query.js\";\nimport I from \"../../../../../rest/support/Query.js\";\nimport { StateType as v, PendingFeatureTile as O } from \"./PendingFeatureTile.js\";\nlet C = class extends r {\n  constructor(e) {\n    super(e), this.tilesOfInterest = [], this.availability = 0, this._pendingTiles = new Map(), this._pendingEdits = new i(), this._pendingEditsAbortController = new AbortController();\n  }\n\n  get _minimumVerticesPerFeature() {\n    switch (this.store?.featureStore.geometryType) {\n      case \"esriGeometryPoint\":\n      case \"esriGeometryMultipoint\":\n        return 1;\n\n      case \"esriGeometryPolygon\":\n        return 4;\n\n      case \"esriGeometryPolyline\":\n        return 2;\n    }\n  }\n\n  set filter(e) {\n    const t = this._get(\"filter\"),\n          i = this._filterProperties(e);\n\n    JSON.stringify(t) !== JSON.stringify(i) && this._set(\"filter\", i);\n  }\n\n  set customParameters(e) {\n    const t = this._get(\"customParameters\");\n\n    JSON.stringify(t) !== JSON.stringify(e) && this._set(\"customParameters\", e);\n  }\n\n  get _configuration() {\n    return {\n      filter: this.filter,\n      customParameters: this.customParameters,\n      tileInfo: this.tileInfo,\n      tileSize: this.tileSize\n    };\n  }\n\n  set tileInfo(e) {\n    const t = this._get(\"tileInfo\");\n\n    t !== e && (a(e) && a(t) && JSON.stringify(e) === JSON.stringify(t) || (this._set(\"tileInfo\", e), this.store.tileInfo = e));\n  }\n\n  set tileSize(e) {\n    this._get(\"tileSize\") !== e && this._set(\"tileSize\", e);\n  }\n\n  get updating() {\n    return this.updatingExcludingEdits || this._pendingEdits.updating;\n  }\n\n  get updatingExcludingEdits() {\n    return this.updatingHandles.updating;\n  }\n\n  get hasZ() {\n    return this.store.featureStore.hasZ;\n  }\n\n  initialize() {\n    this._initializeFetchExtent(), this.updatingHandles.add(() => this._configuration, () => this.refresh()), this.updatingHandles.add(() => this.tilesOfInterest, (e, i) => {\n      t(e, i, ({\n        id: e\n      }, {\n        id: t\n      }) => e === t) || this._process();\n    }, d);\n  }\n\n  destroy() {\n    this._pendingTiles.forEach(e => this._deletePendingTile(e)), this._pendingTiles.clear(), this.store.destroy(), this.tilesOfInterest.length = 0, this._pendingEditsAbortController.abort(), this._pendingEditsAbortController = null;\n  }\n\n  refresh() {\n    this.store.refresh(), this._pendingTiles.forEach(e => this._deletePendingTile(e)), this._process();\n  }\n\n  applyEdits(e) {\n    this._pendingEdits.push(e, async e => {\n      if (0 === e.addedFeatures.length && 0 === e.updatedFeatures.length && 0 === e.deletedFeatures.length) return;\n\n      for (const [, i] of this._pendingTiles) i.reset();\n\n      const t = { ...e,\n        deletedFeatures: e.deletedFeatures.map(({\n          objectId: e,\n          globalId: t\n        }) => e && -1 !== e ? e : this._lookupObjectIdByGlobalId(t))\n      };\n      await this.updatingHandles.addPromise(this.store.processEdits(t, (e, t) => this._queryFeaturesById(e, t), this._pendingEditsAbortController.signal)), this._processPendingTiles();\n    });\n  }\n\n  _initializeFetchExtent() {\n    if (!this.capabilities.query.supportsExtent || !_(this.url)) return;\n    const e = s(async e => {\n      try {\n        const t = await F(this.url, new I({\n          where: \"1=1\",\n          outSpatialReference: this.spatialReference,\n          cacheHint: !!this.capabilities.query.supportsCacheHint || void 0\n        }), {\n          query: this._configuration.customParameters,\n          signal: e\n        });\n        this.store.extent = f.fromJSON(t.data?.extent);\n      } catch (t) {\n        c(t), n.getLogger(this.declaredClass).warn(\"Failed to fetch data extent\", t);\n      }\n    });\n    this.updatingHandles.addPromise(e.promise.then(() => this._process())), this.handles.add(o(() => e.abort()));\n  }\n\n  get debugInfo() {\n    return {\n      numberOfFeatures: this.store.featureStore.numFeatures,\n      tilesOfInterest: this.tilesOfInterest,\n      pendingTiles: Array.from(this._pendingTiles.values()).map(e => e.debugInfo),\n      storedTiles: this.store.debugInfo\n    };\n  }\n\n  _process() {\n    this._markTilesNotAlive(), this._createPendingTiles(), this._deletePendingTiles(), this._processPendingTiles();\n  }\n\n  _markTilesNotAlive() {\n    for (const [, e] of this._pendingTiles) e.alive = !1;\n  }\n\n  _createPendingTiles() {\n    const e = this._collectMissingTilesInfo();\n\n    if (this._setAvailability(l(e) ? 1 : e.coveredArea / e.fullArea), !l(e)) for (const {\n      data: t,\n      resolution: i\n    } of e.missingTiles) {\n      const e = this._pendingTiles.get(t.id);\n\n      e ? (e.resolution = i, e.alive = !0) : this._createPendingTile(t, i);\n    }\n  }\n\n  _collectMissingTilesInfo() {\n    let e = null;\n\n    for (let t = this.tilesOfInterest.length - 1; t >= 0; t--) {\n      const i = this.tilesOfInterest[t],\n            s = this.store.process(i, (e, t) => this._verifyTileComplexity(e, t));\n      l(e) ? e = s : e.prepend(s);\n    }\n\n    return e;\n  }\n\n  _deletePendingTiles() {\n    for (const [, e] of this._pendingTiles) e.alive || this._deletePendingTile(e);\n  }\n\n  _processPendingTiles() {\n    const e = {\n      fetchCount: (e, t) => this._fetchCount(e, t),\n      fetchFeatures: (e, t, i) => this._fetchFeatures(e, t, i),\n      finish: (e, t) => this._finishPendingTile(e, t),\n      resume: () => this._processPendingTiles()\n    };\n    if (this._ensureFetchAllCounts(e)) for (const [, t] of this._pendingTiles) this._verifyTileComplexity(this.store.getFeatureCount(t.data), t.resolution) && this.updatingHandles.addPromise(t.process(e));\n  }\n\n  _verifyTileComplexity(e, t) {\n    return this._verifyVertexComplexity(e) && this._verifyFeatureDensity(e, t);\n  }\n\n  _verifyVertexComplexity(e) {\n    return e * this._minimumVerticesPerFeature < x;\n  }\n\n  _verifyFeatureDensity(e, t) {\n    if (l(this.tileInfo)) return !1;\n    const i = this.tileSize * t;\n    return e * (j / (i * i)) < w;\n  }\n\n  _ensureFetchAllCounts(e) {\n    let t = !0;\n\n    for (const [, i] of this._pendingTiles) i.state.type < v.FETCHED_COUNT && this.updatingHandles.addPromise(i.process(e)), i.state.type <= v.FETCH_COUNT && (t = !1);\n\n    return t;\n  }\n\n  _finishPendingTile(e, t) {\n    this.store.add(e.data, t), this._deletePendingTile(e), this._updateAvailability();\n  }\n\n  _updateAvailability() {\n    const e = this._collectMissingTilesInfo();\n\n    this._setAvailability(l(e) ? 1 : e.coveredArea / e.fullArea);\n  }\n\n  _setAvailability(e) {\n    this._set(\"availability\", e);\n  }\n\n  _createPendingTile(e, t) {\n    const i = new O(e, t);\n    return this._pendingTiles.set(e.id, i), i;\n  }\n\n  _deletePendingTile(e) {\n    e.reset(), this._pendingTiles.delete(e.data.id);\n  }\n\n  async _fetchCount(e, t) {\n    return this.store.fetchCount(e.data, this.url, this._createCountQuery(e), {\n      query: this.customParameters,\n      timeout: S,\n      signal: t\n    });\n  }\n\n  async _fetchFeatures(e, t, i) {\n    let s,\n        r = 0,\n        o = 0,\n        n = t;\n\n    for (;;) {\n      const a = this._createFeaturesQuery(e),\n            l = this._setPagingParameters(a, r, n),\n            {\n        features: c,\n        exceededTransferLimit: d\n      } = await this._queryFeatures(a, i);\n\n      if (l && (r += u(a.num)), o += c.length, s = s ? s.concat(c) : c, n = t - o, !l || !d || n <= 0) return s;\n    }\n  }\n\n  _filterProperties(e) {\n    return l(e) ? {\n      where: \"1=1\",\n      gdbVersion: void 0,\n      timeExtent: void 0\n    } : {\n      where: e.where || \"1=1\",\n      timeExtent: e.timeExtent,\n      gdbVersion: e.gdbVersion\n    };\n  }\n\n  _lookupObjectIdByGlobalId(e) {\n    const t = this.globalIdField,\n          i = this.objectIdField;\n    if (l(t)) throw new Error(\"Expected globalIdField to be defined\");\n    let s = null;\n    if (this.store.featureStore.forEach(r => {\n      e === r.attributes[t] && (s = r.objectId ?? r.attributes[i]);\n    }), l(s)) throw new Error(`Expected to find a feature with globalId ${e}`);\n    return s;\n  }\n\n  _queryFeaturesById(e, t) {\n    const i = this._createFeaturesQuery();\n\n    return i.objectIds = e, this._queryFeatures(i, t);\n  }\n\n  _queryFeatures(e, t) {\n    return this.capabilities.query.supportsFormatPBF ? this._queryFeaturesPBF(e, t) : this._queryFeaturesJSON(e, t);\n  }\n\n  async _queryFeaturesPBF(e, t) {\n    const {\n      sourceSpatialReference: i\n    } = this,\n          {\n      data: s\n    } = await T(this.url, e, new b({\n      sourceSpatialReference: i\n    }), {\n      query: this._configuration.customParameters,\n      timeout: S,\n      signal: t\n    });\n    return g(s);\n  }\n\n  async _queryFeaturesJSON(e, t) {\n    const {\n      sourceSpatialReference: i\n    } = this,\n          {\n      data: s\n    } = await P(this.url, e, i, {\n      query: this._configuration.customParameters,\n      timeout: S,\n      signal: t\n    });\n    return m(s, this.objectIdField);\n  }\n\n  _createCountQuery(e) {\n    const t = this._createBaseQuery(e);\n\n    return this.capabilities.query.supportsCacheHint && (t.cacheHint = !0), t;\n  }\n\n  _createFeaturesQuery(e = null) {\n    const t = this._createBaseQuery(e);\n\n    return t.outFields = this.globalIdField ? [this.globalIdField, this.objectIdField] : [this.objectIdField], t.returnGeometry = !0, a(e) && (this.capabilities.query.supportsResultType ? t.resultType = \"tile\" : this.capabilities.query.supportsCacheHint && (t.cacheHint = !0)), t;\n  }\n\n  _createBaseQuery(e) {\n    const t = new I({\n      returnZ: this.hasZ,\n      returnM: !1,\n      geometry: a(this.tileInfo) && a(e) ? y(e.data.extent, this.tileInfo.spatialReference) : void 0\n    }),\n          i = this._configuration.filter;\n    return a(i) && (t.where = i.where, t.gdbVersion = i.gdbVersion, t.timeExtent = i.timeExtent), t.outSpatialReference = this.spatialReference, t;\n  }\n\n  _setPagingParameters(e, t, i) {\n    if (!this.capabilities.query.supportsPagination) return !1;\n    const {\n      supportsMaxRecordCountFactor: s,\n      supportsCacheHint: r,\n      tileMaxRecordCount: o,\n      maxRecordCount: n,\n      supportsResultType: a\n    } = this.capabilities.query,\n          l = s ? I.MAX_MAX_RECORD_COUNT_FACTOR : 1,\n          u = l * ((a || r) && o ? o : n || E);\n    return e.start = t, s ? (e.maxRecordCountFactor = Math.min(l, Math.ceil(i / u)), e.num = Math.min(i, e.maxRecordCountFactor * u)) : e.num = Math.min(i, u), !0;\n  }\n\n};\ne([h({\n  constructOnly: !0\n})], C.prototype, \"url\", void 0), e([h({\n  constructOnly: !0\n})], C.prototype, \"objectIdField\", void 0), e([h({\n  constructOnly: !0\n})], C.prototype, \"globalIdField\", void 0), e([h({\n  constructOnly: !0\n})], C.prototype, \"capabilities\", void 0), e([h({\n  constructOnly: !0\n})], C.prototype, \"sourceSpatialReference\", void 0), e([h({\n  constructOnly: !0\n})], C.prototype, \"spatialReference\", void 0), e([h({\n  constructOnly: !0\n})], C.prototype, \"store\", void 0), e([h({\n  readOnly: !0\n})], C.prototype, \"_minimumVerticesPerFeature\", null), e([h()], C.prototype, \"filter\", null), e([h()], C.prototype, \"customParameters\", null), e([h({\n  readOnly: !0\n})], C.prototype, \"_configuration\", null), e([h()], C.prototype, \"tileInfo\", null), e([h()], C.prototype, \"tileSize\", null), e([h()], C.prototype, \"tilesOfInterest\", void 0), e([h({\n  readOnly: !0\n})], C.prototype, \"updating\", null), e([h({\n  readOnly: !0\n})], C.prototype, \"updatingExcludingEdits\", null), e([h({\n  readOnly: !0\n})], C.prototype, \"availability\", void 0), e([h()], C.prototype, \"hasZ\", null), C = e([p(\"esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiledFetcher\")], C);\nconst E = 2e3,\n      S = 6e5,\n      x = 1e6,\n      j = 25,\n      w = 1;\nexport { C as FeatureServiceTiledFetcher };","map":{"version":3,"names":["_","e","equals","t","AsyncSequence","i","createTask","s","HandleOwner","r","makeHandle","o","n","isSome","a","isNone","l","unwrap","u","throwIfAbortError","c","sync","d","property","h","subclass","p","f","toExtent","y","unquantizeOptimizedFeatureSet","g","convertFromFeatureSet","m","isHostedAgolService","OptimizedFeatureSetParserContext","b","executeQueryForExtent","F","executeQueryPBF","T","executeQuery","P","I","StateType","v","PendingFeatureTile","O","C","constructor","tilesOfInterest","availability","_pendingTiles","Map","_pendingEdits","_pendingEditsAbortController","AbortController","_minimumVerticesPerFeature","store","featureStore","geometryType","filter","_get","_filterProperties","JSON","stringify","_set","customParameters","_configuration","tileInfo","tileSize","updating","updatingExcludingEdits","updatingHandles","hasZ","initialize","_initializeFetchExtent","add","refresh","id","_process","destroy","forEach","_deletePendingTile","clear","length","abort","applyEdits","push","addedFeatures","updatedFeatures","deletedFeatures","reset","map","objectId","globalId","_lookupObjectIdByGlobalId","addPromise","processEdits","_queryFeaturesById","signal","_processPendingTiles","capabilities","query","supportsExtent","url","where","outSpatialReference","spatialReference","cacheHint","supportsCacheHint","extent","fromJSON","data","getLogger","declaredClass","warn","promise","then","handles","debugInfo","numberOfFeatures","numFeatures","pendingTiles","Array","from","values","storedTiles","_markTilesNotAlive","_createPendingTiles","_deletePendingTiles","alive","_collectMissingTilesInfo","_setAvailability","coveredArea","fullArea","resolution","missingTiles","get","_createPendingTile","process","_verifyTileComplexity","prepend","fetchCount","_fetchCount","fetchFeatures","_fetchFeatures","finish","_finishPendingTile","resume","_ensureFetchAllCounts","getFeatureCount","_verifyVertexComplexity","_verifyFeatureDensity","x","j","w","state","type","FETCHED_COUNT","FETCH_COUNT","_updateAvailability","set","delete","_createCountQuery","timeout","S","_createFeaturesQuery","_setPagingParameters","features","exceededTransferLimit","_queryFeatures","num","concat","gdbVersion","timeExtent","globalIdField","objectIdField","Error","attributes","objectIds","supportsFormatPBF","_queryFeaturesPBF","_queryFeaturesJSON","sourceSpatialReference","_createBaseQuery","outFields","returnGeometry","supportsResultType","resultType","returnZ","returnM","geometry","supportsPagination","supportsMaxRecordCountFactor","tileMaxRecordCount","maxRecordCount","MAX_MAX_RECORD_COUNT_FACTOR","E","start","maxRecordCountFactor","Math","min","ceil","constructOnly","prototype","readOnly","FeatureServiceTiledFetcher"],"sources":["E:/各个学科/论文/毕业论文/Atmosphere/eco-friendly/node_modules/@arcgis/core/views/interactive/snapping/featureSources/featureServiceSource/FeatureServiceTiledFetcher.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../../chunks/tslib.es6.js\";import{equals as t}from\"../../../../../core/arrayUtils.js\";import{AsyncSequence as i}from\"../../../../../core/AsyncSequence.js\";import{createTask as s}from\"../../../../../core/asyncUtils.js\";import{HandleOwner as r}from\"../../../../../core/HandleOwner.js\";import{makeHandle as o}from\"../../../../../core/handleUtils.js\";import n from\"../../../../../core/Logger.js\";import{isSome as a,isNone as l,unwrap as u}from\"../../../../../core/maybe.js\";import{throwIfAbortError as c}from\"../../../../../core/promiseUtils.js\";import{sync as d}from\"../../../../../core/reactiveUtils.js\";import{property as h}from\"../../../../../core/accessorSupport/decorators/property.js\";import\"../../../../../core/accessorSupport/ensureType.js\";import{subclass as p}from\"../../../../../core/accessorSupport/decorators/subclass.js\";import f from\"../../../../../geometry/Extent.js\";import{toExtent as y}from\"../../../../../geometry/support/aaBoundingRect.js\";import{unquantizeOptimizedFeatureSet as g,convertFromFeatureSet as m}from\"../../../../../layers/graphics/featureConversionUtils.js\";import{isHostedAgolService as _}from\"../../../../../layers/support/arcgisLayerUrl.js\";import{OptimizedFeatureSetParserContext as b}from\"../../../../../rest/query/operations/pbfOptimizedFeatureSet.js\";import{executeQueryForExtent as F,executeQueryPBF as T,executeQuery as P}from\"../../../../../rest/query/operations/query.js\";import I from\"../../../../../rest/support/Query.js\";import{StateType as v,PendingFeatureTile as O}from\"./PendingFeatureTile.js\";let C=class extends r{constructor(e){super(e),this.tilesOfInterest=[],this.availability=0,this._pendingTiles=new Map,this._pendingEdits=new i,this._pendingEditsAbortController=new AbortController}get _minimumVerticesPerFeature(){switch(this.store?.featureStore.geometryType){case\"esriGeometryPoint\":case\"esriGeometryMultipoint\":return 1;case\"esriGeometryPolygon\":return 4;case\"esriGeometryPolyline\":return 2}}set filter(e){const t=this._get(\"filter\"),i=this._filterProperties(e);JSON.stringify(t)!==JSON.stringify(i)&&this._set(\"filter\",i)}set customParameters(e){const t=this._get(\"customParameters\");JSON.stringify(t)!==JSON.stringify(e)&&this._set(\"customParameters\",e)}get _configuration(){return{filter:this.filter,customParameters:this.customParameters,tileInfo:this.tileInfo,tileSize:this.tileSize}}set tileInfo(e){const t=this._get(\"tileInfo\");t!==e&&(a(e)&&a(t)&&JSON.stringify(e)===JSON.stringify(t)||(this._set(\"tileInfo\",e),this.store.tileInfo=e))}set tileSize(e){this._get(\"tileSize\")!==e&&this._set(\"tileSize\",e)}get updating(){return this.updatingExcludingEdits||this._pendingEdits.updating}get updatingExcludingEdits(){return this.updatingHandles.updating}get hasZ(){return this.store.featureStore.hasZ}initialize(){this._initializeFetchExtent(),this.updatingHandles.add((()=>this._configuration),(()=>this.refresh())),this.updatingHandles.add((()=>this.tilesOfInterest),((e,i)=>{t(e,i,(({id:e},{id:t})=>e===t))||this._process()}),d)}destroy(){this._pendingTiles.forEach((e=>this._deletePendingTile(e))),this._pendingTiles.clear(),this.store.destroy(),this.tilesOfInterest.length=0,this._pendingEditsAbortController.abort(),this._pendingEditsAbortController=null}refresh(){this.store.refresh(),this._pendingTiles.forEach((e=>this._deletePendingTile(e))),this._process()}applyEdits(e){this._pendingEdits.push(e,(async e=>{if(0===e.addedFeatures.length&&0===e.updatedFeatures.length&&0===e.deletedFeatures.length)return;for(const[,i]of this._pendingTiles)i.reset();const t={...e,deletedFeatures:e.deletedFeatures.map((({objectId:e,globalId:t})=>e&&-1!==e?e:this._lookupObjectIdByGlobalId(t)))};await this.updatingHandles.addPromise(this.store.processEdits(t,((e,t)=>this._queryFeaturesById(e,t)),this._pendingEditsAbortController.signal)),this._processPendingTiles()}))}_initializeFetchExtent(){if(!this.capabilities.query.supportsExtent||!_(this.url))return;const e=s((async e=>{try{const t=await F(this.url,new I({where:\"1=1\",outSpatialReference:this.spatialReference,cacheHint:!!this.capabilities.query.supportsCacheHint||void 0}),{query:this._configuration.customParameters,signal:e});this.store.extent=f.fromJSON(t.data?.extent)}catch(t){c(t),n.getLogger(this.declaredClass).warn(\"Failed to fetch data extent\",t)}}));this.updatingHandles.addPromise(e.promise.then((()=>this._process()))),this.handles.add(o((()=>e.abort())))}get debugInfo(){return{numberOfFeatures:this.store.featureStore.numFeatures,tilesOfInterest:this.tilesOfInterest,pendingTiles:Array.from(this._pendingTiles.values()).map((e=>e.debugInfo)),storedTiles:this.store.debugInfo}}_process(){this._markTilesNotAlive(),this._createPendingTiles(),this._deletePendingTiles(),this._processPendingTiles()}_markTilesNotAlive(){for(const[,e]of this._pendingTiles)e.alive=!1}_createPendingTiles(){const e=this._collectMissingTilesInfo();if(this._setAvailability(l(e)?1:e.coveredArea/e.fullArea),!l(e))for(const{data:t,resolution:i}of e.missingTiles){const e=this._pendingTiles.get(t.id);e?(e.resolution=i,e.alive=!0):this._createPendingTile(t,i)}}_collectMissingTilesInfo(){let e=null;for(let t=this.tilesOfInterest.length-1;t>=0;t--){const i=this.tilesOfInterest[t],s=this.store.process(i,((e,t)=>this._verifyTileComplexity(e,t)));l(e)?e=s:e.prepend(s)}return e}_deletePendingTiles(){for(const[,e]of this._pendingTiles)e.alive||this._deletePendingTile(e)}_processPendingTiles(){const e={fetchCount:(e,t)=>this._fetchCount(e,t),fetchFeatures:(e,t,i)=>this._fetchFeatures(e,t,i),finish:(e,t)=>this._finishPendingTile(e,t),resume:()=>this._processPendingTiles()};if(this._ensureFetchAllCounts(e))for(const[,t]of this._pendingTiles)this._verifyTileComplexity(this.store.getFeatureCount(t.data),t.resolution)&&this.updatingHandles.addPromise(t.process(e))}_verifyTileComplexity(e,t){return this._verifyVertexComplexity(e)&&this._verifyFeatureDensity(e,t)}_verifyVertexComplexity(e){return e*this._minimumVerticesPerFeature<x}_verifyFeatureDensity(e,t){if(l(this.tileInfo))return!1;const i=this.tileSize*t;return e*(j/(i*i))<w}_ensureFetchAllCounts(e){let t=!0;for(const[,i]of this._pendingTiles)i.state.type<v.FETCHED_COUNT&&this.updatingHandles.addPromise(i.process(e)),i.state.type<=v.FETCH_COUNT&&(t=!1);return t}_finishPendingTile(e,t){this.store.add(e.data,t),this._deletePendingTile(e),this._updateAvailability()}_updateAvailability(){const e=this._collectMissingTilesInfo();this._setAvailability(l(e)?1:e.coveredArea/e.fullArea)}_setAvailability(e){this._set(\"availability\",e)}_createPendingTile(e,t){const i=new O(e,t);return this._pendingTiles.set(e.id,i),i}_deletePendingTile(e){e.reset(),this._pendingTiles.delete(e.data.id)}async _fetchCount(e,t){return this.store.fetchCount(e.data,this.url,this._createCountQuery(e),{query:this.customParameters,timeout:S,signal:t})}async _fetchFeatures(e,t,i){let s,r=0,o=0,n=t;for(;;){const a=this._createFeaturesQuery(e),l=this._setPagingParameters(a,r,n),{features:c,exceededTransferLimit:d}=await this._queryFeatures(a,i);if(l&&(r+=u(a.num)),o+=c.length,s=s?s.concat(c):c,n=t-o,!l||!d||n<=0)return s}}_filterProperties(e){return l(e)?{where:\"1=1\",gdbVersion:void 0,timeExtent:void 0}:{where:e.where||\"1=1\",timeExtent:e.timeExtent,gdbVersion:e.gdbVersion}}_lookupObjectIdByGlobalId(e){const t=this.globalIdField,i=this.objectIdField;if(l(t))throw new Error(\"Expected globalIdField to be defined\");let s=null;if(this.store.featureStore.forEach((r=>{e===r.attributes[t]&&(s=r.objectId??r.attributes[i])})),l(s))throw new Error(`Expected to find a feature with globalId ${e}`);return s}_queryFeaturesById(e,t){const i=this._createFeaturesQuery();return i.objectIds=e,this._queryFeatures(i,t)}_queryFeatures(e,t){return this.capabilities.query.supportsFormatPBF?this._queryFeaturesPBF(e,t):this._queryFeaturesJSON(e,t)}async _queryFeaturesPBF(e,t){const{sourceSpatialReference:i}=this,{data:s}=await T(this.url,e,new b({sourceSpatialReference:i}),{query:this._configuration.customParameters,timeout:S,signal:t});return g(s)}async _queryFeaturesJSON(e,t){const{sourceSpatialReference:i}=this,{data:s}=await P(this.url,e,i,{query:this._configuration.customParameters,timeout:S,signal:t});return m(s,this.objectIdField)}_createCountQuery(e){const t=this._createBaseQuery(e);return this.capabilities.query.supportsCacheHint&&(t.cacheHint=!0),t}_createFeaturesQuery(e=null){const t=this._createBaseQuery(e);return t.outFields=this.globalIdField?[this.globalIdField,this.objectIdField]:[this.objectIdField],t.returnGeometry=!0,a(e)&&(this.capabilities.query.supportsResultType?t.resultType=\"tile\":this.capabilities.query.supportsCacheHint&&(t.cacheHint=!0)),t}_createBaseQuery(e){const t=new I({returnZ:this.hasZ,returnM:!1,geometry:a(this.tileInfo)&&a(e)?y(e.data.extent,this.tileInfo.spatialReference):void 0}),i=this._configuration.filter;return a(i)&&(t.where=i.where,t.gdbVersion=i.gdbVersion,t.timeExtent=i.timeExtent),t.outSpatialReference=this.spatialReference,t}_setPagingParameters(e,t,i){if(!this.capabilities.query.supportsPagination)return!1;const{supportsMaxRecordCountFactor:s,supportsCacheHint:r,tileMaxRecordCount:o,maxRecordCount:n,supportsResultType:a}=this.capabilities.query,l=s?I.MAX_MAX_RECORD_COUNT_FACTOR:1,u=l*((a||r)&&o?o:n||E);return e.start=t,s?(e.maxRecordCountFactor=Math.min(l,Math.ceil(i/u)),e.num=Math.min(i,e.maxRecordCountFactor*u)):e.num=Math.min(i,u),!0}};e([h({constructOnly:!0})],C.prototype,\"url\",void 0),e([h({constructOnly:!0})],C.prototype,\"objectIdField\",void 0),e([h({constructOnly:!0})],C.prototype,\"globalIdField\",void 0),e([h({constructOnly:!0})],C.prototype,\"capabilities\",void 0),e([h({constructOnly:!0})],C.prototype,\"sourceSpatialReference\",void 0),e([h({constructOnly:!0})],C.prototype,\"spatialReference\",void 0),e([h({constructOnly:!0})],C.prototype,\"store\",void 0),e([h({readOnly:!0})],C.prototype,\"_minimumVerticesPerFeature\",null),e([h()],C.prototype,\"filter\",null),e([h()],C.prototype,\"customParameters\",null),e([h({readOnly:!0})],C.prototype,\"_configuration\",null),e([h()],C.prototype,\"tileInfo\",null),e([h()],C.prototype,\"tileSize\",null),e([h()],C.prototype,\"tilesOfInterest\",void 0),e([h({readOnly:!0})],C.prototype,\"updating\",null),e([h({readOnly:!0})],C.prototype,\"updatingExcludingEdits\",null),e([h({readOnly:!0})],C.prototype,\"availability\",void 0),e([h()],C.prototype,\"hasZ\",null),C=e([p(\"esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiledFetcher\")],C);const E=2e3,S=6e5,x=1e6,j=25,w=1;export{C as FeatureServiceTiledFetcher};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}