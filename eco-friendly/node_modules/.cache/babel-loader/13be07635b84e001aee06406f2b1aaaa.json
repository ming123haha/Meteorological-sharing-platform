{"ast":null,"code":"import \"core-js/modules/es.array.includes.js\";\n\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport { isSome as e } from \"../../core/maybe.js\";\nimport { sqlAnd as r } from \"../../core/sql.js\";\nimport { getJsonType as t } from \"../../geometry/support/jsonUtils.js\";\nimport { getScale as i } from \"../../geometry/support/scaleUtils.js\";\nimport { getLayerFloorFilterClause as n } from \"../../layers/support/floorFilterUtils.js\";\nimport { isExportDynamic as s } from \"../../layers/support/sublayerUtils.js\";\n\nconst o = e => e.spatialReference.wkid || JSON.stringify(e.spatialReference);\n\nfunction l(r, i) {\n  const {\n    dpi: n,\n    gdbVersion: s,\n    geometry: l,\n    geometryPrecision: f,\n    height: p,\n    layerOption: m,\n    mapExtent: y,\n    maxAllowableOffset: c,\n    returnFieldName: u,\n    returnGeometry: d,\n    returnUnformattedValues: g,\n    returnZ: x,\n    spatialReference: b,\n    timeExtent: h,\n    tolerance: E,\n    width: O\n  } = r.toJSON(),\n        {\n    dynamicLayers: S,\n    layerDefs: j,\n    layerIds: N\n  } = a(r),\n        J = i && e(i.geometry) ? i.geometry : null,\n        R = {\n    geometryPrecision: f,\n    maxAllowableOffset: c,\n    returnFieldName: u,\n    returnGeometry: d,\n    returnUnformattedValues: g,\n    returnZ: x,\n    tolerance: E\n  },\n        $ = J && J.toJSON() || l;\n\n  if (R.imageDisplay = `${O},${p},${n}`, s && (R.gdbVersion = s), $ && (delete $.spatialReference, R.geometry = JSON.stringify($), R.geometryType = t($)), b ? R.sr = b.wkid || JSON.stringify(b) : $ && $.spatialReference ? R.sr = o($) : y && y.spatialReference && (R.sr = o(y)), R.time = h ? [h.start, h.end].join(\",\") : null, y) {\n    const {\n      xmin: e,\n      ymin: r,\n      xmax: t,\n      ymax: i\n    } = y;\n    R.mapExtent = `${e},${r},${t},${i}`;\n  }\n\n  return j && (R.layerDefs = j), S && !j && (R.dynamicLayers = S), R.layers = \"popup\" === m ? \"visible\" : m, N && !S && (R.layers += `:${N.join(\",\")}`), R;\n}\n\nfunction a(r) {\n  const {\n    mapExtent: t,\n    floors: o,\n    width: l,\n    sublayers: a,\n    layerIds: p,\n    layerOption: m,\n    gdbVersion: y\n  } = r,\n        c = a?.find(e => null != e.layer)?.layer?.serviceSublayers,\n        u = \"popup\" === m,\n        d = {},\n        g = i({\n    extent: t,\n    width: l,\n    spatialReference: t?.spatialReference\n  }),\n        x = [],\n        b = e => {\n    const r = 0 === g,\n          t = 0 === e.minScale || g <= e.minScale,\n          i = 0 === e.maxScale || g >= e.maxScale;\n    if (e.visible && (r || t && i)) if (e.sublayers) e.sublayers.forEach(b);else {\n      if (!1 === p?.includes(e.id) || u && (!e.popupTemplate || !e.popupEnabled)) return;\n      x.unshift(e);\n    }\n  };\n\n  if (a?.forEach(b), a && !x.length) d.layerIds = [];else {\n    const r = s(x, c, y),\n          t = x.map(e => {\n      const r = n(o, e);\n      return e.toExportImageJSON(r);\n    });\n    if (r) d.dynamicLayers = JSON.stringify(t);else {\n      if (a) {\n        let e = x.map(({\n          id: e\n        }) => e);\n        p && (e = e.filter(e => p.includes(e))), d.layerIds = e;\n      } else p?.length && (d.layerIds = p);\n\n      const r = f(o, x);\n\n      if (e(r) && r.length) {\n        const e = {};\n\n        for (const t of r) t.definitionExpression && (e[t.id] = t.definitionExpression);\n\n        Object.keys(e).length && (d.layerDefs = JSON.stringify(e));\n      }\n    }\n  }\n  return d;\n}\n\nfunction f(e, t) {\n  const i = !!e?.length,\n        s = t.filter(e => null != e.definitionExpression || i && null != e.floorInfo);\n  return s.length ? s.map(t => {\n    const i = n(e, t),\n          s = r(i, t.definitionExpression);\n    return {\n      id: t.id,\n      definitionExpression: s\n    };\n  }) : null;\n}\n\nexport { l as identifyToIdentifyRESTParameters, a as toDynamicLayersJSON };","map":{"version":3,"names":["isSome","e","sqlAnd","r","getJsonType","t","getScale","i","getLayerFloorFilterClause","n","isExportDynamic","s","o","spatialReference","wkid","JSON","stringify","l","dpi","gdbVersion","geometry","geometryPrecision","f","height","p","layerOption","m","mapExtent","y","maxAllowableOffset","c","returnFieldName","u","returnGeometry","d","returnUnformattedValues","g","returnZ","x","b","timeExtent","h","tolerance","E","width","O","toJSON","dynamicLayers","S","layerDefs","j","layerIds","N","a","J","R","$","imageDisplay","geometryType","sr","time","start","end","join","xmin","ymin","xmax","ymax","layers","floors","sublayers","find","layer","serviceSublayers","extent","minScale","maxScale","visible","forEach","includes","id","popupTemplate","popupEnabled","unshift","length","map","toExportImageJSON","filter","definitionExpression","Object","keys","floorInfo","identifyToIdentifyRESTParameters","toDynamicLayersJSON"],"sources":["E:/各个学科/论文/毕业论文/Atmosphere/eco-friendly/node_modules/@arcgis/core/rest/operations/identify.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{isSome as e}from\"../../core/maybe.js\";import{sqlAnd as r}from\"../../core/sql.js\";import{getJsonType as t}from\"../../geometry/support/jsonUtils.js\";import{getScale as i}from\"../../geometry/support/scaleUtils.js\";import{getLayerFloorFilterClause as n}from\"../../layers/support/floorFilterUtils.js\";import{isExportDynamic as s}from\"../../layers/support/sublayerUtils.js\";const o=e=>e.spatialReference.wkid||JSON.stringify(e.spatialReference);function l(r,i){const{dpi:n,gdbVersion:s,geometry:l,geometryPrecision:f,height:p,layerOption:m,mapExtent:y,maxAllowableOffset:c,returnFieldName:u,returnGeometry:d,returnUnformattedValues:g,returnZ:x,spatialReference:b,timeExtent:h,tolerance:E,width:O}=r.toJSON(),{dynamicLayers:S,layerDefs:j,layerIds:N}=a(r),J=i&&e(i.geometry)?i.geometry:null,R={geometryPrecision:f,maxAllowableOffset:c,returnFieldName:u,returnGeometry:d,returnUnformattedValues:g,returnZ:x,tolerance:E},$=J&&J.toJSON()||l;if(R.imageDisplay=`${O},${p},${n}`,s&&(R.gdbVersion=s),$&&(delete $.spatialReference,R.geometry=JSON.stringify($),R.geometryType=t($)),b?R.sr=b.wkid||JSON.stringify(b):$&&$.spatialReference?R.sr=o($):y&&y.spatialReference&&(R.sr=o(y)),R.time=h?[h.start,h.end].join(\",\"):null,y){const{xmin:e,ymin:r,xmax:t,ymax:i}=y;R.mapExtent=`${e},${r},${t},${i}`}return j&&(R.layerDefs=j),S&&!j&&(R.dynamicLayers=S),R.layers=\"popup\"===m?\"visible\":m,N&&!S&&(R.layers+=`:${N.join(\",\")}`),R}function a(r){const{mapExtent:t,floors:o,width:l,sublayers:a,layerIds:p,layerOption:m,gdbVersion:y}=r,c=a?.find((e=>null!=e.layer))?.layer?.serviceSublayers,u=\"popup\"===m,d={},g=i({extent:t,width:l,spatialReference:t?.spatialReference}),x=[],b=e=>{const r=0===g,t=0===e.minScale||g<=e.minScale,i=0===e.maxScale||g>=e.maxScale;if(e.visible&&(r||t&&i))if(e.sublayers)e.sublayers.forEach(b);else{if(!1===p?.includes(e.id)||u&&(!e.popupTemplate||!e.popupEnabled))return;x.unshift(e)}};if(a?.forEach(b),a&&!x.length)d.layerIds=[];else{const r=s(x,c,y),t=x.map((e=>{const r=n(o,e);return e.toExportImageJSON(r)}));if(r)d.dynamicLayers=JSON.stringify(t);else{if(a){let e=x.map((({id:e})=>e));p&&(e=e.filter((e=>p.includes(e)))),d.layerIds=e}else p?.length&&(d.layerIds=p);const r=f(o,x);if(e(r)&&r.length){const e={};for(const t of r)t.definitionExpression&&(e[t.id]=t.definitionExpression);Object.keys(e).length&&(d.layerDefs=JSON.stringify(e))}}}return d}function f(e,t){const i=!!e?.length,s=t.filter((e=>null!=e.definitionExpression||i&&null!=e.floorInfo));return s.length?s.map((t=>{const i=n(e,t),s=r(i,t.definitionExpression);return{id:t.id,definitionExpression:s}})):null}export{l as identifyToIdentifyRESTParameters,a as toDynamicLayersJSON};\n"],"mappings":";;AAAA;AACA;AACA;AACA;AACA,SAAOA,MAAM,IAAIC,CAAjB,QAAuB,qBAAvB;AAA6C,SAAOC,MAAM,IAAIC,CAAjB,QAAuB,mBAAvB;AAA2C,SAAOC,WAAW,IAAIC,CAAtB,QAA4B,qCAA5B;AAAkE,SAAOC,QAAQ,IAAIC,CAAnB,QAAyB,sCAAzB;AAAgE,SAAOC,yBAAyB,IAAIC,CAApC,QAA0C,0CAA1C;AAAqF,SAAOC,eAAe,IAAIC,CAA1B,QAAgC,uCAAhC;;AAAwE,MAAMC,CAAC,GAACX,CAAC,IAAEA,CAAC,CAACY,gBAAF,CAAmBC,IAAnB,IAAyBC,IAAI,CAACC,SAAL,CAAef,CAAC,CAACY,gBAAjB,CAApC;;AAAuE,SAASI,CAAT,CAAWd,CAAX,EAAaI,CAAb,EAAe;EAAC,MAAK;IAACW,GAAG,EAACT,CAAL;IAAOU,UAAU,EAACR,CAAlB;IAAoBS,QAAQ,EAACH,CAA7B;IAA+BI,iBAAiB,EAACC,CAAjD;IAAmDC,MAAM,EAACC,CAA1D;IAA4DC,WAAW,EAACC,CAAxE;IAA0EC,SAAS,EAACC,CAApF;IAAsFC,kBAAkB,EAACC,CAAzG;IAA2GC,eAAe,EAACC,CAA3H;IAA6HC,cAAc,EAACC,CAA5I;IAA8IC,uBAAuB,EAACC,CAAtK;IAAwKC,OAAO,EAACC,CAAhL;IAAkLzB,gBAAgB,EAAC0B,CAAnM;IAAqMC,UAAU,EAACC,CAAhN;IAAkNC,SAAS,EAACC,CAA5N;IAA8NC,KAAK,EAACC;EAApO,IAAuO1C,CAAC,CAAC2C,MAAF,EAA5O;EAAA,MAAuP;IAACC,aAAa,EAACC,CAAf;IAAiBC,SAAS,EAACC,CAA3B;IAA6BC,QAAQ,EAACC;EAAtC,IAAyCC,CAAC,CAAClD,CAAD,CAAjS;EAAA,MAAqSmD,CAAC,GAAC/C,CAAC,IAAEN,CAAC,CAACM,CAAC,CAACa,QAAH,CAAJ,GAAiBb,CAAC,CAACa,QAAnB,GAA4B,IAAnU;EAAA,MAAwUmC,CAAC,GAAC;IAAClC,iBAAiB,EAACC,CAAnB;IAAqBO,kBAAkB,EAACC,CAAxC;IAA0CC,eAAe,EAACC,CAA1D;IAA4DC,cAAc,EAACC,CAA3E;IAA6EC,uBAAuB,EAACC,CAArG;IAAuGC,OAAO,EAACC,CAA/G;IAAiHI,SAAS,EAACC;EAA3H,CAA1U;EAAA,MAAwca,CAAC,GAACF,CAAC,IAAEA,CAAC,CAACR,MAAF,EAAH,IAAe7B,CAAzd;;EAA2d,IAAGsC,CAAC,CAACE,YAAF,GAAgB,GAAEZ,CAAE,IAAGrB,CAAE,IAAGf,CAAE,EAA9B,EAAgCE,CAAC,KAAG4C,CAAC,CAACpC,UAAF,GAAaR,CAAhB,CAAjC,EAAoD6C,CAAC,KAAG,OAAOA,CAAC,CAAC3C,gBAAT,EAA0B0C,CAAC,CAACnC,QAAF,GAAWL,IAAI,CAACC,SAAL,CAAewC,CAAf,CAArC,EAAuDD,CAAC,CAACG,YAAF,GAAerD,CAAC,CAACmD,CAAD,CAA1E,CAArD,EAAoIjB,CAAC,GAACgB,CAAC,CAACI,EAAF,GAAKpB,CAAC,CAACzB,IAAF,IAAQC,IAAI,CAACC,SAAL,CAAeuB,CAAf,CAAd,GAAgCiB,CAAC,IAAEA,CAAC,CAAC3C,gBAAL,GAAsB0C,CAAC,CAACI,EAAF,GAAK/C,CAAC,CAAC4C,CAAD,CAA5B,GAAgC5B,CAAC,IAAEA,CAAC,CAACf,gBAAL,KAAwB0C,CAAC,CAACI,EAAF,GAAK/C,CAAC,CAACgB,CAAD,CAA9B,CAArM,EAAwO2B,CAAC,CAACK,IAAF,GAAOnB,CAAC,GAAC,CAACA,CAAC,CAACoB,KAAH,EAASpB,CAAC,CAACqB,GAAX,EAAgBC,IAAhB,CAAqB,GAArB,CAAD,GAA2B,IAA3Q,EAAgRnC,CAAnR,EAAqR;IAAC,MAAK;MAACoC,IAAI,EAAC/D,CAAN;MAAQgE,IAAI,EAAC9D,CAAb;MAAe+D,IAAI,EAAC7D,CAApB;MAAsB8D,IAAI,EAAC5D;IAA3B,IAA8BqB,CAAnC;IAAqC2B,CAAC,CAAC5B,SAAF,GAAa,GAAE1B,CAAE,IAAGE,CAAE,IAAGE,CAAE,IAAGE,CAAE,EAAhC;EAAkC;;EAAA,OAAO2C,CAAC,KAAGK,CAAC,CAACN,SAAF,GAAYC,CAAf,CAAD,EAAmBF,CAAC,IAAE,CAACE,CAAJ,KAAQK,CAAC,CAACR,aAAF,GAAgBC,CAAxB,CAAnB,EAA8CO,CAAC,CAACa,MAAF,GAAS,YAAU1C,CAAV,GAAY,SAAZ,GAAsBA,CAA7E,EAA+E0B,CAAC,IAAE,CAACJ,CAAJ,KAAQO,CAAC,CAACa,MAAF,IAAW,IAAGhB,CAAC,CAACW,IAAF,CAAO,GAAP,CAAY,EAAlC,CAA/E,EAAoHR,CAA3H;AAA6H;;AAAA,SAASF,CAAT,CAAWlD,CAAX,EAAa;EAAC,MAAK;IAACwB,SAAS,EAACtB,CAAX;IAAagE,MAAM,EAACzD,CAApB;IAAsBgC,KAAK,EAAC3B,CAA5B;IAA8BqD,SAAS,EAACjB,CAAxC;IAA0CF,QAAQ,EAAC3B,CAAnD;IAAqDC,WAAW,EAACC,CAAjE;IAAmEP,UAAU,EAACS;EAA9E,IAAiFzB,CAAtF;EAAA,MAAwF2B,CAAC,GAACuB,CAAC,EAAEkB,IAAH,CAAStE,CAAC,IAAE,QAAMA,CAAC,CAACuE,KAApB,GAA6BA,KAA7B,EAAoCC,gBAA9H;EAAA,MAA+IzC,CAAC,GAAC,YAAUN,CAA3J;EAAA,MAA6JQ,CAAC,GAAC,EAA/J;EAAA,MAAkKE,CAAC,GAAC7B,CAAC,CAAC;IAACmE,MAAM,EAACrE,CAAR;IAAUuC,KAAK,EAAC3B,CAAhB;IAAkBJ,gBAAgB,EAACR,CAAC,EAAEQ;EAAtC,CAAD,CAArK;EAAA,MAA+NyB,CAAC,GAAC,EAAjO;EAAA,MAAoOC,CAAC,GAACtC,CAAC,IAAE;IAAC,MAAME,CAAC,GAAC,MAAIiC,CAAZ;IAAA,MAAc/B,CAAC,GAAC,MAAIJ,CAAC,CAAC0E,QAAN,IAAgBvC,CAAC,IAAEnC,CAAC,CAAC0E,QAArC;IAAA,MAA8CpE,CAAC,GAAC,MAAIN,CAAC,CAAC2E,QAAN,IAAgBxC,CAAC,IAAEnC,CAAC,CAAC2E,QAArE;IAA8E,IAAG3E,CAAC,CAAC4E,OAAF,KAAY1E,CAAC,IAAEE,CAAC,IAAEE,CAAlB,CAAH,EAAwB,IAAGN,CAAC,CAACqE,SAAL,EAAerE,CAAC,CAACqE,SAAF,CAAYQ,OAAZ,CAAoBvC,CAApB,EAAf,KAA0C;MAAC,IAAG,CAAC,CAAD,KAAKf,CAAC,EAAEuD,QAAH,CAAY9E,CAAC,CAAC+E,EAAd,CAAL,IAAwBhD,CAAC,KAAG,CAAC/B,CAAC,CAACgF,aAAH,IAAkB,CAAChF,CAAC,CAACiF,YAAxB,CAA5B,EAAkE;MAAO5C,CAAC,CAAC6C,OAAF,CAAUlF,CAAV;IAAa;EAAC,CAAld;;EAAmd,IAAGoD,CAAC,EAAEyB,OAAH,CAAWvC,CAAX,GAAcc,CAAC,IAAE,CAACf,CAAC,CAAC8C,MAAvB,EAA8BlD,CAAC,CAACiB,QAAF,GAAW,EAAX,CAA9B,KAAgD;IAAC,MAAMhD,CAAC,GAACQ,CAAC,CAAC2B,CAAD,EAAGR,CAAH,EAAKF,CAAL,CAAT;IAAA,MAAiBvB,CAAC,GAACiC,CAAC,CAAC+C,GAAF,CAAOpF,CAAC,IAAE;MAAC,MAAME,CAAC,GAACM,CAAC,CAACG,CAAD,EAAGX,CAAH,CAAT;MAAe,OAAOA,CAAC,CAACqF,iBAAF,CAAoBnF,CAApB,CAAP;IAA8B,CAAxD,CAAnB;IAA8E,IAAGA,CAAH,EAAK+B,CAAC,CAACa,aAAF,GAAgBhC,IAAI,CAACC,SAAL,CAAeX,CAAf,CAAhB,CAAL,KAA2C;MAAC,IAAGgD,CAAH,EAAK;QAAC,IAAIpD,CAAC,GAACqC,CAAC,CAAC+C,GAAF,CAAO,CAAC;UAACL,EAAE,EAAC/E;QAAJ,CAAD,KAAUA,CAAjB,CAAN;QAA2BuB,CAAC,KAAGvB,CAAC,GAACA,CAAC,CAACsF,MAAF,CAAUtF,CAAC,IAAEuB,CAAC,CAACuD,QAAF,CAAW9E,CAAX,CAAb,CAAL,CAAD,EAAoCiC,CAAC,CAACiB,QAAF,GAAWlD,CAA/C;MAAiD,CAAlF,MAAuFuB,CAAC,EAAE4D,MAAH,KAAYlD,CAAC,CAACiB,QAAF,GAAW3B,CAAvB;;MAA0B,MAAMrB,CAAC,GAACmB,CAAC,CAACV,CAAD,EAAG0B,CAAH,CAAT;;MAAe,IAAGrC,CAAC,CAACE,CAAD,CAAD,IAAMA,CAAC,CAACiF,MAAX,EAAkB;QAAC,MAAMnF,CAAC,GAAC,EAAR;;QAAW,KAAI,MAAMI,CAAV,IAAeF,CAAf,EAAiBE,CAAC,CAACmF,oBAAF,KAAyBvF,CAAC,CAACI,CAAC,CAAC2E,EAAH,CAAD,GAAQ3E,CAAC,CAACmF,oBAAnC;;QAAyDC,MAAM,CAACC,IAAP,CAAYzF,CAAZ,EAAemF,MAAf,KAAwBlD,CAAC,CAACe,SAAF,GAAYlC,IAAI,CAACC,SAAL,CAAef,CAAf,CAApC;MAAuD;IAAC;EAAC;EAAA,OAAOiC,CAAP;AAAS;;AAAA,SAASZ,CAAT,CAAWrB,CAAX,EAAaI,CAAb,EAAe;EAAC,MAAME,CAAC,GAAC,CAAC,CAACN,CAAC,EAAEmF,MAAb;EAAA,MAAoBzE,CAAC,GAACN,CAAC,CAACkF,MAAF,CAAUtF,CAAC,IAAE,QAAMA,CAAC,CAACuF,oBAAR,IAA8BjF,CAAC,IAAE,QAAMN,CAAC,CAAC0F,SAAtD,CAAtB;EAAwF,OAAOhF,CAAC,CAACyE,MAAF,GAASzE,CAAC,CAAC0E,GAAF,CAAOhF,CAAC,IAAE;IAAC,MAAME,CAAC,GAACE,CAAC,CAACR,CAAD,EAAGI,CAAH,CAAT;IAAA,MAAeM,CAAC,GAACR,CAAC,CAACI,CAAD,EAAGF,CAAC,CAACmF,oBAAL,CAAlB;IAA6C,OAAM;MAACR,EAAE,EAAC3E,CAAC,CAAC2E,EAAN;MAASQ,oBAAoB,EAAC7E;IAA9B,CAAN;EAAuC,CAA/F,CAAT,GAA2G,IAAlH;AAAuH;;AAAA,SAAOM,CAAC,IAAI2E,gCAAZ,EAA6CvC,CAAC,IAAIwC,mBAAlD"},"metadata":{},"sourceType":"module"}