{"ast":null,"code":"import \"core-js/modules/es.error.cause.js\";\n\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport { id as t } from \"../../kernel.js\";\nimport r from \"../../request.js\";\nimport { isNone as e, isSome as a } from \"../../core/maybe.js\";\nimport { throwIfAbortError as s } from \"../../core/promiseUtils.js\";\nimport i from \"../FeatureLayer.js\";\nimport o from \"../../portal/Portal.js\";\nimport n from \"../../portal/PortalItem.js\";\n\nclass l {\n  constructor(t, r, e, a) {\n    this.parsedUrl = t, this.portalItem = r, this.apiKey = e, this.signal = a, this.rootDocument = null;\n    const s = this.parsedUrl.path.match(/^(.*)\\/SceneServer\\/layers\\/([\\d]*)\\/?$/i);\n    s && (this.urlParts = {\n      root: s[1],\n      layerId: parseInt(s[2], 10)\n    });\n  }\n\n  async fetch() {\n    if (!this.urlParts) return null;\n    const t = this.portalItem ?? (await this._portalItemFromServiceItemId());\n    if (e(t)) return this._loadFromUrl();\n    const r = await this._findAndLoadRelatedPortalItem(t);\n    return e(r) ? null : this._loadFeatureLayerFromPortalItem(r);\n  }\n\n  async fetchPortalItem() {\n    if (!this.urlParts) return null;\n    const t = this.portalItem ?? (await this._portalItemFromServiceItemId());\n    return e(t) ? null : this._findAndLoadRelatedPortalItem(t);\n  }\n\n  async _fetchRootDocument() {\n    if (a(this.rootDocument)) return this.rootDocument;\n    if (e(this.urlParts)) return this.rootDocument = {}, {};\n    const t = {\n      query: {\n        f: \"json\",\n        token: this.apiKey\n      },\n      responseType: \"json\",\n      signal: this.signal\n    },\n          s = `${this.urlParts.root}/SceneServer`;\n\n    try {\n      const e = await r(s, t);\n      this.rootDocument = e.data;\n    } catch {\n      this.rootDocument = {};\n    }\n\n    return this.rootDocument;\n  }\n\n  async _fetchServiceOwningPortalUrl() {\n    const e = t?.findServerInfo(this.parsedUrl.path);\n    if (e?.owningSystemUrl) return e.owningSystemUrl;\n    const a = this.parsedUrl.path.replace(/(.*\\/rest)\\/.*/i, \"$1\") + \"/info\";\n\n    try {\n      const t = (await r(a, {\n        query: {\n          f: \"json\"\n        },\n        responseType: \"json\",\n        signal: this.signal\n      })).data.owningSystemUrl;\n      if (t) return t;\n    } catch (i) {\n      s(i);\n    }\n\n    return null;\n  }\n\n  async _findAndLoadRelatedPortalItem(t) {\n    try {\n      return (await t.fetchRelatedItems({\n        relationshipType: \"Service2Service\",\n        direction: \"reverse\"\n      }, {\n        signal: this.signal\n      })).find(t => \"Feature Service\" === t.type) || null;\n    } catch (r) {\n      return s(r), null;\n    }\n  }\n\n  async _loadFeatureLayerFromPortalItem(t) {\n    await t.load({\n      signal: this.signal\n    });\n    const r = await this._findMatchingAssociatedSublayerUrl(t.url);\n    return new i({\n      url: r,\n      portalItem: t\n    }).load({\n      signal: this.signal\n    });\n  }\n\n  async _loadFromUrl() {\n    const t = await this._findMatchingAssociatedSublayerUrl(`${this.urlParts.root}/FeatureServer`);\n    return new i({\n      url: t\n    }).load({\n      signal: this.signal\n    });\n  }\n\n  async _findMatchingAssociatedSublayerUrl(t) {\n    const e = t.replace(/^(.*FeatureServer)(\\/[\\d]*\\/?)?$/i, \"$1\"),\n          a = {\n      query: {\n        f: \"json\"\n      },\n      responseType: \"json\",\n      authMode: \"no-prompt\",\n      signal: this.signal\n    },\n          s = this.urlParts.layerId,\n          i = this._fetchRootDocument(),\n          o = r(e, a),\n          [n, l] = await Promise.all([o, i]),\n          c = l && l.layers,\n          h = n.data && n.data.layers;\n\n    if (!Array.isArray(h)) throw new Error(\"expected layers array\");\n    if (Array.isArray(c)) for (let r = 0; r < Math.min(c.length, h.length); r++) {\n      if (c[r].id === s) return `${e}/${h[r].id}`;\n    } else if (s < h.length) return `${e}/${h[s].id}`;\n    throw new Error(\"could not find matching associated sublayer\");\n  }\n\n  async _portalItemFromServiceItemId() {\n    const t = (await this._fetchRootDocument()).serviceItemId;\n    if (!t) return null;\n    const r = new n({\n      id: t,\n      apiKey: this.apiKey\n    }),\n          e = await this._fetchServiceOwningPortalUrl();\n    a(e) && (r.portal = new o({\n      url: e\n    }));\n\n    try {\n      return r.load({\n        signal: this.signal\n      });\n    } catch (i) {\n      return s(i), null;\n    }\n  }\n\n}\n\nexport { l as FetchAssociatedFeatureLayer };","map":{"version":3,"names":["id","t","r","isNone","e","isSome","a","throwIfAbortError","s","i","o","n","l","constructor","parsedUrl","portalItem","apiKey","signal","rootDocument","path","match","urlParts","root","layerId","parseInt","fetch","_portalItemFromServiceItemId","_loadFromUrl","_findAndLoadRelatedPortalItem","_loadFeatureLayerFromPortalItem","fetchPortalItem","_fetchRootDocument","query","f","token","responseType","data","_fetchServiceOwningPortalUrl","findServerInfo","owningSystemUrl","replace","fetchRelatedItems","relationshipType","direction","find","type","load","_findMatchingAssociatedSublayerUrl","url","authMode","Promise","all","c","layers","h","Array","isArray","Error","Math","min","length","serviceItemId","portal","FetchAssociatedFeatureLayer"],"sources":["C:/Users/hp/Desktop/eco-friendly atmosphere/Atmosphere/eco-friendly/node_modules/@arcgis/core/layers/support/FetchAssociatedFeatureLayer.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport{id as t}from\"../../kernel.js\";import r from\"../../request.js\";import{isNone as e,isSome as a}from\"../../core/maybe.js\";import{throwIfAbortError as s}from\"../../core/promiseUtils.js\";import i from\"../FeatureLayer.js\";import o from\"../../portal/Portal.js\";import n from\"../../portal/PortalItem.js\";class l{constructor(t,r,e,a){this.parsedUrl=t,this.portalItem=r,this.apiKey=e,this.signal=a,this.rootDocument=null;const s=this.parsedUrl.path.match(/^(.*)\\/SceneServer\\/layers\\/([\\d]*)\\/?$/i);s&&(this.urlParts={root:s[1],layerId:parseInt(s[2],10)})}async fetch(){if(!this.urlParts)return null;const t=this.portalItem??await this._portalItemFromServiceItemId();if(e(t))return this._loadFromUrl();const r=await this._findAndLoadRelatedPortalItem(t);return e(r)?null:this._loadFeatureLayerFromPortalItem(r)}async fetchPortalItem(){if(!this.urlParts)return null;const t=this.portalItem??await this._portalItemFromServiceItemId();return e(t)?null:this._findAndLoadRelatedPortalItem(t)}async _fetchRootDocument(){if(a(this.rootDocument))return this.rootDocument;if(e(this.urlParts))return this.rootDocument={},{};const t={query:{f:\"json\",token:this.apiKey},responseType:\"json\",signal:this.signal},s=`${this.urlParts.root}/SceneServer`;try{const e=await r(s,t);this.rootDocument=e.data}catch{this.rootDocument={}}return this.rootDocument}async _fetchServiceOwningPortalUrl(){const e=t?.findServerInfo(this.parsedUrl.path);if(e?.owningSystemUrl)return e.owningSystemUrl;const a=this.parsedUrl.path.replace(/(.*\\/rest)\\/.*/i,\"$1\")+\"/info\";try{const t=(await r(a,{query:{f:\"json\"},responseType:\"json\",signal:this.signal})).data.owningSystemUrl;if(t)return t}catch(i){s(i)}return null}async _findAndLoadRelatedPortalItem(t){try{return(await t.fetchRelatedItems({relationshipType:\"Service2Service\",direction:\"reverse\"},{signal:this.signal})).find((t=>\"Feature Service\"===t.type))||null}catch(r){return s(r),null}}async _loadFeatureLayerFromPortalItem(t){await t.load({signal:this.signal});const r=await this._findMatchingAssociatedSublayerUrl(t.url);return new i({url:r,portalItem:t}).load({signal:this.signal})}async _loadFromUrl(){const t=await this._findMatchingAssociatedSublayerUrl(`${this.urlParts.root}/FeatureServer`);return new i({url:t}).load({signal:this.signal})}async _findMatchingAssociatedSublayerUrl(t){const e=t.replace(/^(.*FeatureServer)(\\/[\\d]*\\/?)?$/i,\"$1\"),a={query:{f:\"json\"},responseType:\"json\",authMode:\"no-prompt\",signal:this.signal},s=this.urlParts.layerId,i=this._fetchRootDocument(),o=r(e,a),[n,l]=await Promise.all([o,i]),c=l&&l.layers,h=n.data&&n.data.layers;if(!Array.isArray(h))throw new Error(\"expected layers array\");if(Array.isArray(c))for(let r=0;r<Math.min(c.length,h.length);r++){if(c[r].id===s)return`${e}/${h[r].id}`}else if(s<h.length)return`${e}/${h[s].id}`;throw new Error(\"could not find matching associated sublayer\")}async _portalItemFromServiceItemId(){const t=(await this._fetchRootDocument()).serviceItemId;if(!t)return null;const r=new n({id:t,apiKey:this.apiKey}),e=await this._fetchServiceOwningPortalUrl();a(e)&&(r.portal=new o({url:e}));try{return r.load({signal:this.signal})}catch(i){return s(i),null}}}export{l as FetchAssociatedFeatureLayer};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}