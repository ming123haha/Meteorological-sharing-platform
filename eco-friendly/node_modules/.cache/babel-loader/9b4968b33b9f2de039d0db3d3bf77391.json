{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport { clock as t } from \"../../../core/clock.js\";\nimport { removeMaybe as e } from \"../../../core/maybe.js\";\nimport { InputHandler as i } from \"../InputHandler.js\";\nimport { euclideanDistance as n } from \"./support.js\";\nconst o = {\n  maximumClickDelay: 300,\n  movementUntilMouseDrag: 1.5,\n  movementUntilPenDrag: 6,\n  movementUntilTouchDrag: 6,\n  holdDelay: 500\n};\n\nclass r extends i {\n  constructor(e = o.maximumClickDelay, i = o.movementUntilMouseDrag, n = o.movementUntilPenDrag, r = o.movementUntilTouchDrag, s = o.holdDelay, a = t) {\n    super(!1), this._maximumClickDelay = e, this._movementUntilMouseDrag = i, this._movementUntilPenDrag = n, this._movementUntilTouchDrag = r, this._holdDelay = s, this._clock = a, this._pointerState = new Map(), this._pointerDrag = this.registerOutgoing(\"pointer-drag\"), this._immediateClick = this.registerOutgoing(\"immediate-click\"), this._pointerHold = this.registerOutgoing(\"hold\"), this.registerIncoming(\"pointer-down\", this._handlePointerDown.bind(this)), this.registerIncoming(\"pointer-up\", t => {\n      this._handlePointerLoss(t, \"pointer-up\");\n    }), this.registerIncoming(\"pointer-capture-lost\", t => {\n      this._handlePointerLoss(t, \"pointer-capture-lost\");\n    }), this.registerIncoming(\"pointer-cancel\", t => {\n      this._handlePointerLoss(t, \"pointer-cancel\");\n    }), this._moveHandle = this.registerIncoming(\"pointer-move\", this._handlePointerMove.bind(this)), this._moveHandle.pause();\n  }\n\n  onUninstall() {\n    this._pointerState.forEach(t => {\n      t.holdTimeout = e(t.holdTimeout);\n    }), super.onUninstall();\n  }\n\n  _handlePointerDown(t) {\n    const e = t.data,\n          i = e.native.pointerId;\n    let n = null;\n    0 === this._pointerState.size && (n = this._clock.setTimeout(() => {\n      const e = this._pointerState.get(i);\n\n      if (e) {\n        if (!e.isDragging) {\n          const i = e.previousEvent;\n          this._pointerHold.emit(i, void 0, t.modifiers), e.holdEmitted = !0;\n        }\n\n        e.holdTimeout = null;\n      }\n    }, this._holdDelay));\n    const o = {\n      startEvent: e,\n      previousEvent: e,\n      startTimestamp: t.timestamp,\n      isDragging: !1,\n      downButton: e.native.button,\n      holdTimeout: n,\n      modifiers: new Set()\n    };\n    this._pointerState.set(i, o), this.startCapturingPointer(e.native), this._moveHandle.resume(), this._pointerState.size > 1 && this._startDragging(t);\n  }\n\n  _createPointerDragData(t, e, i) {\n    return {\n      action: t,\n      startEvent: e.startEvent,\n      previousEvent: e.previousEvent,\n      currentEvent: i\n    };\n  }\n\n  _handlePointerMove(t) {\n    const e = t.data,\n          i = e.native.pointerId,\n          o = this._pointerState.get(i);\n\n    if (o) {\n      if (o.isDragging) this._pointerDrag.emit(this._createPointerDragData(\"update\", o, e), void 0, o.modifiers);else {\n        n(e, o.startEvent) > this._getDragThreshold(e.native.pointerType) && this._startDragging(t);\n      }\n      o.previousEvent = e;\n    }\n  }\n\n  _getDragThreshold(t) {\n    switch (t) {\n      case \"touch\":\n        return this._movementUntilTouchDrag;\n\n      case \"pen\":\n        return this._movementUntilPenDrag;\n\n      default:\n        return this._movementUntilMouseDrag;\n    }\n  }\n\n  _startDragging(t) {\n    const e = t.data,\n          i = e.native.pointerId;\n\n    this._pointerState.forEach(n => {\n      null != n.holdTimeout && (n.holdTimeout.remove(), n.holdTimeout = null), n.isDragging || (n.modifiers = t.modifiers, n.isDragging = !0, i === n.startEvent.native.pointerId ? this._pointerDrag.emit(this._createPointerDragData(\"start\", n, e)) : this._pointerDrag.emit(this._createPointerDragData(\"start\", n, n.previousEvent), t.timestamp));\n    });\n  }\n\n  _handlePointerLoss(t, e) {\n    const i = t.data,\n          n = i.native.pointerId,\n          o = this._pointerState.get(n);\n\n    if (o) {\n      if (null != o.holdTimeout && (o.holdTimeout.remove(), o.holdTimeout = null), o.isDragging) this._pointerDrag.emit(this._createPointerDragData(\"end\", o, \"pointer-up\" === e ? i : o.previousEvent), void 0, o.modifiers);else if (\"pointer-up\" === e && o.downButton === i.native.button) {\n        t.timestamp - o.startTimestamp <= this._maximumClickDelay && !o.holdEmitted && this._immediateClick.emit(i);\n      }\n      this._pointerState.delete(n), this.stopCapturingPointer(i.native), 0 === this._pointerState.size && this._moveHandle.pause();\n    }\n  }\n\n}\n\nexport { o as DefaultParameters, r as PointerClickHoldAndDrag };","map":{"version":3,"names":["clock","t","removeMaybe","e","InputHandler","i","euclideanDistance","n","o","maximumClickDelay","movementUntilMouseDrag","movementUntilPenDrag","movementUntilTouchDrag","holdDelay","r","constructor","s","a","_maximumClickDelay","_movementUntilMouseDrag","_movementUntilPenDrag","_movementUntilTouchDrag","_holdDelay","_clock","_pointerState","Map","_pointerDrag","registerOutgoing","_immediateClick","_pointerHold","registerIncoming","_handlePointerDown","bind","_handlePointerLoss","_moveHandle","_handlePointerMove","pause","onUninstall","forEach","holdTimeout","data","native","pointerId","size","setTimeout","get","isDragging","previousEvent","emit","modifiers","holdEmitted","startEvent","startTimestamp","timestamp","downButton","button","Set","set","startCapturingPointer","resume","_startDragging","_createPointerDragData","action","currentEvent","_getDragThreshold","pointerType","remove","delete","stopCapturingPointer","DefaultParameters","PointerClickHoldAndDrag"],"sources":["E:/各个学科/论文/毕业论文/Atmosphere/eco-friendly/node_modules/@arcgis/core/views/input/recognizers/PointerClickHoldAndDrag.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{clock as t}from\"../../../core/clock.js\";import{removeMaybe as e}from\"../../../core/maybe.js\";import{InputHandler as i}from\"../InputHandler.js\";import{euclideanDistance as n}from\"./support.js\";const o={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500};class r extends i{constructor(e=o.maximumClickDelay,i=o.movementUntilMouseDrag,n=o.movementUntilPenDrag,r=o.movementUntilTouchDrag,s=o.holdDelay,a=t){super(!1),this._maximumClickDelay=e,this._movementUntilMouseDrag=i,this._movementUntilPenDrag=n,this._movementUntilTouchDrag=r,this._holdDelay=s,this._clock=a,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing(\"pointer-drag\"),this._immediateClick=this.registerOutgoing(\"immediate-click\"),this._pointerHold=this.registerOutgoing(\"hold\"),this.registerIncoming(\"pointer-down\",this._handlePointerDown.bind(this)),this.registerIncoming(\"pointer-up\",(t=>{this._handlePointerLoss(t,\"pointer-up\")})),this.registerIncoming(\"pointer-capture-lost\",(t=>{this._handlePointerLoss(t,\"pointer-capture-lost\")})),this.registerIncoming(\"pointer-cancel\",(t=>{this._handlePointerLoss(t,\"pointer-cancel\")})),this._moveHandle=this.registerIncoming(\"pointer-move\",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach((t=>{t.holdTimeout=e(t.holdTimeout)})),super.onUninstall()}_handlePointerDown(t){const e=t.data,i=e.native.pointerId;let n=null;0===this._pointerState.size&&(n=this._clock.setTimeout((()=>{const e=this._pointerState.get(i);if(e){if(!e.isDragging){const i=e.previousEvent;this._pointerHold.emit(i,void 0,t.modifiers),e.holdEmitted=!0}e.holdTimeout=null}}),this._holdDelay));const o={startEvent:e,previousEvent:e,startTimestamp:t.timestamp,isDragging:!1,downButton:e.native.button,holdTimeout:n,modifiers:new Set};this._pointerState.set(i,o),this.startCapturingPointer(e.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(t)}_createPointerDragData(t,e,i){return{action:t,startEvent:e.startEvent,previousEvent:e.previousEvent,currentEvent:i}}_handlePointerMove(t){const e=t.data,i=e.native.pointerId,o=this._pointerState.get(i);if(o){if(o.isDragging)this._pointerDrag.emit(this._createPointerDragData(\"update\",o,e),void 0,o.modifiers);else{n(e,o.startEvent)>this._getDragThreshold(e.native.pointerType)&&this._startDragging(t)}o.previousEvent=e}}_getDragThreshold(t){switch(t){case\"touch\":return this._movementUntilTouchDrag;case\"pen\":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(t){const e=t.data,i=e.native.pointerId;this._pointerState.forEach((n=>{null!=n.holdTimeout&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging||(n.modifiers=t.modifiers,n.isDragging=!0,i===n.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData(\"start\",n,e)):this._pointerDrag.emit(this._createPointerDragData(\"start\",n,n.previousEvent),t.timestamp))}))}_handlePointerLoss(t,e){const i=t.data,n=i.native.pointerId,o=this._pointerState.get(n);if(o){if(null!=o.holdTimeout&&(o.holdTimeout.remove(),o.holdTimeout=null),o.isDragging)this._pointerDrag.emit(this._createPointerDragData(\"end\",o,\"pointer-up\"===e?i:o.previousEvent),void 0,o.modifiers);else if(\"pointer-up\"===e&&o.downButton===i.native.button){t.timestamp-o.startTimestamp<=this._maximumClickDelay&&!o.holdEmitted&&this._immediateClick.emit(i)}this._pointerState.delete(n),this.stopCapturingPointer(i.native),0===this._pointerState.size&&this._moveHandle.pause()}}}export{o as DefaultParameters,r as PointerClickHoldAndDrag};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}