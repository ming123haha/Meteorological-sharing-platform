{"ast":null,"code":"import \"core-js/modules/es.typed-array.at.js\";\nimport \"core-js/modules/es.typed-array.set.js\";\nimport \"core-js/modules/esnext.typed-array.find-last.js\";\nimport \"core-js/modules/esnext.typed-array.find-last-index.js\";\n\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport has from \"../../../../core/has.js\";\nimport { isSome as t, unwrapOrThrow as e, isNone as s } from \"../../../../core/maybe.js\";\nimport { FreeList as r } from \"./cpuMapped/FreeList.js\";\nconst a = has(\"esri-2d-log-allocations\");\n\nclass i {\n  constructor(t, e) {\n    this._array = t, this._pool = e;\n  }\n\n  get array() {\n    return this._array;\n  }\n\n  get length() {\n    return this._array.length;\n  }\n\n  static create(t, e) {\n    const s = e.acquire(t);\n    return new i(s, e);\n  }\n\n  expand(t) {\n    const e = this._pool.acquire(t);\n\n    e.set(this._array), this._pool.release(this._array), this._array = e;\n  }\n\n  destroy() {\n    this._pool.release(this._array);\n  }\n\n  set(t, e) {\n    this._array.set(t._array, e);\n  }\n\n  slice() {\n    const t = this._pool.acquire(this._array.byteLength);\n\n    return t.set(this._array), new i(t, this._pool);\n  }\n\n}\n\nclass o {\n  constructor() {\n    this._data = new ArrayBuffer(o.BYTE_LENGTH), this._freeList = new r({\n      start: 0,\n      end: this._data.byteLength\n    });\n  }\n\n  static get BYTE_LENGTH() {\n    return 64e6;\n  }\n\n  get buffer() {\n    return this._data;\n  }\n\n  allocate(t) {\n    const e = this._freeList.firstFit(t);\n\n    return s(e) ? null : new Uint32Array(this._data, e, t / Uint32Array.BYTES_PER_ELEMENT);\n  }\n\n  free(t) {\n    this._freeList.free(t.byteOffset, t.byteLength);\n  }\n\n}\n\nclass n {\n  constructor() {\n    this._bytesAllocated = 0, this._pages = [], this._pagesByBuffer = new Map(), this._addPage();\n  }\n\n  destroy() {\n    this._pages = [], this._pagesByBuffer = null;\n  }\n\n  get _bytesTotal() {\n    return this._pages.length * o.BYTE_LENGTH;\n  }\n\n  acquire(s) {\n    if (this._bytesAllocated += s, a && console.log(`Allocating ${s}, (${this._bytesAllocated} / ${this._bytesTotal})`), s > o.BYTE_LENGTH) return new Uint32Array(s / Uint32Array.BYTES_PER_ELEMENT);\n\n    for (const e of this._pages) {\n      const r = e.allocate(s);\n      if (t(r)) return r;\n    }\n\n    return e(this._addPage().allocate(s), \"Expected to allocate page\");\n  }\n\n  release(t) {\n    this._bytesAllocated -= t.byteLength, a && console.log(`Freeing ${t.byteLength}, (${this._bytesAllocated} / ${this._bytesTotal})`);\n\n    const e = this._pagesByBuffer.get(t.buffer);\n\n    e && e.free(t);\n  }\n\n  _addPage() {\n    const t = new o();\n    return this._pages.push(t), this._pagesByBuffer.set(t.buffer, t), t;\n  }\n\n}\n\nexport { n as BufferPool, i as TypedBuffer };","map":{"version":3,"names":["has","isSome","t","unwrapOrThrow","e","isNone","s","FreeList","r","a","i","constructor","_array","_pool","array","length","create","acquire","expand","set","release","destroy","slice","byteLength","o","_data","ArrayBuffer","BYTE_LENGTH","_freeList","start","end","buffer","allocate","firstFit","Uint32Array","BYTES_PER_ELEMENT","free","byteOffset","n","_bytesAllocated","_pages","_pagesByBuffer","Map","_addPage","_bytesTotal","console","log","get","push","BufferPool","TypedBuffer"],"sources":["E:/各个学科/论文/毕业论文/Atmosphere/eco-friendly/node_modules/@arcgis/core/views/2d/engine/webgl/BufferPool.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport has from\"../../../../core/has.js\";import{isSome as t,unwrapOrThrow as e,isNone as s}from\"../../../../core/maybe.js\";import{FreeList as r}from\"./cpuMapped/FreeList.js\";const a=has(\"esri-2d-log-allocations\");class i{constructor(t,e){this._array=t,this._pool=e}get array(){return this._array}get length(){return this._array.length}static create(t,e){const s=e.acquire(t);return new i(s,e)}expand(t){const e=this._pool.acquire(t);e.set(this._array),this._pool.release(this._array),this._array=e}destroy(){this._pool.release(this._array)}set(t,e){this._array.set(t._array,e)}slice(){const t=this._pool.acquire(this._array.byteLength);return t.set(this._array),new i(t,this._pool)}}class o{constructor(){this._data=new ArrayBuffer(o.BYTE_LENGTH),this._freeList=new r({start:0,end:this._data.byteLength})}static get BYTE_LENGTH(){return 64e6}get buffer(){return this._data}allocate(t){const e=this._freeList.firstFit(t);return s(e)?null:new Uint32Array(this._data,e,t/Uint32Array.BYTES_PER_ELEMENT)}free(t){this._freeList.free(t.byteOffset,t.byteLength)}}class n{constructor(){this._bytesAllocated=0,this._pages=[],this._pagesByBuffer=new Map,this._addPage()}destroy(){this._pages=[],this._pagesByBuffer=null}get _bytesTotal(){return this._pages.length*o.BYTE_LENGTH}acquire(s){if(this._bytesAllocated+=s,a&&console.log(`Allocating ${s}, (${this._bytesAllocated} / ${this._bytesTotal})`),s>o.BYTE_LENGTH)return new Uint32Array(s/Uint32Array.BYTES_PER_ELEMENT);for(const e of this._pages){const r=e.allocate(s);if(t(r))return r}return e(this._addPage().allocate(s),\"Expected to allocate page\")}release(t){this._bytesAllocated-=t.byteLength,a&&console.log(`Freeing ${t.byteLength}, (${this._bytesAllocated} / ${this._bytesTotal})`);const e=this._pagesByBuffer.get(t.buffer);e&&e.free(t)}_addPage(){const t=new o;return this._pages.push(t),this._pagesByBuffer.set(t.buffer,t),t}}export{n as BufferPool,i as TypedBuffer};\n"],"mappings":";;;;;AAAA;AACA;AACA;AACA;AACA,OAAOA,GAAP,MAAe,yBAAf;AAAyC,SAAOC,MAAM,IAAIC,CAAjB,EAAmBC,aAAa,IAAIC,CAApC,EAAsCC,MAAM,IAAIC,CAAhD,QAAsD,2BAAtD;AAAkF,SAAOC,QAAQ,IAAIC,CAAnB,QAAyB,yBAAzB;AAAmD,MAAMC,CAAC,GAACT,GAAG,CAAC,yBAAD,CAAX;;AAAuC,MAAMU,CAAN,CAAO;EAACC,WAAW,CAACT,CAAD,EAAGE,CAAH,EAAK;IAAC,KAAKQ,MAAL,GAAYV,CAAZ,EAAc,KAAKW,KAAL,GAAWT,CAAzB;EAA2B;;EAAS,IAALU,KAAK,GAAE;IAAC,OAAO,KAAKF,MAAZ;EAAmB;;EAAU,IAANG,MAAM,GAAE;IAAC,OAAO,KAAKH,MAAL,CAAYG,MAAnB;EAA0B;;EAAa,OAANC,MAAM,CAACd,CAAD,EAAGE,CAAH,EAAK;IAAC,MAAME,CAAC,GAACF,CAAC,CAACa,OAAF,CAAUf,CAAV,CAAR;IAAqB,OAAO,IAAIQ,CAAJ,CAAMJ,CAAN,EAAQF,CAAR,CAAP;EAAkB;;EAAAc,MAAM,CAAChB,CAAD,EAAG;IAAC,MAAME,CAAC,GAAC,KAAKS,KAAL,CAAWI,OAAX,CAAmBf,CAAnB,CAAR;;IAA8BE,CAAC,CAACe,GAAF,CAAM,KAAKP,MAAX,GAAmB,KAAKC,KAAL,CAAWO,OAAX,CAAmB,KAAKR,MAAxB,CAAnB,EAAmD,KAAKA,MAAL,GAAYR,CAA/D;EAAiE;;EAAAiB,OAAO,GAAE;IAAC,KAAKR,KAAL,CAAWO,OAAX,CAAmB,KAAKR,MAAxB;EAAgC;;EAAAO,GAAG,CAACjB,CAAD,EAAGE,CAAH,EAAK;IAAC,KAAKQ,MAAL,CAAYO,GAAZ,CAAgBjB,CAAC,CAACU,MAAlB,EAAyBR,CAAzB;EAA4B;;EAAAkB,KAAK,GAAE;IAAC,MAAMpB,CAAC,GAAC,KAAKW,KAAL,CAAWI,OAAX,CAAmB,KAAKL,MAAL,CAAYW,UAA/B,CAAR;;IAAmD,OAAOrB,CAAC,CAACiB,GAAF,CAAM,KAAKP,MAAX,GAAmB,IAAIF,CAAJ,CAAMR,CAAN,EAAQ,KAAKW,KAAb,CAA1B;EAA8C;;AAA9c;;AAA+c,MAAMW,CAAN,CAAO;EAACb,WAAW,GAAE;IAAC,KAAKc,KAAL,GAAW,IAAIC,WAAJ,CAAgBF,CAAC,CAACG,WAAlB,CAAX,EAA0C,KAAKC,SAAL,GAAe,IAAIpB,CAAJ,CAAM;MAACqB,KAAK,EAAC,CAAP;MAASC,GAAG,EAAC,KAAKL,KAAL,CAAWF;IAAxB,CAAN,CAAzD;EAAoG;;EAAsB,WAAXI,WAAW,GAAE;IAAC,OAAO,IAAP;EAAY;;EAAU,IAANI,MAAM,GAAE;IAAC,OAAO,KAAKN,KAAZ;EAAkB;;EAAAO,QAAQ,CAAC9B,CAAD,EAAG;IAAC,MAAME,CAAC,GAAC,KAAKwB,SAAL,CAAeK,QAAf,CAAwB/B,CAAxB,CAAR;;IAAmC,OAAOI,CAAC,CAACF,CAAD,CAAD,GAAK,IAAL,GAAU,IAAI8B,WAAJ,CAAgB,KAAKT,KAArB,EAA2BrB,CAA3B,EAA6BF,CAAC,GAACgC,WAAW,CAACC,iBAA3C,CAAjB;EAA+E;;EAAAC,IAAI,CAAClC,CAAD,EAAG;IAAC,KAAK0B,SAAL,CAAeQ,IAAf,CAAoBlC,CAAC,CAACmC,UAAtB,EAAiCnC,CAAC,CAACqB,UAAnC;EAA+C;;AAA5W;;AAA6W,MAAMe,CAAN,CAAO;EAAC3B,WAAW,GAAE;IAAC,KAAK4B,eAAL,GAAqB,CAArB,EAAuB,KAAKC,MAAL,GAAY,EAAnC,EAAsC,KAAKC,cAAL,GAAoB,IAAIC,GAAJ,EAA1D,EAAkE,KAAKC,QAAL,EAAlE;EAAkF;;EAAAtB,OAAO,GAAE;IAAC,KAAKmB,MAAL,GAAY,EAAZ,EAAe,KAAKC,cAAL,GAAoB,IAAnC;EAAwC;;EAAe,IAAXG,WAAW,GAAE;IAAC,OAAO,KAAKJ,MAAL,CAAYzB,MAAZ,GAAmBS,CAAC,CAACG,WAA5B;EAAwC;;EAAAV,OAAO,CAACX,CAAD,EAAG;IAAC,IAAG,KAAKiC,eAAL,IAAsBjC,CAAtB,EAAwBG,CAAC,IAAEoC,OAAO,CAACC,GAAR,CAAa,cAAaxC,CAAE,MAAK,KAAKiC,eAAgB,MAAK,KAAKK,WAAY,GAA5E,CAA3B,EAA2GtC,CAAC,GAACkB,CAAC,CAACG,WAAlH,EAA8H,OAAO,IAAIO,WAAJ,CAAgB5B,CAAC,GAAC4B,WAAW,CAACC,iBAA9B,CAAP;;IAAwD,KAAI,MAAM/B,CAAV,IAAe,KAAKoC,MAApB,EAA2B;MAAC,MAAMhC,CAAC,GAACJ,CAAC,CAAC4B,QAAF,CAAW1B,CAAX,CAAR;MAAsB,IAAGJ,CAAC,CAACM,CAAD,CAAJ,EAAQ,OAAOA,CAAP;IAAS;;IAAA,OAAOJ,CAAC,CAAC,KAAKuC,QAAL,GAAgBX,QAAhB,CAAyB1B,CAAzB,CAAD,EAA6B,2BAA7B,CAAR;EAAkE;;EAAAc,OAAO,CAAClB,CAAD,EAAG;IAAC,KAAKqC,eAAL,IAAsBrC,CAAC,CAACqB,UAAxB,EAAmCd,CAAC,IAAEoC,OAAO,CAACC,GAAR,CAAa,WAAU5C,CAAC,CAACqB,UAAW,MAAK,KAAKgB,eAAgB,MAAK,KAAKK,WAAY,GAApF,CAAtC;;IAA8H,MAAMxC,CAAC,GAAC,KAAKqC,cAAL,CAAoBM,GAApB,CAAwB7C,CAAC,CAAC6B,MAA1B,CAAR;;IAA0C3B,CAAC,IAAEA,CAAC,CAACgC,IAAF,CAAOlC,CAAP,CAAH;EAAa;;EAAAyC,QAAQ,GAAE;IAAC,MAAMzC,CAAC,GAAC,IAAIsB,CAAJ,EAAR;IAAc,OAAO,KAAKgB,MAAL,CAAYQ,IAAZ,CAAiB9C,CAAjB,GAAoB,KAAKuC,cAAL,CAAoBtB,GAApB,CAAwBjB,CAAC,CAAC6B,MAA1B,EAAiC7B,CAAjC,CAApB,EAAwDA,CAA/D;EAAiE;;AAA7yB;;AAA8yB,SAAOoC,CAAC,IAAIW,UAAZ,EAAuBvC,CAAC,IAAIwC,WAA5B"},"metadata":{},"sourceType":"module"}