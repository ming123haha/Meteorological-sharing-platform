{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport { remove as e } from \"../arrayUtils.js\";\nimport { makeHandle as t } from \"../handleUtils.js\";\nimport r from \"../Logger.js\";\nimport { isSome as s } from \"../maybe.js\";\nimport { throwIfAborted as i } from \"../promiseUtils.js\";\nimport { open as o } from \"./workers.js\";\n\nclass h {\n  constructor(e, t, s, i, h = {}) {\n    this._mainMethod = t, this._transferLists = s, this._listeners = [], this._promise = o(e, { ...h,\n      schedule: i\n    }).then(e => {\n      if (void 0 === this._thread) {\n        this._thread = e, this._promise = null, h.hasInitialize && this.broadcast({}, \"initialize\");\n\n        for (const e of this._listeners) this._connectListener(e);\n      } else e.close();\n    }), this._promise.catch(t => r.getLogger(\"esri.core.workers.WorkerHandle\").error(`Failed to initialize ${e} worker: ${t}`));\n  }\n\n  on(r, i) {\n    const o = {\n      removed: !1,\n      eventName: r,\n      callback: i,\n      threadHandle: null\n    };\n    return this._listeners.push(o), this._connectListener(o), t(() => {\n      o.removed = !0, e(this._listeners, o), this._thread && s(o.threadHandle) && o.threadHandle.remove();\n    });\n  }\n\n  destroy() {\n    this._thread && (this._thread.close(), this._thread = null), this._promise = null;\n  }\n\n  invoke(e, t) {\n    return this.invokeMethod(this._mainMethod, e, t);\n  }\n\n  invokeMethod(e, t, r) {\n    if (this._thread) {\n      const s = this._transferLists[e],\n            i = s ? s(t) : [];\n      return this._thread.invoke(e, t, {\n        transferList: i,\n        signal: r\n      });\n    }\n\n    return this._promise ? this._promise.then(() => (i(r), this.invokeMethod(e, t, r))) : Promise.reject(null);\n  }\n\n  broadcast(e, t) {\n    return this._thread ? Promise.all(this._thread.broadcast(t, e)).then(() => {}) : this._promise ? this._promise.then(() => this.broadcast(e, t)) : Promise.reject();\n  }\n\n  get promise() {\n    return this._promise;\n  }\n\n  _connectListener(e) {\n    this._thread && this._thread.on(e.eventName, e.callback).then(t => {\n      e.removed || (e.threadHandle = t);\n    });\n  }\n\n}\n\nexport { h as WorkerHandle };","map":{"version":3,"names":["remove","e","makeHandle","t","r","isSome","s","throwIfAborted","i","open","o","h","constructor","_mainMethod","_transferLists","_listeners","_promise","schedule","then","_thread","hasInitialize","broadcast","_connectListener","close","catch","getLogger","error","on","removed","eventName","callback","threadHandle","push","destroy","invoke","invokeMethod","transferList","signal","Promise","reject","all","promise","WorkerHandle"],"sources":["E:/各个学科/论文/毕业论文/Atmosphere/eco-friendly/node_modules/@arcgis/core/core/workers/WorkerHandle.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{remove as e}from\"../arrayUtils.js\";import{makeHandle as t}from\"../handleUtils.js\";import r from\"../Logger.js\";import{isSome as s}from\"../maybe.js\";import{throwIfAborted as i}from\"../promiseUtils.js\";import{open as o}from\"./workers.js\";class h{constructor(e,t,s,i,h={}){this._mainMethod=t,this._transferLists=s,this._listeners=[],this._promise=o(e,{...h,schedule:i}).then((e=>{if(void 0===this._thread){this._thread=e,this._promise=null,h.hasInitialize&&this.broadcast({},\"initialize\");for(const e of this._listeners)this._connectListener(e)}else e.close()})),this._promise.catch((t=>r.getLogger(\"esri.core.workers.WorkerHandle\").error(`Failed to initialize ${e} worker: ${t}`)))}on(r,i){const o={removed:!1,eventName:r,callback:i,threadHandle:null};return this._listeners.push(o),this._connectListener(o),t((()=>{o.removed=!0,e(this._listeners,o),this._thread&&s(o.threadHandle)&&o.threadHandle.remove()}))}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null}invoke(e,t){return this.invokeMethod(this._mainMethod,e,t)}invokeMethod(e,t,r){if(this._thread){const s=this._transferLists[e],i=s?s(t):[];return this._thread.invoke(e,t,{transferList:i,signal:r})}return this._promise?this._promise.then((()=>(i(r),this.invokeMethod(e,t,r)))):Promise.reject(null)}broadcast(e,t){return this._thread?Promise.all(this._thread.broadcast(t,e)).then((()=>{})):this._promise?this._promise.then((()=>this.broadcast(e,t))):Promise.reject()}get promise(){return this._promise}_connectListener(e){this._thread&&this._thread.on(e.eventName,e.callback).then((t=>{e.removed||(e.threadHandle=t)}))}}export{h as WorkerHandle};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}