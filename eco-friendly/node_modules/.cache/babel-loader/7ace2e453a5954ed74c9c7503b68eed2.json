{"ast":null,"code":"import \"core-js/modules/es.error.cause.js\";\n\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport { workerMessages as e } from \"../../kernel.js\";\nimport t from \"../Error.js\";\nimport o from \"../Logger.js\";\nimport { removeMaybe as s } from \"../maybe.js\";\nimport { onAbortOrThrow as r, isPromiseLike as n, isAbortError as a } from \"../promiseUtils.js\";\nimport { newJobId as i, receiveMessage as l, toInvokeError as d, postMessage as h, MessageType as c } from \"./utils.js\";\nimport { createWorker as p } from \"./workerFactory.js\";\nconst {\n  ABORT: b,\n  INVOKE: m,\n  OPEN: _,\n  OPENED: g,\n  RESPONSE: u\n} = c;\n\nclass j {\n  constructor(e, t) {\n    this._outJobs = new Map(), this._inJobs = new Map(), this.worker = e, this.id = t, e.addEventListener(\"message\", this._onMessage.bind(this)), e.addEventListener(\"error\", e => {\n      e.preventDefault(), o.getLogger(\"esri.core.workers.WorkerOwner\").error(e);\n    });\n  }\n\n  static async create(e) {\n    const t = await p();\n    return new j(t, e);\n  }\n\n  terminate() {\n    this.worker.terminate();\n  }\n\n  async open(e, t = {}) {\n    const {\n      signal: o\n    } = t,\n          s = i();\n    return new Promise((t, n) => {\n      const a = {\n        resolve: t,\n        reject: n,\n        abortHandle: r(o, () => {\n          this._outJobs.delete(s), this._post({\n            type: b,\n            jobId: s\n          });\n        })\n      };\n      this._outJobs.set(s, a), this._post({\n        type: _,\n        jobId: s,\n        modulePath: e\n      });\n    });\n  }\n\n  _onMessage(e) {\n    const t = l(e);\n    if (t) switch (t.type) {\n      case g:\n        this._onOpenedMessage(t);\n\n        break;\n\n      case u:\n        this._onResponseMessage(t);\n\n        break;\n\n      case b:\n        this._onAbortMessage(t);\n\n        break;\n\n      case m:\n        this._onInvokeMessage(t);\n\n    }\n  }\n\n  _onAbortMessage(e) {\n    const t = this._inJobs,\n          o = e.jobId,\n          s = t.get(o);\n    s && (s.controller && s.controller.abort(), t.delete(o));\n  }\n\n  _onInvokeMessage(t) {\n    const {\n      methodName: o,\n      jobId: s,\n      data: r,\n      abortable: i\n    } = t,\n          l = i ? new AbortController() : null,\n          h = this._inJobs,\n          c = e[o];\n    let p;\n\n    try {\n      if (\"function\" != typeof c) throw new TypeError(`${o} is not a function`);\n      p = c.call(null, r, {\n        signal: l ? l.signal : null\n      });\n    } catch (b) {\n      return void this._post({\n        type: u,\n        jobId: s,\n        error: d(b)\n      });\n    }\n\n    n(p) ? (h.set(s, {\n      controller: l,\n      promise: p\n    }), p.then(e => {\n      h.has(s) && (h.delete(s), this._post({\n        type: u,\n        jobId: s\n      }, e));\n    }, e => {\n      h.has(s) && (h.delete(s), e || (e = {\n        message: \"Error encountered at method\" + o\n      }), a(e) || this._post({\n        type: u,\n        jobId: s,\n        error: d(e || {\n          message: `Error encountered at method ${o}`\n        })\n      }));\n    })) : this._post({\n      type: u,\n      jobId: s\n    }, p);\n  }\n\n  _onOpenedMessage(e) {\n    const {\n      jobId: t,\n      data: o\n    } = e,\n          r = this._outJobs.get(t);\n\n    r && (this._outJobs.delete(t), s(r.abortHandle), r.resolve(o));\n  }\n\n  _onResponseMessage(e) {\n    const {\n      jobId: o,\n      error: r,\n      data: n\n    } = e,\n          a = this._outJobs.get(o);\n\n    a && (this._outJobs.delete(o), s(a.abortHandle), r ? a.reject(t.fromJSON(JSON.parse(r))) : a.resolve(n));\n  }\n\n  _post(e, t, o) {\n    return h(this.worker, e, t, o);\n  }\n\n}\n\nexport { j as default };","map":{"version":3,"names":["workerMessages","e","t","o","removeMaybe","s","onAbortOrThrow","r","isPromiseLike","n","isAbortError","a","newJobId","i","receiveMessage","l","toInvokeError","d","postMessage","h","MessageType","c","createWorker","p","ABORT","b","INVOKE","m","OPEN","_","OPENED","g","RESPONSE","u","j","constructor","_outJobs","Map","_inJobs","worker","id","addEventListener","_onMessage","bind","preventDefault","getLogger","error","create","terminate","open","signal","Promise","resolve","reject","abortHandle","delete","_post","type","jobId","set","modulePath","_onOpenedMessage","_onResponseMessage","_onAbortMessage","_onInvokeMessage","get","controller","abort","methodName","data","abortable","AbortController","TypeError","call","promise","then","has","message","fromJSON","JSON","parse","default"],"sources":["E:/各个学科/论文/毕业论文/Atmosphere/eco-friendly/node_modules/@arcgis/core/core/workers/WorkerOwner.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{workerMessages as e}from\"../../kernel.js\";import t from\"../Error.js\";import o from\"../Logger.js\";import{removeMaybe as s}from\"../maybe.js\";import{onAbortOrThrow as r,isPromiseLike as n,isAbortError as a}from\"../promiseUtils.js\";import{newJobId as i,receiveMessage as l,toInvokeError as d,postMessage as h,MessageType as c}from\"./utils.js\";import{createWorker as p}from\"./workerFactory.js\";const{ABORT:b,INVOKE:m,OPEN:_,OPENED:g,RESPONSE:u}=c;class j{constructor(e,t){this._outJobs=new Map,this._inJobs=new Map,this.worker=e,this.id=t,e.addEventListener(\"message\",this._onMessage.bind(this)),e.addEventListener(\"error\",(e=>{e.preventDefault(),o.getLogger(\"esri.core.workers.WorkerOwner\").error(e)}))}static async create(e){const t=await p();return new j(t,e)}terminate(){this.worker.terminate()}async open(e,t={}){const{signal:o}=t,s=i();return new Promise(((t,n)=>{const a={resolve:t,reject:n,abortHandle:r(o,(()=>{this._outJobs.delete(s),this._post({type:b,jobId:s})}))};this._outJobs.set(s,a),this._post({type:_,jobId:s,modulePath:e})}))}_onMessage(e){const t=l(e);if(t)switch(t.type){case g:this._onOpenedMessage(t);break;case u:this._onResponseMessage(t);break;case b:this._onAbortMessage(t);break;case m:this._onInvokeMessage(t)}}_onAbortMessage(e){const t=this._inJobs,o=e.jobId,s=t.get(o);s&&(s.controller&&s.controller.abort(),t.delete(o))}_onInvokeMessage(t){const{methodName:o,jobId:s,data:r,abortable:i}=t,l=i?new AbortController:null,h=this._inJobs,c=e[o];let p;try{if(\"function\"!=typeof c)throw new TypeError(`${o} is not a function`);p=c.call(null,r,{signal:l?l.signal:null})}catch(b){return void this._post({type:u,jobId:s,error:d(b)})}n(p)?(h.set(s,{controller:l,promise:p}),p.then((e=>{h.has(s)&&(h.delete(s),this._post({type:u,jobId:s},e))}),(e=>{h.has(s)&&(h.delete(s),e||(e={message:\"Error encountered at method\"+o}),a(e)||this._post({type:u,jobId:s,error:d(e||{message:`Error encountered at method ${o}`})}))}))):this._post({type:u,jobId:s},p)}_onOpenedMessage(e){const{jobId:t,data:o}=e,r=this._outJobs.get(t);r&&(this._outJobs.delete(t),s(r.abortHandle),r.resolve(o))}_onResponseMessage(e){const{jobId:o,error:r,data:n}=e,a=this._outJobs.get(o);a&&(this._outJobs.delete(o),s(a.abortHandle),r?a.reject(t.fromJSON(JSON.parse(r))):a.resolve(n))}_post(e,t,o){return h(this.worker,e,t,o)}}export{j as default};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}