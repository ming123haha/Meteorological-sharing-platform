{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../chunks/tslib.es6.js\";\nimport s from \"../Accessor.js\";\nimport t from \"../Handles.js\";\nimport { isNone as i } from \"../maybe.js\";\nimport { watch as n, when as d, on as a, sync as r } from \"../reactiveUtils.js\";\nimport { schedule as h } from \"../scheduling.js\";\nimport { property as o } from \"../accessorSupport/decorators/property.js\";\nimport { subclass as l } from \"../accessorSupport/decorators/subclass.js\";\nlet c = class extends s {\n  constructor() {\n    super(...arguments), this.updating = !1, this._handleId = 0, this._handles = new t(), this._scheduleHandleId = 0, this._pendingPromises = new Set();\n  }\n\n  destroy() {\n    this.removeAll(), this._handles.destroy();\n  }\n\n  add(e, s, t = {}) {\n    return this._installWatch(e, s, t, n);\n  }\n\n  addWhen(e, s, t = {}) {\n    return this._installWatch(e, s, t, d);\n  }\n\n  addOnCollectionChange(e, s, {\n    initial: t = !1,\n    final: i = !1\n  } = {}) {\n    const n = ++this._handleId;\n    return this._handles.add([a(e, \"after-changes\", this._createSyncUpdatingCallback(), r), a(e, \"change\", s, {\n      onListenerAdd: t ? e => s({\n        added: e.toArray(),\n        removed: []\n      }) : void 0,\n      onListenerRemove: i ? e => s({\n        added: [],\n        removed: e.toArray()\n      }) : void 0\n    })], n), {\n      remove: () => this._handles.remove(n)\n    };\n  }\n\n  addPromise(e) {\n    if (i(e)) return e;\n    const s = ++this._handleId;\n    this._handles.add({\n      remove: () => {\n        this._pendingPromises.delete(e) && (0 !== this._pendingPromises.size || this._handles.has(_) || this._set(\"updating\", !1));\n      }\n    }, s), this._pendingPromises.add(e), this._set(\"updating\", !0);\n\n    const t = () => this._handles.remove(s);\n\n    return e.then(t, t), e;\n  }\n\n  removeAll() {\n    this._pendingPromises.clear(), this._handles.removeAll(), this._set(\"updating\", !1);\n  }\n\n  _installWatch(e, s, t = {}, i) {\n    const n = ++this._handleId;\n    t.sync || this._installSyncUpdatingWatch(e, n);\n    const d = i(e, s, t);\n    return this._handles.add(d, n), {\n      remove: () => this._handles.remove(n)\n    };\n  }\n\n  _installSyncUpdatingWatch(e, s) {\n    const t = this._createSyncUpdatingCallback(),\n          i = n(e, t, {\n      sync: !0,\n      equals: () => !1\n    });\n\n    return this._handles.add(i, s), i;\n  }\n\n  _createSyncUpdatingCallback() {\n    return () => {\n      this._handles.remove(_), ++this._scheduleHandleId;\n      const e = this._scheduleHandleId;\n      this._get(\"updating\") || this._set(\"updating\", !0), this._handles.add(h(() => {\n        e === this._scheduleHandleId && (this._set(\"updating\", this._pendingPromises.size > 0), this._handles.remove(_));\n      }), _);\n    };\n  }\n\n};\ne([o({\n  readOnly: !0\n})], c.prototype, \"updating\", void 0), c = e([l(\"esri.core.support.WatchUpdatingTracking\")], c);\n\nconst _ = -42;\n\nexport { c as WatchUpdatingTracking };","map":{"version":3,"names":["_","e","s","t","isNone","i","watch","n","when","d","on","a","sync","r","schedule","h","property","o","subclass","l","c","constructor","arguments","updating","_handleId","_handles","_scheduleHandleId","_pendingPromises","Set","destroy","removeAll","add","_installWatch","addWhen","addOnCollectionChange","initial","final","_createSyncUpdatingCallback","onListenerAdd","added","toArray","removed","onListenerRemove","remove","addPromise","delete","size","has","_set","then","clear","_installSyncUpdatingWatch","equals","_get","readOnly","prototype","WatchUpdatingTracking"],"sources":["E:/各个学科/论文/毕业论文/Atmosphere/eco-friendly/node_modules/@arcgis/core/core/support/WatchUpdatingTracking.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import s from\"../Accessor.js\";import t from\"../Handles.js\";import{isNone as i}from\"../maybe.js\";import{watch as n,when as d,on as a,sync as r}from\"../reactiveUtils.js\";import{schedule as h}from\"../scheduling.js\";import{property as o}from\"../accessorSupport/decorators/property.js\";import{subclass as l}from\"../accessorSupport/decorators/subclass.js\";let c=class extends s{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._handles=new t,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll(),this._handles.destroy()}add(e,s,t={}){return this._installWatch(e,s,t,n)}addWhen(e,s,t={}){return this._installWatch(e,s,t,d)}addOnCollectionChange(e,s,{initial:t=!1,final:i=!1}={}){const n=++this._handleId;return this._handles.add([a(e,\"after-changes\",this._createSyncUpdatingCallback(),r),a(e,\"change\",s,{onListenerAdd:t?e=>s({added:e.toArray(),removed:[]}):void 0,onListenerRemove:i?e=>s({added:[],removed:e.toArray()}):void 0})],n),{remove:()=>this._handles.remove(n)}}addPromise(e){if(i(e))return e;const s=++this._handleId;this._handles.add({remove:()=>{this._pendingPromises.delete(e)&&(0!==this._pendingPromises.size||this._handles.has(_)||this._set(\"updating\",!1))}},s),this._pendingPromises.add(e),this._set(\"updating\",!0);const t=()=>this._handles.remove(s);return e.then(t,t),e}removeAll(){this._pendingPromises.clear(),this._handles.removeAll(),this._set(\"updating\",!1)}_installWatch(e,s,t={},i){const n=++this._handleId;t.sync||this._installSyncUpdatingWatch(e,n);const d=i(e,s,t);return this._handles.add(d,n),{remove:()=>this._handles.remove(n)}}_installSyncUpdatingWatch(e,s){const t=this._createSyncUpdatingCallback(),i=n(e,t,{sync:!0,equals:()=>!1});return this._handles.add(i,s),i}_createSyncUpdatingCallback(){return()=>{this._handles.remove(_),++this._scheduleHandleId;const e=this._scheduleHandleId;this._get(\"updating\")||this._set(\"updating\",!0),this._handles.add(h((()=>{e===this._scheduleHandleId&&(this._set(\"updating\",this._pendingPromises.size>0),this._handles.remove(_))})),_)}}};e([o({readOnly:!0})],c.prototype,\"updating\",void 0),c=e([l(\"esri.core.support.WatchUpdatingTracking\")],c);const _=-42;export{c as WatchUpdatingTracking};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}