{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport e from \"../../../../../core/Error.js\";\nimport has from \"../../../../../core/has.js\";\nimport r from \"../../../../../core/Logger.js\";\nimport { toPt as t } from \"../../../../../core/screenUtils.js\";\nimport { getWebGLCapabilities as o } from \"../../../../webgl/capabilities.js\";\n\nconst s = 8,\n      l = s - 2,\n      a = r.getLogger(\"esri.views.2d.layers.features.support.rendererUtils\"),\n      n = e => {\n  if (!(\"visualVariables\" in e) || !e.visualVariables || !e.visualVariables.length) return e;\n  const r = e.clone(),\n        t = r.visualVariables.map(e => u(e) ? p(e) : e);\n  return r.visualVariables = t, r;\n};\n\nfunction i(e) {\n  return e.map(e => u(e) ? p(e.clone()) : e);\n}\n\nfunction u(e) {\n  return (\"size\" === e.type || \"color\" === e.type || \"opacity\" === e.type) && null != e.stops;\n}\n\nfunction p(e) {\n  return e.stops = m(e.type, e.stops), e;\n}\n\nfunction c(e, r, t) {\n  return (1 - t) * e + t * r;\n}\n\nfunction f(e, r) {\n  const [o, ...s] = r,\n        a = s.pop(),\n        n = s[0].value,\n        i = s[s.length - 1].value,\n        u = (i - n) / l,\n        p = [];\n\n  for (let l = n; l < i; l += u) {\n    let o = 0;\n\n    for (; l >= s[o].value;) o++;\n\n    const a = s[o],\n          n = r[o - 1],\n          i = l - n.value,\n          u = a.value === n.value ? 1 : i / (a.value - n.value);\n\n    if (\"color\" === e) {\n      const e = s[o],\n            t = r[o - 1],\n            a = e.color.clone();\n      a.r = c(t.color.r, a.r, u), a.g = c(t.color.g, a.g, u), a.b = c(t.color.b, a.b, u), a.a = c(t.color.a, a.a, u), p.push({\n        value: l,\n        color: a,\n        label: e.label\n      });\n    } else if (\"size\" === e) {\n      const e = s[o],\n            a = r[o - 1],\n            n = t(e.size),\n            i = c(t(a.size), n, u);\n      p.push({\n        value: l,\n        size: i,\n        label: e.label\n      });\n    } else {\n      const e = s[o],\n            t = c(r[o - 1].opacity, e.opacity, u);\n      p.push({\n        value: l,\n        opacity: t,\n        label: e.label\n      });\n    }\n  }\n\n  return [o, ...p, a];\n}\n\nfunction b(e) {\n  const [r, ...t] = e,\n        o = t.pop();\n\n  for (; t.length > l;) {\n    let e = 0,\n        r = 0;\n\n    for (let o = 1; o < t.length; o++) {\n      const s = t[o - 1],\n            l = t[o],\n            a = Math.abs(l.value - s.value);\n      a > r && (r = a, e = o);\n    }\n\n    t.splice(e, 1);\n  }\n\n  return [r, ...t, o];\n}\n\nfunction m(e, r) {\n  return r.length <= s ? r : (a.warn(`Found ${r.length} Visual Variable stops, but MapView only supports ${s}. Displayed stops will be simplified.`), r.length > 2 * s ? f(e, r) : b(r));\n}\n\nfunction g() {\n  if (has(\"heatmap-force-raster\")) return \"raster\";\n  const {\n    supportsTextureFloat: e,\n    supportsTextureHalfFloat: r,\n    supportsColorBufferFloat: t,\n    supportsColorBufferFloatBlend: s,\n    supportsColorBufferHalfFloat: l\n  } = o(\"2d\");\n  return e && t && s || r && l ? \"symbol\" : has(\"heatmap-allow-raster-fallback\") ? \"raster\" : \"none\";\n}\n\nfunction h(r) {\n  if (!r) return !0;\n\n  switch (r.type) {\n    case \"dot-density\":\n      if (!o(\"2d\").supportsTextureFloat) return a.error(new e(\"webgl-missing-extension\", \"Missing WebGL extension OES_Texture_Float which is required for DotDensity\")), !1;\n      break;\n\n    case \"heatmap\":\n      {\n        const r = g();\n\n        if (\"none\" === r || \"raster\" === r && !has(\"heatmap-force-raster\")) {\n          const t = o(\"2d\"),\n                s = [\"supportsTextureFloat\", \"supportsTextureHalfFloat\", \"supportsColorBufferFloat\", \"supportsColorBufferFloatBlend\", \"supportsColorBufferHalfFloat\"].filter(e => !t[e]).join(\", \");\n          if (\"none\" === r) return a.errorOnce(new e(\"webgl-missing-extension\", `Missing WebGL${t.type} requirements for Heatmap: ${s}`)), !1;\n          \"raster\" === r && a.warnOnce(`Missing WebGL${t.type} requirements for accelerated Heatmap: ${s}. Feature support may be limited.`);\n        }\n\n        break;\n      }\n  }\n\n  return !0;\n}\n\nexport { g as getSupportedHeatmapRenderer, h as isRendererSupported, n as simplifyVVRenderer, i as simplifyVisualVariables };","map":{"version":3,"names":["e","has","r","toPt","t","getWebGLCapabilities","o","s","l","a","getLogger","n","visualVariables","length","clone","map","u","p","i","type","stops","m","c","f","pop","value","color","g","b","push","label","size","opacity","Math","abs","splice","warn","supportsTextureFloat","supportsTextureHalfFloat","supportsColorBufferFloat","supportsColorBufferFloatBlend","supportsColorBufferHalfFloat","h","error","filter","join","errorOnce","warnOnce","getSupportedHeatmapRenderer","isRendererSupported","simplifyVVRenderer","simplifyVisualVariables"],"sources":["E:/各个学科/论文/毕业论文/Atmosphere/eco-friendly/node_modules/@arcgis/core/views/2d/layers/features/support/rendererUtils.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport e from\"../../../../../core/Error.js\";import has from\"../../../../../core/has.js\";import r from\"../../../../../core/Logger.js\";import{toPt as t}from\"../../../../../core/screenUtils.js\";import{getWebGLCapabilities as o}from\"../../../../webgl/capabilities.js\";const s=8,l=s-2,a=r.getLogger(\"esri.views.2d.layers.features.support.rendererUtils\"),n=e=>{if(!(\"visualVariables\"in e)||!e.visualVariables||!e.visualVariables.length)return e;const r=e.clone(),t=r.visualVariables.map((e=>u(e)?p(e):e));return r.visualVariables=t,r};function i(e){return e.map((e=>u(e)?p(e.clone()):e))}function u(e){return(\"size\"===e.type||\"color\"===e.type||\"opacity\"===e.type)&&null!=e.stops}function p(e){return e.stops=m(e.type,e.stops),e}function c(e,r,t){return(1-t)*e+t*r}function f(e,r){const[o,...s]=r,a=s.pop(),n=s[0].value,i=s[s.length-1].value,u=(i-n)/l,p=[];for(let l=n;l<i;l+=u){let o=0;for(;l>=s[o].value;)o++;const a=s[o],n=r[o-1],i=l-n.value,u=a.value===n.value?1:i/(a.value-n.value);if(\"color\"===e){const e=s[o],t=r[o-1],a=e.color.clone();a.r=c(t.color.r,a.r,u),a.g=c(t.color.g,a.g,u),a.b=c(t.color.b,a.b,u),a.a=c(t.color.a,a.a,u),p.push({value:l,color:a,label:e.label})}else if(\"size\"===e){const e=s[o],a=r[o-1],n=t(e.size),i=c(t(a.size),n,u);p.push({value:l,size:i,label:e.label})}else{const e=s[o],t=c(r[o-1].opacity,e.opacity,u);p.push({value:l,opacity:t,label:e.label})}}return[o,...p,a]}function b(e){const[r,...t]=e,o=t.pop();for(;t.length>l;){let e=0,r=0;for(let o=1;o<t.length;o++){const s=t[o-1],l=t[o],a=Math.abs(l.value-s.value);a>r&&(r=a,e=o)}t.splice(e,1)}return[r,...t,o]}function m(e,r){return r.length<=s?r:(a.warn(`Found ${r.length} Visual Variable stops, but MapView only supports ${s}. Displayed stops will be simplified.`),r.length>2*s?f(e,r):b(r))}function g(){if(has(\"heatmap-force-raster\"))return\"raster\";const{supportsTextureFloat:e,supportsTextureHalfFloat:r,supportsColorBufferFloat:t,supportsColorBufferFloatBlend:s,supportsColorBufferHalfFloat:l}=o(\"2d\");return e&&t&&s||r&&l?\"symbol\":has(\"heatmap-allow-raster-fallback\")?\"raster\":\"none\"}function h(r){if(!r)return!0;switch(r.type){case\"dot-density\":if(!o(\"2d\").supportsTextureFloat)return a.error(new e(\"webgl-missing-extension\",\"Missing WebGL extension OES_Texture_Float which is required for DotDensity\")),!1;break;case\"heatmap\":{const r=g();if(\"none\"===r||\"raster\"===r&&!has(\"heatmap-force-raster\")){const t=o(\"2d\"),s=[\"supportsTextureFloat\",\"supportsTextureHalfFloat\",\"supportsColorBufferFloat\",\"supportsColorBufferFloatBlend\",\"supportsColorBufferHalfFloat\"].filter((e=>!t[e])).join(\", \");if(\"none\"===r)return a.errorOnce(new e(\"webgl-missing-extension\",`Missing WebGL${t.type} requirements for Heatmap: ${s}`)),!1;\"raster\"===r&&a.warnOnce(`Missing WebGL${t.type} requirements for accelerated Heatmap: ${s}. Feature support may be limited.`)}break}}return!0}export{g as getSupportedHeatmapRenderer,h as isRendererSupported,n as simplifyVVRenderer,i as simplifyVisualVariables};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}