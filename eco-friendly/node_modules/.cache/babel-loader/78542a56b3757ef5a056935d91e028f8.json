{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../../chunks/tslib.es6.js\";\nimport { isSome as t } from \"../../../../core/maybe.js\";\nimport { watch as i } from \"../../../../core/reactiveUtils.js\";\nimport { property as r } from \"../../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../../core/arrayUtils.js\";\nimport \"../../../../core/accessorSupport/ensureType.js\";\nimport { subclass as o } from \"../../../../core/accessorSupport/decorators/subclass.js\";\nimport { sampleVectorField as s } from \"../../../../layers/support/rasterFunctions/vectorFieldUtils.js\";\nimport { RasterVFTileContainer as l } from \"../../engine/imagery/RasterVFTileContainer.js\";\nimport { BaseImageryTileSubView2D as a } from \"./BaseImageryTileSubView2D.js\";\nlet n = class extends a {\n  constructor() {\n    super(...arguments), this._handle = null, this.container = null, this.layer = null, this.type = \"rasterVF\";\n  }\n\n  canUseWebGLForProcessing() {\n    return !1;\n  }\n\n  async fetchTile(e, t) {\n    t = { ...t,\n      interpolation: \"nearest\",\n      requestProjectedLocalDirections: !0\n    };\n    const i = await this.layer.fetchTile(e.level, e.row, e.col, t);\n    return \"vector-magdir\" === this.layer.rasterInfo.dataType && i?.pixelBlock && (i.pixelBlock = await this.layer.convertVectorFieldData(i.pixelBlock, t)), i;\n  }\n\n  updateTileSource(e, i) {\n    const r = i.symbolizerParams,\n          {\n      tileData: o\n    } = e;\n    o.key = e.key, o.width = this._tileInfoView.tileInfo.size[0], o.height = this._tileInfoView.tileInfo.size[1];\n    const {\n      symbolTileSize: s\n    } = r,\n          {\n      source: l\n    } = i;\n\n    if (o.offset = this._getTileSymbolOffset(o.key, s), t(l) && t(l.pixelBlock)) {\n      const e = {\n        extent: l.extent,\n        pixelBlock: l.pixelBlock\n      };\n      o.rawPixelData = e, o.symbolizerParameters = r, o.source = this._sampleVectorFieldData(l.pixelBlock, r, o.offset);\n    } else {\n      const e = [Math.round((this._tileInfoView.tileInfo[0] - o.offset[0]) / s), Math.round((this._tileInfoView.tileInfo[1] - o.offset[1]) / s)],\n            t = this.createEmptyTilePixelBlock(e);\n      o.source = t, o.symbolizerParameters = r;\n    }\n\n    return o.invalidateVAO(), Promise.resolve(null);\n  }\n\n  updateTileSymbolizerParameters(e, i) {\n    const r = i.local,\n          {\n      symbolTileSize: o\n    } = r,\n          {\n      tileData: s\n    } = e;\n    s.offset = this._getTileSymbolOffset(s.key, o);\n    const l = s.symbolizerParameters.symbolTileSize;\n    return s.symbolizerParameters = r, t(s.rawPixelData?.pixelBlock) && l !== o && (s.source = this._sampleVectorFieldData(s.rawPixelData.pixelBlock, s.symbolizerParameters, s.offset)), Promise.resolve(null);\n  }\n\n  attach() {\n    super.attach(), this.container = new l(this._tileInfoView), this.container.isCustomTilingScheme = this._isCustomTilingScheme, this._updateSymbolType(this.layer.renderer), this._handle = i(() => this.layer.renderer, e => this._updateSymbolType(e));\n  }\n\n  detach() {\n    super.detach(), this.container.removeAllChildren(), this._handle.remove(), this._handle = null;\n  }\n\n  _getTileSymbolOffset(e, t) {\n    const i = e.col * this._tileInfoView.tileInfo.size[0] % t,\n          r = e.row * this._tileInfoView.tileInfo.size[1] % t;\n    return [i > t / 2 ? t - i : -i, r > t / 2 ? t - r : -r];\n  }\n\n  _sampleVectorFieldData(e, t, i) {\n    const {\n      symbolTileSize: r\n    } = t;\n    return s(e, \"vector-uv\", r, i);\n  }\n\n  _updateSymbolType(e) {\n    \"vector-field\" === e.type && (this.container.symbolTypes = \"wind-barb\" === e.style ? [\"scalar\", \"triangle\"] : \"simple-scalar\" === e.style ? [\"scalar\"] : [\"triangle\"]);\n  }\n\n};\ne([r()], n.prototype, \"container\", void 0), e([r()], n.prototype, \"layer\", void 0), e([r()], n.prototype, \"type\", void 0), n = e([o(\"esri.views.2d.layers.imagery.VectorFieldTileView2D\")], n);\nconst c = n;\nexport { c as default };","map":{"version":3,"names":["_","e","isSome","t","watch","i","property","r","subclass","o","sampleVectorField","s","RasterVFTileContainer","l","BaseImageryTileSubView2D","a","n","constructor","arguments","_handle","container","layer","type","canUseWebGLForProcessing","fetchTile","interpolation","requestProjectedLocalDirections","level","row","col","rasterInfo","dataType","pixelBlock","convertVectorFieldData","updateTileSource","symbolizerParams","tileData","key","width","_tileInfoView","tileInfo","size","height","symbolTileSize","source","offset","_getTileSymbolOffset","extent","rawPixelData","symbolizerParameters","_sampleVectorFieldData","Math","round","createEmptyTilePixelBlock","invalidateVAO","Promise","resolve","updateTileSymbolizerParameters","local","attach","isCustomTilingScheme","_isCustomTilingScheme","_updateSymbolType","renderer","detach","removeAllChildren","remove","symbolTypes","style","prototype","c","default"],"sources":["E:/各个学科/论文/毕业论文/Atmosphere/eco-friendly/node_modules/@arcgis/core/views/2d/layers/imagery/VectorFieldTileView2D.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import{isSome as t}from\"../../../../core/maybe.js\";import{watch as i}from\"../../../../core/reactiveUtils.js\";import{property as r}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/arrayUtils.js\";import\"../../../../core/accessorSupport/ensureType.js\";import{subclass as o}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{sampleVectorField as s}from\"../../../../layers/support/rasterFunctions/vectorFieldUtils.js\";import{RasterVFTileContainer as l}from\"../../engine/imagery/RasterVFTileContainer.js\";import{BaseImageryTileSubView2D as a}from\"./BaseImageryTileSubView2D.js\";let n=class extends a{constructor(){super(...arguments),this._handle=null,this.container=null,this.layer=null,this.type=\"rasterVF\"}canUseWebGLForProcessing(){return!1}async fetchTile(e,t){t={...t,interpolation:\"nearest\",requestProjectedLocalDirections:!0};const i=await this.layer.fetchTile(e.level,e.row,e.col,t);return\"vector-magdir\"===this.layer.rasterInfo.dataType&&i?.pixelBlock&&(i.pixelBlock=await this.layer.convertVectorFieldData(i.pixelBlock,t)),i}updateTileSource(e,i){const r=i.symbolizerParams,{tileData:o}=e;o.key=e.key,o.width=this._tileInfoView.tileInfo.size[0],o.height=this._tileInfoView.tileInfo.size[1];const{symbolTileSize:s}=r,{source:l}=i;if(o.offset=this._getTileSymbolOffset(o.key,s),t(l)&&t(l.pixelBlock)){const e={extent:l.extent,pixelBlock:l.pixelBlock};o.rawPixelData=e,o.symbolizerParameters=r,o.source=this._sampleVectorFieldData(l.pixelBlock,r,o.offset)}else{const e=[Math.round((this._tileInfoView.tileInfo[0]-o.offset[0])/s),Math.round((this._tileInfoView.tileInfo[1]-o.offset[1])/s)],t=this.createEmptyTilePixelBlock(e);o.source=t,o.symbolizerParameters=r}return o.invalidateVAO(),Promise.resolve(null)}updateTileSymbolizerParameters(e,i){const r=i.local,{symbolTileSize:o}=r,{tileData:s}=e;s.offset=this._getTileSymbolOffset(s.key,o);const l=s.symbolizerParameters.symbolTileSize;return s.symbolizerParameters=r,t(s.rawPixelData?.pixelBlock)&&l!==o&&(s.source=this._sampleVectorFieldData(s.rawPixelData.pixelBlock,s.symbolizerParameters,s.offset)),Promise.resolve(null)}attach(){super.attach(),this.container=new l(this._tileInfoView),this.container.isCustomTilingScheme=this._isCustomTilingScheme,this._updateSymbolType(this.layer.renderer),this._handle=i((()=>this.layer.renderer),(e=>this._updateSymbolType(e)))}detach(){super.detach(),this.container.removeAllChildren(),this._handle.remove(),this._handle=null}_getTileSymbolOffset(e,t){const i=e.col*this._tileInfoView.tileInfo.size[0]%t,r=e.row*this._tileInfoView.tileInfo.size[1]%t;return[i>t/2?t-i:-i,r>t/2?t-r:-r]}_sampleVectorFieldData(e,t,i){const{symbolTileSize:r}=t;return s(e,\"vector-uv\",r,i)}_updateSymbolType(e){\"vector-field\"===e.type&&(this.container.symbolTypes=\"wind-barb\"===e.style?[\"scalar\",\"triangle\"]:\"simple-scalar\"===e.style?[\"scalar\"]:[\"triangle\"])}};e([r()],n.prototype,\"container\",void 0),e([r()],n.prototype,\"layer\",void 0),e([r()],n.prototype,\"type\",void 0),n=e([o(\"esri.views.2d.layers.imagery.VectorFieldTileView2D\")],n);const c=n;export{c as default};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}