{"ast":null,"code":"import \"core-js/modules/es.error.cause.js\";\n\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../../../chunks/tslib.es6.js\";\nimport { HandleOwner as t } from \"../../../../../core/HandleOwner.js\";\nimport r from \"../../../../../core/has.js\";\nimport { isNone as s, applySome as i, isSome as a, filterNones as o } from \"../../../../../core/maybe.js\";\nimport { ignoreAbortErrors as n, after as u, throwIfAborted as h, throwIfNotAbortError as g, isAbortError as d } from \"../../../../../core/promiseUtils.js\";\nimport { when as c, whenOnce as l } from \"../../../../../core/reactiveUtils.js\";\nimport { property as p } from \"../../../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../../../core/arrayUtils.js\";\nimport \"../../../../../core/accessorSupport/ensureType.js\";\nimport { subclass as f } from \"../../../../../core/accessorSupport/decorators/subclass.js\";\nimport { convertToGeometry as y } from \"../../../../../layers/graphics/featureConversionUtils.js\";\nimport { QueryEngine as m } from \"../../../../../layers/graphics/data/QueryEngine.js\";\nimport S from \"../../../../../layers/support/FieldsIndex.js\";\nimport { FeatureStore2D as _ } from \"../FeatureStore2D.js\";\nimport { createSource as v } from \"../sources/createSource.js\";\nimport b from \"../support/AttributeStore.js\";\nimport { BinStore as I } from \"../support/BinStore.js\";\nimport { ClusterStore as w } from \"../support/ClusterStore.js\";\nimport { ComputedAttributeStorage as C } from \"../support/ComputedAttributeStorage.js\";\nimport { FeatureSetReaderJSON as E } from \"../support/FeatureSetReaderJSON.js\";\nimport { UpdateToken as j } from \"../support/UpdateToken.js\";\nimport { QueueProcessor as F } from \"../../../../support/QueueProcessor.js\";\nconst T = 5e3,\n      k = \"tileRenderer.featuresView.attributeView.initialize\",\n      q = \"tileRenderer.featuresView.attributeView.requestUpdate\",\n      R = \"tileRenderer.featuresView.requestRender\";\n\nfunction U(e) {\n  return \"worker:port-closed\" === e.name;\n}\n\nfunction x(e) {\n  if (!d(e) && !U(e)) throw e;\n}\n\nfunction Q(e) {\n  return \"feature\" === e.type && \"snapshot\" === e.mode;\n}\n\nlet O = class extends t {\n  constructor() {\n    super(...arguments), this._storage = new C(), this._markedIdsBufId = this._storage.createBitset(), this._lastCleanup = performance.now(), this._cleanupNeeded = !1, this._invalidated = !1, this._tileToResolver = new Map(), this._didEdit = !1, this._updateVersion = 1, this.tileStore = null, this.config = null, this.processor = null, this.remoteClient = null, this.service = null;\n  }\n\n  initialize() {\n    this._initStores(), this._initSource(), this._updateQueue = new F({\n      concurrency: \"geoevent\" === this._source.type ? 1 : 4,\n      process: (e, t) => this._onTileMessage(e, {\n        signal: t\n      })\n    }), this.handles.add([this.tileStore.on(\"update\", this.onTileUpdate.bind(this)), c(() => !this.updating, () => this.onIdle())]), this._checkUpdating = setInterval(() => this.notifyChange(\"updating\"), 300);\n  }\n\n  _initSource() {\n    const e = this.tileStore.tileScheme,\n          t = () => this._updateQueue.length < 50,\n          r = (e, t) => (this._invalidated = !0, this._patchTile(e, t));\n\n    this._source = v(this.service, this.spatialReference, e, r, t, this.featureStore), this._proxyEvents();\n  }\n\n  _proxyEvents() {\n    if (\"geoevent\" === this._source.type) {\n      const e = this._source.events;\n      this.handles.add([e.on(\"connectionStatus\", e => this.remoteClient.invoke(\"setProperty\", {\n        propertyName: \"connectionStatus\",\n        value: e\n      }).catch(x)), e.on(\"errorString\", e => this.remoteClient.invoke(\"setProperty\", {\n        propertyName: \"errorString\",\n        value: e\n      }).catch(x)), e.on(\"feature\", e => this.remoteClient.invoke(\"emitEvent\", {\n        name: \"data-received\",\n        event: {\n          attributes: e.attributes,\n          centroid: e.centroid,\n          geometry: e.geometry\n        }\n      }).catch(x)), e.on(\"updateRate\", e => this.remoteClient.invoke(\"emitEvent\", {\n        name: \"update-rate\",\n        event: { ...e\n        }\n      }).catch(x))]);\n    }\n  }\n\n  _initAttributeStore(e) {\n    this.attributeStore ? this.attributeStore.invalidateResources() : this.attributeStore = new b({\n      type: \"remote\",\n      initialize: (e, t) => n(this.remoteClient.invoke(k, e, {\n        signal: t\n      }).catch(x)),\n      update: (e, t) => n(this.remoteClient.invoke(q, e, {\n        signal: t\n      }).catch(x)),\n      render: e => n(this.remoteClient.invoke(R, void 0, {\n        signal: e\n      }).catch(x))\n    }, e, () => this.notifyChange(\"updating\"));\n  }\n\n  _initStores() {\n    const e = \"snapshot\" === this.service.type ? \"snapshot\" : \"on-demand\",\n          t = {\n      geometryInfo: {\n        geometryType: this.service.geometryType,\n        hasM: !1,\n        hasZ: !1\n      },\n      spatialReference: this.spatialReference,\n      fieldsIndex: this.fieldsIndex,\n      fields: this.service.fields\n    };\n    this.featureStore = new _(t, this._storage, e);\n  }\n\n  _initQueryEngine(e) {\n    const t = this;\n    this.queryEngine?.destroy(), this.queryEngine = new m({\n      definitionExpression: e.schema.source.definitionExpression,\n      fields: this.service.fields,\n      geometryType: this.service.geometryType,\n      objectIdField: this.service.objectIdField,\n      hasM: !1,\n      hasZ: !1,\n      spatialReference: this.spatialReference.toJSON(),\n      cacheSpatialQueries: !0,\n      featureStore: this.featureStore,\n      aggregateAdapter: {\n        getFeatureObjectIds(e) {\n          if (s(t.aggregateStore)) return [];\n          return t.aggregateStore.getFeatureDisplayIdsForAggregate(e).map(e => t.getObjectId(e));\n        }\n\n      },\n      timeInfo: this.service.timeInfo\n    });\n  }\n\n  destroy() {\n    this._updateQueue.destroy(), this._source.destroy(), this.queryEngine.destroy(), this.attributeStore && this.attributeStore.destroy();\n\n    for (const e of this.tileStore.tiles) this._source.unsubscribe(e);\n\n    clearInterval(this._checkUpdating);\n  }\n\n  get fieldsIndex() {\n    return new S(this.service.fields);\n  }\n\n  get spatialReference() {\n    return this.tileStore.tileScheme.spatialReference;\n  }\n\n  get updating() {\n    return this.isUpdating();\n  }\n\n  isUpdating() {\n    const e = this._source.updating,\n          t = !!this._updateQueue.length,\n          s = !this.attributeStore || this.attributeStore.isUpdating(),\n          i = e || t || s;\n    return r(\"esri-2d-log-updating\") && console.log(`Updating FeatureController2D: ${i}\\n  -> updatingSource ${e}\\n  -> updateQueue ${t}\\n  -> updatingAttributeStore ${s}\\n`), i;\n  }\n\n  enableEvent(e) {\n    this._source.enableEvent(e.name, e.value);\n  }\n\n  pause() {\n    this._updateQueue.pause(), this._updateQueue.clear();\n  }\n\n  resume() {\n    this._updateQueue.resume();\n  }\n\n  pauseStream() {\n    \"geoevent\" === this._source.type && this._source.pauseStream();\n  }\n\n  resumeStream() {\n    \"geoevent\" === this._source.type && this._source.resumeStream();\n  }\n\n  _initAggregateStore(e) {\n    const t = {\n      geometryInfo: {\n        geometryType: this.service.geometryType,\n        hasM: !1,\n        hasZ: !1\n      },\n      spatialReference: this.spatialReference,\n      fieldsIndex: this.fieldsIndex,\n      fields: this.service.fields\n    },\n          r = e.schema.targets?.aggregate?.type,\n          s = i(this.config, e => e.schema.targets?.aggregate?.type);\n\n    if (s !== r && (a(this.aggregateStore) && (this.handles.remove(\"valueRangesChanged\"), this.aggregateStore.destroy(), this.aggregateStore = null), r)) {\n      switch (r) {\n        case \"cluster\":\n          this.aggregateStore = new w(t, this.spatialReference, this._storage, this.service), this.handles.add(this.aggregateStore.events.on(\"valueRangesChanged\", e => {\n            this.remoteClient.invoke(\"emitEvent\", {\n              name: \"valueRangesChanged\",\n              event: {\n                valueRanges: e.valueRanges\n              }\n            }).catch(x);\n          }), \"valueRangesChanged\");\n          break;\n\n        case \"bin\":\n          this.aggregateStore = new I(t, this.spatialReference, this._storage, this.service);\n      }\n\n      this.aggregateStore.onTileUpdate({\n        added: this.tileStore.tiles,\n        removed: []\n      });\n    }\n  }\n\n  async update(e, t) {\n    this._updateVersion++, this._initQueryEngine(t), this._initAttributeStore(t), this.pause(), await Promise.all([this._source.update(e, t.schema.source), this.featureStore.updateSchema(e, t.schema.targets.feature), this.attributeStore.update(e, t), this.attributeStore.updateFilters(e, t, this)]), this._initAggregateStore(t), a(this.aggregateStore) && (await this.aggregateStore.updateSchema(e, t.schema.targets.aggregate)), r(\"esri-2d-update-debug\") && e.describe(), this._set(\"config\", t);\n  }\n\n  async applyUpdate(e) {\n    e.version = this._updateVersion, r(\"esri-2d-update-debug\") && console.debug(`Applying update ${e.version}`), e.mesh && this.clearTiles(), this._updateQueue.resume(), await this._source.applyUpdate(e), this.notifyChange(\"updating\"), await l(() => !this.updating), a(this.aggregateStore) && (await u(10), await l(() => !this.updating));\n  }\n\n  async onEdits({\n    edits: e\n  }) {\n    r(\"esri-2d-update-debug\") && console.debug(\"Applying Edit:\", e), this._didEdit = !0;\n\n    try {\n      const t = e.removed.map(e => e.objectId && -1 !== e.objectId ? e.objectId : this._lookupObjectIdByGlobalId(e.globalId)),\n            r = e.addOrModified.map(({\n        objectId: e\n      }) => e);\n      this.featureStore.invalidate(), await this._source.edit(r, t), this.clearTiles(), this.notifyChange(\"updating\"), a(this.aggregateStore) && this.aggregateStore.clear(), await this._source.resend(), await l(() => !this.updating);\n    } catch (t) {}\n  }\n\n  async refresh(e) {\n    if (!e) {\n      const e = j.empty();\n      return e.storage.filters = !0, this.applyUpdate(e);\n    }\n\n    this.featureStore.invalidate(), this.clearTiles(), this._source.refresh(this._updateVersion), this._cleanupNeeded = !0, this.notifyChange(\"updating\"), await l(() => !this.updating);\n  }\n\n  clearTiles() {\n    for (const e of this.tileStore.tiles) this.processor.onTileClear(e);\n  }\n\n  onTileUpdate(e) {\n    a(this.aggregateStore) && this.aggregateStore.onTileUpdate(e);\n\n    for (const t of e.added) this._source.subscribe(t, this._updateVersion), this._level = t.level;\n\n    for (const t of e.removed) this._source.unsubscribe(t), this._cleanupNeeded = !0, this._tileToResolver.has(t.id) && (this._tileToResolver.get(t.id).resolve(), this._tileToResolver.delete(t.id));\n\n    this.notifyChange(\"updating\");\n  }\n\n  async onIdle() {\n    this._invalidated && (this._invalidated = !1, (a(this.aggregateStore) || \"heatmap\" === this.processor.type) && (await this._repushCurrentLevelTiles())), this._markAndSweep();\n  }\n\n  async querySummaryStatistics({\n    query: e,\n    params: t\n  }) {\n    return this.queryEngine.executeQueryForSummaryStatistics(e, t);\n  }\n\n  async queryUniqueValues({\n    query: e,\n    params: t\n  }) {\n    return this.queryEngine.executeQueryForUniqueValues(e, t);\n  }\n\n  async queryClassBreaks({\n    query: e,\n    params: t\n  }) {\n    return this.queryEngine.executeQueryForClassBreaks(e, t);\n  }\n\n  async queryHistogram({\n    query: e,\n    params: t\n  }) {\n    return this.queryEngine.executeQueryForHistogram(e, t);\n  }\n\n  queryExtent(e) {\n    return this.queryEngine.executeQueryForExtent(e);\n  }\n\n  queryFeatures(e) {\n    return this.queryEngine.executeQuery(e);\n  }\n\n  async queryVisibleFeatures(e) {\n    const t = await this.queryEngine.executeQuery(e),\n          r = t.objectIdFieldName;\n    return t.features = t.features.filter(e => {\n      const t = e.attributes[r],\n            s = this.getDisplayId(t);\n      return i(s, e => this.attributeStore.isVisible(e));\n    }), t;\n  }\n\n  queryFeatureCount(e) {\n    return this.queryEngine.executeQueryForCount(e);\n  }\n\n  queryLatestObservations(e) {\n    return this.queryEngine.executeQueryForLatestObservations(e);\n  }\n\n  queryObjectIds(e) {\n    return this.queryEngine.executeQueryForIds(e);\n  }\n\n  async queryStatistics() {\n    return this.featureStore.storeStatistics;\n  }\n\n  getObjectId(e) {\n    return this.featureStore.lookupObjectId(e, this._storage);\n  }\n\n  getDisplayId(e) {\n    if (a(this.aggregateStore)) {\n      const t = this.aggregateStore.getDisplayId(e);\n\n      if (s(t)) {\n        const t = this.featureStore.lookupDisplayId(e);\n        return this.aggregateStore.getDisplayIdForReferenceId(t);\n      }\n\n      return t;\n    }\n\n    return this.featureStore.lookupDisplayId(e);\n  }\n\n  getFeatures(e) {\n    const t = [],\n          r = [];\n\n    for (const s of e) {\n      const e = a(this.aggregateStore) ? this.getAggregate(s) : null;\n      if (a(e)) {\n        if (a(e.referenceId)) {\n          const r = this.getFeature(e.referenceId);\n          a(r) && t.push(r);\n        } else r.push(e);\n      } else {\n        const e = this.getFeature(s);\n        a(e) && t.push(e);\n      }\n    }\n\n    return {\n      features: t,\n      aggregates: r\n    };\n  }\n\n  getFeature(e) {\n    const t = this.featureStore.lookupFeatureByDisplayId(e, this._storage);\n    if (s(t)) return null;\n    const r = t.readHydratedGeometry(),\n          i = y(r, t.geometryType, t.hasZ, t.hasM);\n    return {\n      attributes: t.readAttributes(),\n      geometry: i\n    };\n  }\n\n  getAggregate(e) {\n    return s(this.aggregateStore) ? null : this.aggregateStore.getAggregate(e);\n  }\n\n  getAggregates() {\n    return s(this.aggregateStore) ? [] : this.aggregateStore.getAggregates();\n  }\n\n  async setHighlight(e) {\n    const t = o(e.map(e => this.getDisplayId(e)));\n    return this.attributeStore.setHighlight(e, t);\n  }\n\n  _lookupObjectIdByGlobalId(e) {\n    const t = this.service.globalIdField;\n    if (s(t)) throw new Error(\"Expected globalIdField to be defined\");\n    let r = null;\n    if (this.featureStore.forEach(s => {\n      e === s.readAttribute(t) && (r = s.getObjectId());\n    }), s(r)) throw new Error(`Expected to find a feature with globalId ${e}`);\n    return r;\n  }\n\n  async _repushCurrentLevelTiles() {\n    const e = this.tileStore.tiles.filter(e => e.level === this._level).map(async e => this._patchTile({\n      type: \"append\",\n      id: e.key.id,\n      addOrUpdate: E.fromOptimizedFeatures([], this.service),\n      remove: [],\n      end: !0,\n      status: j.empty()\n    }));\n    await Promise.all(e);\n  }\n\n  _maybeForceCleanup() {\n    performance.now() - this._lastCleanup > T && this._markAndSweep();\n  }\n\n  _patchTile(e, t) {\n    const r = this._updateQueue.push(e, t).then(() => {\n      this.notifyChange(\"updating\");\n    }).catch(e => {\n      this.notifyChange(\"updating\");\n    });\n\n    return this.notifyChange(\"updating\"), r;\n  }\n\n  async _onTileMessage(e, t) {\n    h(t);\n    const r = this.tileStore.get(e.id);\n    if (!r) return;\n    if (e.clear) return this.processor.onTileClear(r);\n    const i = e.status;\n    this._cleanupNeeded = !0;\n    const o = [];\n\n    for (const s of e.remove) {\n      const e = this.featureStore.lookupDisplayId(s);\n      e && o.push(e);\n    }\n\n    e.remove = o;\n\n    try {\n      if (s(e.addOrUpdate)) return void this.processor.onTileMessage(r, { ...e,\n        addOrUpdate: null\n      }, a(this.aggregateStore), t).catch(g);\n\n      if (e.addOrUpdate.setArcadeSpatialReference(this.spatialReference), this.featureStore.hasInstance(e.addOrUpdate.instance) && i.targets.feature || (i.targets.feature = !0, this.featureStore.onTileData(r, e)), !i.storage.data || !i.storage.filters) {\n        i.storage.data = !0, i.storage.filters = !0, this.attributeStore.onTileData(r, e);\n        \"geoevent\" === this._source.type || this._didEdit ? (await this.attributeStore.sendUpdates(), h(t)) : this.attributeStore.sendUpdates();\n      }\n\n      if (a(this.aggregateStore) && !i.targets.aggregate) {\n        i.targets.aggregate = !0;\n\n        const t = Q(this._source) && this._source.loading,\n              s = !Q(this._source) || t || e.end;\n\n        if (this.aggregateStore.onTileData(r, e, this._storage, this.attributeStore, s), !s) return;\n        i.mesh || (this.attributeStore.onTileData(r, e), await this.attributeStore.sendUpdates());\n      }\n\n      i.mesh || (i.mesh = !0, await this.processor.onTileMessage(r, e, a(this.aggregateStore), t), h(t)), this._maybeForceCleanup();\n    } catch (n) {\n      g(n);\n    }\n  }\n\n  _mark(e, t, r) {\n    const s = (4294901760 & this._storage.getInstanceId(e)) >>> 16;\n    e && (t.add(s), r.set(e));\n  }\n\n  _markAndSweep() {\n    this._lastCleanup = performance.now();\n    if (!(!(\"feature\" === this._source.type && \"snapshot\" === this._source.mode) && (\"geoevent\" === this._source.type || this._cleanupNeeded))) return;\n    this._cleanupNeeded = !1;\n\n    const e = this._storage.getBitset(this._markedIdsBufId),\n          t = new Set();\n\n    e.clear();\n\n    for (const r of this.tileStore.tiles) for (const s of this._source.readers(r.id)) {\n      const r = s.getCursor();\n\n      for (; r.next();) {\n        let s = r.getDisplayId();\n\n        if (!s) {\n          const e = r.getObjectId();\n          s = this.featureStore.lookupDisplayId(e);\n        }\n\n        this._mark(s, t, e);\n      }\n    }\n\n    \"symbol\" === this.processor.type && this.processor.forEachBufferId(r => {\n      this._mark(r, t, e);\n    }), this._updateQueue.forEach(r => {\n      for (const s of r.remove) {\n        const r = this.featureStore.lookupDisplayId(s);\n\n        this._mark(r, t, e);\n      }\n    }), a(this.aggregateStore) && (this.aggregateStore.sweepFeatures(e, this.featureStore), \"sweepAggregates\" in this.aggregateStore && this.aggregateStore.sweepAggregates(this._storage, this.attributeStore, this._level)), this.featureStore.sweepFeatures(e, this._storage, this.attributeStore), this.featureStore.sweepFeatureSets(t);\n  }\n\n};\ne([p({\n  constructOnly: !0\n})], O.prototype, \"tileStore\", void 0), e([p()], O.prototype, \"config\", void 0), e([p({\n  readOnly: !0\n})], O.prototype, \"fieldsIndex\", null), e([p()], O.prototype, \"processor\", void 0), e([p({\n  constructOnly: !0\n})], O.prototype, \"remoteClient\", void 0), e([p({\n  constructOnly: !0\n})], O.prototype, \"service\", void 0), e([p()], O.prototype, \"spatialReference\", null), e([p()], O.prototype, \"updating\", null), O = e([f(\"esri.views.2d.layers.features.controllers.FeatureController2D\")], O);\nconst A = O;\nexport { A as default };","map":{"version":3,"names":["_","e","HandleOwner","t","r","isNone","s","applySome","i","isSome","a","filterNones","o","ignoreAbortErrors","n","after","u","throwIfAborted","h","throwIfNotAbortError","g","isAbortError","d","when","c","whenOnce","l","property","p","subclass","f","convertToGeometry","y","QueryEngine","m","S","FeatureStore2D","createSource","v","b","BinStore","I","ClusterStore","w","ComputedAttributeStorage","C","FeatureSetReaderJSON","E","UpdateToken","j","QueueProcessor","F","T","k","q","R","U","name","x","Q","type","mode","O","constructor","arguments","_storage","_markedIdsBufId","createBitset","_lastCleanup","performance","now","_cleanupNeeded","_invalidated","_tileToResolver","Map","_didEdit","_updateVersion","tileStore","config","processor","remoteClient","service","initialize","_initStores","_initSource","_updateQueue","concurrency","_source","process","_onTileMessage","signal","handles","add","on","onTileUpdate","bind","updating","onIdle","_checkUpdating","setInterval","notifyChange","tileScheme","length","_patchTile","spatialReference","featureStore","_proxyEvents","events","invoke","propertyName","value","catch","event","attributes","centroid","geometry","_initAttributeStore","attributeStore","invalidateResources","update","render","geometryInfo","geometryType","hasM","hasZ","fieldsIndex","fields","_initQueryEngine","queryEngine","destroy","definitionExpression","schema","source","objectIdField","toJSON","cacheSpatialQueries","aggregateAdapter","getFeatureObjectIds","aggregateStore","getFeatureDisplayIdsForAggregate","map","getObjectId","timeInfo","tiles","unsubscribe","clearInterval","isUpdating","console","log","enableEvent","pause","clear","resume","pauseStream","resumeStream","_initAggregateStore","targets","aggregate","remove","valueRanges","added","removed","Promise","all","updateSchema","feature","updateFilters","describe","_set","applyUpdate","version","debug","mesh","clearTiles","onEdits","edits","objectId","_lookupObjectIdByGlobalId","globalId","addOrModified","invalidate","edit","resend","refresh","empty","storage","filters","onTileClear","subscribe","_level","level","has","id","get","resolve","delete","_repushCurrentLevelTiles","_markAndSweep","querySummaryStatistics","query","params","executeQueryForSummaryStatistics","queryUniqueValues","executeQueryForUniqueValues","queryClassBreaks","executeQueryForClassBreaks","queryHistogram","executeQueryForHistogram","queryExtent","executeQueryForExtent","queryFeatures","executeQuery","queryVisibleFeatures","objectIdFieldName","features","filter","getDisplayId","isVisible","queryFeatureCount","executeQueryForCount","queryLatestObservations","executeQueryForLatestObservations","queryObjectIds","executeQueryForIds","queryStatistics","storeStatistics","lookupObjectId","lookupDisplayId","getDisplayIdForReferenceId","getFeatures","getAggregate","referenceId","getFeature","push","aggregates","lookupFeatureByDisplayId","readHydratedGeometry","readAttributes","getAggregates","setHighlight","globalIdField","Error","forEach","readAttribute","key","addOrUpdate","fromOptimizedFeatures","end","status","_maybeForceCleanup","then","onTileMessage","setArcadeSpatialReference","hasInstance","instance","onTileData","data","sendUpdates","loading","_mark","getInstanceId","set","getBitset","Set","readers","getCursor","next","forEachBufferId","sweepFeatures","sweepAggregates","sweepFeatureSets","constructOnly","prototype","readOnly","A","default"],"sources":["C:/Users/hp/Desktop/eco-friendly atmosphere/Atmosphere/eco-friendly/node_modules/@arcgis/core/views/2d/layers/features/controllers/FeatureController2D.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../../chunks/tslib.es6.js\";import{HandleOwner as t}from\"../../../../../core/HandleOwner.js\";import r from\"../../../../../core/has.js\";import{isNone as s,applySome as i,isSome as a,filterNones as o}from\"../../../../../core/maybe.js\";import{ignoreAbortErrors as n,after as u,throwIfAborted as h,throwIfNotAbortError as g,isAbortError as d}from\"../../../../../core/promiseUtils.js\";import{when as c,whenOnce as l}from\"../../../../../core/reactiveUtils.js\";import{property as p}from\"../../../../../core/accessorSupport/decorators/property.js\";import\"../../../../../core/arrayUtils.js\";import\"../../../../../core/accessorSupport/ensureType.js\";import{subclass as f}from\"../../../../../core/accessorSupport/decorators/subclass.js\";import{convertToGeometry as y}from\"../../../../../layers/graphics/featureConversionUtils.js\";import{QueryEngine as m}from\"../../../../../layers/graphics/data/QueryEngine.js\";import S from\"../../../../../layers/support/FieldsIndex.js\";import{FeatureStore2D as _}from\"../FeatureStore2D.js\";import{createSource as v}from\"../sources/createSource.js\";import b from\"../support/AttributeStore.js\";import{BinStore as I}from\"../support/BinStore.js\";import{ClusterStore as w}from\"../support/ClusterStore.js\";import{ComputedAttributeStorage as C}from\"../support/ComputedAttributeStorage.js\";import{FeatureSetReaderJSON as E}from\"../support/FeatureSetReaderJSON.js\";import{UpdateToken as j}from\"../support/UpdateToken.js\";import{QueueProcessor as F}from\"../../../../support/QueueProcessor.js\";const T=5e3,k=\"tileRenderer.featuresView.attributeView.initialize\",q=\"tileRenderer.featuresView.attributeView.requestUpdate\",R=\"tileRenderer.featuresView.requestRender\";function U(e){return\"worker:port-closed\"===e.name}function x(e){if(!d(e)&&!U(e))throw e}function Q(e){return\"feature\"===e.type&&\"snapshot\"===e.mode}let O=class extends t{constructor(){super(...arguments),this._storage=new C,this._markedIdsBufId=this._storage.createBitset(),this._lastCleanup=performance.now(),this._cleanupNeeded=!1,this._invalidated=!1,this._tileToResolver=new Map,this._didEdit=!1,this._updateVersion=1,this.tileStore=null,this.config=null,this.processor=null,this.remoteClient=null,this.service=null}initialize(){this._initStores(),this._initSource(),this._updateQueue=new F({concurrency:\"geoevent\"===this._source.type?1:4,process:(e,t)=>this._onTileMessage(e,{signal:t})}),this.handles.add([this.tileStore.on(\"update\",this.onTileUpdate.bind(this)),c((()=>!this.updating),(()=>this.onIdle()))]),this._checkUpdating=setInterval((()=>this.notifyChange(\"updating\")),300)}_initSource(){const e=this.tileStore.tileScheme,t=()=>this._updateQueue.length<50,r=(e,t)=>(this._invalidated=!0,this._patchTile(e,t));this._source=v(this.service,this.spatialReference,e,r,t,this.featureStore),this._proxyEvents()}_proxyEvents(){if(\"geoevent\"===this._source.type){const e=this._source.events;this.handles.add([e.on(\"connectionStatus\",(e=>this.remoteClient.invoke(\"setProperty\",{propertyName:\"connectionStatus\",value:e}).catch(x))),e.on(\"errorString\",(e=>this.remoteClient.invoke(\"setProperty\",{propertyName:\"errorString\",value:e}).catch(x))),e.on(\"feature\",(e=>this.remoteClient.invoke(\"emitEvent\",{name:\"data-received\",event:{attributes:e.attributes,centroid:e.centroid,geometry:e.geometry}}).catch(x))),e.on(\"updateRate\",(e=>this.remoteClient.invoke(\"emitEvent\",{name:\"update-rate\",event:{...e}}).catch(x)))])}}_initAttributeStore(e){this.attributeStore?this.attributeStore.invalidateResources():this.attributeStore=new b({type:\"remote\",initialize:(e,t)=>n(this.remoteClient.invoke(k,e,{signal:t}).catch(x)),update:(e,t)=>n(this.remoteClient.invoke(q,e,{signal:t}).catch(x)),render:e=>n(this.remoteClient.invoke(R,void 0,{signal:e}).catch(x))},e,(()=>this.notifyChange(\"updating\")))}_initStores(){const e=\"snapshot\"===this.service.type?\"snapshot\":\"on-demand\",t={geometryInfo:{geometryType:this.service.geometryType,hasM:!1,hasZ:!1},spatialReference:this.spatialReference,fieldsIndex:this.fieldsIndex,fields:this.service.fields};this.featureStore=new _(t,this._storage,e)}_initQueryEngine(e){const t=this;this.queryEngine?.destroy(),this.queryEngine=new m({definitionExpression:e.schema.source.definitionExpression,fields:this.service.fields,geometryType:this.service.geometryType,objectIdField:this.service.objectIdField,hasM:!1,hasZ:!1,spatialReference:this.spatialReference.toJSON(),cacheSpatialQueries:!0,featureStore:this.featureStore,aggregateAdapter:{getFeatureObjectIds(e){if(s(t.aggregateStore))return[];return t.aggregateStore.getFeatureDisplayIdsForAggregate(e).map((e=>t.getObjectId(e)))}},timeInfo:this.service.timeInfo})}destroy(){this._updateQueue.destroy(),this._source.destroy(),this.queryEngine.destroy(),this.attributeStore&&this.attributeStore.destroy();for(const e of this.tileStore.tiles)this._source.unsubscribe(e);clearInterval(this._checkUpdating)}get fieldsIndex(){return new S(this.service.fields)}get spatialReference(){return this.tileStore.tileScheme.spatialReference}get updating(){return this.isUpdating()}isUpdating(){const e=this._source.updating,t=!!this._updateQueue.length,s=!this.attributeStore||this.attributeStore.isUpdating(),i=e||t||s;return r(\"esri-2d-log-updating\")&&console.log(`Updating FeatureController2D: ${i}\\n  -> updatingSource ${e}\\n  -> updateQueue ${t}\\n  -> updatingAttributeStore ${s}\\n`),i}enableEvent(e){this._source.enableEvent(e.name,e.value)}pause(){this._updateQueue.pause(),this._updateQueue.clear()}resume(){this._updateQueue.resume()}pauseStream(){\"geoevent\"===this._source.type&&this._source.pauseStream()}resumeStream(){\"geoevent\"===this._source.type&&this._source.resumeStream()}_initAggregateStore(e){const t={geometryInfo:{geometryType:this.service.geometryType,hasM:!1,hasZ:!1},spatialReference:this.spatialReference,fieldsIndex:this.fieldsIndex,fields:this.service.fields},r=e.schema.targets?.aggregate?.type,s=i(this.config,(e=>e.schema.targets?.aggregate?.type));if(s!==r&&(a(this.aggregateStore)&&(this.handles.remove(\"valueRangesChanged\"),this.aggregateStore.destroy(),this.aggregateStore=null),r)){switch(r){case\"cluster\":this.aggregateStore=new w(t,this.spatialReference,this._storage,this.service),this.handles.add(this.aggregateStore.events.on(\"valueRangesChanged\",(e=>{this.remoteClient.invoke(\"emitEvent\",{name:\"valueRangesChanged\",event:{valueRanges:e.valueRanges}}).catch(x)})),\"valueRangesChanged\");break;case\"bin\":this.aggregateStore=new I(t,this.spatialReference,this._storage,this.service)}this.aggregateStore.onTileUpdate({added:this.tileStore.tiles,removed:[]})}}async update(e,t){this._updateVersion++,this._initQueryEngine(t),this._initAttributeStore(t),this.pause(),await Promise.all([this._source.update(e,t.schema.source),this.featureStore.updateSchema(e,t.schema.targets.feature),this.attributeStore.update(e,t),this.attributeStore.updateFilters(e,t,this)]),this._initAggregateStore(t),a(this.aggregateStore)&&await this.aggregateStore.updateSchema(e,t.schema.targets.aggregate),r(\"esri-2d-update-debug\")&&e.describe(),this._set(\"config\",t)}async applyUpdate(e){e.version=this._updateVersion,r(\"esri-2d-update-debug\")&&console.debug(`Applying update ${e.version}`),e.mesh&&this.clearTiles(),this._updateQueue.resume(),await this._source.applyUpdate(e),this.notifyChange(\"updating\"),await l((()=>!this.updating)),a(this.aggregateStore)&&(await u(10),await l((()=>!this.updating)))}async onEdits({edits:e}){r(\"esri-2d-update-debug\")&&console.debug(\"Applying Edit:\",e),this._didEdit=!0;try{const t=e.removed.map((e=>e.objectId&&-1!==e.objectId?e.objectId:this._lookupObjectIdByGlobalId(e.globalId))),r=e.addOrModified.map((({objectId:e})=>e));this.featureStore.invalidate(),await this._source.edit(r,t),this.clearTiles(),this.notifyChange(\"updating\"),a(this.aggregateStore)&&this.aggregateStore.clear(),await this._source.resend(),await l((()=>!this.updating))}catch(t){}}async refresh(e){if(!e){const e=j.empty();return e.storage.filters=!0,this.applyUpdate(e)}this.featureStore.invalidate(),this.clearTiles(),this._source.refresh(this._updateVersion),this._cleanupNeeded=!0,this.notifyChange(\"updating\"),await l((()=>!this.updating))}clearTiles(){for(const e of this.tileStore.tiles)this.processor.onTileClear(e)}onTileUpdate(e){a(this.aggregateStore)&&this.aggregateStore.onTileUpdate(e);for(const t of e.added)this._source.subscribe(t,this._updateVersion),this._level=t.level;for(const t of e.removed)this._source.unsubscribe(t),this._cleanupNeeded=!0,this._tileToResolver.has(t.id)&&(this._tileToResolver.get(t.id).resolve(),this._tileToResolver.delete(t.id));this.notifyChange(\"updating\")}async onIdle(){this._invalidated&&(this._invalidated=!1,(a(this.aggregateStore)||\"heatmap\"===this.processor.type)&&await this._repushCurrentLevelTiles()),this._markAndSweep()}async querySummaryStatistics({query:e,params:t}){return this.queryEngine.executeQueryForSummaryStatistics(e,t)}async queryUniqueValues({query:e,params:t}){return this.queryEngine.executeQueryForUniqueValues(e,t)}async queryClassBreaks({query:e,params:t}){return this.queryEngine.executeQueryForClassBreaks(e,t)}async queryHistogram({query:e,params:t}){return this.queryEngine.executeQueryForHistogram(e,t)}queryExtent(e){return this.queryEngine.executeQueryForExtent(e)}queryFeatures(e){return this.queryEngine.executeQuery(e)}async queryVisibleFeatures(e){const t=await this.queryEngine.executeQuery(e),r=t.objectIdFieldName;return t.features=t.features.filter((e=>{const t=e.attributes[r],s=this.getDisplayId(t);return i(s,(e=>this.attributeStore.isVisible(e)))})),t}queryFeatureCount(e){return this.queryEngine.executeQueryForCount(e)}queryLatestObservations(e){return this.queryEngine.executeQueryForLatestObservations(e)}queryObjectIds(e){return this.queryEngine.executeQueryForIds(e)}async queryStatistics(){return this.featureStore.storeStatistics}getObjectId(e){return this.featureStore.lookupObjectId(e,this._storage)}getDisplayId(e){if(a(this.aggregateStore)){const t=this.aggregateStore.getDisplayId(e);if(s(t)){const t=this.featureStore.lookupDisplayId(e);return this.aggregateStore.getDisplayIdForReferenceId(t)}return t}return this.featureStore.lookupDisplayId(e)}getFeatures(e){const t=[],r=[];for(const s of e){const e=a(this.aggregateStore)?this.getAggregate(s):null;if(a(e))if(a(e.referenceId)){const r=this.getFeature(e.referenceId);a(r)&&t.push(r)}else r.push(e);else{const e=this.getFeature(s);a(e)&&t.push(e)}}return{features:t,aggregates:r}}getFeature(e){const t=this.featureStore.lookupFeatureByDisplayId(e,this._storage);if(s(t))return null;const r=t.readHydratedGeometry(),i=y(r,t.geometryType,t.hasZ,t.hasM);return{attributes:t.readAttributes(),geometry:i}}getAggregate(e){return s(this.aggregateStore)?null:this.aggregateStore.getAggregate(e)}getAggregates(){return s(this.aggregateStore)?[]:this.aggregateStore.getAggregates()}async setHighlight(e){const t=o(e.map((e=>this.getDisplayId(e))));return this.attributeStore.setHighlight(e,t)}_lookupObjectIdByGlobalId(e){const t=this.service.globalIdField;if(s(t))throw new Error(\"Expected globalIdField to be defined\");let r=null;if(this.featureStore.forEach((s=>{e===s.readAttribute(t)&&(r=s.getObjectId())})),s(r))throw new Error(`Expected to find a feature with globalId ${e}`);return r}async _repushCurrentLevelTiles(){const e=this.tileStore.tiles.filter((e=>e.level===this._level)).map((async e=>this._patchTile({type:\"append\",id:e.key.id,addOrUpdate:E.fromOptimizedFeatures([],this.service),remove:[],end:!0,status:j.empty()})));await Promise.all(e)}_maybeForceCleanup(){performance.now()-this._lastCleanup>T&&this._markAndSweep()}_patchTile(e,t){const r=this._updateQueue.push(e,t).then((()=>{this.notifyChange(\"updating\")})).catch((e=>{this.notifyChange(\"updating\")}));return this.notifyChange(\"updating\"),r}async _onTileMessage(e,t){h(t);const r=this.tileStore.get(e.id);if(!r)return;if(e.clear)return this.processor.onTileClear(r);const i=e.status;this._cleanupNeeded=!0;const o=[];for(const s of e.remove){const e=this.featureStore.lookupDisplayId(s);e&&o.push(e)}e.remove=o;try{if(s(e.addOrUpdate))return void this.processor.onTileMessage(r,{...e,addOrUpdate:null},a(this.aggregateStore),t).catch(g);if(e.addOrUpdate.setArcadeSpatialReference(this.spatialReference),this.featureStore.hasInstance(e.addOrUpdate.instance)&&i.targets.feature||(i.targets.feature=!0,this.featureStore.onTileData(r,e)),!i.storage.data||!i.storage.filters){i.storage.data=!0,i.storage.filters=!0,this.attributeStore.onTileData(r,e);\"geoevent\"===this._source.type||this._didEdit?(await this.attributeStore.sendUpdates(),h(t)):this.attributeStore.sendUpdates()}if(a(this.aggregateStore)&&!i.targets.aggregate){i.targets.aggregate=!0;const t=Q(this._source)&&this._source.loading,s=!Q(this._source)||t||e.end;if(this.aggregateStore.onTileData(r,e,this._storage,this.attributeStore,s),!s)return;i.mesh||(this.attributeStore.onTileData(r,e),await this.attributeStore.sendUpdates())}i.mesh||(i.mesh=!0,await this.processor.onTileMessage(r,e,a(this.aggregateStore),t),h(t)),this._maybeForceCleanup()}catch(n){g(n)}}_mark(e,t,r){const s=(4294901760&this._storage.getInstanceId(e))>>>16;e&&(t.add(s),r.set(e))}_markAndSweep(){this._lastCleanup=performance.now();if(!(!(\"feature\"===this._source.type&&\"snapshot\"===this._source.mode)&&(\"geoevent\"===this._source.type||this._cleanupNeeded)))return;this._cleanupNeeded=!1;const e=this._storage.getBitset(this._markedIdsBufId),t=new Set;e.clear();for(const r of this.tileStore.tiles)for(const s of this._source.readers(r.id)){const r=s.getCursor();for(;r.next();){let s=r.getDisplayId();if(!s){const e=r.getObjectId();s=this.featureStore.lookupDisplayId(e)}this._mark(s,t,e)}}\"symbol\"===this.processor.type&&this.processor.forEachBufferId((r=>{this._mark(r,t,e)})),this._updateQueue.forEach((r=>{for(const s of r.remove){const r=this.featureStore.lookupDisplayId(s);this._mark(r,t,e)}})),a(this.aggregateStore)&&(this.aggregateStore.sweepFeatures(e,this.featureStore),\"sweepAggregates\"in this.aggregateStore&&this.aggregateStore.sweepAggregates(this._storage,this.attributeStore,this._level)),this.featureStore.sweepFeatures(e,this._storage,this.attributeStore),this.featureStore.sweepFeatureSets(t)}};e([p({constructOnly:!0})],O.prototype,\"tileStore\",void 0),e([p()],O.prototype,\"config\",void 0),e([p({readOnly:!0})],O.prototype,\"fieldsIndex\",null),e([p()],O.prototype,\"processor\",void 0),e([p({constructOnly:!0})],O.prototype,\"remoteClient\",void 0),e([p({constructOnly:!0})],O.prototype,\"service\",void 0),e([p()],O.prototype,\"spatialReference\",null),e([p()],O.prototype,\"updating\",null),O=e([f(\"esri.views.2d.layers.features.controllers.FeatureController2D\")],O);const A=O;export{A as default};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}