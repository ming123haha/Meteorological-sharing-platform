{"ast":null,"code":"import \"core-js/modules/es.error.cause.js\";\n\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport { eachAlways as e } from \"../../../../../core/promiseUtils.js\";\nimport { BufferView as i } from \"./bufferview.js\";\n\nclass r {\n  constructor(e) {\n    this._gltf = e, this._bufferViews = [], this._isFinalized = !1, e.buffers || (e.buffers = []), this.index = e.buffers.length;\n    const i = {\n      byteLength: -1\n    };\n    e.buffers.push(i), this._buffer = i;\n  }\n\n  addBufferView(e, r, t) {\n    if (this._finalizePromise) throw new Error(\"Cannot add buffer view after fiinalizing buffer\");\n    const f = new i(this, this._gltf, e, r, t);\n    return this._bufferViews.push(f), f;\n  }\n\n  getByteOffset(e) {\n    let i = 0;\n\n    for (const r of this._bufferViews) {\n      if (r === e) return i;\n      i += r.byteSize;\n    }\n\n    throw new Error(\"Given bufferView was not present in this buffer\");\n  }\n\n  getViewFinalizePromises(e) {\n    const i = [];\n\n    for (const r of this._bufferViews) {\n      if (e && r === e) return i;\n      i.push(r.finalized);\n    }\n\n    return i;\n  }\n\n  getArrayBuffer() {\n    if (!this._isFinalized) throw new Error(\"Cannot get ArrayBuffer from Buffer before it is finalized\");\n\n    const e = this._getTotalSize(),\n          i = new ArrayBuffer(e);\n\n    let r = 0;\n\n    for (const t of this._bufferViews) t.writeOutToBuffer(i, r), r += t.byteSize;\n\n    return i;\n  }\n\n  finalize() {\n    if (this._finalizePromise) throw new Error(`Buffer ${this.index} was already finalized`);\n    return this._finalizePromise = new Promise(i => {\n      i(e(this.getViewFinalizePromises()));\n    }).then(() => {\n      this._isFinalized = !0;\n      const e = this.getArrayBuffer();\n      this._buffer.byteLength = e.byteLength, this._buffer.uri = e;\n    }), this._gltf.extras?.promises.push(this._finalizePromise), this._finalizePromise;\n  }\n\n  _getTotalSize() {\n    let e = 0;\n\n    for (const i of this._bufferViews) e += i.byteSize;\n\n    return e;\n  }\n\n}\n\nexport { r as Buffer };","map":{"version":3,"names":["eachAlways","e","BufferView","i","r","constructor","_gltf","_bufferViews","_isFinalized","buffers","index","length","byteLength","push","_buffer","addBufferView","t","_finalizePromise","Error","f","getByteOffset","byteSize","getViewFinalizePromises","finalized","getArrayBuffer","_getTotalSize","ArrayBuffer","writeOutToBuffer","finalize","Promise","then","uri","extras","promises","Buffer"],"sources":["E:/各个学科/论文/毕业论文/Atmosphere/eco-friendly/node_modules/@arcgis/core/geometry/support/meshUtils/exporters/gltf/buffer.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{eachAlways as e}from\"../../../../../core/promiseUtils.js\";import{BufferView as i}from\"./bufferview.js\";class r{constructor(e){this._gltf=e,this._bufferViews=[],this._isFinalized=!1,e.buffers||(e.buffers=[]),this.index=e.buffers.length;const i={byteLength:-1};e.buffers.push(i),this._buffer=i}addBufferView(e,r,t){if(this._finalizePromise)throw new Error(\"Cannot add buffer view after fiinalizing buffer\");const f=new i(this,this._gltf,e,r,t);return this._bufferViews.push(f),f}getByteOffset(e){let i=0;for(const r of this._bufferViews){if(r===e)return i;i+=r.byteSize}throw new Error(\"Given bufferView was not present in this buffer\")}getViewFinalizePromises(e){const i=[];for(const r of this._bufferViews){if(e&&r===e)return i;i.push(r.finalized)}return i}getArrayBuffer(){if(!this._isFinalized)throw new Error(\"Cannot get ArrayBuffer from Buffer before it is finalized\");const e=this._getTotalSize(),i=new ArrayBuffer(e);let r=0;for(const t of this._bufferViews)t.writeOutToBuffer(i,r),r+=t.byteSize;return i}finalize(){if(this._finalizePromise)throw new Error(`Buffer ${this.index} was already finalized`);return this._finalizePromise=new Promise((i=>{i(e(this.getViewFinalizePromises()))})).then((()=>{this._isFinalized=!0;const e=this.getArrayBuffer();this._buffer.byteLength=e.byteLength,this._buffer.uri=e})),this._gltf.extras?.promises.push(this._finalizePromise),this._finalizePromise}_getTotalSize(){let e=0;for(const i of this._bufferViews)e+=i.byteSize;return e}}export{r as Buffer};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}