{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../../chunks/tslib.es6.js\";\nimport t from \"../../../../Graphic.js\";\nimport r from \"../../../../core/Accessor.js\";\nimport i from \"../../../../core/Logger.js\";\nimport { isSome as s } from \"../../../../core/maybe.js\";\nimport { isAbortError as a } from \"../../../../core/promiseUtils.js\";\nimport { property as o } from \"../../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../../core/arrayUtils.js\";\nimport \"../../../../core/accessorSupport/ensureType.js\";\nimport { subclass as p } from \"../../../../core/accessorSupport/decorators/subclass.js\";\nimport { mosaicPixelData as n } from \"../../../../layers/support/rasterFunctions/pixelUtils.js\";\nimport { BitmapContainer as l } from \"../../engine/BitmapContainer.js\";\nimport { Container as c } from \"../../engine/Container.js\";\nimport h from \"../../engine/ImageryBitmapSource.js\";\nimport m from \"../support/ExportStrategy.js\";\nlet d = class extends r {\n  constructor() {\n    super(...arguments), this.attached = !1, this.container = new c(), this.updateRequested = !1, this.type = \"imagery\", this._bitmapView = new l();\n  }\n\n  destroy() {\n    this.attached && (this.detach(), this.attached = !1), this.updateRequested = !1;\n  }\n\n  get updating() {\n    return !this.attached || this.isUpdating();\n  }\n\n  update(e) {\n    this.strategy.update(e).catch(e => {\n      a(e) || i.getLogger(this.declaredClass).error(e);\n    });\n  }\n\n  hitTest(e) {\n    return new t({\n      attributes: {},\n      geometry: e.clone(),\n      layer: this.layer\n    });\n  }\n\n  attach() {\n    this.container.addChild(this._bitmapView);\n    const e = this.layer.version >= 10,\n          t = this.layer.version >= 10.1 ? this.layer.imageMaxHeight : 2048,\n          r = this.layer.version >= 10.1 ? this.layer.imageMaxWidth : 2048;\n    this.strategy = new m({\n      container: this._bitmapView,\n      imageNormalizationSupported: e,\n      imageMaxHeight: t,\n      imageMaxWidth: r,\n      fetchSource: this._fetchImage.bind(this),\n      requestUpdate: () => this.requestUpdate()\n    });\n  }\n\n  detach() {\n    this.strategy.destroy(), this._bitmapView.removeAllChildren(), this.container.removeAllChildren(), this.updateRequested = !1;\n  }\n\n  redraw() {\n    this.strategy.updateExports(async e => {\n      if (e.source instanceof HTMLImageElement) return;\n      const t = await this.layer.applyRenderer({\n        extent: e.source.extent,\n        pixelBlock: e.source.originalPixelBlock ?? e.source.pixelBlock\n      }),\n            r = e.source;\n\n      r.filter = e => this.layer.pixelFilter ? this.layer.applyFilter(e) : { ...t,\n        extent: r.extent\n      };\n    }).catch(e => {\n      a(e) || i.getLogger(this.declaredClass).error(e);\n    });\n  }\n\n  requestUpdate() {\n    this.updateRequested || (this.updateRequested = !0, this.view.requestUpdate());\n  }\n\n  isUpdating() {\n    return this.strategy.updating || this.updateRequested;\n  }\n\n  getPixelData() {\n    if (this.updating) return null;\n    const e = this.strategy.bitmaps;\n    if (1 === e.length && e[0].source) return {\n      extent: e[0].source.extent,\n      pixelBlock: e[0].source.originalPixelBlock\n    };\n\n    if (e.length > 1) {\n      const t = this.view.extent,\n            r = e.map(e => e.source).filter(e => e.extent && e.extent.intersects(t)).map(e => ({\n        extent: e.extent,\n        pixelBlock: e.originalPixelBlock\n      })),\n            i = n(r, t);\n      return s(i) ? {\n        extent: i.extent,\n        pixelBlock: i.pixelBlock\n      } : null;\n    }\n\n    return null;\n  }\n\n  _fetchImage(e, t, r, i) {\n    return (i = i || {}).timeExtent = this.timeExtent, i.requestAsImageElement = !0, this.layer.fetchImage(e, t, r, i).then(e => e.imageOrCanvasElement ? e.imageOrCanvasElement : this.layer.applyRenderer(e.pixelData, {\n      signal: i.signal\n    }).then(t => {\n      const r = new h(t.pixelBlock, t.extent.clone(), e.pixelData.pixelBlock);\n      return r.filter = e => this.layer.applyFilter(e), r;\n    }));\n  }\n\n};\ne([o()], d.prototype, \"attached\", void 0), e([o()], d.prototype, \"container\", void 0), e([o()], d.prototype, \"layer\", void 0), e([o()], d.prototype, \"strategy\", void 0), e([o()], d.prototype, \"timeExtent\", void 0), e([o()], d.prototype, \"view\", void 0), e([o()], d.prototype, \"updateRequested\", void 0), e([o()], d.prototype, \"updating\", null), e([o()], d.prototype, \"type\", void 0), d = e([p(\"esri.views.2d.layers.imagery.ImageryView2D\")], d);\nconst u = d;\nexport { u as default };","map":{"version":3,"names":["_","e","t","r","i","isSome","s","isAbortError","a","property","o","subclass","p","mosaicPixelData","n","BitmapContainer","l","Container","c","h","m","d","constructor","arguments","attached","container","updateRequested","type","_bitmapView","destroy","detach","updating","isUpdating","update","strategy","catch","getLogger","declaredClass","error","hitTest","attributes","geometry","clone","layer","attach","addChild","version","imageMaxHeight","imageMaxWidth","imageNormalizationSupported","fetchSource","_fetchImage","bind","requestUpdate","removeAllChildren","redraw","updateExports","source","HTMLImageElement","applyRenderer","extent","pixelBlock","originalPixelBlock","filter","pixelFilter","applyFilter","view","getPixelData","bitmaps","length","map","intersects","timeExtent","requestAsImageElement","fetchImage","then","imageOrCanvasElement","pixelData","signal","prototype","u","default"],"sources":["E:/各个学科/论文/毕业论文/Atmosphere/eco-friendly/node_modules/@arcgis/core/views/2d/layers/imagery/ImageryView2D.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import t from\"../../../../Graphic.js\";import r from\"../../../../core/Accessor.js\";import i from\"../../../../core/Logger.js\";import{isSome as s}from\"../../../../core/maybe.js\";import{isAbortError as a}from\"../../../../core/promiseUtils.js\";import{property as o}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/arrayUtils.js\";import\"../../../../core/accessorSupport/ensureType.js\";import{subclass as p}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{mosaicPixelData as n}from\"../../../../layers/support/rasterFunctions/pixelUtils.js\";import{BitmapContainer as l}from\"../../engine/BitmapContainer.js\";import{Container as c}from\"../../engine/Container.js\";import h from\"../../engine/ImageryBitmapSource.js\";import m from\"../support/ExportStrategy.js\";let d=class extends r{constructor(){super(...arguments),this.attached=!1,this.container=new c,this.updateRequested=!1,this.type=\"imagery\",this._bitmapView=new l}destroy(){this.attached&&(this.detach(),this.attached=!1),this.updateRequested=!1}get updating(){return!this.attached||this.isUpdating()}update(e){this.strategy.update(e).catch((e=>{a(e)||i.getLogger(this.declaredClass).error(e)}))}hitTest(e){return new t({attributes:{},geometry:e.clone(),layer:this.layer})}attach(){this.container.addChild(this._bitmapView);const e=this.layer.version>=10,t=this.layer.version>=10.1?this.layer.imageMaxHeight:2048,r=this.layer.version>=10.1?this.layer.imageMaxWidth:2048;this.strategy=new m({container:this._bitmapView,imageNormalizationSupported:e,imageMaxHeight:t,imageMaxWidth:r,fetchSource:this._fetchImage.bind(this),requestUpdate:()=>this.requestUpdate()})}detach(){this.strategy.destroy(),this._bitmapView.removeAllChildren(),this.container.removeAllChildren(),this.updateRequested=!1}redraw(){this.strategy.updateExports((async e=>{if(e.source instanceof HTMLImageElement)return;const t=await this.layer.applyRenderer({extent:e.source.extent,pixelBlock:e.source.originalPixelBlock??e.source.pixelBlock}),r=e.source;r.filter=e=>this.layer.pixelFilter?this.layer.applyFilter(e):{...t,extent:r.extent}})).catch((e=>{a(e)||i.getLogger(this.declaredClass).error(e)}))}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate())}isUpdating(){return this.strategy.updating||this.updateRequested}getPixelData(){if(this.updating)return null;const e=this.strategy.bitmaps;if(1===e.length&&e[0].source)return{extent:e[0].source.extent,pixelBlock:e[0].source.originalPixelBlock};if(e.length>1){const t=this.view.extent,r=e.map((e=>e.source)).filter((e=>e.extent&&e.extent.intersects(t))).map((e=>({extent:e.extent,pixelBlock:e.originalPixelBlock}))),i=n(r,t);return s(i)?{extent:i.extent,pixelBlock:i.pixelBlock}:null}return null}_fetchImage(e,t,r,i){return(i=i||{}).timeExtent=this.timeExtent,i.requestAsImageElement=!0,this.layer.fetchImage(e,t,r,i).then((e=>e.imageOrCanvasElement?e.imageOrCanvasElement:this.layer.applyRenderer(e.pixelData,{signal:i.signal}).then((t=>{const r=new h(t.pixelBlock,t.extent.clone(),e.pixelData.pixelBlock);return r.filter=e=>this.layer.applyFilter(e),r}))))}};e([o()],d.prototype,\"attached\",void 0),e([o()],d.prototype,\"container\",void 0),e([o()],d.prototype,\"layer\",void 0),e([o()],d.prototype,\"strategy\",void 0),e([o()],d.prototype,\"timeExtent\",void 0),e([o()],d.prototype,\"view\",void 0),e([o()],d.prototype,\"updateRequested\",void 0),e([o()],d.prototype,\"updating\",null),e([o()],d.prototype,\"type\",void 0),d=e([p(\"esri.views.2d.layers.imagery.ImageryView2D\")],d);const u=d;export{u as default};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}