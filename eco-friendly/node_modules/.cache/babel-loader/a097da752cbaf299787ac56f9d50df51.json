{"ast":null,"code":"import \"core-js/modules/es.typed-array.at.js\";\nimport \"core-js/modules/es.typed-array.set.js\";\nimport \"core-js/modules/esnext.typed-array.find-last.js\";\nimport \"core-js/modules/esnext.typed-array.find-last-index.js\";\n\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport { isSome as t, isNone as e } from \"../../../../../core/maybe.js\";\nimport { HITTEST_RADIUS as i, ATTRIBUTE_DATA_GPGPU as s } from \"../definitions.js\";\nimport { Effect as r } from \"./Effect.js\";\nimport { PixelFormat as o, PixelType as n } from \"../../../../webgl/enums.js\";\n\nclass c extends r {\n  constructor() {\n    super(...arguments), this.name = this.constructor.name, this.defines = [\"hittest\"];\n  }\n\n  dispose() {\n    t(this._fbo) && this._fbo.dispose();\n  }\n\n  createOptions({\n    pixelRatio: t\n  }, e, s = i) {\n    if (!e.length) return null;\n    const r = e.shift(),\n          o = r.x,\n          n = r.y;\n    return this._outstanding = r, {\n      type: \"hittest\",\n      distance: s * t,\n      position: [o, n]\n    };\n  }\n\n  bind(t) {\n    const {\n      context: i,\n      attributeView: r\n    } = t;\n    if (!r.size) return;\n    const o = r.getBlock(s);\n    if (e(o)) return;\n    const n = o.getFBO(i);\n    i.setViewport(0, 0, r.size, r.size), i.bindFramebuffer(n), i.setColorMask(!0, !0, !0, !0), i.setClearColor(0, 0, 0, 0), i.clear(i.gl.COLOR_BUFFER_BIT | i.gl.DEPTH_BUFFER_BIT);\n  }\n\n  unbind(t) {}\n\n  draw(t) {\n    if (e(this._outstanding)) return;\n    const i = this._outstanding;\n    this._outstanding = null, this._resolve(t, i.resolvers);\n  }\n\n  async _resolve(t, i) {\n    const {\n      context: r,\n      attributeView: c\n    } = t,\n          a = c.getBlock(s);\n    if (e(a)) return void i.forEach(t => t.resolve([]));\n    const d = a.getFBO(r),\n          h = new Uint8Array(d.width * d.height * 4);\n\n    try {\n      await d.readPixelsAsync(0, 0, d.width, d.height, o.RGBA, n.UNSIGNED_BYTE, h);\n    } catch (u) {\n      return void i.forEach(t => t.resolve([]));\n    }\n\n    const l = [];\n\n    for (let e = 0; e < h.length; e += 4) {\n      const t = h[e],\n            i = h[e + 3];\n      t && l.push({\n        id: e / 4,\n        directHits: i\n      });\n    }\n\n    l.sort((t, e) => e.directHits === t.directHits ? e.id - t.id : e.directHits - t.directHits);\n    const f = l.map(t => t.id);\n    i.forEach(t => t.resolve(f));\n  }\n\n}\n\nexport { c as HittestEffect };","map":{"version":3,"names":["isSome","t","isNone","e","HITTEST_RADIUS","i","ATTRIBUTE_DATA_GPGPU","s","Effect","r","PixelFormat","o","PixelType","n","c","constructor","arguments","name","defines","dispose","_fbo","createOptions","pixelRatio","length","shift","x","y","_outstanding","type","distance","position","bind","context","attributeView","size","getBlock","getFBO","setViewport","bindFramebuffer","setColorMask","setClearColor","clear","gl","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","unbind","draw","_resolve","resolvers","a","forEach","resolve","d","h","Uint8Array","width","height","readPixelsAsync","RGBA","UNSIGNED_BYTE","u","l","push","id","directHits","sort","f","map","HittestEffect"],"sources":["E:/各个学科/论文/毕业论文/Atmosphere/eco-friendly/node_modules/@arcgis/core/views/2d/engine/webgl/effects/HittestEffect.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{isSome as t,isNone as e}from\"../../../../../core/maybe.js\";import{HITTEST_RADIUS as i,ATTRIBUTE_DATA_GPGPU as s}from\"../definitions.js\";import{Effect as r}from\"./Effect.js\";import{PixelFormat as o,PixelType as n}from\"../../../../webgl/enums.js\";class c extends r{constructor(){super(...arguments),this.name=this.constructor.name,this.defines=[\"hittest\"]}dispose(){t(this._fbo)&&this._fbo.dispose()}createOptions({pixelRatio:t},e,s=i){if(!e.length)return null;const r=e.shift(),o=r.x,n=r.y;return this._outstanding=r,{type:\"hittest\",distance:s*t,position:[o,n]}}bind(t){const{context:i,attributeView:r}=t;if(!r.size)return;const o=r.getBlock(s);if(e(o))return;const n=o.getFBO(i);i.setViewport(0,0,r.size,r.size),i.bindFramebuffer(n),i.setColorMask(!0,!0,!0,!0),i.setClearColor(0,0,0,0),i.clear(i.gl.COLOR_BUFFER_BIT|i.gl.DEPTH_BUFFER_BIT)}unbind(t){}draw(t){if(e(this._outstanding))return;const i=this._outstanding;this._outstanding=null,this._resolve(t,i.resolvers)}async _resolve(t,i){const{context:r,attributeView:c}=t,a=c.getBlock(s);if(e(a))return void i.forEach((t=>t.resolve([])));const d=a.getFBO(r),h=new Uint8Array(d.width*d.height*4);try{await d.readPixelsAsync(0,0,d.width,d.height,o.RGBA,n.UNSIGNED_BYTE,h)}catch(u){return void i.forEach((t=>t.resolve([])))}const l=[];for(let e=0;e<h.length;e+=4){const t=h[e],i=h[e+3];t&&l.push({id:e/4,directHits:i})}l.sort(((t,e)=>e.directHits===t.directHits?e.id-t.id:e.directHits-t.directHits));const f=l.map((t=>t.id));i.forEach((t=>t.resolve(f)))}}export{c as HittestEffect};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}