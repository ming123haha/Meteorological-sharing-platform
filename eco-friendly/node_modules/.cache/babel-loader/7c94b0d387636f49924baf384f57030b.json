{"ast":null,"code":"import \"core-js/modules/es.array.includes.js\";\n\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport { isNone as t } from \"../../../core/maybe.js\";\nimport { getExpressionFromFieldName as e, getWhereClause as i, getAliasFromFieldName as s } from \"./attributeSupport.js\";\nimport { processNullValue as a, getNormalizedValue as l } from \"../../../statistics/utils.js\";\n\nclass r {\n  constructor(t, a, l) {\n    this._fieldDataCache = new Map(), this._returnDistinctMap = new Map(), this.returnDistinctValues = t.returnDistinctValues ?? !1, this.fieldsIndex = l, this.featureAdapter = a;\n    const r = t.outFields;\n\n    if (r && !r.includes(\"*\")) {\n      this.outFields = r;\n      let t = 0;\n\n      for (const a of r) {\n        const r = e(a),\n              n = this.fieldsIndex.get(r),\n              u = n ? null : i(r, l),\n              d = n ? n.name : s(a) || \"FIELD_EXP_\" + t++;\n\n        this._fieldDataCache.set(a, {\n          alias: d,\n          clause: u\n        });\n      }\n    }\n  }\n\n  countDistinctValues(t) {\n    return this.returnDistinctValues ? (t.forEach(t => this.getAttributes(t)), this._returnDistinctMap.size) : t.length;\n  }\n\n  getAttributes(t) {\n    const e = this._processAttributesForOutFields(t);\n\n    return this._processAttributesForDistinctValues(e);\n  }\n\n  getFieldValue(t, e, s) {\n    const a = s ? s.name : e;\n    let l = null;\n    return this._fieldDataCache.has(a) ? l = this._fieldDataCache.get(a).clause : s || (l = i(e, this.fieldsIndex), this._fieldDataCache.set(a, {\n      alias: a,\n      clause: l\n    })), s ? this.featureAdapter.getAttribute(t, a) : l.calculateValue(t, this.featureAdapter);\n  }\n\n  getDataValue(t, e) {\n    const i = e.normalizationType,\n          s = e.normalizationTotal;\n    let r = this.getFieldValue(t, e.field, this.fieldsIndex.get(e.field));\n\n    if (e.field2 && (r = `${a(r)}${e.fieldDelimiter}${a(this.getFieldValue(t, e.field2, this.fieldsIndex.get(e.field2)))}`, e.field3 && (r = `${r}${e.fieldDelimiter}${a(this.getFieldValue(t, e.field3, this.fieldsIndex.get(e.field3)))}`)), i && Number.isFinite(r)) {\n      const a = \"field\" === i && e.normalizationField ? this.getFieldValue(t, e.normalizationField, this.fieldsIndex.get(e.normalizationField)) : null;\n      r = l(r, i, a, s);\n    }\n\n    return r;\n  }\n\n  getExpressionValue(t, e, i, s) {\n    const a = {\n      attributes: this.featureAdapter.getAttributes(t),\n      layer: {\n        fields: this.fieldsIndex.fields\n      }\n    },\n          l = s.createExecContext(a, i);\n    return s.executeFunction(e, l);\n  }\n\n  getExpressionValues(t, e, i, s) {\n    const a = {\n      fields: this.fieldsIndex.fields\n    };\n    return t.map(t => {\n      const l = {\n        attributes: this.featureAdapter.getAttributes(t),\n        layer: a\n      },\n            r = s.createExecContext(l, i);\n      return s.executeFunction(e, r);\n    });\n  }\n\n  validateItem(t, e) {\n    return this._fieldDataCache.has(e) || this._fieldDataCache.set(e, {\n      alias: e,\n      clause: i(e, this.fieldsIndex)\n    }), this._fieldDataCache.get(e).clause.testFeature(t, this.featureAdapter);\n  }\n\n  validateItems(t, e) {\n    return this._fieldDataCache.has(e) || this._fieldDataCache.set(e, {\n      alias: e,\n      clause: i(e, this.fieldsIndex)\n    }), this._fieldDataCache.get(e).clause.testSet(t, this.featureAdapter);\n  }\n\n  _processAttributesForOutFields(t) {\n    const e = this.outFields;\n    if (!e || !e.length) return this.featureAdapter.getAttributes(t);\n    const i = {};\n\n    for (const s of e) {\n      const {\n        alias: e,\n        clause: a\n      } = this._fieldDataCache.get(s);\n\n      i[e] = a ? a.calculateValue(t, this.featureAdapter) : this.featureAdapter.getAttribute(t, e);\n    }\n\n    return i;\n  }\n\n  _processAttributesForDistinctValues(e) {\n    if (t(e) || !this.returnDistinctValues) return e;\n    const i = this.outFields,\n          s = [];\n    if (i) for (const t of i) {\n      const {\n        alias: i\n      } = this._fieldDataCache.get(t);\n\n      s.push(e[i]);\n    } else for (const t in e) s.push(e[t]);\n    const a = `${(i || [\"*\"]).join(\",\")}=${s.join(\",\")}`;\n    let l = this._returnDistinctMap.get(a) || 0;\n    return this._returnDistinctMap.set(a, ++l), l > 1 ? null : e;\n  }\n\n}\n\nexport { r as default };","map":{"version":3,"names":["isNone","t","getExpressionFromFieldName","e","getWhereClause","i","getAliasFromFieldName","s","processNullValue","a","getNormalizedValue","l","r","constructor","_fieldDataCache","Map","_returnDistinctMap","returnDistinctValues","fieldsIndex","featureAdapter","outFields","includes","n","get","u","d","name","set","alias","clause","countDistinctValues","forEach","getAttributes","size","length","_processAttributesForOutFields","_processAttributesForDistinctValues","getFieldValue","has","getAttribute","calculateValue","getDataValue","normalizationType","normalizationTotal","field","field2","fieldDelimiter","field3","Number","isFinite","normalizationField","getExpressionValue","attributes","layer","fields","createExecContext","executeFunction","getExpressionValues","map","validateItem","testFeature","validateItems","testSet","push","join","default"],"sources":["E:/各个学科/论文/毕业论文/Atmosphere/eco-friendly/node_modules/@arcgis/core/layers/graphics/data/AttributesBuilder.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{isNone as t}from\"../../../core/maybe.js\";import{getExpressionFromFieldName as e,getWhereClause as i,getAliasFromFieldName as s}from\"./attributeSupport.js\";import{processNullValue as a,getNormalizedValue as l}from\"../../../statistics/utils.js\";class r{constructor(t,a,l){this._fieldDataCache=new Map,this._returnDistinctMap=new Map,this.returnDistinctValues=t.returnDistinctValues??!1,this.fieldsIndex=l,this.featureAdapter=a;const r=t.outFields;if(r&&!r.includes(\"*\")){this.outFields=r;let t=0;for(const a of r){const r=e(a),n=this.fieldsIndex.get(r),u=n?null:i(r,l),d=n?n.name:s(a)||\"FIELD_EXP_\"+t++;this._fieldDataCache.set(a,{alias:d,clause:u})}}}countDistinctValues(t){return this.returnDistinctValues?(t.forEach((t=>this.getAttributes(t))),this._returnDistinctMap.size):t.length}getAttributes(t){const e=this._processAttributesForOutFields(t);return this._processAttributesForDistinctValues(e)}getFieldValue(t,e,s){const a=s?s.name:e;let l=null;return this._fieldDataCache.has(a)?l=this._fieldDataCache.get(a).clause:s||(l=i(e,this.fieldsIndex),this._fieldDataCache.set(a,{alias:a,clause:l})),s?this.featureAdapter.getAttribute(t,a):l.calculateValue(t,this.featureAdapter)}getDataValue(t,e){const i=e.normalizationType,s=e.normalizationTotal;let r=this.getFieldValue(t,e.field,this.fieldsIndex.get(e.field));if(e.field2&&(r=`${a(r)}${e.fieldDelimiter}${a(this.getFieldValue(t,e.field2,this.fieldsIndex.get(e.field2)))}`,e.field3&&(r=`${r}${e.fieldDelimiter}${a(this.getFieldValue(t,e.field3,this.fieldsIndex.get(e.field3)))}`)),i&&Number.isFinite(r)){const a=\"field\"===i&&e.normalizationField?this.getFieldValue(t,e.normalizationField,this.fieldsIndex.get(e.normalizationField)):null;r=l(r,i,a,s)}return r}getExpressionValue(t,e,i,s){const a={attributes:this.featureAdapter.getAttributes(t),layer:{fields:this.fieldsIndex.fields}},l=s.createExecContext(a,i);return s.executeFunction(e,l)}getExpressionValues(t,e,i,s){const a={fields:this.fieldsIndex.fields};return t.map((t=>{const l={attributes:this.featureAdapter.getAttributes(t),layer:a},r=s.createExecContext(l,i);return s.executeFunction(e,r)}))}validateItem(t,e){return this._fieldDataCache.has(e)||this._fieldDataCache.set(e,{alias:e,clause:i(e,this.fieldsIndex)}),this._fieldDataCache.get(e).clause.testFeature(t,this.featureAdapter)}validateItems(t,e){return this._fieldDataCache.has(e)||this._fieldDataCache.set(e,{alias:e,clause:i(e,this.fieldsIndex)}),this._fieldDataCache.get(e).clause.testSet(t,this.featureAdapter)}_processAttributesForOutFields(t){const e=this.outFields;if(!e||!e.length)return this.featureAdapter.getAttributes(t);const i={};for(const s of e){const{alias:e,clause:a}=this._fieldDataCache.get(s);i[e]=a?a.calculateValue(t,this.featureAdapter):this.featureAdapter.getAttribute(t,e)}return i}_processAttributesForDistinctValues(e){if(t(e)||!this.returnDistinctValues)return e;const i=this.outFields,s=[];if(i)for(const t of i){const{alias:i}=this._fieldDataCache.get(t);s.push(e[i])}else for(const t in e)s.push(e[t]);const a=`${(i||[\"*\"]).join(\",\")}=${s.join(\",\")}`;let l=this._returnDistinctMap.get(a)||0;return this._returnDistinctMap.set(a,++l),l>1?null:e}}export{r as default};\n"],"mappings":";;AAAA;AACA;AACA;AACA;AACA,SAAOA,MAAM,IAAIC,CAAjB,QAAuB,wBAAvB;AAAgD,SAAOC,0BAA0B,IAAIC,CAArC,EAAuCC,cAAc,IAAIC,CAAzD,EAA2DC,qBAAqB,IAAIC,CAApF,QAA0F,uBAA1F;AAAkH,SAAOC,gBAAgB,IAAIC,CAA3B,EAA6BC,kBAAkB,IAAIC,CAAnD,QAAyD,8BAAzD;;AAAwF,MAAMC,CAAN,CAAO;EAACC,WAAW,CAACZ,CAAD,EAAGQ,CAAH,EAAKE,CAAL,EAAO;IAAC,KAAKG,eAAL,GAAqB,IAAIC,GAAJ,EAArB,EAA6B,KAAKC,kBAAL,GAAwB,IAAID,GAAJ,EAArD,EAA6D,KAAKE,oBAAL,GAA0BhB,CAAC,CAACgB,oBAAF,IAAwB,CAAC,CAAhH,EAAkH,KAAKC,WAAL,GAAiBP,CAAnI,EAAqI,KAAKQ,cAAL,GAAoBV,CAAzJ;IAA2J,MAAMG,CAAC,GAACX,CAAC,CAACmB,SAAV;;IAAoB,IAAGR,CAAC,IAAE,CAACA,CAAC,CAACS,QAAF,CAAW,GAAX,CAAP,EAAuB;MAAC,KAAKD,SAAL,GAAeR,CAAf;MAAiB,IAAIX,CAAC,GAAC,CAAN;;MAAQ,KAAI,MAAMQ,CAAV,IAAeG,CAAf,EAAiB;QAAC,MAAMA,CAAC,GAACT,CAAC,CAACM,CAAD,CAAT;QAAA,MAAaa,CAAC,GAAC,KAAKJ,WAAL,CAAiBK,GAAjB,CAAqBX,CAArB,CAAf;QAAA,MAAuCY,CAAC,GAACF,CAAC,GAAC,IAAD,GAAMjB,CAAC,CAACO,CAAD,EAAGD,CAAH,CAAjD;QAAA,MAAuDc,CAAC,GAACH,CAAC,GAACA,CAAC,CAACI,IAAH,GAAQnB,CAAC,CAACE,CAAD,CAAD,IAAM,eAAaR,CAAC,EAAtF;;QAAyF,KAAKa,eAAL,CAAqBa,GAArB,CAAyBlB,CAAzB,EAA2B;UAACmB,KAAK,EAACH,CAAP;UAASI,MAAM,EAACL;QAAhB,CAA3B;MAA+C;IAAC;EAAC;;EAAAM,mBAAmB,CAAC7B,CAAD,EAAG;IAAC,OAAO,KAAKgB,oBAAL,IAA2BhB,CAAC,CAAC8B,OAAF,CAAW9B,CAAC,IAAE,KAAK+B,aAAL,CAAmB/B,CAAnB,CAAd,GAAsC,KAAKe,kBAAL,CAAwBiB,IAAzF,IAA+FhC,CAAC,CAACiC,MAAxG;EAA+G;;EAAAF,aAAa,CAAC/B,CAAD,EAAG;IAAC,MAAME,CAAC,GAAC,KAAKgC,8BAAL,CAAoClC,CAApC,CAAR;;IAA+C,OAAO,KAAKmC,mCAAL,CAAyCjC,CAAzC,CAAP;EAAmD;;EAAAkC,aAAa,CAACpC,CAAD,EAAGE,CAAH,EAAKI,CAAL,EAAO;IAAC,MAAME,CAAC,GAACF,CAAC,GAACA,CAAC,CAACmB,IAAH,GAAQvB,CAAjB;IAAmB,IAAIQ,CAAC,GAAC,IAAN;IAAW,OAAO,KAAKG,eAAL,CAAqBwB,GAArB,CAAyB7B,CAAzB,IAA4BE,CAAC,GAAC,KAAKG,eAAL,CAAqBS,GAArB,CAAyBd,CAAzB,EAA4BoB,MAA1D,GAAiEtB,CAAC,KAAGI,CAAC,GAACN,CAAC,CAACF,CAAD,EAAG,KAAKe,WAAR,CAAH,EAAwB,KAAKJ,eAAL,CAAqBa,GAArB,CAAyBlB,CAAzB,EAA2B;MAACmB,KAAK,EAACnB,CAAP;MAASoB,MAAM,EAAClB;IAAhB,CAA3B,CAA3B,CAAlE,EAA6IJ,CAAC,GAAC,KAAKY,cAAL,CAAoBoB,YAApB,CAAiCtC,CAAjC,EAAmCQ,CAAnC,CAAD,GAAuCE,CAAC,CAAC6B,cAAF,CAAiBvC,CAAjB,EAAmB,KAAKkB,cAAxB,CAA5L;EAAoO;;EAAAsB,YAAY,CAACxC,CAAD,EAAGE,CAAH,EAAK;IAAC,MAAME,CAAC,GAACF,CAAC,CAACuC,iBAAV;IAAA,MAA4BnC,CAAC,GAACJ,CAAC,CAACwC,kBAAhC;IAAmD,IAAI/B,CAAC,GAAC,KAAKyB,aAAL,CAAmBpC,CAAnB,EAAqBE,CAAC,CAACyC,KAAvB,EAA6B,KAAK1B,WAAL,CAAiBK,GAAjB,CAAqBpB,CAAC,CAACyC,KAAvB,CAA7B,CAAN;;IAAkE,IAAGzC,CAAC,CAAC0C,MAAF,KAAWjC,CAAC,GAAE,GAAEH,CAAC,CAACG,CAAD,CAAI,GAAET,CAAC,CAAC2C,cAAe,GAAErC,CAAC,CAAC,KAAK4B,aAAL,CAAmBpC,CAAnB,EAAqBE,CAAC,CAAC0C,MAAvB,EAA8B,KAAK3B,WAAL,CAAiBK,GAAjB,CAAqBpB,CAAC,CAAC0C,MAAvB,CAA9B,CAAD,CAAgE,EAAhG,EAAkG1C,CAAC,CAAC4C,MAAF,KAAWnC,CAAC,GAAE,GAAEA,CAAE,GAAET,CAAC,CAAC2C,cAAe,GAAErC,CAAC,CAAC,KAAK4B,aAAL,CAAmBpC,CAAnB,EAAqBE,CAAC,CAAC4C,MAAvB,EAA8B,KAAK7B,WAAL,CAAiBK,GAAjB,CAAqBpB,CAAC,CAAC4C,MAAvB,CAA9B,CAAD,CAAgE,EAAxG,CAA7G,GAAyN1C,CAAC,IAAE2C,MAAM,CAACC,QAAP,CAAgBrC,CAAhB,CAA/N,EAAkP;MAAC,MAAMH,CAAC,GAAC,YAAUJ,CAAV,IAAaF,CAAC,CAAC+C,kBAAf,GAAkC,KAAKb,aAAL,CAAmBpC,CAAnB,EAAqBE,CAAC,CAAC+C,kBAAvB,EAA0C,KAAKhC,WAAL,CAAiBK,GAAjB,CAAqBpB,CAAC,CAAC+C,kBAAvB,CAA1C,CAAlC,GAAwH,IAAhI;MAAqItC,CAAC,GAACD,CAAC,CAACC,CAAD,EAAGP,CAAH,EAAKI,CAAL,EAAOF,CAAP,CAAH;IAAa;;IAAA,OAAOK,CAAP;EAAS;;EAAAuC,kBAAkB,CAAClD,CAAD,EAAGE,CAAH,EAAKE,CAAL,EAAOE,CAAP,EAAS;IAAC,MAAME,CAAC,GAAC;MAAC2C,UAAU,EAAC,KAAKjC,cAAL,CAAoBa,aAApB,CAAkC/B,CAAlC,CAAZ;MAAiDoD,KAAK,EAAC;QAACC,MAAM,EAAC,KAAKpC,WAAL,CAAiBoC;MAAzB;IAAvD,CAAR;IAAA,MAAiG3C,CAAC,GAACJ,CAAC,CAACgD,iBAAF,CAAoB9C,CAApB,EAAsBJ,CAAtB,CAAnG;IAA4H,OAAOE,CAAC,CAACiD,eAAF,CAAkBrD,CAAlB,EAAoBQ,CAApB,CAAP;EAA8B;;EAAA8C,mBAAmB,CAACxD,CAAD,EAAGE,CAAH,EAAKE,CAAL,EAAOE,CAAP,EAAS;IAAC,MAAME,CAAC,GAAC;MAAC6C,MAAM,EAAC,KAAKpC,WAAL,CAAiBoC;IAAzB,CAAR;IAAyC,OAAOrD,CAAC,CAACyD,GAAF,CAAOzD,CAAC,IAAE;MAAC,MAAMU,CAAC,GAAC;QAACyC,UAAU,EAAC,KAAKjC,cAAL,CAAoBa,aAApB,CAAkC/B,CAAlC,CAAZ;QAAiDoD,KAAK,EAAC5C;MAAvD,CAAR;MAAA,MAAkEG,CAAC,GAACL,CAAC,CAACgD,iBAAF,CAAoB5C,CAApB,EAAsBN,CAAtB,CAApE;MAA6F,OAAOE,CAAC,CAACiD,eAAF,CAAkBrD,CAAlB,EAAoBS,CAApB,CAAP;IAA8B,CAAtI,CAAP;EAAgJ;;EAAA+C,YAAY,CAAC1D,CAAD,EAAGE,CAAH,EAAK;IAAC,OAAO,KAAKW,eAAL,CAAqBwB,GAArB,CAAyBnC,CAAzB,KAA6B,KAAKW,eAAL,CAAqBa,GAArB,CAAyBxB,CAAzB,EAA2B;MAACyB,KAAK,EAACzB,CAAP;MAAS0B,MAAM,EAACxB,CAAC,CAACF,CAAD,EAAG,KAAKe,WAAR;IAAjB,CAA3B,CAA7B,EAAgG,KAAKJ,eAAL,CAAqBS,GAArB,CAAyBpB,CAAzB,EAA4B0B,MAA5B,CAAmC+B,WAAnC,CAA+C3D,CAA/C,EAAiD,KAAKkB,cAAtD,CAAvG;EAA6K;;EAAA0C,aAAa,CAAC5D,CAAD,EAAGE,CAAH,EAAK;IAAC,OAAO,KAAKW,eAAL,CAAqBwB,GAArB,CAAyBnC,CAAzB,KAA6B,KAAKW,eAAL,CAAqBa,GAArB,CAAyBxB,CAAzB,EAA2B;MAACyB,KAAK,EAACzB,CAAP;MAAS0B,MAAM,EAACxB,CAAC,CAACF,CAAD,EAAG,KAAKe,WAAR;IAAjB,CAA3B,CAA7B,EAAgG,KAAKJ,eAAL,CAAqBS,GAArB,CAAyBpB,CAAzB,EAA4B0B,MAA5B,CAAmCiC,OAAnC,CAA2C7D,CAA3C,EAA6C,KAAKkB,cAAlD,CAAvG;EAAyK;;EAAAgB,8BAA8B,CAAClC,CAAD,EAAG;IAAC,MAAME,CAAC,GAAC,KAAKiB,SAAb;IAAuB,IAAG,CAACjB,CAAD,IAAI,CAACA,CAAC,CAAC+B,MAAV,EAAiB,OAAO,KAAKf,cAAL,CAAoBa,aAApB,CAAkC/B,CAAlC,CAAP;IAA4C,MAAMI,CAAC,GAAC,EAAR;;IAAW,KAAI,MAAME,CAAV,IAAeJ,CAAf,EAAiB;MAAC,MAAK;QAACyB,KAAK,EAACzB,CAAP;QAAS0B,MAAM,EAACpB;MAAhB,IAAmB,KAAKK,eAAL,CAAqBS,GAArB,CAAyBhB,CAAzB,CAAxB;;MAAoDF,CAAC,CAACF,CAAD,CAAD,GAAKM,CAAC,GAACA,CAAC,CAAC+B,cAAF,CAAiBvC,CAAjB,EAAmB,KAAKkB,cAAxB,CAAD,GAAyC,KAAKA,cAAL,CAAoBoB,YAApB,CAAiCtC,CAAjC,EAAmCE,CAAnC,CAA/C;IAAqF;;IAAA,OAAOE,CAAP;EAAS;;EAAA+B,mCAAmC,CAACjC,CAAD,EAAG;IAAC,IAAGF,CAAC,CAACE,CAAD,CAAD,IAAM,CAAC,KAAKc,oBAAf,EAAoC,OAAOd,CAAP;IAAS,MAAME,CAAC,GAAC,KAAKe,SAAb;IAAA,MAAuBb,CAAC,GAAC,EAAzB;IAA4B,IAAGF,CAAH,EAAK,KAAI,MAAMJ,CAAV,IAAeI,CAAf,EAAiB;MAAC,MAAK;QAACuB,KAAK,EAACvB;MAAP,IAAU,KAAKS,eAAL,CAAqBS,GAArB,CAAyBtB,CAAzB,CAAf;;MAA2CM,CAAC,CAACwD,IAAF,CAAO5D,CAAC,CAACE,CAAD,CAAR;IAAa,CAA/E,MAAoF,KAAI,MAAMJ,CAAV,IAAeE,CAAf,EAAiBI,CAAC,CAACwD,IAAF,CAAO5D,CAAC,CAACF,CAAD,CAAR;IAAa,MAAMQ,CAAC,GAAE,GAAE,CAACJ,CAAC,IAAE,CAAC,GAAD,CAAJ,EAAW2D,IAAX,CAAgB,GAAhB,CAAqB,IAAGzD,CAAC,CAACyD,IAAF,CAAO,GAAP,CAAY,EAA/C;IAAiD,IAAIrD,CAAC,GAAC,KAAKK,kBAAL,CAAwBO,GAAxB,CAA4Bd,CAA5B,KAAgC,CAAtC;IAAwC,OAAO,KAAKO,kBAAL,CAAwBW,GAAxB,CAA4BlB,CAA5B,EAA8B,EAAEE,CAAhC,GAAmCA,CAAC,GAAC,CAAF,GAAI,IAAJ,GAASR,CAAnD;EAAqD;;AAAj1F;;AAAk1F,SAAOS,CAAC,IAAIqD,OAAZ"},"metadata":{},"sourceType":"module"}