{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport { handlesGroup as e } from \"../handleUtils.js\";\nimport t from \"../Logger.js\";\nimport { isPromiseLike as s, createAbortError as n, createDeferred as i, throwIfAborted as o } from \"../promiseUtils.js\";\nimport r from \"../Queue.js\";\nimport l from \"./RemoteClient.js\";\n\nclass h {\n  constructor() {\n    this._inUseClients = new Array(), this._clients = new Array(), this._clientPromises = new Array(), this._ongoingJobsQueue = new r();\n  }\n\n  destroy() {\n    this.close();\n  }\n\n  get closed() {\n    return !this._clients || !this._clients.length;\n  }\n\n  open(e, t) {\n    return new Promise((n, i) => {\n      let r = !0;\n\n      const h = e => {\n        o(t.signal), r && (r = !1, e());\n      };\n\n      this._clients.length = e.length, this._clientPromises.length = e.length, this._inUseClients.length = e.length;\n\n      for (let o = 0; o < e.length; ++o) {\n        const r = e[o];\n        s(r) ? this._clientPromises[o] = r.then(e => (this._clients[o] = new l(e, t, () => this._ongoingJobsQueue.pop() ?? null), h(n), this._clients[o]), () => (h(i), null)) : (this._clients[o] = new l(r, t, () => this._ongoingJobsQueue.pop() ?? null), this._clientPromises[o] = Promise.resolve(this._clients[o]), h(n));\n      }\n    });\n  }\n\n  broadcast(e, t, s) {\n    const n = new Array(this._clientPromises.length);\n\n    for (let i = 0; i < this._clientPromises.length; ++i) {\n      const o = this._clientPromises[i];\n      n[i] = o.then(n => n?.invoke(e, t, s));\n    }\n\n    return n;\n  }\n\n  close() {\n    let e;\n\n    for (; e = this._ongoingJobsQueue.pop();) e.deferred.reject(n(`Worker closing, aborting job calling '${e.methodName}'`));\n\n    for (const t of this._clientPromises) t.then(e => e?.close());\n\n    this._clients.length = 0, this._clientPromises.length = 0;\n  }\n\n  invoke(e, s, n) {\n    let o;\n    Array.isArray(n) ? (t.getLogger(\"esri.core.workers.Connection\").warn(\"invoke()\", \"The transferList parameter is deprecated, use the options object instead\"), o = {\n      transferList: n\n    }) : o = n;\n    const r = i();\n\n    this._ongoingJobsQueue.push({\n      methodName: e,\n      data: s,\n      invokeOptions: o,\n      deferred: r\n    });\n\n    for (let t = 0; t < this._clientPromises.length; t++) {\n      const e = this._clients[t];\n      e ? e.jobAdded() : this._clientPromises[t].then(e => e?.jobAdded());\n    }\n\n    return r.promise;\n  }\n\n  on(t, s) {\n    return Promise.all(this._clientPromises).then(() => e(this._clients.map(e => e.on(t, s))));\n  }\n\n  openPorts() {\n    return new Promise(e => {\n      const t = new Array(this._clientPromises.length);\n      let s = t.length;\n\n      for (let n = 0; n < this._clientPromises.length; ++n) {\n        this._clientPromises[n].then(i => {\n          i && (t[n] = i.openPort()), 0 == --s && e(t);\n        });\n      }\n    });\n  }\n\n  get test() {\n    return {\n      numClients: this._clients.length\n    };\n  }\n\n}\n\nexport { h as default };","map":{"version":3,"names":["handlesGroup","e","t","isPromiseLike","s","createAbortError","n","createDeferred","i","throwIfAborted","o","r","l","h","constructor","_inUseClients","Array","_clients","_clientPromises","_ongoingJobsQueue","destroy","close","closed","length","open","Promise","signal","then","pop","resolve","broadcast","invoke","deferred","reject","methodName","isArray","getLogger","warn","transferList","push","data","invokeOptions","jobAdded","promise","on","all","map","openPorts","openPort","test","numClients","default"],"sources":["E:/各个学科/论文/毕业论文/Atmosphere/eco-friendly/node_modules/@arcgis/core/core/workers/Connection.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{handlesGroup as e}from\"../handleUtils.js\";import t from\"../Logger.js\";import{isPromiseLike as s,createAbortError as n,createDeferred as i,throwIfAborted as o}from\"../promiseUtils.js\";import r from\"../Queue.js\";import l from\"./RemoteClient.js\";class h{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new r}destroy(){this.close()}get closed(){return!this._clients||!this._clients.length}open(e,t){return new Promise(((n,i)=>{let r=!0;const h=e=>{o(t.signal),r&&(r=!1,e())};this._clients.length=e.length,this._clientPromises.length=e.length,this._inUseClients.length=e.length;for(let o=0;o<e.length;++o){const r=e[o];s(r)?this._clientPromises[o]=r.then((e=>(this._clients[o]=new l(e,t,(()=>this._ongoingJobsQueue.pop()??null)),h(n),this._clients[o])),(()=>(h(i),null))):(this._clients[o]=new l(r,t,(()=>this._ongoingJobsQueue.pop()??null)),this._clientPromises[o]=Promise.resolve(this._clients[o]),h(n))}}))}broadcast(e,t,s){const n=new Array(this._clientPromises.length);for(let i=0;i<this._clientPromises.length;++i){const o=this._clientPromises[i];n[i]=o.then((n=>n?.invoke(e,t,s)))}return n}close(){let e;for(;e=this._ongoingJobsQueue.pop();)e.deferred.reject(n(`Worker closing, aborting job calling '${e.methodName}'`));for(const t of this._clientPromises)t.then((e=>e?.close()));this._clients.length=0,this._clientPromises.length=0}invoke(e,s,n){let o;Array.isArray(n)?(t.getLogger(\"esri.core.workers.Connection\").warn(\"invoke()\",\"The transferList parameter is deprecated, use the options object instead\"),o={transferList:n}):o=n;const r=i();this._ongoingJobsQueue.push({methodName:e,data:s,invokeOptions:o,deferred:r});for(let t=0;t<this._clientPromises.length;t++){const e=this._clients[t];e?e.jobAdded():this._clientPromises[t].then((e=>e?.jobAdded()))}return r.promise}on(t,s){return Promise.all(this._clientPromises).then((()=>e(this._clients.map((e=>e.on(t,s))))))}openPorts(){return new Promise((e=>{const t=new Array(this._clientPromises.length);let s=t.length;for(let n=0;n<this._clientPromises.length;++n){this._clientPromises[n].then((i=>{i&&(t[n]=i.openPort()),0==--s&&e(t)}))}}))}get test(){return{numClients:this._clients.length}}}export{h as default};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}