{"ast":null,"code":"import \"core-js/modules/es.array.includes.js\";\n\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../../chunks/tslib.es6.js\";\nimport \"../../../../geometry.js\";\nimport t from \"../../../../request.js\";\nimport r from \"../../../../core/Error.js\";\nimport s from \"../../../../core/Logger.js\";\nimport { isSome as o, isNone as i, unwrapOr as n, get as a } from \"../../../../core/maybe.js\";\nimport { createResolver as c } from \"../../../../core/promiseUtils.js\";\nimport { addQueryParameters as u } from \"../../../../core/urlUtils.js\";\nimport \"../../../../core/accessorSupport/ensureType.js\";\nimport \"../../../../core/arrayUtils.js\";\nimport \"../../../../core/has.js\";\nimport { subclass as d } from \"../../../../core/accessorSupport/decorators/subclass.js\";\nimport { WebSocketConnection as l } from \"./WebSocketConnection.js\";\nimport { executeQuery as f } from \"../../../../rest/query/operations/query.js\";\nimport h from \"../../../../rest/support/Query.js\";\nimport { fromJSON as g } from \"../../../../geometry/support/jsonUtils.js\";\nimport y from \"../../../../geometry/SpatialReference.js\";\nconst m = 1e4,\n      p = {\n  maxQueryDepth: 5,\n  maxRecordCountFactor: 3\n};\n\nlet _ = class extends l {\n  constructor(e) {\n    super({ ...p,\n      ...e\n    });\n  }\n\n  async _open() {\n    const e = await this._fetchServiceDefinition(this._config.source);\n    e.timeInfo.trackIdField || s.getLogger(this.declaredClass).warn(\"GeoEvent service was configured without a TrackIdField. This may result in certain functionality being disabled. The purgeOptions.maxObservations property will have no effect.\");\n\n    const t = this._fetchWebSocketUrl(e.streamUrls, this._config.spatialReference);\n\n    this._buddyServicesQuery || (this._buddyServicesQuery = this._queryBuddyServices()), await this._buddyServicesQuery, await this._tryCreateWebSocket(t);\n    const {\n      filter: r,\n      outFields: o\n    } = this._config;\n    this.destroyed || this._setFilter(r, o);\n  }\n\n  _onMessage(e) {\n    let t;\n\n    try {\n      t = this._enrich(JSON.parse(e.data)), o(this._featureZScaler) && this._featureZScaler(t.geometry);\n    } catch (i) {\n      return void s.getLogger(this.declaredClass).error(new r(\"geoevent-connection\", \"Failed to parse message\", i));\n    }\n\n    this.onFeature(t);\n  }\n\n  async _fetchServiceDefinition(e) {\n    const r = {\n      f: \"json\",\n      ...this._config.customParameters\n    },\n          s = t(e.path, {\n      query: r,\n      responseType: \"json\"\n    }),\n          o = (await s).data;\n    return this._serviceDefinition = o, o;\n  }\n\n  _fetchWebSocketUrl(e, t) {\n    const r = e[0],\n          {\n      urls: s,\n      token: o\n    } = r,\n          i = this._inferWebSocketBaseUrl(s);\n\n    return u(`${i}/subscribe`, {\n      outSR: \"\" + t.wkid,\n      token: o\n    });\n  }\n\n  _inferWebSocketBaseUrl(e) {\n    if (1 === e.length) return e[0];\n\n    for (const t of e) if (t.includes(\"wss\")) return t;\n\n    return s.getLogger(this.declaredClass).error(new r(\"geoevent-connection\", \"Unable to infer WebSocket url\", e)), null;\n  }\n\n  async _setFilter(e, t) {\n    const o = this._websocket;\n    if (i(o) || i(e) && i(t)) return;\n    const n = JSON.stringify({\n      filter: this._serializeFilter(e, t)\n    });\n    let a = !1;\n\n    const u = c(),\n          d = () => {\n      a || (this.destroyed || this._websocket !== o || s.getLogger(this.declaredClass).error(new r(\"geoevent-connection\", \"Server timed out when setting filter\")), u.reject());\n    },\n          l = e => {\n      const t = JSON.parse(e.data);\n      t.filter && (t.error && (s.getLogger(this.declaredClass).error(new r(\"geoevent-connection\", \"Failed to set service filter\", t.error)), this._set(\"errorString\", `Could not set service filter - ${t.error}`), u.reject(t.error)), o.onmessage = this._onMessage.bind(this), a = !0, u.resolve());\n    };\n\n    return o.onmessage = l, o.send(n), setTimeout(d, m), u.promise;\n  }\n\n  _serializeFilter(e, t) {\n    const n = {};\n    if (i(e) && i(t)) return n;\n    if (o(e) && e.geometry) try {\n      const t = g(e.geometry);\n      if (\"extent\" !== t.type) throw new r(`Expected extent but found type ${t.type}`);\n      n.geometry = JSON.stringify(t.shiftCentralMeridian());\n    } catch (a) {\n      s.getLogger(this.declaredClass).error(new r(\"geoevent-connection\", \"Encountered an error when setting connection geometryDefinition\", a));\n    }\n    return o(e) && e.where && \"1 = 1\" !== e.where && (n.where = e.where), o(t) && (n.outFields = t.join(\",\")), n;\n  }\n\n  _enrich(e) {\n    if (!this._relatedFeatures) return e;\n    const t = this._serviceDefinition.relatedFeatures.joinField,\n          o = e.attributes[t];\n    if (!this._relatedFeatures.has(o)) return s.getLogger(this.declaredClass).warn(\"geoevent-connection\", \"Feature join failed. Is the join field configured correctly?\", e), e;\n\n    const {\n      attributes: i,\n      geometry: n\n    } = this._relatedFeatures.get(o);\n\n    for (const r in i) e.attributes[r] = i[r];\n\n    return n && (e.geometry = n), e.geometry || e.centroid || s.getLogger(this.declaredClass).error(new r(\"geoevent-connection\", \"Found malformed feature - no geometry found\", e)), e;\n  }\n\n  async _queryBuddyServices() {\n    try {\n      const {\n        relatedFeatures: e,\n        keepLatestArchive: t\n      } = this._serviceDefinition,\n            r = this._queryRelatedFeatures(e),\n            s = this._queryArchive(t);\n\n      await r;\n      const o = await s;\n      if (!o) return;\n\n      for (const i of o.features) this.onFeature(this._enrich(i));\n    } catch (e) {\n      s.getLogger(this.declaredClass).error(new r(\"geoevent-connection\", \"Encountered an error when querying buddy services\", {\n        error: e\n      }));\n    }\n  }\n\n  async _queryRelatedFeatures(e) {\n    if (!e) return;\n    const t = await this._queryBuddy(e.featuresUrl);\n\n    this._addRelatedFeatures(t);\n  }\n\n  async _queryArchive(e) {\n    if (e) return this._queryBuddy(e.featuresUrl);\n  }\n\n  async _queryBuddy(e) {\n    const t = new (await import(\"../../../FeatureLayer.js\")).default({\n      url: e\n    }),\n          {\n      capabilities: r\n    } = await t.load(),\n          s = r.query.supportsMaxRecordCountFactor,\n          o = r.query.supportsPagination,\n          i = r.query.supportsCentroid,\n          c = this._config.maxRecordCountFactor,\n          u = t.capabilities.query.maxRecordCount,\n          d = s ? u * c : u,\n          l = new h();\n    if (l.outFields = n(this._config.outFields, [\"*\"]), l.where = n(a(this._config.filter, \"where\"), \"1=1\"), l.returnGeometry = !0, l.returnExceededLimitFeatures = !0, l.outSpatialReference = y.fromJSON(this._config.spatialReference), i && (l.returnCentroid = !0), s && (l.maxRecordCountFactor = c), o) return l.num = d, t.destroy(), this._queryPages(e, l);\n    const g = await f(e, l, this._config.sourceSpatialReference);\n    return t.destroy(), g.data;\n  }\n\n  async _queryPages(e, t, r = [], s = 0) {\n    t.start = o(t.num) ? s * t.num : null;\n    const {\n      data: i\n    } = await f(e, t, this._config.sourceSpatialReference);\n    return i.exceededTransferLimit && s < this._config.maxQueryDepth ? (i.features.forEach(e => r.push(e)), this._queryPages(e, t, r, s + 1)) : (r.forEach(e => i.features.push(e)), i);\n  }\n\n  _addRelatedFeatures(e) {\n    const t = new Map(),\n          r = e.features,\n          s = this._serviceDefinition.relatedFeatures.joinField;\n\n    for (const o of r) {\n      const e = o.attributes[s];\n      t.set(e, o);\n    }\n\n    this._relatedFeatures = t;\n  }\n\n};\n\n_ = e([d(\"esri.layers.graphics.sources.connections.GeoEventConnection\")], _);\nconst w = _;\nexport { w as default };","map":{"version":3,"names":["_","e","t","r","s","isSome","o","isNone","i","unwrapOr","n","get","a","createResolver","c","addQueryParameters","u","subclass","d","WebSocketConnection","l","executeQuery","f","h","fromJSON","g","y","m","p","maxQueryDepth","maxRecordCountFactor","constructor","_open","_fetchServiceDefinition","_config","source","timeInfo","trackIdField","getLogger","declaredClass","warn","_fetchWebSocketUrl","streamUrls","spatialReference","_buddyServicesQuery","_queryBuddyServices","_tryCreateWebSocket","filter","outFields","destroyed","_setFilter","_onMessage","_enrich","JSON","parse","data","_featureZScaler","geometry","error","onFeature","customParameters","path","query","responseType","_serviceDefinition","urls","token","_inferWebSocketBaseUrl","outSR","wkid","length","includes","_websocket","stringify","_serializeFilter","reject","_set","onmessage","bind","resolve","send","setTimeout","promise","type","shiftCentralMeridian","where","join","_relatedFeatures","relatedFeatures","joinField","attributes","has","centroid","keepLatestArchive","_queryRelatedFeatures","_queryArchive","features","_queryBuddy","featuresUrl","_addRelatedFeatures","default","url","capabilities","load","supportsMaxRecordCountFactor","supportsPagination","supportsCentroid","maxRecordCount","returnGeometry","returnExceededLimitFeatures","outSpatialReference","returnCentroid","num","destroy","_queryPages","sourceSpatialReference","start","exceededTransferLimit","forEach","push","Map","set","w"],"sources":["E:/各个学科/论文/毕业论文/Atmosphere/eco-friendly/node_modules/@arcgis/core/layers/graphics/sources/connections/GeoEventConnection.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import\"../../../../geometry.js\";import t from\"../../../../request.js\";import r from\"../../../../core/Error.js\";import s from\"../../../../core/Logger.js\";import{isSome as o,isNone as i,unwrapOr as n,get as a}from\"../../../../core/maybe.js\";import{createResolver as c}from\"../../../../core/promiseUtils.js\";import{addQueryParameters as u}from\"../../../../core/urlUtils.js\";import\"../../../../core/accessorSupport/ensureType.js\";import\"../../../../core/arrayUtils.js\";import\"../../../../core/has.js\";import{subclass as d}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{WebSocketConnection as l}from\"./WebSocketConnection.js\";import{executeQuery as f}from\"../../../../rest/query/operations/query.js\";import h from\"../../../../rest/support/Query.js\";import{fromJSON as g}from\"../../../../geometry/support/jsonUtils.js\";import y from\"../../../../geometry/SpatialReference.js\";const m=1e4,p={maxQueryDepth:5,maxRecordCountFactor:3};let _=class extends l{constructor(e){super({...p,...e})}async _open(){const e=await this._fetchServiceDefinition(this._config.source);e.timeInfo.trackIdField||s.getLogger(this.declaredClass).warn(\"GeoEvent service was configured without a TrackIdField. This may result in certain functionality being disabled. The purgeOptions.maxObservations property will have no effect.\");const t=this._fetchWebSocketUrl(e.streamUrls,this._config.spatialReference);this._buddyServicesQuery||(this._buddyServicesQuery=this._queryBuddyServices()),await this._buddyServicesQuery,await this._tryCreateWebSocket(t);const{filter:r,outFields:o}=this._config;this.destroyed||this._setFilter(r,o)}_onMessage(e){let t;try{t=this._enrich(JSON.parse(e.data)),o(this._featureZScaler)&&this._featureZScaler(t.geometry)}catch(i){return void s.getLogger(this.declaredClass).error(new r(\"geoevent-connection\",\"Failed to parse message\",i))}this.onFeature(t)}async _fetchServiceDefinition(e){const r={f:\"json\",...this._config.customParameters},s=t(e.path,{query:r,responseType:\"json\"}),o=(await s).data;return this._serviceDefinition=o,o}_fetchWebSocketUrl(e,t){const r=e[0],{urls:s,token:o}=r,i=this._inferWebSocketBaseUrl(s);return u(`${i}/subscribe`,{outSR:\"\"+t.wkid,token:o})}_inferWebSocketBaseUrl(e){if(1===e.length)return e[0];for(const t of e)if(t.includes(\"wss\"))return t;return s.getLogger(this.declaredClass).error(new r(\"geoevent-connection\",\"Unable to infer WebSocket url\",e)),null}async _setFilter(e,t){const o=this._websocket;if(i(o)||i(e)&&i(t))return;const n=JSON.stringify({filter:this._serializeFilter(e,t)});let a=!1;const u=c(),d=()=>{a||(this.destroyed||this._websocket!==o||s.getLogger(this.declaredClass).error(new r(\"geoevent-connection\",\"Server timed out when setting filter\")),u.reject())},l=e=>{const t=JSON.parse(e.data);t.filter&&(t.error&&(s.getLogger(this.declaredClass).error(new r(\"geoevent-connection\",\"Failed to set service filter\",t.error)),this._set(\"errorString\",`Could not set service filter - ${t.error}`),u.reject(t.error)),o.onmessage=this._onMessage.bind(this),a=!0,u.resolve())};return o.onmessage=l,o.send(n),setTimeout(d,m),u.promise}_serializeFilter(e,t){const n={};if(i(e)&&i(t))return n;if(o(e)&&e.geometry)try{const t=g(e.geometry);if(\"extent\"!==t.type)throw new r(`Expected extent but found type ${t.type}`);n.geometry=JSON.stringify(t.shiftCentralMeridian())}catch(a){s.getLogger(this.declaredClass).error(new r(\"geoevent-connection\",\"Encountered an error when setting connection geometryDefinition\",a))}return o(e)&&e.where&&\"1 = 1\"!==e.where&&(n.where=e.where),o(t)&&(n.outFields=t.join(\",\")),n}_enrich(e){if(!this._relatedFeatures)return e;const t=this._serviceDefinition.relatedFeatures.joinField,o=e.attributes[t];if(!this._relatedFeatures.has(o))return s.getLogger(this.declaredClass).warn(\"geoevent-connection\",\"Feature join failed. Is the join field configured correctly?\",e),e;const{attributes:i,geometry:n}=this._relatedFeatures.get(o);for(const r in i)e.attributes[r]=i[r];return n&&(e.geometry=n),e.geometry||e.centroid||s.getLogger(this.declaredClass).error(new r(\"geoevent-connection\",\"Found malformed feature - no geometry found\",e)),e}async _queryBuddyServices(){try{const{relatedFeatures:e,keepLatestArchive:t}=this._serviceDefinition,r=this._queryRelatedFeatures(e),s=this._queryArchive(t);await r;const o=await s;if(!o)return;for(const i of o.features)this.onFeature(this._enrich(i))}catch(e){s.getLogger(this.declaredClass).error(new r(\"geoevent-connection\",\"Encountered an error when querying buddy services\",{error:e}))}}async _queryRelatedFeatures(e){if(!e)return;const t=await this._queryBuddy(e.featuresUrl);this._addRelatedFeatures(t)}async _queryArchive(e){if(e)return this._queryBuddy(e.featuresUrl)}async _queryBuddy(e){const t=new((await import(\"../../../FeatureLayer.js\")).default)({url:e}),{capabilities:r}=await t.load(),s=r.query.supportsMaxRecordCountFactor,o=r.query.supportsPagination,i=r.query.supportsCentroid,c=this._config.maxRecordCountFactor,u=t.capabilities.query.maxRecordCount,d=s?u*c:u,l=new h;if(l.outFields=n(this._config.outFields,[\"*\"]),l.where=n(a(this._config.filter,\"where\"),\"1=1\"),l.returnGeometry=!0,l.returnExceededLimitFeatures=!0,l.outSpatialReference=y.fromJSON(this._config.spatialReference),i&&(l.returnCentroid=!0),s&&(l.maxRecordCountFactor=c),o)return l.num=d,t.destroy(),this._queryPages(e,l);const g=await f(e,l,this._config.sourceSpatialReference);return t.destroy(),g.data}async _queryPages(e,t,r=[],s=0){t.start=o(t.num)?s*t.num:null;const{data:i}=await f(e,t,this._config.sourceSpatialReference);return i.exceededTransferLimit&&s<this._config.maxQueryDepth?(i.features.forEach((e=>r.push(e))),this._queryPages(e,t,r,s+1)):(r.forEach((e=>i.features.push(e))),i)}_addRelatedFeatures(e){const t=new Map,r=e.features,s=this._serviceDefinition.relatedFeatures.joinField;for(const o of r){const e=o.attributes[s];t.set(e,o)}this._relatedFeatures=t}};_=e([d(\"esri.layers.graphics.sources.connections.GeoEventConnection\")],_);const w=_;export{w as default};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}