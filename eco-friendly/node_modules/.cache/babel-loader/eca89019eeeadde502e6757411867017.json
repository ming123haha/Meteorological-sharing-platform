{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport { isSome as e } from \"../../../core/maybe.js\";\nimport i from \"./TileCoverage.js\";\nimport t from \"./TileKey.js\";\nconst l = 1e-6;\n\nclass s {\n  constructor(e) {\n    this._tiles = new Map(), this.buffer = 0, this.acquireTile = e.acquireTile, this.releaseTile = e.releaseTile, this.tileInfoView = e.tileInfoView, this.buffer = e.buffer;\n  }\n\n  destroy() {}\n\n  clear() {\n    this._tiles.forEach(e => this._releaseTile(e));\n  }\n\n  tileKeys() {\n    const e = [];\n    return this._tiles.forEach((i, t) => e.push(t)), e;\n  }\n\n  update(e) {\n    const l = this.tileInfoView.getTileCoverage(e.state, this.buffer, \"closest\"),\n          {\n      spans: s,\n      lodInfo: r\n    } = l,\n          {\n      level: a\n    } = r,\n          o = [],\n          d = [],\n          h = new Set(),\n          n = new Set();\n\n    for (const {\n      row: i,\n      colFrom: c,\n      colTo: f\n    } of s) for (let e = c; e <= f; e++) {\n      const l = t.getId(a, i, r.normalizeCol(e), r.getWorldForColumn(e)),\n            s = this._getOrAcquireTile(o, l);\n\n      h.add(l), s.isReady ? s.visible = !0 : n.add(s.key);\n    }\n\n    n.forEach(e => this._addPlaceholders(h, e)), this._tiles.forEach(e => {\n      h.has(e.key.id) || (d.push(e.key.id), this._releaseTile(e));\n    }), i.pool.release(l);\n    return {\n      hasMissingTiles: n.size > 0,\n      added: o,\n      removed: d\n    };\n  }\n\n  _getOrAcquireTile(e, i) {\n    if (!this._tiles.has(i)) {\n      const l = this.acquireTile(new t(i));\n      e.push(i), this._tiles.set(i, l), l.visible = !1;\n    }\n\n    return this._tiles.get(i);\n  }\n\n  _getTile(e) {\n    return this._tiles.get(e);\n  }\n\n  _releaseTile(e) {\n    this._tiles.delete(e.key.id), this.releaseTile(e);\n  }\n\n  _addPlaceholders(e, i) {\n    const t = this._addPlaceholderChildren(e, i);\n\n    if (!(Math.abs(1 - t) < l)) {\n      if (!this._addPlaceholderParent(e, i)) {\n        this._getTile(i.id).visible = !0;\n      }\n    }\n  }\n\n  _addPlaceholderChildren(e, i) {\n    let t = 0;\n    return this._tiles.forEach(l => {\n      t += this._addPlaceholderChild(e, l, i);\n    }), t;\n  }\n\n  _addPlaceholderChild(e, i, t) {\n    if (i.key.level <= t.level || !i.hasData || !t.contains(i.key)) return 0;\n    i.visible = !0, e.add(i.key.id);\n    return 1 / (1 << 2 * (i.key.level - t.level));\n  }\n\n  _addPlaceholderParent(i, t) {\n    let l = t.getParentKey(),\n        s = 0,\n        r = null;\n\n    for (; e(l);) {\n      if (i.has(l.id)) return !0;\n\n      const e = this._getTile(l.id);\n\n      if (e?.isReady) return e.visible = !0, i.add(e.key.id), !0;\n      e?.hasData && e.patchCount > s && (s = e.patchCount, r = e), l = l.getParentKey();\n    }\n\n    return !!r && (r.visible = !0, i.add(r.key.id), !0);\n  }\n\n}\n\nexport { s as TileManager };","map":{"version":3,"names":["isSome","e","i","t","l","s","constructor","_tiles","Map","buffer","acquireTile","releaseTile","tileInfoView","destroy","clear","forEach","_releaseTile","tileKeys","push","update","getTileCoverage","state","spans","lodInfo","r","level","a","o","d","h","Set","n","row","colFrom","c","colTo","f","getId","normalizeCol","getWorldForColumn","_getOrAcquireTile","add","isReady","visible","key","_addPlaceholders","has","id","pool","release","hasMissingTiles","size","added","removed","set","get","_getTile","delete","_addPlaceholderChildren","Math","abs","_addPlaceholderParent","_addPlaceholderChild","hasData","contains","getParentKey","patchCount","TileManager"],"sources":["C:/Users/hp/Desktop/eco-friendly atmosphere/Atmosphere/eco-friendly/node_modules/@arcgis/core/views/2d/tiling/TileManager.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport{isSome as e}from\"../../../core/maybe.js\";import i from\"./TileCoverage.js\";import t from\"./TileKey.js\";const l=1e-6;class s{constructor(e){this._tiles=new Map,this.buffer=0,this.acquireTile=e.acquireTile,this.releaseTile=e.releaseTile,this.tileInfoView=e.tileInfoView,this.buffer=e.buffer}destroy(){}clear(){this._tiles.forEach((e=>this._releaseTile(e)))}tileKeys(){const e=[];return this._tiles.forEach(((i,t)=>e.push(t))),e}update(e){const l=this.tileInfoView.getTileCoverage(e.state,this.buffer,\"closest\"),{spans:s,lodInfo:r}=l,{level:a}=r,o=[],d=[],h=new Set,n=new Set;for(const{row:i,colFrom:c,colTo:f}of s)for(let e=c;e<=f;e++){const l=t.getId(a,i,r.normalizeCol(e),r.getWorldForColumn(e)),s=this._getOrAcquireTile(o,l);h.add(l),s.isReady?s.visible=!0:n.add(s.key)}n.forEach((e=>this._addPlaceholders(h,e))),this._tiles.forEach((e=>{h.has(e.key.id)||(d.push(e.key.id),this._releaseTile(e))})),i.pool.release(l);return{hasMissingTiles:n.size>0,added:o,removed:d}}_getOrAcquireTile(e,i){if(!this._tiles.has(i)){const l=this.acquireTile(new t(i));e.push(i),this._tiles.set(i,l),l.visible=!1}return this._tiles.get(i)}_getTile(e){return this._tiles.get(e)}_releaseTile(e){this._tiles.delete(e.key.id),this.releaseTile(e)}_addPlaceholders(e,i){const t=this._addPlaceholderChildren(e,i);if(!(Math.abs(1-t)<l)){if(!this._addPlaceholderParent(e,i)){this._getTile(i.id).visible=!0}}}_addPlaceholderChildren(e,i){let t=0;return this._tiles.forEach((l=>{t+=this._addPlaceholderChild(e,l,i)})),t}_addPlaceholderChild(e,i,t){if(i.key.level<=t.level||!i.hasData||!t.contains(i.key))return 0;i.visible=!0,e.add(i.key.id);return 1/(1<<2*(i.key.level-t.level))}_addPlaceholderParent(i,t){let l=t.getParentKey(),s=0,r=null;for(;e(l);){if(i.has(l.id))return!0;const e=this._getTile(l.id);if(e?.isReady)return e.visible=!0,i.add(e.key.id),!0;e?.hasData&&e.patchCount>s&&(s=e.patchCount,r=e),l=l.getParentKey()}return!!r&&(r.visible=!0,i.add(r.key.id),!0)}}export{s as TileManager};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}