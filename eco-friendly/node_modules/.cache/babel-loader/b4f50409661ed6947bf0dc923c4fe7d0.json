{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport { k as e } from \"../../../chunks/vec2.js\";\n\nclass t {\n  constructor(e, t, i) {\n    this.maxSize = e, this._tileInfoView = t, this._removedFunc = i, this._tilePerId = new Map(), this._tileKeysPerLevel = [];\n  }\n\n  has(e) {\n    return this._tilePerId.has(e);\n  }\n\n  get(e) {\n    return this._tilePerId.get(e);\n  }\n\n  pop(e) {\n    const t = this._tilePerId.get(e);\n\n    if (!t) return;\n    const s = t.key.level,\n          r = this._tileKeysPerLevel[s];\n    i(this._tilePerId, e);\n\n    for (let i = 0; i < r.length; i++) if (r[i].id === e) {\n      r.splice(i, 1);\n      break;\n    }\n\n    return t.visible = !0, t;\n  }\n\n  add(e) {\n    e.visible = !1;\n    const t = e.key,\n          i = t.id;\n    if (this._tilePerId.has(i)) return;\n\n    this._tilePerId.set(i, e);\n\n    const s = t.level;\n    this._tileKeysPerLevel[s] || (this._tileKeysPerLevel[s] = []), this._tileKeysPerLevel[s].push(t);\n  }\n\n  prune(e, t, i) {\n    let s = this._tilePerId.size;\n    if (s <= this.maxSize) return;\n    let r = this._tileKeysPerLevel.length - 1;\n\n    for (; s > this.maxSize && r >= 0;) r !== e && (s = this._pruneAroundCenterTile(s, t, i, r)), r--;\n\n    s > this.maxSize && (s = this._pruneAroundCenterTile(s, t, i, e));\n  }\n\n  _pruneAroundCenterTile(t, i, s, r) {\n    const l = this._tileKeysPerLevel[r];\n    if (!l || 0 === l.length) return t;\n\n    const {\n      size: n,\n      origin: h\n    } = this._tileInfoView.tileInfo,\n          o = s * n[0],\n          _ = s * n[1],\n          d = [0, 0],\n          u = [0, 0];\n\n    for (l.sort((t, s) => (d[0] = h.x + o * (t.col + .5), d[1] = h.y - _ * (t.row + .5), u[0] = h.x + o * (s.col + .5), u[1] = h.y - _ * (s.row + .5), e(d, i) - e(u, i))); l.length > 0;) {\n      const e = l.pop();\n      if (this._removeTile(e.id), --t === this.maxSize) break;\n    }\n\n    return t;\n  }\n\n  _removeTile(e) {\n    const t = this._tilePerId.get(e);\n\n    this._removedFunc && t && this._removedFunc(t), i(this._tilePerId, e);\n  }\n\n}\n\nfunction i(e, t) {\n  e.delete(t);\n}\n\nexport { t as default };","map":{"version":3,"names":["k","e","t","constructor","i","maxSize","_tileInfoView","_removedFunc","_tilePerId","Map","_tileKeysPerLevel","has","get","pop","s","key","level","r","length","id","splice","visible","add","set","push","prune","size","_pruneAroundCenterTile","l","n","origin","h","tileInfo","o","_","d","u","sort","x","col","y","row","_removeTile","delete","default"],"sources":["E:/各个学科/论文/毕业论文/Atmosphere/eco-friendly/node_modules/@arcgis/core/views/2d/tiling/TileCache.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{k as e}from\"../../../chunks/vec2.js\";class t{constructor(e,t,i){this.maxSize=e,this._tileInfoView=t,this._removedFunc=i,this._tilePerId=new Map,this._tileKeysPerLevel=[]}has(e){return this._tilePerId.has(e)}get(e){return this._tilePerId.get(e)}pop(e){const t=this._tilePerId.get(e);if(!t)return;const s=t.key.level,r=this._tileKeysPerLevel[s];i(this._tilePerId,e);for(let i=0;i<r.length;i++)if(r[i].id===e){r.splice(i,1);break}return t.visible=!0,t}add(e){e.visible=!1;const t=e.key,i=t.id;if(this._tilePerId.has(i))return;this._tilePerId.set(i,e);const s=t.level;this._tileKeysPerLevel[s]||(this._tileKeysPerLevel[s]=[]),this._tileKeysPerLevel[s].push(t)}prune(e,t,i){let s=this._tilePerId.size;if(s<=this.maxSize)return;let r=this._tileKeysPerLevel.length-1;for(;s>this.maxSize&&r>=0;)r!==e&&(s=this._pruneAroundCenterTile(s,t,i,r)),r--;s>this.maxSize&&(s=this._pruneAroundCenterTile(s,t,i,e))}_pruneAroundCenterTile(t,i,s,r){const l=this._tileKeysPerLevel[r];if(!l||0===l.length)return t;const{size:n,origin:h}=this._tileInfoView.tileInfo,o=s*n[0],_=s*n[1],d=[0,0],u=[0,0];for(l.sort(((t,s)=>(d[0]=h.x+o*(t.col+.5),d[1]=h.y-_*(t.row+.5),u[0]=h.x+o*(s.col+.5),u[1]=h.y-_*(s.row+.5),e(d,i)-e(u,i))));l.length>0;){const e=l.pop();if(this._removeTile(e.id),--t===this.maxSize)break}return t}_removeTile(e){const t=this._tilePerId.get(e);this._removedFunc&&t&&this._removedFunc(t),i(this._tilePerId,e)}}function i(e,t){e.delete(t)}export{t as default};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}