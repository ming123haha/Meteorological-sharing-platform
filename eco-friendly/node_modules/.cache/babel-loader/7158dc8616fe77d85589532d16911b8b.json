{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport { isSome as e } from \"../../../../core/maybe.js\";\nimport { MIN_PRIORITY as t } from \"../../../../core/MemCache.js\";\nimport { throwIfAborted as o } from \"../../../../core/promiseUtils.js\";\nimport { f as s } from \"../../../../chunks/mat3f32.js\";\nimport { create as i } from \"../../../../geometry/support/aaBoundingRect.js\";\nimport { TileHandler as r } from \"./TileHandler.js\";\nimport { VectorTile as n } from \"./VectorTile.js\";\nimport { declutterSingleTile as l } from \"./decluttering/jobsUtil.js\";\nimport a from \"../../tiling/TileKey.js\";\n\nclass g extends r {\n  constructor(e, t, o, s, i) {\n    super(e, t, o), this._memCache = s, this._loader = i, this._ongoingTileRequests = new Map(), this._ongoingRequestToController = new Map();\n  }\n\n  destroy() {\n    this._ongoingRequestToController.forEach(e => e.abort()), this._ongoingRequestToController.clear(), this._ongoingTileRequests.clear();\n  }\n\n  async getVectorTile(r, g, h, m) {\n    const u = new a(r, g, h, 0);\n\n    let c = this._memCache.get(u.id);\n\n    if (e(c)) return c.retain(), c;\n\n    const _ = await this._getVectorTileData(u);\n\n    if (o(m), !this._layer) return null;\n    if (c = this._memCache.get(u.id), e(c)) return c.retain(), c;\n\n    const T = this._layer.tileInfo.getTileBounds(i(), u);\n\n    return c = new n(u, T[0], T[3], 512, 512, this._styleRepository, this._memCache), e(_) ? (c.setData(_), c.retain(), this._memCache.put(u.id, c, c.memoryUsage * c.referenced, t)) : c.setData(null), c.neededForCoverage = !0, c.transforms.tileUnitsToPixels = s(1 / 8, 0, 0, 0, 1 / 8, 0, 0, 0, 1), l(c, this._styleRepository), c;\n  }\n\n  _getVectorTileData(e) {\n    const t = e.id;\n    if (this._ongoingTileRequests.has(t)) return this._ongoingTileRequests.get(t);\n\n    const o = new AbortController(),\n          s = {\n      signal: o.signal\n    },\n          i = this._getParsedVectorTileData(e, s).then(e => (this._ongoingTileRequests.delete(t), this._ongoingRequestToController.delete(t), e)).catch(() => (this._ongoingTileRequests.delete(t), this._ongoingRequestToController.delete(t), null));\n\n    return this._ongoingTileRequests.set(t, i), this._ongoingRequestToController.set(t, o), i;\n  }\n\n  _getParsedVectorTileData(e, t) {\n    return this.fetchTileData(e, t).then(o => this.parseTileData({\n      key: e,\n      data: o\n    }, t));\n  }\n\n  request(e, t) {\n    return this._loader.request(e, \"binary\", t);\n  }\n\n}\n\nexport { g as default };","map":{"version":3,"names":["isSome","e","MIN_PRIORITY","t","throwIfAborted","o","f","s","create","i","TileHandler","r","VectorTile","n","declutterSingleTile","l","a","g","constructor","_memCache","_loader","_ongoingTileRequests","Map","_ongoingRequestToController","destroy","forEach","abort","clear","getVectorTile","h","m","u","c","get","id","retain","_","_getVectorTileData","_layer","T","tileInfo","getTileBounds","_styleRepository","setData","put","memoryUsage","referenced","neededForCoverage","transforms","tileUnitsToPixels","has","AbortController","signal","_getParsedVectorTileData","then","delete","catch","set","fetchTileData","parseTileData","key","data","request","default"],"sources":["C:/Users/hp/Desktop/eco-friendly atmosphere/Atmosphere/eco-friendly/node_modules/@arcgis/core/views/2d/engine/vectorTiles/TileHandler3D.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport{isSome as e}from\"../../../../core/maybe.js\";import{MIN_PRIORITY as t}from\"../../../../core/MemCache.js\";import{throwIfAborted as o}from\"../../../../core/promiseUtils.js\";import{f as s}from\"../../../../chunks/mat3f32.js\";import{create as i}from\"../../../../geometry/support/aaBoundingRect.js\";import{TileHandler as r}from\"./TileHandler.js\";import{VectorTile as n}from\"./VectorTile.js\";import{declutterSingleTile as l}from\"./decluttering/jobsUtil.js\";import a from\"../../tiling/TileKey.js\";class g extends r{constructor(e,t,o,s,i){super(e,t,o),this._memCache=s,this._loader=i,this._ongoingTileRequests=new Map,this._ongoingRequestToController=new Map}destroy(){this._ongoingRequestToController.forEach((e=>e.abort())),this._ongoingRequestToController.clear(),this._ongoingTileRequests.clear()}async getVectorTile(r,g,h,m){const u=new a(r,g,h,0);let c=this._memCache.get(u.id);if(e(c))return c.retain(),c;const _=await this._getVectorTileData(u);if(o(m),!this._layer)return null;if(c=this._memCache.get(u.id),e(c))return c.retain(),c;const T=this._layer.tileInfo.getTileBounds(i(),u);return c=new n(u,T[0],T[3],512,512,this._styleRepository,this._memCache),e(_)?(c.setData(_),c.retain(),this._memCache.put(u.id,c,c.memoryUsage*c.referenced,t)):c.setData(null),c.neededForCoverage=!0,c.transforms.tileUnitsToPixels=s(1/8,0,0,0,1/8,0,0,0,1),l(c,this._styleRepository),c}_getVectorTileData(e){const t=e.id;if(this._ongoingTileRequests.has(t))return this._ongoingTileRequests.get(t);const o=new AbortController,s={signal:o.signal},i=this._getParsedVectorTileData(e,s).then((e=>(this._ongoingTileRequests.delete(t),this._ongoingRequestToController.delete(t),e))).catch((()=>(this._ongoingTileRequests.delete(t),this._ongoingRequestToController.delete(t),null)));return this._ongoingTileRequests.set(t,i),this._ongoingRequestToController.set(t,o),i}_getParsedVectorTileData(e,t){return this.fetchTileData(e,t).then((o=>this.parseTileData({key:e,data:o},t)))}request(e,t){return this._loader.request(e,\"binary\",t)}}export{g as default};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}