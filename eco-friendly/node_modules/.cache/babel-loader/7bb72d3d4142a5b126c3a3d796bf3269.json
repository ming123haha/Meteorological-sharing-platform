{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport e from \"../../../../../core/Evented.js\";\nimport has from \"../../../../../core/has.js\";\nimport { r as t } from \"../../../../../chunks/rbush.js\";\nimport { Tile as s } from \"./Tile.js\";\nimport i from \"../../../tiling/TileCoverage.js\";\nimport o from \"../../../tiling/TileKey.js\";\nconst h = {\n  added: [],\n  removed: []\n},\n      n = new Set(),\n      r = new o(0, 0, 0, 0);\n\nclass d extends e {\n  constructor(e) {\n    super(), this._tiles = new Map(), this._index = t(9, has(\"esri-csp-restrictions\") ? e => ({\n      minX: e.bounds[0],\n      minY: e.bounds[1],\n      maxX: e.bounds[2],\n      maxY: e.bounds[3]\n    }) : [\".bounds[0]\", \".bounds[1]\", \".bounds[2]\", \".bounds[3]\"]), this.tiles = [], this.tileScheme = e;\n  }\n\n  destroy() {\n    this.clear();\n  }\n\n  clear() {\n    this.tiles.length = 0, this._tiles.clear(), this._index.clear();\n  }\n\n  has(e) {\n    return this._tiles.has(e);\n  }\n\n  get(e) {\n    return this._tiles.get(e);\n  }\n\n  boundsIntersections(e) {\n    return this._index.search({\n      minX: e[0],\n      minY: e[1],\n      maxX: e[2],\n      maxY: e[3]\n    });\n  }\n\n  updateTiles(e) {\n    const t = {\n      added: [],\n      removed: []\n    };\n\n    for (const i of e.added) if (!this.has(i)) {\n      const e = new s(this.tileScheme, i);\n      this._tiles.set(i, e), this._index.insert(e), t.added.push(e);\n    }\n\n    for (const s of e.removed) if (this.has(s)) {\n      const e = this.get(s);\n      this._tiles.delete(s), this._index.remove(e), t.removed.push(e);\n    }\n\n    this.tiles.length = 0, this._tiles.forEach(e => this.tiles.push(e)), (t.added.length || t.removed.length) && this.emit(\"update\", t);\n  }\n\n  setViewState(e) {\n    const t = this.tileScheme.getTileCoverage(e, 0);\n    if (!t) return;\n    const {\n      spans: o,\n      lodInfo: d\n    } = t,\n          {\n      level: l\n    } = d;\n    if (o.length > 0) for (const {\n      row: i,\n      colFrom: a,\n      colTo: m\n    } of o) for (let e = a; e <= m; e++) {\n      const t = r.set(l, i, d.normalizeCol(e), d.getWorldForColumn(e)).id;\n\n      if (n.add(t), !this.has(t)) {\n        const e = new s(this.tileScheme, t);\n        this._tiles.set(t, e), this._index.insert(e), this.tiles.push(e), h.added.push(e);\n      }\n    }\n\n    for (let s = this.tiles.length - 1; s >= 0; s--) {\n      const e = this.tiles[s];\n      n.has(e.id) || (this._tiles.delete(e.id), this.tiles.splice(s, 1), this._index.remove(e), h.removed.push(e));\n    }\n\n    (h.added.length || h.removed.length) && this.emit(\"update\", h), i.pool.release(t), n.clear(), h.added.length = 0, h.removed.length = 0;\n  }\n\n}\n\nexport { d as default };","map":{"version":3,"names":["e","has","r","t","Tile","s","i","o","h","added","removed","n","Set","d","constructor","_tiles","Map","_index","minX","bounds","minY","maxX","maxY","tiles","tileScheme","destroy","clear","length","get","boundsIntersections","search","updateTiles","set","insert","push","delete","remove","forEach","emit","setViewState","getTileCoverage","spans","lodInfo","level","l","row","colFrom","a","colTo","m","normalizeCol","getWorldForColumn","id","add","splice","pool","release","default"],"sources":["E:/各个学科/论文/毕业论文/Atmosphere/eco-friendly/node_modules/@arcgis/core/views/2d/layers/features/support/TileStore.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport e from\"../../../../../core/Evented.js\";import has from\"../../../../../core/has.js\";import{r as t}from\"../../../../../chunks/rbush.js\";import{Tile as s}from\"./Tile.js\";import i from\"../../../tiling/TileCoverage.js\";import o from\"../../../tiling/TileKey.js\";const h={added:[],removed:[]},n=new Set,r=new o(0,0,0,0);class d extends e{constructor(e){super(),this._tiles=new Map,this._index=t(9,has(\"esri-csp-restrictions\")?e=>({minX:e.bounds[0],minY:e.bounds[1],maxX:e.bounds[2],maxY:e.bounds[3]}):[\".bounds[0]\",\".bounds[1]\",\".bounds[2]\",\".bounds[3]\"]),this.tiles=[],this.tileScheme=e}destroy(){this.clear()}clear(){this.tiles.length=0,this._tiles.clear(),this._index.clear()}has(e){return this._tiles.has(e)}get(e){return this._tiles.get(e)}boundsIntersections(e){return this._index.search({minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]})}updateTiles(e){const t={added:[],removed:[]};for(const i of e.added)if(!this.has(i)){const e=new s(this.tileScheme,i);this._tiles.set(i,e),this._index.insert(e),t.added.push(e)}for(const s of e.removed)if(this.has(s)){const e=this.get(s);this._tiles.delete(s),this._index.remove(e),t.removed.push(e)}this.tiles.length=0,this._tiles.forEach((e=>this.tiles.push(e))),(t.added.length||t.removed.length)&&this.emit(\"update\",t)}setViewState(e){const t=this.tileScheme.getTileCoverage(e,0);if(!t)return;const{spans:o,lodInfo:d}=t,{level:l}=d;if(o.length>0)for(const{row:i,colFrom:a,colTo:m}of o)for(let e=a;e<=m;e++){const t=r.set(l,i,d.normalizeCol(e),d.getWorldForColumn(e)).id;if(n.add(t),!this.has(t)){const e=new s(this.tileScheme,t);this._tiles.set(t,e),this._index.insert(e),this.tiles.push(e),h.added.push(e)}}for(let s=this.tiles.length-1;s>=0;s--){const e=this.tiles[s];n.has(e.id)||(this._tiles.delete(e.id),this.tiles.splice(s,1),this._index.remove(e),h.removed.push(e))}(h.added.length||h.removed.length)&&this.emit(\"update\",h),i.pool.release(t),n.clear(),h.added.length=0,h.removed.length=0}}export{d as default};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}