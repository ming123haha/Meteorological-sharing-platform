{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport { isSome as t } from \"../../../../../../core/maybe.js\";\nimport { pt2px as e } from \"../../../../../../core/screenUtils.js\";\nimport { premultiplyAlphaRGBA as s } from \"../../color.js\";\nimport { BITSET_GENERIC_LOCK_COLOR as i, BITSET_FILL_RANDOM_PATTERN_OFFSET as o, BITSET_GENERIC_CONSIDER_ALPHA_ONLY as r, SPRITE_PADDING as a, MIN_MAX_ZOOM_PRECISION_FACTOR as l } from \"../../definitions.js\";\nimport { degToByte as n } from \"../../GeometryUtils.js\";\nimport { i1616to32 as c, i8888to32 as h } from \"../../number.js\";\nimport { FillMaterialKey as f } from \"../../materialKey/MaterialKey.js\";\nimport { isFunction as m, getMinMaxZoom as p } from \"./util.js\";\nimport _ from \"./WGLBaseFillTemplate.js\";\nimport y from \"./WGLDynamicMeshTemplate.js\";\nimport { ok as d } from \"../../util/Result.js\";\nconst u = 128;\n\nclass M extends _(y) {\n  constructor(a, h, f) {\n    if (super(a), this._minMaxZoom = c(Math.round(h * l), Math.round(f * l)), m(a.color)) {\n      const t = (t, e, i) => {\n        const o = a.color(t, e, i);\n        return o && s(o) || 0;\n      };\n\n      this._dynamicPropertyMap.set(\"fillColor\", t);\n    } else {\n      const t = a.color;\n      this.fillColor = t && s(t) || 0;\n    }\n\n    const p = \"CIMMarkerPlacementInsidePolygon\" === a.cim.placement?.type && a.cim.placement.shiftOddRows ? 2 : 1,\n          _ = a.height;\n\n    if (m(_)) {\n      const t = (t, e, s) => _(t, e, s) * p;\n\n      this._dynamicPropertyMap.set(\"_height\", t);\n    } else this._height = (_ || 0) * p;\n\n    const y = a.offsetX;\n\n    if (m(y)) {\n      const t = (t, s, i) => e(y(t, s, i));\n\n      this._dynamicPropertyMap.set(\"_offsetX\", t);\n    } else this._offsetX = e(y || 0);\n\n    const d = a.offsetY;\n\n    if (m(d)) {\n      const t = (t, s, i) => e(-d(t, s, i));\n\n      this._dynamicPropertyMap.set(\"_offsetY\", t);\n    } else this._offsetY = e(-d || 0);\n\n    const u = a.scaleX;\n    m(u) ? this._dynamicPropertyMap.set(\"_scaleX\", u) : this._scaleX = u || 1;\n    const M = a.angle;\n\n    if (m(M)) {\n      const t = (t, e, s) => n(M(t, e, s));\n\n      this._dynamicPropertyMap.set(\"_angle\", t);\n    } else this._angle = n(M) || 0;\n\n    if (t(a.effects)) {\n      const t = a.effects;\n      m(t) ? this._dynamicPropertyMap.set(\"_effects\", t) : this._effects = t;\n    }\n\n    this._cimFillLayer = a, this._bitset = (a.colorLocked ? i : 0) | (a.applyRandomOffset ? o : 0) | (a.sampleAlphaOnly ? r : 0), this._fillMaterialKey = a.materialKey;\n  }\n\n  static fromCIMFill(t, e) {\n    const [s, i] = p(t.scaleInfo, e);\n    return new M(t, s, i);\n  }\n\n  bindFeature(t, s, i) {\n    const o = t.readLegacyFeature();\n\n    this._dynamicPropertyMap.forEach((t, e) => {\n      this[e] = t(o, s, i);\n    });\n\n    const r = f.load(this._fillMaterialKey),\n          l = this._materialCache,\n          n = (0, this._cimFillLayer.materialHash)(o, s, i),\n          m = l.get(n);\n    let p = null;\n\n    if (m && d(m.spriteMosaicItem) && (p = m.spriteMosaicItem), p) {\n      const {\n        rect: t,\n        width: s,\n        height: i\n      } = p,\n            o = t.x + a,\n            l = t.y + a,\n            n = o + s,\n            f = l + i;\n      let m = Math.round(e(this._height));\n      m <= 0 && (m = f - l);\n\n      let _ = Math.round(e(this._height / i * s || 0));\n\n      _ <= 0 && (_ = n - o);\n      const y = this._scaleX,\n            d = 1;\n      this.tl = c(o, l), this.br = c(n, f), this.aux21 = c(_, m), this.aux22 = c(this._offsetX, this._offsetY), this.aux3 = h(y * u, d * u, this._angle, 0), r.sdf = p.sdf, r.pattern = !0, r.textureBinding = p.textureBinding;\n    } else this.tl = 0, this.br = 0, this.aux21 = 0, this.aux22 = 0, this.aux3 = 0, r.sdf = !1, r.pattern = !1, r.textureBinding = 0;\n\n    this._materialKey = r.data;\n  }\n\n}\n\nexport { M as default };","map":{"version":3,"names":["isSome","t","pt2px","e","premultiplyAlphaRGBA","s","BITSET_GENERIC_LOCK_COLOR","i","BITSET_FILL_RANDOM_PATTERN_OFFSET","o","BITSET_GENERIC_CONSIDER_ALPHA_ONLY","r","SPRITE_PADDING","a","MIN_MAX_ZOOM_PRECISION_FACTOR","l","degToByte","n","i1616to32","c","i8888to32","h","FillMaterialKey","f","isFunction","m","getMinMaxZoom","p","_","y","ok","d","u","M","constructor","_minMaxZoom","Math","round","color","_dynamicPropertyMap","set","fillColor","cim","placement","type","shiftOddRows","height","_height","offsetX","_offsetX","offsetY","_offsetY","scaleX","_scaleX","angle","_angle","effects","_effects","_cimFillLayer","_bitset","colorLocked","applyRandomOffset","sampleAlphaOnly","_fillMaterialKey","materialKey","fromCIMFill","scaleInfo","bindFeature","readLegacyFeature","forEach","load","_materialCache","materialHash","get","spriteMosaicItem","rect","width","x","tl","br","aux21","aux22","aux3","sdf","pattern","textureBinding","_materialKey","data","default"],"sources":["E:/各个学科/论文/毕业论文/Atmosphere/eco-friendly/node_modules/@arcgis/core/views/2d/engine/webgl/mesh/templates/WGLDynamicFillTemplate.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{isSome as t}from\"../../../../../../core/maybe.js\";import{pt2px as e}from\"../../../../../../core/screenUtils.js\";import{premultiplyAlphaRGBA as s}from\"../../color.js\";import{BITSET_GENERIC_LOCK_COLOR as i,BITSET_FILL_RANDOM_PATTERN_OFFSET as o,BITSET_GENERIC_CONSIDER_ALPHA_ONLY as r,SPRITE_PADDING as a,MIN_MAX_ZOOM_PRECISION_FACTOR as l}from\"../../definitions.js\";import{degToByte as n}from\"../../GeometryUtils.js\";import{i1616to32 as c,i8888to32 as h}from\"../../number.js\";import{FillMaterialKey as f}from\"../../materialKey/MaterialKey.js\";import{isFunction as m,getMinMaxZoom as p}from\"./util.js\";import _ from\"./WGLBaseFillTemplate.js\";import y from\"./WGLDynamicMeshTemplate.js\";import{ok as d}from\"../../util/Result.js\";const u=128;class M extends(_(y)){constructor(a,h,f){if(super(a),this._minMaxZoom=c(Math.round(h*l),Math.round(f*l)),m(a.color)){const t=(t,e,i)=>{const o=a.color(t,e,i);return o&&s(o)||0};this._dynamicPropertyMap.set(\"fillColor\",t)}else{const t=a.color;this.fillColor=t&&s(t)||0}const p=\"CIMMarkerPlacementInsidePolygon\"===a.cim.placement?.type&&a.cim.placement.shiftOddRows?2:1,_=a.height;if(m(_)){const t=(t,e,s)=>_(t,e,s)*p;this._dynamicPropertyMap.set(\"_height\",t)}else this._height=(_||0)*p;const y=a.offsetX;if(m(y)){const t=(t,s,i)=>e(y(t,s,i));this._dynamicPropertyMap.set(\"_offsetX\",t)}else this._offsetX=e(y||0);const d=a.offsetY;if(m(d)){const t=(t,s,i)=>e(-d(t,s,i));this._dynamicPropertyMap.set(\"_offsetY\",t)}else this._offsetY=e(-d||0);const u=a.scaleX;m(u)?this._dynamicPropertyMap.set(\"_scaleX\",u):this._scaleX=u||1;const M=a.angle;if(m(M)){const t=(t,e,s)=>n(M(t,e,s));this._dynamicPropertyMap.set(\"_angle\",t)}else this._angle=n(M)||0;if(t(a.effects)){const t=a.effects;m(t)?this._dynamicPropertyMap.set(\"_effects\",t):this._effects=t}this._cimFillLayer=a,this._bitset=(a.colorLocked?i:0)|(a.applyRandomOffset?o:0)|(a.sampleAlphaOnly?r:0),this._fillMaterialKey=a.materialKey}static fromCIMFill(t,e){const[s,i]=p(t.scaleInfo,e);return new M(t,s,i)}bindFeature(t,s,i){const o=t.readLegacyFeature();this._dynamicPropertyMap.forEach(((t,e)=>{this[e]=t(o,s,i)}));const r=f.load(this._fillMaterialKey),l=this._materialCache,n=(0,this._cimFillLayer.materialHash)(o,s,i),m=l.get(n);let p=null;if(m&&d(m.spriteMosaicItem)&&(p=m.spriteMosaicItem),p){const{rect:t,width:s,height:i}=p,o=t.x+a,l=t.y+a,n=o+s,f=l+i;let m=Math.round(e(this._height));m<=0&&(m=f-l);let _=Math.round(e(this._height/i*s||0));_<=0&&(_=n-o);const y=this._scaleX,d=1;this.tl=c(o,l),this.br=c(n,f),this.aux21=c(_,m),this.aux22=c(this._offsetX,this._offsetY),this.aux3=h(y*u,d*u,this._angle,0),r.sdf=p.sdf,r.pattern=!0,r.textureBinding=p.textureBinding}else this.tl=0,this.br=0,this.aux21=0,this.aux22=0,this.aux3=0,r.sdf=!1,r.pattern=!1,r.textureBinding=0;this._materialKey=r.data}}export{M as default};\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA,SAAOA,MAAM,IAAIC,CAAjB,QAAuB,iCAAvB;AAAyD,SAAOC,KAAK,IAAIC,CAAhB,QAAsB,uCAAtB;AAA8D,SAAOC,oBAAoB,IAAIC,CAA/B,QAAqC,gBAArC;AAAsD,SAAOC,yBAAyB,IAAIC,CAApC,EAAsCC,iCAAiC,IAAIC,CAA3E,EAA6EC,kCAAkC,IAAIC,CAAnH,EAAqHC,cAAc,IAAIC,CAAvI,EAAyIC,6BAA6B,IAAIC,CAA1K,QAAgL,sBAAhL;AAAuM,SAAOC,SAAS,IAAIC,CAApB,QAA0B,wBAA1B;AAAmD,SAAOC,SAAS,IAAIC,CAApB,EAAsBC,SAAS,IAAIC,CAAnC,QAAyC,iBAAzC;AAA2D,SAAOC,eAAe,IAAIC,CAA1B,QAAgC,kCAAhC;AAAmE,SAAOC,UAAU,IAAIC,CAArB,EAAuBC,aAAa,IAAIC,CAAxC,QAA8C,WAA9C;AAA0D,OAAOC,CAAP,MAAa,0BAAb;AAAwC,OAAOC,CAAP,MAAa,6BAAb;AAA2C,SAAOC,EAAE,IAAIC,CAAb,QAAmB,sBAAnB;AAA0C,MAAMC,CAAC,GAAC,GAAR;;AAAY,MAAMC,CAAN,SAAgBL,CAAC,CAACC,CAAD,CAAjB,CAAqB;EAACK,WAAW,CAACrB,CAAD,EAAGQ,CAAH,EAAKE,CAAL,EAAO;IAAC,IAAG,MAAMV,CAAN,GAAS,KAAKsB,WAAL,GAAiBhB,CAAC,CAACiB,IAAI,CAACC,KAAL,CAAWhB,CAAC,GAACN,CAAb,CAAD,EAAiBqB,IAAI,CAACC,KAAL,CAAWd,CAAC,GAACR,CAAb,CAAjB,CAA3B,EAA6DU,CAAC,CAACZ,CAAC,CAACyB,KAAH,CAAjE,EAA2E;MAAC,MAAMrC,CAAC,GAAC,CAACA,CAAD,EAAGE,CAAH,EAAKI,CAAL,KAAS;QAAC,MAAME,CAAC,GAACI,CAAC,CAACyB,KAAF,CAAQrC,CAAR,EAAUE,CAAV,EAAYI,CAAZ,CAAR;QAAuB,OAAOE,CAAC,IAAEJ,CAAC,CAACI,CAAD,CAAJ,IAAS,CAAhB;MAAkB,CAA3D;;MAA4D,KAAK8B,mBAAL,CAAyBC,GAAzB,CAA6B,WAA7B,EAAyCvC,CAAzC;IAA4C,CAApL,MAAwL;MAAC,MAAMA,CAAC,GAACY,CAAC,CAACyB,KAAV;MAAgB,KAAKG,SAAL,GAAexC,CAAC,IAAEI,CAAC,CAACJ,CAAD,CAAJ,IAAS,CAAxB;IAA0B;;IAAA,MAAM0B,CAAC,GAAC,sCAAoCd,CAAC,CAAC6B,GAAF,CAAMC,SAAN,EAAiBC,IAArD,IAA2D/B,CAAC,CAAC6B,GAAF,CAAMC,SAAN,CAAgBE,YAA3E,GAAwF,CAAxF,GAA0F,CAAlG;IAAA,MAAoGjB,CAAC,GAACf,CAAC,CAACiC,MAAxG;;IAA+G,IAAGrB,CAAC,CAACG,CAAD,CAAJ,EAAQ;MAAC,MAAM3B,CAAC,GAAC,CAACA,CAAD,EAAGE,CAAH,EAAKE,CAAL,KAASuB,CAAC,CAAC3B,CAAD,EAAGE,CAAH,EAAKE,CAAL,CAAD,GAASsB,CAA1B;;MAA4B,KAAKY,mBAAL,CAAyBC,GAAzB,CAA6B,SAA7B,EAAuCvC,CAAvC;IAA0C,CAA/E,MAAoF,KAAK8C,OAAL,GAAa,CAACnB,CAAC,IAAE,CAAJ,IAAOD,CAApB;;IAAsB,MAAME,CAAC,GAAChB,CAAC,CAACmC,OAAV;;IAAkB,IAAGvB,CAAC,CAACI,CAAD,CAAJ,EAAQ;MAAC,MAAM5B,CAAC,GAAC,CAACA,CAAD,EAAGI,CAAH,EAAKE,CAAL,KAASJ,CAAC,CAAC0B,CAAC,CAAC5B,CAAD,EAAGI,CAAH,EAAKE,CAAL,CAAF,CAAlB;;MAA6B,KAAKgC,mBAAL,CAAyBC,GAAzB,CAA6B,UAA7B,EAAwCvC,CAAxC;IAA2C,CAAjF,MAAsF,KAAKgD,QAAL,GAAc9C,CAAC,CAAC0B,CAAC,IAAE,CAAJ,CAAf;;IAAsB,MAAME,CAAC,GAAClB,CAAC,CAACqC,OAAV;;IAAkB,IAAGzB,CAAC,CAACM,CAAD,CAAJ,EAAQ;MAAC,MAAM9B,CAAC,GAAC,CAACA,CAAD,EAAGI,CAAH,EAAKE,CAAL,KAASJ,CAAC,CAAC,CAAC4B,CAAC,CAAC9B,CAAD,EAAGI,CAAH,EAAKE,CAAL,CAAH,CAAlB;;MAA8B,KAAKgC,mBAAL,CAAyBC,GAAzB,CAA6B,UAA7B,EAAwCvC,CAAxC;IAA2C,CAAlF,MAAuF,KAAKkD,QAAL,GAAchD,CAAC,CAAC,CAAC4B,CAAD,IAAI,CAAL,CAAf;;IAAuB,MAAMC,CAAC,GAACnB,CAAC,CAACuC,MAAV;IAAiB3B,CAAC,CAACO,CAAD,CAAD,GAAK,KAAKO,mBAAL,CAAyBC,GAAzB,CAA6B,SAA7B,EAAuCR,CAAvC,CAAL,GAA+C,KAAKqB,OAAL,GAAarB,CAAC,IAAE,CAA/D;IAAiE,MAAMC,CAAC,GAACpB,CAAC,CAACyC,KAAV;;IAAgB,IAAG7B,CAAC,CAACQ,CAAD,CAAJ,EAAQ;MAAC,MAAMhC,CAAC,GAAC,CAACA,CAAD,EAAGE,CAAH,EAAKE,CAAL,KAASY,CAAC,CAACgB,CAAC,CAAChC,CAAD,EAAGE,CAAH,EAAKE,CAAL,CAAF,CAAlB;;MAA6B,KAAKkC,mBAAL,CAAyBC,GAAzB,CAA6B,QAA7B,EAAsCvC,CAAtC;IAAyC,CAA/E,MAAoF,KAAKsD,MAAL,GAAYtC,CAAC,CAACgB,CAAD,CAAD,IAAM,CAAlB;;IAAoB,IAAGhC,CAAC,CAACY,CAAC,CAAC2C,OAAH,CAAJ,EAAgB;MAAC,MAAMvD,CAAC,GAACY,CAAC,CAAC2C,OAAV;MAAkB/B,CAAC,CAACxB,CAAD,CAAD,GAAK,KAAKsC,mBAAL,CAAyBC,GAAzB,CAA6B,UAA7B,EAAwCvC,CAAxC,CAAL,GAAgD,KAAKwD,QAAL,GAAcxD,CAA9D;IAAgE;;IAAA,KAAKyD,aAAL,GAAmB7C,CAAnB,EAAqB,KAAK8C,OAAL,GAAa,CAAC9C,CAAC,CAAC+C,WAAF,GAAcrD,CAAd,GAAgB,CAAjB,KAAqBM,CAAC,CAACgD,iBAAF,GAAoBpD,CAApB,GAAsB,CAA3C,KAA+CI,CAAC,CAACiD,eAAF,GAAkBnD,CAAlB,GAAoB,CAAnE,CAAlC,EAAwG,KAAKoD,gBAAL,GAAsBlD,CAAC,CAACmD,WAAhI;EAA4I;;EAAkB,OAAXC,WAAW,CAAChE,CAAD,EAAGE,CAAH,EAAK;IAAC,MAAK,CAACE,CAAD,EAAGE,CAAH,IAAMoB,CAAC,CAAC1B,CAAC,CAACiE,SAAH,EAAa/D,CAAb,CAAZ;IAA4B,OAAO,IAAI8B,CAAJ,CAAMhC,CAAN,EAAQI,CAAR,EAAUE,CAAV,CAAP;EAAoB;;EAAA4D,WAAW,CAAClE,CAAD,EAAGI,CAAH,EAAKE,CAAL,EAAO;IAAC,MAAME,CAAC,GAACR,CAAC,CAACmE,iBAAF,EAAR;;IAA8B,KAAK7B,mBAAL,CAAyB8B,OAAzB,CAAkC,CAACpE,CAAD,EAAGE,CAAH,KAAO;MAAC,KAAKA,CAAL,IAAQF,CAAC,CAACQ,CAAD,EAAGJ,CAAH,EAAKE,CAAL,CAAT;IAAiB,CAA3D;;IAA8D,MAAMI,CAAC,GAACY,CAAC,CAAC+C,IAAF,CAAO,KAAKP,gBAAZ,CAAR;IAAA,MAAsChD,CAAC,GAAC,KAAKwD,cAA7C;IAAA,MAA4DtD,CAAC,GAAC,CAAC,GAAE,KAAKyC,aAAL,CAAmBc,YAAtB,EAAoC/D,CAApC,EAAsCJ,CAAtC,EAAwCE,CAAxC,CAA9D;IAAA,MAAyGkB,CAAC,GAACV,CAAC,CAAC0D,GAAF,CAAMxD,CAAN,CAA3G;IAAoH,IAAIU,CAAC,GAAC,IAAN;;IAAW,IAAGF,CAAC,IAAEM,CAAC,CAACN,CAAC,CAACiD,gBAAH,CAAJ,KAA2B/C,CAAC,GAACF,CAAC,CAACiD,gBAA/B,GAAiD/C,CAApD,EAAsD;MAAC,MAAK;QAACgD,IAAI,EAAC1E,CAAN;QAAQ2E,KAAK,EAACvE,CAAd;QAAgByC,MAAM,EAACvC;MAAvB,IAA0BoB,CAA/B;MAAA,MAAiClB,CAAC,GAACR,CAAC,CAAC4E,CAAF,GAAIhE,CAAvC;MAAA,MAAyCE,CAAC,GAACd,CAAC,CAAC4B,CAAF,GAAIhB,CAA/C;MAAA,MAAiDI,CAAC,GAACR,CAAC,GAACJ,CAArD;MAAA,MAAuDkB,CAAC,GAACR,CAAC,GAACR,CAA3D;MAA6D,IAAIkB,CAAC,GAACW,IAAI,CAACC,KAAL,CAAWlC,CAAC,CAAC,KAAK4C,OAAN,CAAZ,CAAN;MAAkCtB,CAAC,IAAE,CAAH,KAAOA,CAAC,GAACF,CAAC,GAACR,CAAX;;MAAc,IAAIa,CAAC,GAACQ,IAAI,CAACC,KAAL,CAAWlC,CAAC,CAAC,KAAK4C,OAAL,GAAaxC,CAAb,GAAeF,CAAf,IAAkB,CAAnB,CAAZ,CAAN;;MAAyCuB,CAAC,IAAE,CAAH,KAAOA,CAAC,GAACX,CAAC,GAACR,CAAX;MAAc,MAAMoB,CAAC,GAAC,KAAKwB,OAAb;MAAA,MAAqBtB,CAAC,GAAC,CAAvB;MAAyB,KAAK+C,EAAL,GAAQ3D,CAAC,CAACV,CAAD,EAAGM,CAAH,CAAT,EAAe,KAAKgE,EAAL,GAAQ5D,CAAC,CAACF,CAAD,EAAGM,CAAH,CAAxB,EAA8B,KAAKyD,KAAL,GAAW7D,CAAC,CAACS,CAAD,EAAGH,CAAH,CAA1C,EAAgD,KAAKwD,KAAL,GAAW9D,CAAC,CAAC,KAAK8B,QAAN,EAAe,KAAKE,QAApB,CAA5D,EAA0F,KAAK+B,IAAL,GAAU7D,CAAC,CAACQ,CAAC,GAACG,CAAH,EAAKD,CAAC,GAACC,CAAP,EAAS,KAAKuB,MAAd,EAAqB,CAArB,CAArG,EAA6H5C,CAAC,CAACwE,GAAF,GAAMxD,CAAC,CAACwD,GAArI,EAAyIxE,CAAC,CAACyE,OAAF,GAAU,CAAC,CAApJ,EAAsJzE,CAAC,CAAC0E,cAAF,GAAiB1D,CAAC,CAAC0D,cAAzK;IAAwL,CAA5a,MAAib,KAAKP,EAAL,GAAQ,CAAR,EAAU,KAAKC,EAAL,GAAQ,CAAlB,EAAoB,KAAKC,KAAL,GAAW,CAA/B,EAAiC,KAAKC,KAAL,GAAW,CAA5C,EAA8C,KAAKC,IAAL,GAAU,CAAxD,EAA0DvE,CAAC,CAACwE,GAAF,GAAM,CAAC,CAAjE,EAAmExE,CAAC,CAACyE,OAAF,GAAU,CAAC,CAA9E,EAAgFzE,CAAC,CAAC0E,cAAF,GAAiB,CAAjG;;IAAmG,KAAKC,YAAL,GAAkB3E,CAAC,CAAC4E,IAApB;EAAyB;;AAA1+D;;AAA2+D,SAAOtD,CAAC,IAAIuD,OAAZ"},"metadata":{},"sourceType":"module"}