{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport e from \"../../../../../core/CircularArray.js\";\nimport has from \"../../../../../core/has.js\";\nimport { isSome as s, isNone as t, unwrap as r } from \"../../../../../core/maybe.js\";\nimport { FeatureSetReaderJSON as i } from \"../support/FeatureSetReaderJSON.js\";\nimport { UpdateToken as d } from \"../support/UpdateToken.js\";\n\nclass a {\n  constructor(s, t) {\n    this.requests = {\n      done: new Array(),\n      stream: new e(10)\n    }, this._edits = null, this._abortController = new AbortController(), this._version = 0, this._done = !1, this.didSend = !1, this.tile = s, this._version = t;\n  }\n\n  get signal() {\n    return this._abortController.signal;\n  }\n\n  get options() {\n    return {\n      signal: this._abortController.signal\n    };\n  }\n\n  get empty() {\n    return !this.requests.done.length;\n  }\n\n  get edits() {\n    return this._edits;\n  }\n\n  get done() {\n    return this._done;\n  }\n\n  end() {\n    this._done = !0;\n  }\n\n  clear() {\n    this.requests.done = [];\n  }\n\n  applyUpdate(e) {\n    this.requests.done.forEach(s => s.message.status.unset(e)), this._version = e.version, s(this._edits) && this._edits.status.unset(e);\n  }\n\n  add(e) {\n    e.message.status = e.message.status ?? d.empty(), e.message.status.version = this._version, has(\"esri-2d-update-debug\") && console.debug(this.tile.id, \"DataTileSubscription:add\", this._version), e.message.end && this.requests.done.forEach(e => {\n      s(e.message) && e.message.end && (e.message.end = !1);\n    }), this.requests.done.push(e);\n  }\n\n  edit(e, s) {\n    const a = e.getQuantizationTransform(),\n          o = e.fullSchema(),\n          n = Array.from(e.features()),\n          h = [...s, ...n.map(e => e.objectId)];\n    if (this.removeIds(h), this._invalidate(), t(this._edits)) return void (this._edits = {\n      type: \"append\",\n      addOrUpdate: i.fromOptimizedFeatures(n, o, r(a)),\n      id: this.tile.id,\n      status: d.empty(),\n      end: !0\n    });\n    this.requests.done.forEach(e => e.message.end = !1);\n    r(this._edits.addOrUpdate).append(e.features());\n  }\n\n  *readers() {\n    for (const {\n      message: e\n    } of this.requests.done) s(e.addOrUpdate) && (yield e.addOrUpdate);\n\n    s(this._edits) && s(this._edits.addOrUpdate) && (yield this._edits.addOrUpdate);\n  }\n\n  _invalidate() {\n    for (const e of this.requests.done) e.message.status = d.empty();\n\n    s(this._edits) && (this._edits.status = d.empty());\n  }\n\n  removeIds(e) {\n    this._invalidate();\n\n    for (const {\n      message: t\n    } of this.requests.done) {\n      const r = t.addOrUpdate;\n      s(r) && (r.removeIds(e), r.isEmpty && (t.addOrUpdate = null));\n    }\n\n    s(this._edits) && s(this._edits.addOrUpdate) && this._edits.addOrUpdate.removeIds(e), this.requests.done = this.requests.done.filter(e => e.message.addOrUpdate || e.message.end);\n  }\n\n  abort() {\n    this._abortController.abort();\n  }\n\n}\n\nexport { a as DataTileSubscription };","map":{"version":3,"names":["e","has","isSome","s","isNone","t","unwrap","r","FeatureSetReaderJSON","i","UpdateToken","d","a","constructor","requests","done","Array","stream","_edits","_abortController","AbortController","_version","_done","didSend","tile","signal","options","empty","length","edits","end","clear","applyUpdate","forEach","message","status","unset","version","add","console","debug","id","push","edit","getQuantizationTransform","o","fullSchema","n","from","features","h","map","objectId","removeIds","_invalidate","type","addOrUpdate","fromOptimizedFeatures","append","readers","isEmpty","filter","abort","DataTileSubscription"],"sources":["E:/各个学科/论文/毕业论文/Atmosphere/eco-friendly/node_modules/@arcgis/core/views/2d/layers/features/sources/DataTileSubscription.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport e from\"../../../../../core/CircularArray.js\";import has from\"../../../../../core/has.js\";import{isSome as s,isNone as t,unwrap as r}from\"../../../../../core/maybe.js\";import{FeatureSetReaderJSON as i}from\"../support/FeatureSetReaderJSON.js\";import{UpdateToken as d}from\"../support/UpdateToken.js\";class a{constructor(s,t){this.requests={done:new Array,stream:new e(10)},this._edits=null,this._abortController=new AbortController,this._version=0,this._done=!1,this.didSend=!1,this.tile=s,this._version=t}get signal(){return this._abortController.signal}get options(){return{signal:this._abortController.signal}}get empty(){return!this.requests.done.length}get edits(){return this._edits}get done(){return this._done}end(){this._done=!0}clear(){this.requests.done=[]}applyUpdate(e){this.requests.done.forEach((s=>s.message.status.unset(e))),this._version=e.version,s(this._edits)&&this._edits.status.unset(e)}add(e){e.message.status=e.message.status??d.empty(),e.message.status.version=this._version,has(\"esri-2d-update-debug\")&&console.debug(this.tile.id,\"DataTileSubscription:add\",this._version),e.message.end&&this.requests.done.forEach((e=>{s(e.message)&&e.message.end&&(e.message.end=!1)})),this.requests.done.push(e)}edit(e,s){const a=e.getQuantizationTransform(),o=e.fullSchema(),n=Array.from(e.features()),h=[...s,...n.map((e=>e.objectId))];if(this.removeIds(h),this._invalidate(),t(this._edits))return void(this._edits={type:\"append\",addOrUpdate:i.fromOptimizedFeatures(n,o,r(a)),id:this.tile.id,status:d.empty(),end:!0});this.requests.done.forEach((e=>e.message.end=!1));r(this._edits.addOrUpdate).append(e.features())}*readers(){for(const{message:e}of this.requests.done)s(e.addOrUpdate)&&(yield e.addOrUpdate);s(this._edits)&&s(this._edits.addOrUpdate)&&(yield this._edits.addOrUpdate)}_invalidate(){for(const e of this.requests.done)e.message.status=d.empty();s(this._edits)&&(this._edits.status=d.empty())}removeIds(e){this._invalidate();for(const{message:t}of this.requests.done){const r=t.addOrUpdate;s(r)&&(r.removeIds(e),r.isEmpty&&(t.addOrUpdate=null))}s(this._edits)&&s(this._edits.addOrUpdate)&&this._edits.addOrUpdate.removeIds(e),this.requests.done=this.requests.done.filter((e=>e.message.addOrUpdate||e.message.end))}abort(){this._abortController.abort()}}export{a as DataTileSubscription};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}