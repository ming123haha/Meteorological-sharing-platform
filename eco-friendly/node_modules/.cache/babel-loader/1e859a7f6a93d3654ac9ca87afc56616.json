{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport { _ as t } from \"../../../chunks/tslib.es6.js\";\nimport s from \"../../../Basemap.js\";\nimport e from \"../../../core/Collection.js\";\nimport r from \"../../../core/Error.js\";\nimport o from \"../../../core/Handles.js\";\nimport a from \"../../../core/Loadable.js\";\nimport l from \"../../../core/Logger.js\";\nimport { EsriPromiseMixin as i } from \"../../../core/Promise.js\";\nimport { isAbortError as p } from \"../../../core/promiseUtils.js\";\nimport { watch as n, initial as h } from \"../../../core/reactiveUtils.js\";\nimport { property as m } from \"../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../core/arrayUtils.js\";\nimport \"../../../core/accessorSupport/ensureType.js\";\nimport { subclass as c } from \"../../../core/accessorSupport/decorators/subclass.js\";\nimport u from \"../../../portal/Portal.js\";\nimport d from \"./LocalBasemapsSource.js\";\nconst f = e.ofType(s);\nlet y = class extends a.LoadableMixin(i(d)) {\n  constructor(t) {\n    super(t), this._handles = new o(), this.basemaps = new f(), this.filterFunction = null, this.portal = u.getDefault(), this.query = null, this.updateBasemapsCallback = null;\n  }\n\n  initialize() {\n    this._handles.add([n(() => [this.filterFunction, this.loadStatus, this.portal?.basemapGalleryGroupQuery, this.portal?.user, this.query, this.updateBasemapsCallback], () => this.refresh(), h)]);\n  }\n\n  destroy() {\n    this._handles.destroy(), this._handles = null, this.filterFunction = null, this.portal = null;\n  }\n\n  get state() {\n    return \"not-loaded\" === this.loadStatus ? \"not-loaded\" : \"loading\" === this.loadStatus || this._lastPortalBasemapFetchController ? \"loading\" : \"ready\";\n  }\n\n  load(t) {\n    return this.addResolvingPromise(this.portal.load(t)), this.notifyChange(\"state\"), Promise.resolve(this);\n  }\n\n  async refresh() {\n    if (\"ready\" !== this.state) return;\n    this._lastPortalBasemapFetchController && (this._lastPortalBasemapFetchController.abort(), this._lastPortalBasemapFetchController = null);\n    const t = this.portal,\n          s = new AbortController();\n    this._lastPortalBasemapFetchController = s, this.notifyChange(\"state\");\n\n    try {\n      const e = await t.fetchBasemaps(this._toQueryString(this.query), s);\n\n      this._updateBasemaps(e);\n    } catch (e) {\n      if (p(e)) throw e;\n      l.getLogger(this.declaredClass).warn(new r(\"basemap-source:fetch-basemaps-error\", \"Could not fetch basemaps from portal.\", {\n        error: e\n      })), this._updateBasemaps();\n    }\n\n    this._lastPortalBasemapFetchController = null, this.notifyChange(\"state\");\n  }\n\n  _toQueryString(t) {\n    return t && \"string\" != typeof t ? Object.keys(t).map(s => `${s}:${t[s]}`).join(\" AND \") : t;\n  }\n\n  _updateBasemaps(t = []) {\n    let s = this.filterFunction ? t.filter(this.filterFunction) : t;\n    s = this.updateBasemapsCallback ? this.updateBasemapsCallback(s) : s, this.basemaps.removeAll(), this.basemaps.addMany(s);\n  }\n\n};\nt([m({\n  readOnly: !0,\n  type: f\n})], y.prototype, \"basemaps\", void 0), t([m()], y.prototype, \"filterFunction\", void 0), t([m({\n  type: u\n})], y.prototype, \"portal\", void 0), t([m()], y.prototype, \"query\", void 0), t([m({\n  readOnly: !0\n})], y.prototype, \"state\", null), t([m()], y.prototype, \"updateBasemapsCallback\", void 0), y = t([c(\"esri.widgets.BasemapGallery.support.PortalBasemapsSource\")], y);\nconst b = y;\nexport { b as default };","map":{"version":3,"names":["_","t","s","e","r","o","a","l","EsriPromiseMixin","i","isAbortError","p","watch","n","initial","h","property","m","subclass","c","u","d","f","ofType","y","LoadableMixin","constructor","_handles","basemaps","filterFunction","portal","getDefault","query","updateBasemapsCallback","initialize","add","loadStatus","basemapGalleryGroupQuery","user","refresh","destroy","state","_lastPortalBasemapFetchController","load","addResolvingPromise","notifyChange","Promise","resolve","abort","AbortController","fetchBasemaps","_toQueryString","_updateBasemaps","getLogger","declaredClass","warn","error","Object","keys","map","join","filter","removeAll","addMany","readOnly","type","prototype","b","default"],"sources":["E:/各个学科/论文/毕业论文/Atmosphere/eco-friendly/node_modules/@arcgis/core/widgets/BasemapGallery/support/PortalBasemapsSource.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../../chunks/tslib.es6.js\";import s from\"../../../Basemap.js\";import e from\"../../../core/Collection.js\";import r from\"../../../core/Error.js\";import o from\"../../../core/Handles.js\";import a from\"../../../core/Loadable.js\";import l from\"../../../core/Logger.js\";import{EsriPromiseMixin as i}from\"../../../core/Promise.js\";import{isAbortError as p}from\"../../../core/promiseUtils.js\";import{watch as n,initial as h}from\"../../../core/reactiveUtils.js\";import{property as m}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/arrayUtils.js\";import\"../../../core/accessorSupport/ensureType.js\";import{subclass as c}from\"../../../core/accessorSupport/decorators/subclass.js\";import u from\"../../../portal/Portal.js\";import d from\"./LocalBasemapsSource.js\";const f=e.ofType(s);let y=class extends(a.LoadableMixin(i(d))){constructor(t){super(t),this._handles=new o,this.basemaps=new f,this.filterFunction=null,this.portal=u.getDefault(),this.query=null,this.updateBasemapsCallback=null}initialize(){this._handles.add([n((()=>[this.filterFunction,this.loadStatus,this.portal?.basemapGalleryGroupQuery,this.portal?.user,this.query,this.updateBasemapsCallback]),(()=>this.refresh()),h)])}destroy(){this._handles.destroy(),this._handles=null,this.filterFunction=null,this.portal=null}get state(){return\"not-loaded\"===this.loadStatus?\"not-loaded\":\"loading\"===this.loadStatus||this._lastPortalBasemapFetchController?\"loading\":\"ready\"}load(t){return this.addResolvingPromise(this.portal.load(t)),this.notifyChange(\"state\"),Promise.resolve(this)}async refresh(){if(\"ready\"!==this.state)return;this._lastPortalBasemapFetchController&&(this._lastPortalBasemapFetchController.abort(),this._lastPortalBasemapFetchController=null);const t=this.portal,s=new AbortController;this._lastPortalBasemapFetchController=s,this.notifyChange(\"state\");try{const e=await t.fetchBasemaps(this._toQueryString(this.query),s);this._updateBasemaps(e)}catch(e){if(p(e))throw e;l.getLogger(this.declaredClass).warn(new r(\"basemap-source:fetch-basemaps-error\",\"Could not fetch basemaps from portal.\",{error:e})),this._updateBasemaps()}this._lastPortalBasemapFetchController=null,this.notifyChange(\"state\")}_toQueryString(t){return t&&\"string\"!=typeof t?Object.keys(t).map((s=>`${s}:${t[s]}`)).join(\" AND \"):t}_updateBasemaps(t=[]){let s=this.filterFunction?t.filter(this.filterFunction):t;s=this.updateBasemapsCallback?this.updateBasemapsCallback(s):s,this.basemaps.removeAll(),this.basemaps.addMany(s)}};t([m({readOnly:!0,type:f})],y.prototype,\"basemaps\",void 0),t([m()],y.prototype,\"filterFunction\",void 0),t([m({type:u})],y.prototype,\"portal\",void 0),t([m()],y.prototype,\"query\",void 0),t([m({readOnly:!0})],y.prototype,\"state\",null),t([m()],y.prototype,\"updateBasemapsCallback\",void 0),y=t([c(\"esri.widgets.BasemapGallery.support.PortalBasemapsSource\")],y);const b=y;export{b as default};\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA,SAAOA,CAAC,IAAIC,CAAZ,QAAkB,8BAAlB;AAAiD,OAAOC,CAAP,MAAa,qBAAb;AAAmC,OAAOC,CAAP,MAAa,6BAAb;AAA2C,OAAOC,CAAP,MAAa,wBAAb;AAAsC,OAAOC,CAAP,MAAa,0BAAb;AAAwC,OAAOC,CAAP,MAAa,2BAAb;AAAyC,OAAOC,CAAP,MAAa,yBAAb;AAAuC,SAAOC,gBAAgB,IAAIC,CAA3B,QAAiC,0BAAjC;AAA4D,SAAOC,YAAY,IAAIC,CAAvB,QAA6B,+BAA7B;AAA6D,SAAOC,KAAK,IAAIC,CAAhB,EAAkBC,OAAO,IAAIC,CAA7B,QAAmC,gCAAnC;AAAoE,SAAOC,QAAQ,IAAIC,CAAnB,QAAyB,sDAAzB;AAAgF,OAAM,6BAAN;AAAoC,OAAM,6CAAN;AAAoD,SAAOC,QAAQ,IAAIC,CAAnB,QAAyB,sDAAzB;AAAgF,OAAOC,CAAP,MAAa,2BAAb;AAAyC,OAAOC,CAAP,MAAa,0BAAb;AAAwC,MAAMC,CAAC,GAACnB,CAAC,CAACoB,MAAF,CAASrB,CAAT,CAAR;AAAoB,IAAIsB,CAAC,GAAC,cAAclB,CAAC,CAACmB,aAAF,CAAgBhB,CAAC,CAACY,CAAD,CAAjB,CAAd,CAAoC;EAACK,WAAW,CAACzB,CAAD,EAAG;IAAC,MAAMA,CAAN,GAAS,KAAK0B,QAAL,GAAc,IAAItB,CAAJ,EAAvB,EAA6B,KAAKuB,QAAL,GAAc,IAAIN,CAAJ,EAA3C,EAAiD,KAAKO,cAAL,GAAoB,IAArE,EAA0E,KAAKC,MAAL,GAAYV,CAAC,CAACW,UAAF,EAAtF,EAAqG,KAAKC,KAAL,GAAW,IAAhH,EAAqH,KAAKC,sBAAL,GAA4B,IAAjJ;EAAsJ;;EAAAC,UAAU,GAAE;IAAC,KAAKP,QAAL,CAAcQ,GAAd,CAAkB,CAACtB,CAAC,CAAE,MAAI,CAAC,KAAKgB,cAAN,EAAqB,KAAKO,UAA1B,EAAqC,KAAKN,MAAL,EAAaO,wBAAlD,EAA2E,KAAKP,MAAL,EAAaQ,IAAxF,EAA6F,KAAKN,KAAlG,EAAwG,KAAKC,sBAA7G,CAAN,EAA6I,MAAI,KAAKM,OAAL,EAAjJ,EAAiKxB,CAAjK,CAAF,CAAlB;EAA0L;;EAAAyB,OAAO,GAAE;IAAC,KAAKb,QAAL,CAAca,OAAd,IAAwB,KAAKb,QAAL,GAAc,IAAtC,EAA2C,KAAKE,cAAL,GAAoB,IAA/D,EAAoE,KAAKC,MAAL,GAAY,IAAhF;EAAqF;;EAAS,IAALW,KAAK,GAAE;IAAC,OAAM,iBAAe,KAAKL,UAApB,GAA+B,YAA/B,GAA4C,cAAY,KAAKA,UAAjB,IAA6B,KAAKM,iCAAlC,GAAoE,SAApE,GAA8E,OAAhI;EAAwI;;EAAAC,IAAI,CAAC1C,CAAD,EAAG;IAAC,OAAO,KAAK2C,mBAAL,CAAyB,KAAKd,MAAL,CAAYa,IAAZ,CAAiB1C,CAAjB,CAAzB,GAA8C,KAAK4C,YAAL,CAAkB,OAAlB,CAA9C,EAAyEC,OAAO,CAACC,OAAR,CAAgB,IAAhB,CAAhF;EAAsG;;EAAa,MAAPR,OAAO,GAAE;IAAC,IAAG,YAAU,KAAKE,KAAlB,EAAwB;IAAO,KAAKC,iCAAL,KAAyC,KAAKA,iCAAL,CAAuCM,KAAvC,IAA+C,KAAKN,iCAAL,GAAuC,IAA/H;IAAqI,MAAMzC,CAAC,GAAC,KAAK6B,MAAb;IAAA,MAAoB5B,CAAC,GAAC,IAAI+C,eAAJ,EAAtB;IAA0C,KAAKP,iCAAL,GAAuCxC,CAAvC,EAAyC,KAAK2C,YAAL,CAAkB,OAAlB,CAAzC;;IAAoE,IAAG;MAAC,MAAM1C,CAAC,GAAC,MAAMF,CAAC,CAACiD,aAAF,CAAgB,KAAKC,cAAL,CAAoB,KAAKnB,KAAzB,CAAhB,EAAgD9B,CAAhD,CAAd;;MAAiE,KAAKkD,eAAL,CAAqBjD,CAArB;IAAwB,CAA7F,CAA6F,OAAMA,CAAN,EAAQ;MAAC,IAAGQ,CAAC,CAACR,CAAD,CAAJ,EAAQ,MAAMA,CAAN;MAAQI,CAAC,CAAC8C,SAAF,CAAY,KAAKC,aAAjB,EAAgCC,IAAhC,CAAqC,IAAInD,CAAJ,CAAM,qCAAN,EAA4C,uCAA5C,EAAoF;QAACoD,KAAK,EAACrD;MAAP,CAApF,CAArC,GAAqI,KAAKiD,eAAL,EAArI;IAA4J;;IAAA,KAAKV,iCAAL,GAAuC,IAAvC,EAA4C,KAAKG,YAAL,CAAkB,OAAlB,CAA5C;EAAuE;;EAAAM,cAAc,CAAClD,CAAD,EAAG;IAAC,OAAOA,CAAC,IAAE,YAAU,OAAOA,CAApB,GAAsBwD,MAAM,CAACC,IAAP,CAAYzD,CAAZ,EAAe0D,GAAf,CAAoBzD,CAAC,IAAG,GAAEA,CAAE,IAAGD,CAAC,CAACC,CAAD,CAAI,EAApC,EAAwC0D,IAAxC,CAA6C,OAA7C,CAAtB,GAA4E3D,CAAnF;EAAqF;;EAAAmD,eAAe,CAACnD,CAAC,GAAC,EAAH,EAAM;IAAC,IAAIC,CAAC,GAAC,KAAK2B,cAAL,GAAoB5B,CAAC,CAAC4D,MAAF,CAAS,KAAKhC,cAAd,CAApB,GAAkD5B,CAAxD;IAA0DC,CAAC,GAAC,KAAK+B,sBAAL,GAA4B,KAAKA,sBAAL,CAA4B/B,CAA5B,CAA5B,GAA2DA,CAA7D,EAA+D,KAAK0B,QAAL,CAAckC,SAAd,EAA/D,EAAyF,KAAKlC,QAAL,CAAcmC,OAAd,CAAsB7D,CAAtB,CAAzF;EAAkH;;AAAlnD,CAA1C;AAA8pDD,CAAC,CAAC,CAACgB,CAAC,CAAC;EAAC+C,QAAQ,EAAC,CAAC,CAAX;EAAaC,IAAI,EAAC3C;AAAlB,CAAD,CAAF,CAAD,EAA2BE,CAAC,CAAC0C,SAA7B,EAAuC,UAAvC,EAAkD,KAAK,CAAvD,CAAD,EAA2DjE,CAAC,CAAC,CAACgB,CAAC,EAAF,CAAD,EAAOO,CAAC,CAAC0C,SAAT,EAAmB,gBAAnB,EAAoC,KAAK,CAAzC,CAA5D,EAAwGjE,CAAC,CAAC,CAACgB,CAAC,CAAC;EAACgD,IAAI,EAAC7C;AAAN,CAAD,CAAF,CAAD,EAAeI,CAAC,CAAC0C,SAAjB,EAA2B,QAA3B,EAAoC,KAAK,CAAzC,CAAzG,EAAqJjE,CAAC,CAAC,CAACgB,CAAC,EAAF,CAAD,EAAOO,CAAC,CAAC0C,SAAT,EAAmB,OAAnB,EAA2B,KAAK,CAAhC,CAAtJ,EAAyLjE,CAAC,CAAC,CAACgB,CAAC,CAAC;EAAC+C,QAAQ,EAAC,CAAC;AAAX,CAAD,CAAF,CAAD,EAAoBxC,CAAC,CAAC0C,SAAtB,EAAgC,OAAhC,EAAwC,IAAxC,CAA1L,EAAwOjE,CAAC,CAAC,CAACgB,CAAC,EAAF,CAAD,EAAOO,CAAC,CAAC0C,SAAT,EAAmB,wBAAnB,EAA4C,KAAK,CAAjD,CAAzO,EAA6R1C,CAAC,GAACvB,CAAC,CAAC,CAACkB,CAAC,CAAC,0DAAD,CAAF,CAAD,EAAiEK,CAAjE,CAAhS;AAAoW,MAAM2C,CAAC,GAAC3C,CAAR;AAAU,SAAO2C,CAAC,IAAIC,OAAZ"},"metadata":{},"sourceType":"module"}