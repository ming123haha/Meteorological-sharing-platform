{"ast":null,"code":"import \"core-js/modules/es.array.includes.js\";\n\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../../../chunks/tslib.es6.js\";\nimport has from \"../../../../../core/has.js\";\nimport { isAbortError as t } from \"../../../../../core/promiseUtils.js\";\nimport \"../../../../../core/Logger.js\";\nimport \"../../../../../core/accessorSupport/ensureType.js\";\nimport \"../../../../../core/arrayUtils.js\";\nimport \"../../../../../core/Error.js\";\nimport { subclass as i } from \"../../../../../core/accessorSupport/decorators/subclass.js\";\nimport { create as s } from \"../../../../../geometry/support/aaBoundingRect.js\";\nimport { FeatureTile as r } from \"../../../engine/webgl/FeatureTile.js\";\nimport { simplifyVVRenderer as a } from \"../support/rendererUtils.js\";\nimport o from \"./BaseTileRenderer.js\";\nimport { convertVisualVariables as l } from \"./support/visualVariablesUtils.js\";\nimport { WGLFeatureView as n } from \"./support/WGLFeatureView.js\";\nlet u = class extends o {\n  constructor() {\n    super(...arguments), this.type = \"symbol\";\n  }\n\n  install(e) {\n    const t = () => this.notifyChange(\"updating\"),\n          i = new n(this.tileInfoView, this.layerView, this.layer, t);\n\n    this.featuresView = i, e.addChild(i);\n  }\n\n  uninstall(e) {\n    e.removeChild(this.featuresView), this.featuresView.destroy(), this.featuresView = null;\n  }\n\n  fetchResource(e, i) {\n    const {\n      url: s\n    } = e,\n          r = this.featuresView.stage;\n\n    try {\n      return r.resourceManager.fetchResource(s, {\n        signal: i.signal\n      });\n    } catch (a) {\n      return t(a) ? Promise.resolve({\n        width: 0,\n        height: 0\n      }) : Promise.reject(a);\n    }\n  }\n\n  isUpdating() {\n    const e = super.isUpdating(),\n          t = !this.featuresView || this.featuresView.isUpdating(),\n          i = this.featuresView?.hasEmptyAttributeView(),\n          s = e || t || e && i;\n    return has(\"esri-2d-log-updating\") && console.log(`Updating SymbolTileRenderer ${s}\\n  -> updatingTiles ${e}\\n  -> hasFeaturesView ${!!this.featuresView}\\n  -> updatingFeaturesView ${t}`), s;\n  }\n\n  hitTest(e) {\n    return this.featuresView.hitTest(e);\n  }\n\n  supportsRenderer(e) {\n    return null != e && [\"simple\", \"class-breaks\", \"unique-value\", \"dot-density\", \"dictionary\", \"heatmap\", \"pie-chart\"].includes(e.type);\n  }\n\n  onConfigUpdate(e) {\n    let t = null;\n\n    if (e && \"visualVariables\" in e) {\n      const i = (a(e).visualVariables || []).map(e => {\n        const t = e.clone();\n        return \"normalizationField\" in e && (t.normalizationField = null), e.valueExpression && \"$view.scale\" !== e.valueExpression && (t.valueExpression = null, t.field = \"nop\"), t;\n      });\n      t = l(i);\n    }\n\n    this.featuresView.setRendererInfo(e, t, this.layerView.featureEffect);\n  }\n\n  onTileData(e) {\n    const t = this.tiles.get(e.tileKey);\n    t && e.data && this.featuresView.onTileData(t, e.data), this.layerView.view.labelManager.requestUpdate();\n  }\n\n  onTileError(e) {\n    const t = this.tiles.get(e.tileKey);\n    t && this.featuresView.onTileError(t);\n  }\n\n  forceAttributeTextureUpload() {\n    this.featuresView.attributeView.forceTextureUpload();\n  }\n\n  lockGPUUploads() {\n    this.featuresView.attributeView.lockTextureUpload(), this.tiles.forEach(e => e.lock());\n  }\n\n  unlockGPUUploads() {\n    this.featuresView.attributeView.unlockTextureUpload(), this.tiles.forEach(e => e.unlock());\n  }\n\n  async getMaterialItems(e) {\n    return this.featuresView.getMaterialItems(e);\n  }\n\n  invalidateLabels() {\n    this.featuresView.hasLabels && this.layerView.view.labelManager.requestUpdate();\n  }\n\n  createTile(e) {\n    const t = this.tileInfoView.getTileBounds(s(), e),\n          i = () => this.layerView.view.labelManager.requestUpdate(),\n          a = this.tileInfoView.getTileResolution(e.level),\n          o = this.featuresView.attributeView;\n\n    return new r(e, a, t[0], t[3], o, i);\n  }\n\n  disposeTile(e) {\n    this.featuresView.removeChild(e), e.destroy(), this.layerView.view.labelManager.requestUpdate();\n  }\n\n};\nu = e([i(\"esri.views.2d.layers.features.tileRenderers.SymbolTileRenderer\")], u);\nconst p = u;\nexport { p as default };","map":{"version":3,"names":["_","e","has","isAbortError","t","subclass","i","create","s","FeatureTile","r","simplifyVVRenderer","a","o","convertVisualVariables","l","WGLFeatureView","n","u","constructor","arguments","type","install","notifyChange","tileInfoView","layerView","layer","featuresView","addChild","uninstall","removeChild","destroy","fetchResource","url","stage","resourceManager","signal","Promise","resolve","width","height","reject","isUpdating","hasEmptyAttributeView","console","log","hitTest","supportsRenderer","includes","onConfigUpdate","visualVariables","map","clone","normalizationField","valueExpression","field","setRendererInfo","featureEffect","onTileData","tiles","get","tileKey","data","view","labelManager","requestUpdate","onTileError","forceAttributeTextureUpload","attributeView","forceTextureUpload","lockGPUUploads","lockTextureUpload","forEach","lock","unlockGPUUploads","unlockTextureUpload","unlock","getMaterialItems","invalidateLabels","hasLabels","createTile","getTileBounds","getTileResolution","level","disposeTile","p","default"],"sources":["E:/各个学科/论文/毕业论文/Atmosphere/eco-friendly/node_modules/@arcgis/core/views/2d/layers/features/tileRenderers/SymbolTileRenderer.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../../chunks/tslib.es6.js\";import has from\"../../../../../core/has.js\";import{isAbortError as t}from\"../../../../../core/promiseUtils.js\";import\"../../../../../core/Logger.js\";import\"../../../../../core/accessorSupport/ensureType.js\";import\"../../../../../core/arrayUtils.js\";import\"../../../../../core/Error.js\";import{subclass as i}from\"../../../../../core/accessorSupport/decorators/subclass.js\";import{create as s}from\"../../../../../geometry/support/aaBoundingRect.js\";import{FeatureTile as r}from\"../../../engine/webgl/FeatureTile.js\";import{simplifyVVRenderer as a}from\"../support/rendererUtils.js\";import o from\"./BaseTileRenderer.js\";import{convertVisualVariables as l}from\"./support/visualVariablesUtils.js\";import{WGLFeatureView as n}from\"./support/WGLFeatureView.js\";let u=class extends o{constructor(){super(...arguments),this.type=\"symbol\"}install(e){const t=()=>this.notifyChange(\"updating\"),i=new n(this.tileInfoView,this.layerView,this.layer,t);this.featuresView=i,e.addChild(i)}uninstall(e){e.removeChild(this.featuresView),this.featuresView.destroy(),this.featuresView=null}fetchResource(e,i){const{url:s}=e,r=this.featuresView.stage;try{return r.resourceManager.fetchResource(s,{signal:i.signal})}catch(a){return t(a)?Promise.resolve({width:0,height:0}):Promise.reject(a)}}isUpdating(){const e=super.isUpdating(),t=!this.featuresView||this.featuresView.isUpdating(),i=this.featuresView?.hasEmptyAttributeView(),s=e||t||e&&i;return has(\"esri-2d-log-updating\")&&console.log(`Updating SymbolTileRenderer ${s}\\n  -> updatingTiles ${e}\\n  -> hasFeaturesView ${!!this.featuresView}\\n  -> updatingFeaturesView ${t}`),s}hitTest(e){return this.featuresView.hitTest(e)}supportsRenderer(e){return null!=e&&[\"simple\",\"class-breaks\",\"unique-value\",\"dot-density\",\"dictionary\",\"heatmap\",\"pie-chart\"].includes(e.type)}onConfigUpdate(e){let t=null;if(e&&\"visualVariables\"in e){const i=(a(e).visualVariables||[]).map((e=>{const t=e.clone();return\"normalizationField\"in e&&(t.normalizationField=null),e.valueExpression&&\"$view.scale\"!==e.valueExpression&&(t.valueExpression=null,t.field=\"nop\"),t}));t=l(i)}this.featuresView.setRendererInfo(e,t,this.layerView.featureEffect)}onTileData(e){const t=this.tiles.get(e.tileKey);t&&e.data&&this.featuresView.onTileData(t,e.data),this.layerView.view.labelManager.requestUpdate()}onTileError(e){const t=this.tiles.get(e.tileKey);t&&this.featuresView.onTileError(t)}forceAttributeTextureUpload(){this.featuresView.attributeView.forceTextureUpload()}lockGPUUploads(){this.featuresView.attributeView.lockTextureUpload(),this.tiles.forEach((e=>e.lock()))}unlockGPUUploads(){this.featuresView.attributeView.unlockTextureUpload(),this.tiles.forEach((e=>e.unlock()))}async getMaterialItems(e){return this.featuresView.getMaterialItems(e)}invalidateLabels(){this.featuresView.hasLabels&&this.layerView.view.labelManager.requestUpdate()}createTile(e){const t=this.tileInfoView.getTileBounds(s(),e),i=()=>this.layerView.view.labelManager.requestUpdate(),a=this.tileInfoView.getTileResolution(e.level),o=this.featuresView.attributeView;return new r(e,a,t[0],t[3],o,i)}disposeTile(e){this.featuresView.removeChild(e),e.destroy(),this.layerView.view.labelManager.requestUpdate()}};u=e([i(\"esri.views.2d.layers.features.tileRenderers.SymbolTileRenderer\")],u);const p=u;export{p as default};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}