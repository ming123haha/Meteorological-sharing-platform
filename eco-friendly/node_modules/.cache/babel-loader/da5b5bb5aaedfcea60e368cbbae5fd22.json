{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../chunks/tslib.es6.js\";\nimport t from \"../../../core/Accessor.js\";\nimport i from \"../../../core/Handles.js\";\nimport { destroyMaybe as s, isSome as r } from \"../../../core/maybe.js\";\nimport { watch as o } from \"../../../core/reactiveUtils.js\";\nimport { property as n } from \"../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../core/arrayUtils.js\";\nimport \"../../../core/has.js\";\nimport \"../../../core/accessorSupport/ensureType.js\";\nimport { subclass as l } from \"../../../core/accessorSupport/decorators/subclass.js\";\nimport { canProjectToWGS84ComparableLonLat as a } from \"../../../geometry/projection.js\";\nimport { equals as c } from \"../../../geometry/support/aaBoundingRect.js\";\nimport { isMars as h, isMoon as p } from \"../../../geometry/support/spatialReferenceUtils.js\";\nimport { isTiledLayer as d } from \"../../../layers/support/layerUtils.js\";\nimport { ViewingMode as m } from \"../../ViewingMode.js\";\nimport { getTiledLayerInfo as y, isProjectableRasterLayer as u } from \"./terrainUtils.js\";\nimport { TilingScheme as S } from \"./TilingScheme.js\";\nlet g = class extends t {\n  constructor(e) {\n    super(e), this._handles = new i();\n  }\n\n  initialize() {\n    this._handles.add(this.layers.on(\"change\", () => this._update())), this._handles.add(o(() => this.extentHelper.layerViewsExtent, () => this._setAdHocTilingScheme())), this._update(), this.tilingSchemeLocked || this._setAdHocTilingScheme();\n  }\n\n  destroy() {\n    this._handles = s(this._handles), this._waitTask = null;\n  }\n\n  _update() {\n    if (this._waitTask = null, this.tilingSchemeLocked) return;\n    let e;\n    if (this.layers.some(t => !(!d(t) || t.isRejected()) && !(t.isFulfilled() && !f(t, this.viewSpatialReference, this.viewingMode)) && (e = t, !(\"vector-tile\" === t?.type || u(t)))), e) if (e.isResolved()) {\n      const t = y(e, this.viewSpatialReference, this.viewingMode);\n\n      if (r(t)) {\n        const e = new S(t.tileInfo);\n\n        this._lockTilingScheme(e);\n      }\n    } else this._updateWhen(e);\n  }\n\n  _updateWhen(e) {\n    const t = e.when().catch(() => {}).then(() => {\n      t !== this._waitTask || this.destroyed || this._update();\n    });\n    this._waitTask = t;\n  }\n\n  _lockTilingScheme(e) {\n    if (this.viewingMode === m.Global) {\n      const t = e.levels.length - 1;\n      e.spatialReference.isWebMercator ? e = S.makeWebMercatorAuxiliarySphere(t) : a(e.spatialReference) && (e = S.makeGCSWithTileSize(e.spatialReference, e.pixelSize, t));\n    }\n\n    this.tilingSchemeLocked = !0, this.tilingScheme = e, this.extentHelper.tilingScheme = this.tilingScheme, this._updateTiledLayerExtent(), this._handles.removeAll(), this._handles.add(o(() => this.extentHelper.tiledLayersExtent, () => this._updateTiledLayerExtent()));\n  }\n\n  _updateTiledLayerExtent() {\n    this._set(\"extent\", this.extentHelper.tiledLayersExtent);\n  }\n\n  _setAdHocTilingScheme() {\n    if (this.viewingMode === m.Global) {\n      const e = this.extentHelper.viewSpatialReference,\n            t = a(e) || h(e) || p(e);\n      e.isWebMercator ? this.tilingScheme = S.WebMercatorAuxiliarySphere : t && (this.tilingScheme = S.makeGCSWithTileSize(e, 256)), this._set(\"extent\", this.extentHelper.layerViewsExtent);\n    } else {\n      const e = this.extentHelper.layerViewsExtent;\n      r(e) && !c(e, this.extent) && (this.tilingScheme = S.fromExtent(e, this.extentHelper.viewSpatialReference), this._set(\"extent\", e));\n    }\n  }\n\n  get test() {\n    return {\n      lockTilingScheme: e => this._lockTilingScheme(e),\n      done: !this._waitTask\n    };\n  }\n\n};\n\nfunction f(e, t, i) {\n  return r(y(e, t, i));\n}\n\ne([n()], g.prototype, \"tilingScheme\", void 0), e([n({\n  readOnly: !0\n})], g.prototype, \"extent\", void 0), e([n({\n  value: !1\n})], g.prototype, \"tilingSchemeLocked\", void 0), e([n({\n  constructOnly: !0\n})], g.prototype, \"viewSpatialReference\", void 0), e([n({\n  constructOnly: !0\n})], g.prototype, \"layers\", void 0), e([n({\n  constructOnly: !0\n})], g.prototype, \"extentHelper\", void 0), e([n({\n  constructOnly: !0\n})], g.prototype, \"viewingMode\", void 0), g = e([l(\"esri.views.3d.terrain.TilingSchemeLogic\")], g);\nexport { g as TilingSchemeLogic };","map":{"version":3,"names":["_","e","t","i","destroyMaybe","s","isSome","r","watch","o","property","n","subclass","l","canProjectToWGS84ComparableLonLat","a","equals","c","isMars","h","isMoon","p","isTiledLayer","d","ViewingMode","m","getTiledLayerInfo","y","isProjectableRasterLayer","u","TilingScheme","S","g","constructor","_handles","initialize","add","layers","on","_update","extentHelper","layerViewsExtent","_setAdHocTilingScheme","tilingSchemeLocked","destroy","_waitTask","some","isRejected","isFulfilled","f","viewSpatialReference","viewingMode","type","isResolved","tileInfo","_lockTilingScheme","_updateWhen","when","catch","then","destroyed","Global","levels","length","spatialReference","isWebMercator","makeWebMercatorAuxiliarySphere","makeGCSWithTileSize","pixelSize","tilingScheme","_updateTiledLayerExtent","removeAll","tiledLayersExtent","_set","WebMercatorAuxiliarySphere","extent","fromExtent","test","lockTilingScheme","done","prototype","readOnly","value","constructOnly","TilingSchemeLogic"],"sources":["C:/Users/hp/Desktop/eco-friendly atmosphere/Atmosphere/eco-friendly/node_modules/@arcgis/core/views/3d/terrain/TilingSchemeLogic.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import t from\"../../../core/Accessor.js\";import i from\"../../../core/Handles.js\";import{destroyMaybe as s,isSome as r}from\"../../../core/maybe.js\";import{watch as o}from\"../../../core/reactiveUtils.js\";import{property as n}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/arrayUtils.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import{subclass as l}from\"../../../core/accessorSupport/decorators/subclass.js\";import{canProjectToWGS84ComparableLonLat as a}from\"../../../geometry/projection.js\";import{equals as c}from\"../../../geometry/support/aaBoundingRect.js\";import{isMars as h,isMoon as p}from\"../../../geometry/support/spatialReferenceUtils.js\";import{isTiledLayer as d}from\"../../../layers/support/layerUtils.js\";import{ViewingMode as m}from\"../../ViewingMode.js\";import{getTiledLayerInfo as y,isProjectableRasterLayer as u}from\"./terrainUtils.js\";import{TilingScheme as S}from\"./TilingScheme.js\";let g=class extends t{constructor(e){super(e),this._handles=new i}initialize(){this._handles.add(this.layers.on(\"change\",(()=>this._update()))),this._handles.add(o((()=>this.extentHelper.layerViewsExtent),(()=>this._setAdHocTilingScheme()))),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._handles=s(this._handles),this._waitTask=null}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some((t=>!(!d(t)||t.isRejected())&&(!(t.isFulfilled()&&!f(t,this.viewSpatialReference,this.viewingMode))&&(e=t,!(\"vector-tile\"===t?.type||u(t)))))),e)if(e.isResolved()){const t=y(e,this.viewSpatialReference,this.viewingMode);if(r(t)){const e=new S(t.tileInfo);this._lockTilingScheme(e)}}else this._updateWhen(e)}_updateWhen(e){const t=e.when().catch((()=>{})).then((()=>{t!==this._waitTask||this.destroyed||this._update()}));this._waitTask=t}_lockTilingScheme(e){if(this.viewingMode===m.Global){const t=e.levels.length-1;e.spatialReference.isWebMercator?e=S.makeWebMercatorAuxiliarySphere(t):a(e.spatialReference)&&(e=S.makeGCSWithTileSize(e.spatialReference,e.pixelSize,t))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this._handles.removeAll(),this._handles.add(o((()=>this.extentHelper.tiledLayersExtent),(()=>this._updateTiledLayerExtent())))}_updateTiledLayerExtent(){this._set(\"extent\",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===m.Global){const e=this.extentHelper.viewSpatialReference,t=a(e)||h(e)||p(e);e.isWebMercator?this.tilingScheme=S.WebMercatorAuxiliarySphere:t&&(this.tilingScheme=S.makeGCSWithTileSize(e,256)),this._set(\"extent\",this.extentHelper.layerViewsExtent)}else{const e=this.extentHelper.layerViewsExtent;r(e)&&!c(e,this.extent)&&(this.tilingScheme=S.fromExtent(e,this.extentHelper.viewSpatialReference),this._set(\"extent\",e))}}get test(){return{lockTilingScheme:e=>this._lockTilingScheme(e),done:!this._waitTask}}};function f(e,t,i){return r(y(e,t,i))}e([n()],g.prototype,\"tilingScheme\",void 0),e([n({readOnly:!0})],g.prototype,\"extent\",void 0),e([n({value:!1})],g.prototype,\"tilingSchemeLocked\",void 0),e([n({constructOnly:!0})],g.prototype,\"viewSpatialReference\",void 0),e([n({constructOnly:!0})],g.prototype,\"layers\",void 0),e([n({constructOnly:!0})],g.prototype,\"extentHelper\",void 0),e([n({constructOnly:!0})],g.prototype,\"viewingMode\",void 0),g=e([l(\"esri.views.3d.terrain.TilingSchemeLogic\")],g);export{g as TilingSchemeLogic};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}