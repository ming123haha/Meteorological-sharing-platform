{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport { isNone as e, isSome as t } from \"../../../../../core/maybe.js\";\nimport { NestedMap as r } from \"../../../../../core/NestedMap.js\";\n\nclass s {\n  constructor(e) {\n    this._context = e, this._perConstructorInstances = new r(), this._frameCounter = 0, this._keepAliveFrameCount = o;\n  }\n\n  get viewingMode() {\n    return this._context.viewingMode;\n  }\n\n  get constructionContext() {\n    return this._context;\n  }\n\n  dispose() {\n    this._perConstructorInstances.forEach(e => e.forEach(e => e.technique.destroy())), this._perConstructorInstances.clear();\n  }\n\n  acquire(t, r) {\n    const s = r.key;\n\n    let o = this._perConstructorInstances.get(t, s);\n\n    if (e(o)) {\n      const e = new t(this._context, r, () => this.release(e));\n      o = new n(e), this._perConstructorInstances.set(t, s, o);\n    }\n\n    return ++o.refCount, o.technique;\n  }\n\n  releaseAndAcquire(e, r, s) {\n    if (t(s)) {\n      if (r.key === s.key) return s;\n      this.release(s);\n    }\n\n    return this.acquire(e, r);\n  }\n\n  release(t) {\n    if (e(t) || this._perConstructorInstances.empty) return;\n\n    const r = this._perConstructorInstances.get(t.constructor, t.key);\n\n    e(r) || (--r.refCount, 0 === r.refCount && (r.refZeroFrame = this._frameCounter));\n  }\n\n  frameUpdate() {\n    this._frameCounter++, this._keepAliveFrameCount !== o && this._perConstructorInstances.forEach((e, t) => {\n      e.forEach((e, r) => {\n        0 === e.refCount && e.refZeroFrame + this._keepAliveFrameCount < this._frameCounter && (e.technique.destroy(), this._perConstructorInstances.delete(t, r));\n      });\n    });\n  }\n\n  async reloadAll() {\n    const e = new Array();\n    this._perConstructorInstances.forEach((t, r) => {\n      const s = async (e, t) => {\n        const r = t.shader;\n        r && (await r.reload(), e.forEach(e => {\n          e.technique.reload(this._context);\n        }));\n      };\n\n      e.push(s(t, r));\n    }), await Promise.all(e);\n  }\n\n}\n\nclass n {\n  constructor(e) {\n    this.technique = e, this.refCount = 0, this.refZeroFrame = 0;\n  }\n\n}\n\nconst o = -1;\nexport { s as ShaderTechniqueRepository };","map":{"version":3,"names":["isNone","e","isSome","t","NestedMap","r","s","constructor","_context","_perConstructorInstances","_frameCounter","_keepAliveFrameCount","o","viewingMode","constructionContext","dispose","forEach","technique","destroy","clear","acquire","key","get","release","n","set","refCount","releaseAndAcquire","empty","refZeroFrame","frameUpdate","delete","reloadAll","Array","shader","reload","push","Promise","all","ShaderTechniqueRepository"],"sources":["C:/Users/hp/Desktop/eco-friendly atmosphere/Atmosphere/eco-friendly/node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueRepository.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport{isNone as e,isSome as t}from\"../../../../../core/maybe.js\";import{NestedMap as r}from\"../../../../../core/NestedMap.js\";class s{constructor(e){this._context=e,this._perConstructorInstances=new r,this._frameCounter=0,this._keepAliveFrameCount=o}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}dispose(){this._perConstructorInstances.forEach((e=>e.forEach((e=>e.technique.destroy())))),this._perConstructorInstances.clear()}acquire(t,r){const s=r.key;let o=this._perConstructorInstances.get(t,s);if(e(o)){const e=new t(this._context,r,(()=>this.release(e)));o=new n(e),this._perConstructorInstances.set(t,s,o)}return++o.refCount,o.technique}releaseAndAcquire(e,r,s){if(t(s)){if(r.key===s.key)return s;this.release(s)}return this.acquire(e,r)}release(t){if(e(t)||this._perConstructorInstances.empty)return;const r=this._perConstructorInstances.get(t.constructor,t.key);e(r)||(--r.refCount,0===r.refCount&&(r.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==o&&this._perConstructorInstances.forEach(((e,t)=>{e.forEach(((e,r)=>{0===e.refCount&&e.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(e.technique.destroy(),this._perConstructorInstances.delete(t,r))}))}))}async reloadAll(){const e=new Array;this._perConstructorInstances.forEach(((t,r)=>{const s=async(e,t)=>{const r=t.shader;r&&(await r.reload(),e.forEach((e=>{e.technique.reload(this._context)})))};e.push(s(t,r))})),await Promise.all(e)}}class n{constructor(e){this.technique=e,this.refCount=0,this.refZeroFrame=0}}const o=-1;export{s as ShaderTechniqueRepository};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}