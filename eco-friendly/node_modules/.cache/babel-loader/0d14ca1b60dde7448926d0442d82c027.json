{"ast":null,"code":"import Map from \"@arcgis/core/Map\";\nimport FeatureLayer from \"@arcgis/core/layers/FeatureLayer.js\";\nimport MapView from \"@arcgis/core/views/MapView\";\nimport SceneView from \"@arcgis/core/views/SceneView\";\nimport FeatureForm from \"@arcgis/core/widgets/FeatureForm\";\nimport AMapLoader from \"@amap/amap-jsapi-loader\";\nexport default {\n  name: \"Home\",\n\n  data() {\n    return {\n      //所有气象站点的经纬度\n      lngLat: [[117.1959, 31.7848], [117.3072, 31.8764], [117.2588, 31.8707], [117.1604, 31.9052], [117.25, 31.8571], [117.266, 31.9436], [117.336, 31.8586], [117.3027, 31.7964], [117.2776, 31.7385], [117.1318, 31.8403], [117.3803, 31.9147], [118.3714, 31.4134], [118.3673, 31.3131], [118.4022, 31.3839], [118.4209, 31.3707], [118.4781, 31.3225], [118.2746, 31.2326], [117.396, 32.939], [117.3605, 32.9427], [117.4185, 32.8911], [117.3533, 32.9673], [117.3145, 32.8977], [117.3092, 32.9314], [116.8305, 32.7727], [117.0067, 32.6524], [116.8569, 32.5951], [116.8281, 32.633], [116.6325, 32.6201], [117.0566, 32.6531], [117.0108, 32.5893], [118.5092, 31.6837], [118.5024, 31.6449], [118.5228, 31.7231], [118.48, 31.6928], [118.6245, 31.7241], [118.4918, 31.6809], [116.8004, 33.975], [116.8091, 33.9007], [116.7856, 33.9477], [116.8873, 33.9836], [117.8177, 30.9412], [117.8059, 30.9273], [117.7807, 30.9413], [117.7439, 30.8792], [117.846, 30.9413], [117.8483, 30.97], [117.0809, 30.5177], [117.0331, 30.5119], [116.9896, 30.6145], [117.0598, 30.5351], [118.2903, 29.6963], [118.327, 29.7178], [118.1371, 30.2756], [118.3093, 32.3153], [118.3244, 32.2786], [118.3118, 32.3038], [115.8277, 32.8929], [115.8554, 32.8605], [115.784, 32.8892], [115.7901, 32.8631], [115.836, 32.9183], [116.989, 33.6306], [116.9509, 33.666], [116.9708, 33.591], [116.9884, 33.6305], [116.9648, 33.6252], [116.5079, 31.737], [118.4738, 31.7643], [116.4996, 31.7905], [116.5567, 31.7886], [115.8072, 33.8399], [115.7789, 33.8518], [115.7633, 33.8034], []],\n      areaName: \"\",\n      isvisble: true,\n      //高德地图默认显示\n      isvisble1: false,\n      //arcgisapi不默认显示\n      visible: false,\n      result: {},\n      items: [],\n      aqi: \"\",\n      quality: \"\",\n      PM2_5: \"\",\n      PM10: \"\",\n      SO2: \"\",\n      NO2: \"\",\n      O3: \"\",\n      CO: \"\",\n      value1: false\n    };\n  },\n\n  mounted() {\n    this.initGapdeMap();\n  },\n\n  methods: {\n    changValue() {\n      if (this.value1) {\n        this.isvisble = false;\n        this.isvisble1 = true;\n        this.initMap();\n      } else {\n        this.isvisble = true;\n        this.isvisble1 = false;\n        this.initGapdeMap();\n      }\n    },\n\n    initGapdeMap() {\n      AMapLoader.load({\n        key: \"0e5904b2829e2e25ffcdecc5685b2209\",\n        // 申请好的Web端开发者Key，首次调用 load 时必填\n        version: \"2.0\",\n        // 指定要加载的 JSAPI 的版本，缺省时默认为 1.4.15\n        plugins: ['AMap.MoveAnimation', 'AMap.ToolBar', 'AMap.Scale', 'AMap.MapType', 'AMap.Geolocation', 'AMap.HawkEye', 'AMap.HeatMap'] // 需要使用的的插件列表，如比例尺'AMap.Scale'等\n\n      }).then(AMap => {\n        var _this = this;\n\n        this.map = new AMap.Map(\"viewDiv\", {\n          //设置地图容器id\n          resizeEnable: true,\n          //mapStyle: 'amap://styles/normal',\n          viewMode: \"3D\",\n          //是否为3D地图模式\n          zoom: 10,\n          //初始化地图级别\n          center: [118.3093, 32.3153],\n          //初始化地图中心点位置\n          doubleClickZoom: true,\n          // 是否允许鼠标拖拽\n          dragEnable: true,\n          keyboardEnable: false\n        }); //添加marker标记\n\n        function addMarker() {\n          _this.map.clearMap();\n\n          for (var i = 0, marker; i < _this.lngLat.length; i++) {\n            var marker = new AMap.Marker({\n              map: _this.map,\n              position: _this.lngLat[i] //不同经纬度坐标点\n\n            }); //鼠标点击marker弹出自定义的信息窗体\n\n            marker.on('click', function () {\n              infoWindow.open(_this.map, marker.getPosition());\n            });\n          }\n        }\n\n        addMarker(); //实例化信息窗体\n\n        var title = '滁州市<span style=\"font-size:11px;color:#F00;\">老年大学监测站</span>',\n            content = [];\n        content.push(\"<img style='position: relative' src='http://tpc.googlesyndication.com/simgad/5843493769827749134'>\");\n        content.push(\"\");\n        content.push(\"\");\n        content.push(\"\");\n        content.push(\"天气质量:\");\n        content.push(\"CO指数:\");\n        content.push(\"SO2指数:\");\n        content.push(\"NO2指数:\");\n        content.push(\"CO2指数:\");\n        content.push(\"PM2.5指数:\");\n        content.push(\"PM10指数:\");\n        content.push(\"<a href='https://ditu.amap.com/detail/B000A8URXB?citycode=110105'>该站点详细信息</a>\");\n        var infoWindow = new AMap.InfoWindow({\n          isCustom: true,\n          //使用自定义窗体\n          content: createInfoWindow(title, content.join(\"<br/>\")),\n          offset: new AMap.Pixel(16, -45)\n        }); //构建自定义信息窗体\n\n        function createInfoWindow(title, content) {\n          var info = document.createElement(\"div\");\n          info.className = \"custom-info input-card content-window-card\"; //可以通过下面的方式修改自定义窗体的宽高\n\n          info.style.width = \"200px\"; // 定义顶部标题\n\n          var top = document.createElement(\"div\");\n          var titleD = document.createElement(\"div\");\n          var closeX = document.createElement(\"img\");\n          top.className = \"info-top\";\n          titleD.innerHTML = title;\n          closeX.src = \"https://webapi.amap.com/images/close2.gif\";\n          closeX.onclick = closeInfoWindow;\n          top.appendChild(titleD);\n          top.appendChild(closeX);\n          info.appendChild(top); // 定义中部内容\n\n          var middle = document.createElement(\"div\");\n          middle.className = \"info-middle\";\n          middle.style.backgroundColor = 'white';\n          middle.innerHTML = content;\n          info.appendChild(middle); // 定义底部内容\n\n          var bottom = document.createElement(\"div\");\n          bottom.className = \"info-bottom\";\n          bottom.style.position = 'relative';\n          bottom.style.top = '0px';\n          bottom.style.margin = '0 auto';\n          var sharp = document.createElement(\"img\");\n          sharp.src = \"https://webapi.amap.com/images/sharp.png\";\n          bottom.appendChild(sharp);\n          info.appendChild(bottom);\n          return info;\n        } //关闭信息窗体\n\n\n        function closeInfoWindow() {\n          _this.map.clearInfoWindow();\n        }\n\n        this.map.setFitView(); // 在图面添加工具条控件，工具条控件集成了缩放、平移、定位等功能按钮在内的组合控件\n\n        this.map.addControl(new AMap.ToolBar()); // 在图面添加比例尺控件，展示地图在当前层级和纬度下的比例尺\n\n        this.map.addControl(new AMap.Scale()); // 在图面添加鹰眼控件，在地图右下角显示地图的缩略图\n\n        this.map.addControl(new AMap.HawkEye({\n          isOpen: true\n        })); // 在图面添加定位控件，用来获取和展示用户主机所在的经纬度位置\n\n        this.map.addControl(new AMap.Geolocation());\n      }).catch(e => {\n        console.log(e);\n      });\n    },\n\n    initMap() {\n      const template = {\n        //titie:\"站点信息\",\n        content: [{\n          type: \"fields\",\n          fieldInfos: [{\n            fieldName: \"city\",\n            label: \"地区名称\"\n          }, {\n            fieldName: \"station\",\n            label: \"站点名称\"\n          }]\n        }]\n      };\n      const featurelayer = new FeatureLayer({\n        outFields: [\"city\", \"station\"],\n        url: \"http://localhost:6080/arcgis/rest/services/2000坐标/FeatureServer\",\n        popupTemplate: template\n      });\n      const map = new Map({\n        basemap: \"satellite\",\n        ground: \"world-elevation\",\n        layers: [featurelayer]\n      }); //这个view相当于地图视图容器，指定了div等等属性\n\n      const view = new SceneView({\n        container: \"viewDiv1\",\n        map: map,\n        center: [117, 32],\n        zoom: 14\n      }); //监听地图点击事件\n\n      view.on('click', event => {\n        view.hitTest(event).then(response => {\n          if ( //如果点击的是目标矢量图层 并且图层图形数量大于1 完成对目标矢量图层的筛选\n          response.results.length > 0 && response.results[0].graphic && response.results[0].graphic.layer === featurelayer) {\n            //console.log(response.results[0].graphic.attributes.city)\n            this.areaName = response.results[0].graphic.attributes.city + \"(\" + response.results[0].graphic.attributes.station + \")\"; //数据双向绑定 获取点击图块的名称\n            //调用selecFeature方法\n\n            selectFeature(response.results[0].graphic.attributes[featurelayer.objectIdField]);\n            console.log(response.results[0].graphic.attributes.station);\n            this.request.get(\"/nowatmospheredata/data?stationName=\" + response.results[0].graphic.attributes.station).then(res => {\n              //console.log(res)\n              //console.log(res.aqi)\n              this.aqi = res.aqi;\n              this.quality = res.quality;\n              this.PM2_5 = res.pm2_5;\n              this.SO2 = res.so2;\n              this.NO2 = res.no2;\n              this.O3 = res.o3;\n              this.PM10 = res.pm10;\n            }); //console.log(this.items)\n\n            this.items = [\"AQI指数:\" + this.aqi, \"空气质量:\" + this.quality];\n            this.visible = true; //let lat = Math.round(event.mapPoint.latitude * 1000000) / 1000000;\n            //let lon = Math.round(event.mapPoint.longitude * 1000000) / 1000000;\n            //alert(lon + \", \" + lat);\n          } else {\n            this.visible = false;\n          }\n        });\n      });\n\n      function selectFeature(objectId) {\n        featurelayer.queryFeatures({\n          objectIds: [objectId]\n        }).then(results => {\n          if (results.features.length > 0) {\n            //console.log(results.features[0])\n            console.log(results.fields.length);\n          }\n        });\n      }\n\n      view.ui.components = [];\n    }\n\n  }\n};","map":{"version":3,"mappings":"AA4CA;AACA;AACA;AACA;AACA;AACA;AACA;EACAA,YADA;;EAEAC;IACA;MACA;MACAC,oIACA,kBADA,EACA,mBADA,EACA,mBADA,EACA,mBADA,EACA,mBADA,EACA,mBADA,EACA,mBADA,EAEA,mBAFA,EAEA,mBAFA,EAEA,mBAFA,EAEA,mBAFA,EAEA,iBAFA,EAEA,mBAFA,EAEA,mBAFA,EAGA,mBAHA,EAGA,mBAHA,EAGA,mBAHA,EAGA,mBAHA,EAGA,mBAHA,EAGA,mBAHA,EAGA,kBAHA,EAIA,mBAJA,EAIA,mBAJA,EAIA,mBAJA,EAIA,mBAJA,EAIA,mBAJA,EAIA,mBAJA,EAIA,iBAJA,EAKA,mBALA,EAKA,mBALA,EAKA,kBALA,EAKA,mBALA,EAKA,mBALA,EAKA,mBALA,EAKA,mBALA,EAMA,mBANA,EAMA,mBANA,EAMA,mBANA,EAMA,kBANA,EAMA,iBANA,EAMA,mBANA,EAMA,mBANA,EAOA,mBAPA,EAOA,mBAPA,EAOA,mBAPA,EAOA,kBAPA,EAOA,mBAPA,EAOA,mBAPA,EAOA,mBAPA,EAQA,mBARA,EAQA,mBARA,EAQA,mBARA,EAQA,kBARA,EAQA,mBARA,EAQA,kBARA,EAQA,kBARA,EASA,kBATA,EASA,kBATA,EASA,mBATA,EASA,mBATA,EASA,kBATA,EASA,mBATA,EASA,mBATA,EAUA,mBAVA,EAUA,mBAVA,EAUA,mBAVA,EAUA,mBAVA,EAUA,EAVA,CAFA;MAcAC,YAdA;MAeAC,cAfA;MAeA;MACAC,gBAhBA;MAgBA;MACAC,cAjBA;MAkBAC,UAlBA;MAmBAC,SAnBA;MAoBAC,OApBA;MAqBAC,WArBA;MAsBAC,SAtBA;MAuBAC,QAvBA;MAwBAC,OAxBA;MAyBAC,OAzBA;MA0BAC,MA1BA;MA2BAC,MA3BA;MA4BAC;IA5BA;EA8BA,CAjCA;;EAkCAC;IACA;EACA,CApCA;;EAuCAC;IACAC;MACA;QACA;QACA;QACA;MAGA,CANA,MAMA;QACA;QACA;QACA;MACA;IACA,CAbA;;IAcAC;MACAC;QACAC,uCADA;QACA;QACAC,cAFA;QAEA;QACAC,iIAHA,CAGA;;MAHA,GAIAC,IAJA,CAIAC;QACA;;QACA;UAAA;UACAC,kBADA;UAEA;UACAC,cAHA;UAGA;UACAC,QAJA;UAIA;UACAC,2BALA;UAKA;UACAC,qBANA;UAOA;UACAC,gBARA;UASAC;QATA,GAFA,CAcA;;QACA;UACAC;;UACA;YACA;cACAC,cADA;cAEAC,yBAFA,CAEA;;YAFA,GADA,CAKA;;YACAC;cACAC;YACA,CAFA;UAGA;QAGA;;QAEAC,YA/BA,CAiCA;;QACA;QAAA,IACAC,YADA;QAEAA;QACAA;QACAA;QACAA;QACAA;QACAA;QACAA;QACAA;QACAA;QACAA;QACAA;QACAA;QAGA;UACAC,cADA;UACA;UACAD,uDAFA;UAGAE;QAHA,GAlDA,CAwDA;;QACA;UACA;UACAC,8DAFA,CAIA;;UACAA,2BALA,CAMA;;UACA;UACA;UACA;UACAC;UACAC;UACAC;UACAA;UAEAF;UACAA;UACAD,sBAjBA,CAmBA;;UACA;UACAI;UACAA;UACAA;UACAJ,yBAxBA,CA0BA;;UACA;UACAK;UACAA;UACAA;UACAA;UACA;UACAC;UACAD;UACAL;UACA;QACA,CA9FA,CAgGA;;;QACA;UACAT;QACA;;QAGA,sBAtGA,CAwGA;;QACA,wCAzGA,CA2GA;;QACA,sCA5GA,CA8GA;;QACA;UAAAgB;QAAA,IA/GA,CAkHA;;QACA;MAGA,CA1HA,EA0HAC,KA1HA,CA0HAC;QACAC;MACA,CA5HA;IA6HA,CA5IA;;IA6IAC;MACA;QACA;QACAd,UACA;UACAe,cADA;UAEAC,aACA;YACAC,iBADA;YAEAC;UAFA,CADA,EAKA;YACAD,oBADA;YAEAC;UAFA,CALA;QAFA,CADA;MAFA;MAmBA;QACAC,8BADA;QAEAC,sEAFA;QAGAC;MAHA;MAKA;QACAC,oBADA;QAEAC,yBAFA;QAGAC;MAHA,GAzBA,CA8BA;;MACA;QACAC,qBADA;QAEA9B,QAFA;QAGAL,iBAHA;QAIAD;MAJA,GA/BA,CAuCA;;MACAqC;QACAA;UACA;UACAC,+BACAA,2BADA,IAEAA,kDAHA,EAIA;YACA;YACA,yHAFA,CAEA;YACA;;YACAC;YAEAf;YACA;cACA;cACA;cACA;cACA;cACA;cACA;cACA;cACA;cACA;YACA,CAVA,EAPA,CAkBA;;YACA;YACA,oBApBA,CAuBA;YACA;YACA;UACA,CA9BA,MA+BA;YACA;UACA;QACA,CAnCA;MAoCA,CArCA;;MAwCA;QAEAgB;UACAC;QADA,GAEA7C,IAFA,CAEA8C;UACA;YACA;YACAlB;UACA;QACA,CAPA;MAQA;;MACAa;IACA;;EAzOA;AAvCA","names":["name","data","lngLat","areaName","isvisble","isvisble1","visible","result","items","aqi","quality","PM2_5","PM10","SO2","NO2","O3","CO","value1","mounted","methods","changValue","initGapdeMap","AMapLoader","key","version","plugins","then","AMap","resizeEnable","viewMode","zoom","center","doubleClickZoom","dragEnable","keyboardEnable","_this","map","position","marker","infoWindow","addMarker","content","isCustom","offset","info","top","titleD","closeX","middle","bottom","sharp","isOpen","catch","e","console","initMap","type","fieldInfos","fieldName","label","outFields","url","popupTemplate","basemap","ground","layers","container","view","response","selectFeature","featurelayer","objectIds","results"],"sourceRoot":"src/views","sources":["HomeView.vue"],"sourcesContent":["<template>\r\n  <div  class=\"home_div\">\r\n    <div  class=\"map_title\">\r\n      <el-switch\r\n          v-model=\"value1\"\r\n          active-text=\"显示三维实景图\"\r\n          @change=\"changValue()\">\r\n      </el-switch>\r\n    </div>\r\n    <div v-show=\"isvisble\" id=\"viewDiv\" style=\"width: 100%;height: 100%;position:absolute;\"></div>\r\n    <div v-show=\"isvisble1\" id=\"viewDiv1\" style=\"width: 100%;height: 100%;position:absolute;\"></div>\r\n<!--    <div class=\"father\">-->\r\n\r\n<!--&lt;!&ndash;      <div class=\"son\">&ndash;&gt;-->\r\n<!--&lt;!&ndash;        <h1>当前城市</h1>&ndash;&gt;-->\r\n<!--&lt;!&ndash;        <h2>AQI指数</h2>&ndash;&gt;-->\r\n<!--&lt;!&ndash;      </div>&ndash;&gt;-->\r\n<!--    </div>-->\r\n\r\n    <div v-show=\"visible\" style=\"position: absolute;right: 20px; bottom:400px\">\r\n      <el-card class=\"box-card\">\r\n        <div slot=\"header\" class=\"clearfix\">\r\n          <span>{{ areaName }}</span>\r\n        </div>\r\n        <div v-for=\"item in items\" :key=\"item\" class=\"text item\">\r\n          {{item}}\r\n        </div>\r\n      </el-card>\r\n    </div>\r\n\r\n\r\n    <link\r\n        rel=\"stylesheet\"\r\n        href=\"https://js.arcgis.com/4.24/esri/themes/dark/main.css\"\r\n    />\r\n\r\n</div>\r\n\r\n<!-- arcgisapi样式  -->\r\n\r\n\r\n</template>\r\n\r\n<script>\r\nimport Map from \"@arcgis/core/Map\";\r\nimport FeatureLayer from \"@arcgis/core/layers/FeatureLayer.js\"\r\nimport MapView from \"@arcgis/core/views/MapView\";\r\nimport SceneView from \"@arcgis/core/views/SceneView\";\r\nimport FeatureForm from \"@arcgis/core/widgets/FeatureForm\";\r\nimport AMapLoader from \"@amap/amap-jsapi-loader\";\r\nexport default {\r\n  name: \"Home\",\r\n  data() {\r\n    return {\r\n      //所有气象站点的经纬度\r\n      lngLat:[[117.1959,31.7848],[117.3072,31.8764],[117.2588,31.8707],[117.1604,31.9052],[117.25,31.8571],[117.266,31.9436],\r\n          [117.336,31.8586],[117.3027,31.7964],[117.2776,31.7385],[117.1318,31.8403],[117.3803,31.9147],[118.3714,31.4134],[118.3673,31.3131],\r\n          [118.4022,31.3839],[118.4209,31.3707],[118.4781,31.3225],[118.2746,31.2326],[117.396,32.939],[117.3605,32.9427],[117.4185,32.8911],\r\n          [117.3533,32.9673],[117.3145,32.8977],[117.3092,32.9314],[116.8305,32.7727],[117.0067,32.6524],[116.8569,32.5951],[116.8281,32.633],\r\n          [116.6325,32.6201],[117.0566,32.6531],[117.0108,32.5893],[118.5092,31.6837],[118.5024,31.6449],[118.5228,31.7231],[118.48,31.6928],\r\n          [118.6245,31.7241],[118.4918,31.6809],[116.8004,33.975],[116.8091,33.9007],[116.7856,33.9477],[116.8873,33.9836],[117.8177,30.9412],\r\n          [117.8059,30.9273],[117.7807,30.9413],[117.7439,30.8792],[117.846,30.9413],[117.8483,30.97],[117.0809,30.5177],[117.0331,30.5119],\r\n          [116.9896,30.6145],[117.0598,30.5351],[118.2903,29.6963],[118.327,29.7178],[118.1371,30.2756],[118.3093,32.3153],[118.3244,32.2786],\r\n          [118.3118,32.3038],[115.8277,32.8929],[115.8554,32.8605],[115.784,32.8892],[115.7901,32.8631],[115.836,32.9183],[116.989,33.6306],\r\n          [116.9509,33.666],[116.9708,33.591],[116.9884,33.6305],[116.9648,33.6252],[116.5079,31.737],[118.4738,31.7643],[116.4996,31.7905],\r\n          [116.5567,31.7886],[115.8072,33.8399],[115.7789,33.8518],[115.7633,33.8034],[]\r\n      ],\r\n      areaName:\"\",\r\n      isvisble:true,  //高德地图默认显示\r\n      isvisble1:false, //arcgisapi不默认显示\r\n      visible:false,\r\n      result:{},\r\n      items:[],\r\n      aqi:\"\",\r\n      quality:\"\",\r\n      PM2_5:\"\",\r\n      PM10:\"\",\r\n      SO2:\"\",\r\n      NO2:\"\",\r\n      O3:\"\",\r\n      CO:\"\",\r\n      value1:false\r\n    }\r\n  },\r\n  mounted() {\r\n    this.initGapdeMap();\r\n  },\r\n\r\n\r\n  methods: {\r\n    changValue(){\r\n      if(this.value1) {\r\n        this.isvisble=false\r\n        this.isvisble1=true\r\n        this.initMap();\r\n\r\n\r\n      }else {\r\n        this.isvisble=true\r\n        this.isvisble1=false\r\n        this.initGapdeMap();\r\n      }\r\n    },\r\n    initGapdeMap(){\r\n      AMapLoader.load({\r\n        key: \"0e5904b2829e2e25ffcdecc5685b2209\",             // 申请好的Web端开发者Key，首次调用 load 时必填\r\n        version: \"2.0\",      // 指定要加载的 JSAPI 的版本，缺省时默认为 1.4.15\r\n        plugins: ['AMap.MoveAnimation', 'AMap.ToolBar', 'AMap.Scale', 'AMap.MapType', 'AMap.Geolocation', 'AMap.HawkEye', 'AMap.HeatMap'],       // 需要使用的的插件列表，如比例尺'AMap.Scale'等\r\n      }).then((AMap) => {\r\n        var _this = this;\r\n        this.map = new AMap.Map(\"viewDiv\", {  //设置地图容器id\r\n          resizeEnable: true,\r\n          //mapStyle: 'amap://styles/normal',\r\n          viewMode: \"3D\",    //是否为3D地图模式\r\n          zoom: 10,           //初始化地图级别\r\n          center: [118.3093, 32.3153], //初始化地图中心点位置\r\n          doubleClickZoom: true,\r\n          // 是否允许鼠标拖拽\r\n          dragEnable: true,\r\n          keyboardEnable: false,\r\n        });\r\n\r\n        //添加marker标记\r\n        function addMarker() {\r\n          _this.map.clearMap();\r\n          for(var i=0,marker;i<_this.lngLat.length;i++){\r\n            var marker = new AMap.Marker({\r\n              map: _this.map,\r\n              position: _this.lngLat[i]  //不同经纬度坐标点\r\n            });\r\n          //鼠标点击marker弹出自定义的信息窗体\r\n            marker.on('click', function () {\r\n              infoWindow.open(_this.map, marker.getPosition());\r\n            });\r\n          }\r\n\r\n\r\n        }\r\n\r\n        addMarker();\r\n\r\n        //实例化信息窗体\r\n        var title = '滁州市<span style=\"font-size:11px;color:#F00;\">老年大学监测站</span>',\r\n            content = [];\r\n        content.push(\"<img style='position: relative' src='http://tpc.googlesyndication.com/simgad/5843493769827749134'>\");\r\n        content.push(\"\");\r\n        content.push(\"\");\r\n        content.push(\"\");\r\n        content.push(\"天气质量:\");\r\n        content.push(\"CO指数:\");\r\n        content.push(\"SO2指数:\");\r\n        content.push(\"NO2指数:\");\r\n        content.push(\"CO2指数:\");\r\n        content.push(\"PM2.5指数:\");\r\n        content.push(\"PM10指数:\");\r\n        content.push(\"<a href='https://ditu.amap.com/detail/B000A8URXB?citycode=110105'>该站点详细信息</a>\");\r\n\r\n\r\n        var infoWindow = new AMap.InfoWindow({\r\n          isCustom: true,  //使用自定义窗体\r\n          content: createInfoWindow(title, content.join(\"<br/>\")),\r\n          offset: new AMap.Pixel(16, -45)\r\n        });\r\n\r\n        //构建自定义信息窗体\r\n        function createInfoWindow(title, content) {\r\n          var info = document.createElement(\"div\");\r\n          info.className = \"custom-info input-card content-window-card\";\r\n\r\n          //可以通过下面的方式修改自定义窗体的宽高\r\n          info.style.width = \"200px\";\r\n          // 定义顶部标题\r\n          var top = document.createElement(\"div\");\r\n          var titleD = document.createElement(\"div\");\r\n          var closeX = document.createElement(\"img\");\r\n          top.className = \"info-top\";\r\n          titleD.innerHTML = title;\r\n          closeX.src = \"https://webapi.amap.com/images/close2.gif\";\r\n          closeX.onclick = closeInfoWindow;\r\n\r\n          top.appendChild(titleD);\r\n          top.appendChild(closeX);\r\n          info.appendChild(top);\r\n\r\n          // 定义中部内容\r\n          var middle = document.createElement(\"div\");\r\n          middle.className = \"info-middle\";\r\n          middle.style.backgroundColor = 'white';\r\n          middle.innerHTML = content;\r\n          info.appendChild(middle);\r\n\r\n          // 定义底部内容\r\n          var bottom = document.createElement(\"div\");\r\n          bottom.className = \"info-bottom\";\r\n          bottom.style.position = 'relative';\r\n          bottom.style.top = '0px';\r\n          bottom.style.margin = '0 auto';\r\n          var sharp = document.createElement(\"img\");\r\n          sharp.src = \"https://webapi.amap.com/images/sharp.png\";\r\n          bottom.appendChild(sharp);\r\n          info.appendChild(bottom);\r\n          return info;\r\n        }\r\n\r\n        //关闭信息窗体\r\n        function closeInfoWindow() {\r\n          _this.map.clearInfoWindow();\r\n        }\r\n\r\n\r\n        this.map.setFitView();\r\n\r\n        // 在图面添加工具条控件，工具条控件集成了缩放、平移、定位等功能按钮在内的组合控件\r\n        this.map.addControl(new AMap.ToolBar());\r\n\r\n        // 在图面添加比例尺控件，展示地图在当前层级和纬度下的比例尺\r\n        this.map.addControl(new AMap.Scale());\r\n\r\n        // 在图面添加鹰眼控件，在地图右下角显示地图的缩略图\r\n        this.map.addControl(new AMap.HawkEye({isOpen: true}));\r\n\r\n\r\n        // 在图面添加定位控件，用来获取和展示用户主机所在的经纬度位置\r\n        this.map.addControl(new AMap.Geolocation());\r\n\r\n\r\n      }).catch(e => {\r\n        console.log(e);\r\n      })\r\n    },\r\n    initMap(){\r\n      const template={\r\n        //titie:\"站点信息\",\r\n        content:[\r\n          {\r\n            type:\"fields\",\r\n            fieldInfos:[\r\n              {\r\n                fieldName:\"city\",\r\n                label:\"地区名称\"\r\n              },\r\n              {\r\n                fieldName:\"station\",\r\n                label:\"站点名称\"\r\n              }\r\n            ]\r\n          }\r\n        ]\r\n      }\r\n\r\n      const featurelayer=new FeatureLayer({\r\n        outFields:[\"city\",\"station\"],\r\n        url:\"http://localhost:6080/arcgis/rest/services/2000坐标/FeatureServer\",\r\n        popupTemplate:template\r\n      });\r\n      const map=new Map({\r\n        basemap: \"satellite\",\r\n        ground:\"world-elevation\",\r\n        layers: [featurelayer]\r\n      })\r\n      //这个view相当于地图视图容器，指定了div等等属性\r\n      const view=new  SceneView({\r\n        container: \"viewDiv1\",\r\n        map: map,\r\n        center: [117, 32],\r\n        zoom: 14,\r\n\r\n      });\r\n\r\n      //监听地图点击事件\r\n      view.on('click', event => {\r\n        view.hitTest(event).then((response) => {\r\n          if (    //如果点击的是目标矢量图层 并且图层图形数量大于1 完成对目标矢量图层的筛选\r\n              response.results.length > 0 &&\r\n              response.results[0].graphic &&\r\n              response.results[0].graphic.layer === featurelayer\r\n          ){\r\n            //console.log(response.results[0].graphic.attributes.city)\r\n            this.areaName=response.results[0].graphic.attributes.city+\"(\"+response.results[0].graphic.attributes.station+\")\"   //数据双向绑定 获取点击图块的名称\r\n            //调用selecFeature方法\r\n            selectFeature(response.results[0].graphic.attributes[featurelayer.objectIdField])\r\n\r\n            console.log(response.results[0].graphic.attributes.station)\r\n            this.request.get(\"/nowatmospheredata/data?stationName=\"+response.results[0].graphic.attributes.station).then(res => {\r\n              //console.log(res)\r\n              //console.log(res.aqi)\r\n              this.aqi=res.aqi\r\n              this.quality=res.quality\r\n              this.PM2_5=res.pm2_5\r\n              this.SO2=res.so2\r\n              this.NO2=res.no2\r\n              this.O3=res.o3\r\n              this.PM10=res.pm10\r\n            })\r\n            //console.log(this.items)\r\n            this.items=[\"AQI指数:\"+this.aqi,\"空气质量:\"+this.quality]\r\n            this.visible=true\r\n\r\n\r\n            //let lat = Math.round(event.mapPoint.latitude * 1000000) / 1000000;\r\n            //let lon = Math.round(event.mapPoint.longitude * 1000000) / 1000000;\r\n            //alert(lon + \", \" + lat);\r\n          }\r\n          else{\r\n            this.visible=false\r\n          }\r\n        });\r\n      });\r\n\r\n\r\n      function selectFeature(objectId){\r\n\r\n        featurelayer.queryFeatures({\r\n          objectIds:[objectId],\r\n        }).then((results=>{\r\n          if(results.features.length>0){\r\n            //console.log(results.features[0])\r\n            console.log(results.fields.length)\r\n          }\r\n        }))\r\n      }\r\n      view.ui.components=[];\r\n    },\r\n\r\n  }\r\n}\r\n</script>\r\n\r\n<style>\r\n\r\n\r\n\r\n\r\n.box-card {\r\n  width: 240px;\r\n}\r\n\r\n.home_div{\r\n  padding:0px;\r\n  margin: 0px;\r\n  width: 100%;\r\n  height: 100%;\r\n  position: relative;\r\n}\r\n\r\n\r\n.map_title{\r\n  position:absolute;\r\n  z-index: 1;\r\n  width: 100%;\r\n  height: 50px;\r\n\r\n}\r\n\r\n\r\n.content-window-card {\r\n  position: relative;\r\n  box-shadow: none;\r\n  bottom: 0;\r\n  left: 0;\r\n  width: auto;\r\n  padding: 0;\r\n}\r\n\r\n.content-window-card p {\r\n  height: 2rem;\r\n}\r\n\r\n.custom-info {\r\n  border: solid 1px silver;\r\n}\r\n\r\ndiv.info-top {\r\n  position: relative;\r\n  background: none repeat scroll 0 0 #F9F9F9;\r\n  border-bottom: 1px solid #CCC;\r\n  border-radius: 5px 5px 0 0;\r\n}\r\n\r\ndiv.info-top div {\r\n  display: inline-block;\r\n  color: #333333;\r\n  font-size: 14px;\r\n  font-weight: bold;\r\n  line-height: 31px;\r\n  padding: 0 10px;\r\n}\r\n\r\ndiv.info-top img {\r\n  position: absolute;\r\n  top: 10px;\r\n  right: 10px;\r\n  transition-duration: 0.25s;\r\n}\r\n\r\ndiv.info-top img:hover {\r\n  box-shadow: 0px 0px 5px #000;\r\n}\r\n\r\ndiv.info-middle {\r\n  font-size: 12px;\r\n  padding: 10px 6px;\r\n  line-height: 20px;\r\n}\r\n\r\ndiv.info-bottom {\r\n  height: 0px;\r\n  width: 100%;\r\n  clear: both;\r\n  text-align: center;\r\n}\r\n\r\ndiv.info-bottom img {\r\n  position: relative;\r\n  z-index: 104;\r\n}\r\n\r\nspan {\r\n  margin-left: 5px;\r\n  font-size: 11px;\r\n}\r\n\r\n.info-middle img {\r\n  float: left;\r\n  margin-right: 6px;\r\n}\r\n.home_div{\r\n  padding:0px;\r\n  margin: 0px;\r\n  width: 100%;\r\n  height: 100%;\r\n  position: relative;\r\n}\r\n#container{\r\n  width: 100%;\r\n  height: 100%;\r\n  position: absolute;\r\n}\r\n.map_title{\r\n  position:absolute;\r\n  z-index: 1;\r\n  width: 100%;\r\n  height: 50px;\r\n\r\n}\r\n.amap-logo{\r\n  display: none;\r\n}\r\n.amap-copyright {\r\n  opacity:0;\r\n}\r\n\r\n</style>"]},"metadata":{},"sourceType":"module"}