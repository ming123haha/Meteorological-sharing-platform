{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport { px2pt as e, pt2px as t } from \"../../core/screenUtils.js\";\nimport { OverrideHelper as i, CIMSymbolHelper as l } from \"../cim/CIMSymbolHelper.js\";\nimport { CIMSymbolRasterizer as n, GeometryStyle as o } from \"../cim/CIMSymbolRasterizer.js\";\nimport { mapCIMSymbolToGeometryType as r } from \"../cim/utils.js\";\nimport { SymbolSizeDefaults as s } from \"./previewUtils.js\";\nimport { renderSymbol as a } from \"./renderUtils.js\";\nconst h = new n(null, !0),\n      m = e(s.size),\n      c = e(s.maxSize),\n      u = e(s.lineWidth),\n      f = 1;\n\nfunction y(e) {\n  const t = e?.size;\n  if (\"number\" == typeof t) return {\n    width: t,\n    height: t\n  };\n  return {\n    width: null != t && \"object\" == typeof t && \"width\" in t ? t.width : null,\n    height: null != t && \"object\" == typeof t && \"height\" in t ? t.height : null\n  };\n}\n\nasync function d(e, n = {}) {\n  const {\n    node: s,\n    opacity: d,\n    symbolConfig: p\n  } = n,\n        g = \"object\" == typeof p && \"isSquareFill\" in p && p.isSquareFill,\n        w = n.cimOptions || n,\n        b = w.geometryType || r(e?.data?.symbol),\n        M = y(n),\n        {\n    feature: j,\n    fieldMap: v\n  } = w;\n\n  if (null == M.width || null == M.height) {\n    const t = await i.resolveSymbolOverrides(e.data, j, null, v, b);\n    if (!t) return null;\n    (e = e.clone()).data = {\n      type: \"CIMSymbolReference\",\n      symbol: t\n    }, e.data.primitiveOverrides = null;\n    const n = [];\n    l.fetchResources(t, h.resourceManager, n), n.length > 0 && (await Promise.all(n));\n    const {\n      width: o,\n      height: r\n    } = l.getEnvelope(t, null, h.resourceManager);\n    M.width = \"esriGeometryPolygon\" === b ? m : \"esriGeometryPolyline\" === b ? u : null != o && isFinite(o) ? Math.min(o, c) : m, M.height = \"esriGeometryPolygon\" === b ? m : null != r && isFinite(r) ? Math.max(Math.min(r, c), f) : m;\n  }\n\n  const S = await h.rasterizeCIMSymbolAsync(e, j, M, g || \"esriGeometryPolygon\" !== b ? o.Preview : o.Legend, v, b);\n  if (!S) return null;\n  const {\n    width: C,\n    height: I\n  } = S,\n        P = document.createElement(\"canvas\");\n  P.width = C, P.height = I;\n  P.getContext(\"2d\").putImageData(S, 0, 0);\n  const x = t(M.width),\n        z = t(M.height),\n        F = new Image(x, z);\n  F.src = P.toDataURL(), null != d && (F.style.opacity = `${d}`);\n  let G = F;\n\n  if (null != n.effectView) {\n    const e = {\n      shape: {\n        type: \"image\",\n        x: 0,\n        y: 0,\n        width: x,\n        height: z,\n        src: F.src\n      },\n      fill: null,\n      stroke: null,\n      offset: [0, 0]\n    };\n    G = a([[e]], [x, z], {\n      effectView: n.effectView\n    });\n  }\n\n  return s && G && s.appendChild(G), G;\n}\n\nexport { d as previewCIMSymbol };","map":{"version":3,"names":["px2pt","e","pt2px","t","OverrideHelper","i","CIMSymbolHelper","l","CIMSymbolRasterizer","n","GeometryStyle","o","mapCIMSymbolToGeometryType","r","SymbolSizeDefaults","s","renderSymbol","a","h","m","size","c","maxSize","u","lineWidth","f","y","width","height","d","node","opacity","symbolConfig","p","g","isSquareFill","w","cimOptions","b","geometryType","data","symbol","M","feature","j","fieldMap","v","resolveSymbolOverrides","clone","type","primitiveOverrides","fetchResources","resourceManager","length","Promise","all","getEnvelope","isFinite","Math","min","max","S","rasterizeCIMSymbolAsync","Preview","Legend","C","I","P","document","createElement","getContext","putImageData","x","z","F","Image","src","toDataURL","style","G","effectView","shape","fill","stroke","offset","appendChild","previewCIMSymbol"],"sources":["E:/各个学科/论文/毕业论文/Atmosphere/eco-friendly/node_modules/@arcgis/core/symbols/support/previewCIMSymbol.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{px2pt as e,pt2px as t}from\"../../core/screenUtils.js\";import{OverrideHelper as i,CIMSymbolHelper as l}from\"../cim/CIMSymbolHelper.js\";import{CIMSymbolRasterizer as n,GeometryStyle as o}from\"../cim/CIMSymbolRasterizer.js\";import{mapCIMSymbolToGeometryType as r}from\"../cim/utils.js\";import{SymbolSizeDefaults as s}from\"./previewUtils.js\";import{renderSymbol as a}from\"./renderUtils.js\";const h=new n(null,!0),m=e(s.size),c=e(s.maxSize),u=e(s.lineWidth),f=1;function y(e){const t=e?.size;if(\"number\"==typeof t)return{width:t,height:t};return{width:null!=t&&\"object\"==typeof t&&\"width\"in t?t.width:null,height:null!=t&&\"object\"==typeof t&&\"height\"in t?t.height:null}}async function d(e,n={}){const{node:s,opacity:d,symbolConfig:p}=n,g=\"object\"==typeof p&&\"isSquareFill\"in p&&p.isSquareFill,w=n.cimOptions||n,b=w.geometryType||r(e?.data?.symbol),M=y(n),{feature:j,fieldMap:v}=w;if(null==M.width||null==M.height){const t=await i.resolveSymbolOverrides(e.data,j,null,v,b);if(!t)return null;(e=e.clone()).data={type:\"CIMSymbolReference\",symbol:t},e.data.primitiveOverrides=null;const n=[];l.fetchResources(t,h.resourceManager,n),n.length>0&&await Promise.all(n);const{width:o,height:r}=l.getEnvelope(t,null,h.resourceManager);M.width=\"esriGeometryPolygon\"===b?m:\"esriGeometryPolyline\"===b?u:null!=o&&isFinite(o)?Math.min(o,c):m,M.height=\"esriGeometryPolygon\"===b?m:null!=r&&isFinite(r)?Math.max(Math.min(r,c),f):m}const S=await h.rasterizeCIMSymbolAsync(e,j,M,g||\"esriGeometryPolygon\"!==b?o.Preview:o.Legend,v,b);if(!S)return null;const{width:C,height:I}=S,P=document.createElement(\"canvas\");P.width=C,P.height=I;P.getContext(\"2d\").putImageData(S,0,0);const x=t(M.width),z=t(M.height),F=new Image(x,z);F.src=P.toDataURL(),null!=d&&(F.style.opacity=`${d}`);let G=F;if(null!=n.effectView){const e={shape:{type:\"image\",x:0,y:0,width:x,height:z,src:F.src},fill:null,stroke:null,offset:[0,0]};G=a([[e]],[x,z],{effectView:n.effectView})}return s&&G&&s.appendChild(G),G}export{d as previewCIMSymbol};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}