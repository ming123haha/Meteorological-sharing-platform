{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport e from \"../../../../../core/CircularArray.js\";\nimport s from \"../../../../../core/has.js\";\nimport { isSome as t, isNone as r, unwrap as i } from \"../../../../../core/maybe.js\";\nimport { FeatureSetReaderJSON as d } from \"../support/FeatureSetReaderJSON.js\";\nimport { UpdateToken as a } from \"../support/UpdateToken.js\";\n\nclass o {\n  constructor(s, t) {\n    this.requests = {\n      done: new Array(),\n      stream: new e(10)\n    }, this._edits = null, this._abortController = new AbortController(), this._version = 0, this._done = !1, this.didSend = !1, this.tile = s, this._version = t;\n  }\n\n  get signal() {\n    return this._abortController.signal;\n  }\n\n  get options() {\n    return {\n      signal: this._abortController.signal\n    };\n  }\n\n  get empty() {\n    return !this.requests.done.length;\n  }\n\n  get edits() {\n    return this._edits;\n  }\n\n  get done() {\n    return this._done;\n  }\n\n  end() {\n    this._done = !0;\n  }\n\n  clear() {\n    this.requests.done = [];\n  }\n\n  applyUpdate(e) {\n    this.requests.done.forEach(s => s.message.status.unset(e)), this._version = e.version, t(this._edits) && this._edits.status.unset(e);\n  }\n\n  add(e) {\n    e.message.status = e.message.status ?? a.empty(), e.message.status.version = this._version, s(\"esri-2d-update-debug\") && console.debug(this.tile.id, \"DataTileSubscription:add\", this._version), e.message.end && this.requests.done.forEach(e => {\n      t(e.message) && e.message.end && (e.message.end = !1);\n    }), this.requests.done.push(e);\n  }\n\n  edit(e, s) {\n    const t = e.getQuantizationTransform(),\n          o = e.fullSchema(),\n          n = Array.from(e.features()),\n          h = [...s, ...n.map(e => e.objectId)];\n    if (this.removeIds(h), this._invalidate(), r(this._edits)) return void (this._edits = {\n      type: \"append\",\n      addOrUpdate: d.fromOptimizedFeatures(n, o, i(t)),\n      id: this.tile.id,\n      status: a.empty(),\n      end: !0\n    });\n    this.requests.done.forEach(e => e.message.end = !1);\n    i(this._edits.addOrUpdate).append(e.features());\n  }\n\n  *readers() {\n    for (const {\n      message: e\n    } of this.requests.done) t(e.addOrUpdate) && (yield e.addOrUpdate);\n\n    t(this._edits) && t(this._edits.addOrUpdate) && (yield this._edits.addOrUpdate);\n  }\n\n  _invalidate() {\n    for (const e of this.requests.done) e.message.status = a.empty();\n\n    t(this._edits) && (this._edits.status = a.empty());\n  }\n\n  removeIds(e) {\n    this._invalidate();\n\n    for (const {\n      message: s\n    } of this.requests.done) {\n      const r = s.addOrUpdate;\n      t(r) && (r.removeIds(e), r.isEmpty && (s.addOrUpdate = null));\n    }\n\n    t(this._edits) && t(this._edits.addOrUpdate) && this._edits.addOrUpdate.removeIds(e), this.requests.done = this.requests.done.filter(e => e.message.addOrUpdate || e.message.end);\n  }\n\n  abort() {\n    this._abortController.abort();\n  }\n\n}\n\nexport { o as DataTileSubscription };","map":{"version":3,"names":["e","s","isSome","t","isNone","r","unwrap","i","FeatureSetReaderJSON","d","UpdateToken","a","o","constructor","requests","done","Array","stream","_edits","_abortController","AbortController","_version","_done","didSend","tile","signal","options","empty","length","edits","end","clear","applyUpdate","forEach","message","status","unset","version","add","console","debug","id","push","edit","getQuantizationTransform","fullSchema","n","from","features","h","map","objectId","removeIds","_invalidate","type","addOrUpdate","fromOptimizedFeatures","append","readers","isEmpty","filter","abort","DataTileSubscription"],"sources":["C:/Users/hp/Desktop/eco-friendly atmosphere/Atmosphere/eco-friendly/node_modules/@arcgis/core/views/2d/layers/features/sources/DataTileSubscription.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport e from\"../../../../../core/CircularArray.js\";import s from\"../../../../../core/has.js\";import{isSome as t,isNone as r,unwrap as i}from\"../../../../../core/maybe.js\";import{FeatureSetReaderJSON as d}from\"../support/FeatureSetReaderJSON.js\";import{UpdateToken as a}from\"../support/UpdateToken.js\";class o{constructor(s,t){this.requests={done:new Array,stream:new e(10)},this._edits=null,this._abortController=new AbortController,this._version=0,this._done=!1,this.didSend=!1,this.tile=s,this._version=t}get signal(){return this._abortController.signal}get options(){return{signal:this._abortController.signal}}get empty(){return!this.requests.done.length}get edits(){return this._edits}get done(){return this._done}end(){this._done=!0}clear(){this.requests.done=[]}applyUpdate(e){this.requests.done.forEach((s=>s.message.status.unset(e))),this._version=e.version,t(this._edits)&&this._edits.status.unset(e)}add(e){e.message.status=e.message.status??a.empty(),e.message.status.version=this._version,s(\"esri-2d-update-debug\")&&console.debug(this.tile.id,\"DataTileSubscription:add\",this._version),e.message.end&&this.requests.done.forEach((e=>{t(e.message)&&e.message.end&&(e.message.end=!1)})),this.requests.done.push(e)}edit(e,s){const t=e.getQuantizationTransform(),o=e.fullSchema(),n=Array.from(e.features()),h=[...s,...n.map((e=>e.objectId))];if(this.removeIds(h),this._invalidate(),r(this._edits))return void(this._edits={type:\"append\",addOrUpdate:d.fromOptimizedFeatures(n,o,i(t)),id:this.tile.id,status:a.empty(),end:!0});this.requests.done.forEach((e=>e.message.end=!1));i(this._edits.addOrUpdate).append(e.features())}*readers(){for(const{message:e}of this.requests.done)t(e.addOrUpdate)&&(yield e.addOrUpdate);t(this._edits)&&t(this._edits.addOrUpdate)&&(yield this._edits.addOrUpdate)}_invalidate(){for(const e of this.requests.done)e.message.status=a.empty();t(this._edits)&&(this._edits.status=a.empty())}removeIds(e){this._invalidate();for(const{message:s}of this.requests.done){const r=s.addOrUpdate;t(r)&&(r.removeIds(e),r.isEmpty&&(s.addOrUpdate=null))}t(this._edits)&&t(this._edits.addOrUpdate)&&this._edits.addOrUpdate.removeIds(e),this.requests.done=this.requests.done.filter((e=>e.message.addOrUpdate||e.message.end))}abort(){this._abortController.abort()}}export{o as DataTileSubscription};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}