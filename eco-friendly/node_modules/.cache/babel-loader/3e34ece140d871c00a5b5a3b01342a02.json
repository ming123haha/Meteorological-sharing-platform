{"ast":null,"code":"import \"core-js/modules/es.array.includes.js\";\n\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport { _ as t } from \"../../../chunks/tslib.es6.js\";\nimport \"../../../geometry.js\";\nimport s from \"../../../core/Error.js\";\nimport has from \"../../../core/has.js\";\nimport { unwrap as e } from \"../../../core/maybe.js\";\nimport { eachAlways as r, createAbortError as a } from \"../../../core/promiseUtils.js\";\nimport { property as o } from \"../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../core/arrayUtils.js\";\nimport \"../../../core/accessorSupport/ensureType.js\";\nimport { subclass as i } from \"../../../core/accessorSupport/decorators/subclass.js\";\nimport n from \"./BaseRaster.js\";\nimport m from \"./InMemoryRaster.js\";\nimport { parsePAMInfo as l } from \"./pamParser.js\";\nimport { getFormat as p } from \"../rasterFormats/RasterCodec.js\";\nimport { estimateStatisticsFromHistograms as c } from \"../rasterFunctions/stretchUtils.js\";\nimport f from \"../rasterTransforms/PolynomialTransform.js\";\nimport u from \"../../../geometry/SpatialReference.js\";\nimport h from \"../../../geometry/Extent.js\";\nlet d = class extends n {\n  async open(t) {\n    await this.init();\n    const s = await this._fetchData(t);\n    let {\n      spatialReference: e,\n      statistics: r,\n      histograms: a,\n      transform: o\n    } = await this._fetchAuxiliaryData(t);\n    const i = !e;\n    i && (e = new u({\n      wkid: 3857\n    })), a?.length && null == r && (r = c(a));\n    const {\n      width: n,\n      height: l\n    } = s;\n    let p = new h({\n      xmin: -.5,\n      ymin: .5 - l,\n      xmax: n - .5,\n      ymax: .5,\n      spatialReference: e\n    });\n    const f = o ? o.forwardTransform(p) : p;\n    let d = !0;\n\n    if (o) {\n      const t = o.forwardCoefficients;\n      d = t && 0 === t[1] && 0 === t[2], d && (o = null, p = f);\n    }\n\n    const y = new m({\n      data: {\n        extent: f,\n        nativeExtent: p,\n        transform: o,\n        pixelBlock: s,\n        statistics: r,\n        histograms: a,\n        keyProperties: {\n          DateType: \"Processed\"\n        },\n        isPseudoSpatialReference: i\n      }\n    });\n    await y.open(), y.data = null, this._set(\"rasterInfo\", y.rasterInfo), this._inMemoryRaster = y;\n  }\n\n  fetchRawTile(t, s, e, r = {}) {\n    return this._inMemoryRaster.fetchRawTile(t, s, e, r);\n  }\n\n  async _fetchData(t) {\n    const {\n      data: e\n    } = await this.request(this.url, {\n      responseType: \"array-buffer\",\n      signal: t?.signal\n    }),\n          r = p(e).toUpperCase();\n    if (\"JPG\" !== r && \"PNG\" !== r && \"GIF\" !== r && \"BMP\" !== r) throw new s(\"image-aux-raster:open\", \"the data is not a supported format\");\n\n    this._set(\"datasetFormat\", r);\n\n    const a = r.toLowerCase(),\n          o = \"gif\" === a || \"bmp\" === a || !has(\"ios\");\n    return await this.decodePixelBlock(e, {\n      format: a,\n      useCanvas: o,\n      hasNoZlibMask: !0\n    });\n  }\n\n  async _fetchAuxiliaryData(t) {\n    const s = e(t?.signal),\n          o = this.ioConfig.skipExtensions ?? [],\n          i = o.includes(\"aux.xml\") ? null : this.request(this.url + \".aux.xml\", {\n      responseType: \"xml\",\n      signal: s\n    }),\n          n = this.datasetFormat,\n          m = \"JPG\" === n ? \"jgw\" : \"PNG\" === n ? \"pgw\" : \"BMP\" === n ? \"bpw\" : null,\n          p = m && o.includes(m) ? null : this.request(this.url.slice(0, this.url.lastIndexOf(\".\")) + \".\" + m, {\n      responseType: \"text\",\n      signal: s\n    }),\n          c = await r([i, p]);\n    if (s?.aborted) throw a();\n    const u = l(c[0].value?.data);\n\n    if (!u.transform) {\n      const t = c[1].value ? c[1].value.data.split(\"\\n\").slice(0, 6).map(t => Number(t)) : null;\n      u.transform = 6 === t?.length ? new f({\n        forwardCoefficients: [t[4], t[5], t[0], -t[1], t[2], -t[3]]\n      }) : null;\n    }\n\n    return u;\n  }\n\n};\nt([o({\n  type: String,\n  json: {\n    write: !0\n  }\n})], d.prototype, \"datasetFormat\", void 0), d = t([i(\"esri.layers.support.rasterDatasets.ImageAuxRaster\")], d);\nconst y = d;\nexport { y as default };","map":{"version":3,"names":["_","t","s","has","unwrap","e","eachAlways","r","createAbortError","a","property","o","subclass","i","n","m","parsePAMInfo","l","getFormat","p","estimateStatisticsFromHistograms","c","f","u","h","d","open","init","_fetchData","spatialReference","statistics","histograms","transform","_fetchAuxiliaryData","wkid","length","width","height","xmin","ymin","xmax","ymax","forwardTransform","forwardCoefficients","y","data","extent","nativeExtent","pixelBlock","keyProperties","DateType","isPseudoSpatialReference","_set","rasterInfo","_inMemoryRaster","fetchRawTile","request","url","responseType","signal","toUpperCase","toLowerCase","decodePixelBlock","format","useCanvas","hasNoZlibMask","ioConfig","skipExtensions","includes","datasetFormat","slice","lastIndexOf","aborted","value","split","map","Number","type","String","json","write","prototype","default"],"sources":["E:/各个学科/论文/毕业论文/Atmosphere/eco-friendly/node_modules/@arcgis/core/layers/support/rasterDatasets/ImageAuxRaster.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../../chunks/tslib.es6.js\";import\"../../../geometry.js\";import s from\"../../../core/Error.js\";import has from\"../../../core/has.js\";import{unwrap as e}from\"../../../core/maybe.js\";import{eachAlways as r,createAbortError as a}from\"../../../core/promiseUtils.js\";import{property as o}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/arrayUtils.js\";import\"../../../core/accessorSupport/ensureType.js\";import{subclass as i}from\"../../../core/accessorSupport/decorators/subclass.js\";import n from\"./BaseRaster.js\";import m from\"./InMemoryRaster.js\";import{parsePAMInfo as l}from\"./pamParser.js\";import{getFormat as p}from\"../rasterFormats/RasterCodec.js\";import{estimateStatisticsFromHistograms as c}from\"../rasterFunctions/stretchUtils.js\";import f from\"../rasterTransforms/PolynomialTransform.js\";import u from\"../../../geometry/SpatialReference.js\";import h from\"../../../geometry/Extent.js\";let d=class extends n{async open(t){await this.init();const s=await this._fetchData(t);let{spatialReference:e,statistics:r,histograms:a,transform:o}=await this._fetchAuxiliaryData(t);const i=!e;i&&(e=new u({wkid:3857})),a?.length&&null==r&&(r=c(a));const{width:n,height:l}=s;let p=new h({xmin:-.5,ymin:.5-l,xmax:n-.5,ymax:.5,spatialReference:e});const f=o?o.forwardTransform(p):p;let d=!0;if(o){const t=o.forwardCoefficients;d=t&&0===t[1]&&0===t[2],d&&(o=null,p=f)}const y=new m({data:{extent:f,nativeExtent:p,transform:o,pixelBlock:s,statistics:r,histograms:a,keyProperties:{DateType:\"Processed\"},isPseudoSpatialReference:i}});await y.open(),y.data=null,this._set(\"rasterInfo\",y.rasterInfo),this._inMemoryRaster=y}fetchRawTile(t,s,e,r={}){return this._inMemoryRaster.fetchRawTile(t,s,e,r)}async _fetchData(t){const{data:e}=await this.request(this.url,{responseType:\"array-buffer\",signal:t?.signal}),r=p(e).toUpperCase();if(\"JPG\"!==r&&\"PNG\"!==r&&\"GIF\"!==r&&\"BMP\"!==r)throw new s(\"image-aux-raster:open\",\"the data is not a supported format\");this._set(\"datasetFormat\",r);const a=r.toLowerCase(),o=\"gif\"===a||\"bmp\"===a||!has(\"ios\");return await this.decodePixelBlock(e,{format:a,useCanvas:o,hasNoZlibMask:!0})}async _fetchAuxiliaryData(t){const s=e(t?.signal),o=this.ioConfig.skipExtensions??[],i=o.includes(\"aux.xml\")?null:this.request(this.url+\".aux.xml\",{responseType:\"xml\",signal:s}),n=this.datasetFormat,m=\"JPG\"===n?\"jgw\":\"PNG\"===n?\"pgw\":\"BMP\"===n?\"bpw\":null,p=m&&o.includes(m)?null:this.request(this.url.slice(0,this.url.lastIndexOf(\".\"))+\".\"+m,{responseType:\"text\",signal:s}),c=await r([i,p]);if(s?.aborted)throw a();const u=l(c[0].value?.data);if(!u.transform){const t=c[1].value?c[1].value.data.split(\"\\n\").slice(0,6).map((t=>Number(t))):null;u.transform=6===t?.length?new f({forwardCoefficients:[t[4],t[5],t[0],-t[1],t[2],-t[3]]}):null}return u}};t([o({type:String,json:{write:!0}})],d.prototype,\"datasetFormat\",void 0),d=t([i(\"esri.layers.support.rasterDatasets.ImageAuxRaster\")],d);const y=d;export{y as default};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}