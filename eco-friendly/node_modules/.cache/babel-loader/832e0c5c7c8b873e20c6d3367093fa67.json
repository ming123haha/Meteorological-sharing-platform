{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport { W as e } from \"../../../chunks/languageUtils.js\";\nimport { FeatureSetError as t, FeatureSetErrorCodes as r } from \"../support/errorsupport.js\";\nimport n from \"../support/FeatureSet.js\";\nimport s from \"../support/IdSet.js\";\nimport i from \"../support/OrderbyClause.js\";\n\nclass a extends n {\n  constructor(e) {\n    super(e), this._orderbyclause = null, this.declaredClass = \"esri.arcade.featureset.actions.OrderBy\", this._maxProcessing = 100, this._orderbyclause = e.orderbyclause, this._parent = e.parentfeatureset;\n  }\n\n  async _getSet(e) {\n    if (null === this._wset) {\n      await this._ensureLoaded();\n      const t = await this._getFilteredSet(\"\", null, null, this._orderbyclause, e);\n      return this._checkCancelled(e), this._wset = t, this._wset;\n    }\n\n    return this._wset;\n  }\n\n  async manualOrderSet(e, t) {\n    const r = await this.getIdColumnDictionary(e, [], -1, t);\n    this._orderbyclause?.order(r);\n    const n = new s([], [], !0, null);\n\n    for (let s = 0; s < r.length; s++) n._known.push(r[s].id);\n\n    return n;\n  }\n\n  async getIdColumnDictionary(t, r, n, s) {\n    if (n < t._known.length - 1) {\n      const i = this._maxQueryRate();\n\n      if (\"GETPAGES\" === t._known[n + 1]) return await e(this._parent._expandPagedSet(t, i, 0, 0, s)), this.getIdColumnDictionary(t, r, n, s);\n      let a = n + 1;\n      const o = [];\n\n      for (; a < t._known.length && \"GETPAGES\" !== t._known[a];) o.push(t._known[a]), a++;\n\n      n += o.length;\n      const u = await e(this._parent._getFeatureBatch(o, s));\n\n      this._checkCancelled(s);\n\n      for (const e of u) r.push({\n        id: e.attributes[this.objectIdField],\n        feature: e\n      });\n\n      return this.getIdColumnDictionary(t, r, n, s);\n    }\n\n    return t._candidates.length > 0 ? (await e(this._refineSetBlock(t, this._maxProcessingRate(), s)), this._checkCancelled(s), this.getIdColumnDictionary(t, r, n, s)) : r;\n  }\n\n  _isInFeatureSet(e) {\n    return this._parent._isInFeatureSet(e);\n  }\n\n  _getFeatures(e, t, r, n) {\n    return this._parent._getFeatures(e, t, r, n);\n  }\n\n  _featureFromCache(e) {\n    if (void 0 === this._featureCache[e]) {\n      const t = this._parent._featureFromCache(e);\n\n      if (void 0 === t) return;\n      return null === t ? null : (this._featureCache[e] = t, t);\n    }\n\n    return this._featureCache[e];\n  }\n\n  async _fetchAndRefineFeatures() {\n    throw new t(r.NeverReach);\n  }\n\n  async _getFilteredSet(e, t, r, n, i) {\n    await this._ensureLoaded();\n    const a = await this._parent._getFilteredSet(e, t, r, null === n ? this._orderbyclause : n, i);\n\n    this._checkCancelled(i);\n\n    const o = new s(a._candidates.slice(0), a._known.slice(0), a._ordered, this._clonePageDefinition(a.pagesDefinition));\n    let u = !0;\n\n    if (a._candidates.length > 0 && (u = !1), !1 === o._ordered) {\n      let e = await this.manualOrderSet(o, i);\n      return !1 === u && (null === t && null === r || (e = new s(e._candidates.slice(0).concat(e._known.slice(0)), [], e._ordered, this._clonePageDefinition(e.pagesDefinition)))), e;\n    }\n\n    return o;\n  }\n\n  static registerAction() {\n    n._featuresetFunctions.orderBy = function (e) {\n      return \"\" === e ? this : new a({\n        parentfeatureset: this,\n        orderbyclause: new i(e)\n      });\n    };\n  }\n\n}\n\nexport { a as default };","map":{"version":3,"names":["W","e","FeatureSetError","t","FeatureSetErrorCodes","r","n","s","i","a","constructor","_orderbyclause","declaredClass","_maxProcessing","orderbyclause","_parent","parentfeatureset","_getSet","_wset","_ensureLoaded","_getFilteredSet","_checkCancelled","manualOrderSet","getIdColumnDictionary","order","length","_known","push","id","_maxQueryRate","_expandPagedSet","o","u","_getFeatureBatch","attributes","objectIdField","feature","_candidates","_refineSetBlock","_maxProcessingRate","_isInFeatureSet","_getFeatures","_featureFromCache","_featureCache","_fetchAndRefineFeatures","NeverReach","slice","_ordered","_clonePageDefinition","pagesDefinition","concat","registerAction","_featuresetFunctions","orderBy","default"],"sources":["E:/各个学科/论文/毕业论文/Atmosphere/eco-friendly/node_modules/@arcgis/core/arcade/featureset/actions/OrderBy.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{W as e}from\"../../../chunks/languageUtils.js\";import{FeatureSetError as t,FeatureSetErrorCodes as r}from\"../support/errorsupport.js\";import n from\"../support/FeatureSet.js\";import s from\"../support/IdSet.js\";import i from\"../support/OrderbyClause.js\";class a extends n{constructor(e){super(e),this._orderbyclause=null,this.declaredClass=\"esri.arcade.featureset.actions.OrderBy\",this._maxProcessing=100,this._orderbyclause=e.orderbyclause,this._parent=e.parentfeatureset}async _getSet(e){if(null===this._wset){await this._ensureLoaded();const t=await this._getFilteredSet(\"\",null,null,this._orderbyclause,e);return this._checkCancelled(e),this._wset=t,this._wset}return this._wset}async manualOrderSet(e,t){const r=await this.getIdColumnDictionary(e,[],-1,t);this._orderbyclause?.order(r);const n=new s([],[],!0,null);for(let s=0;s<r.length;s++)n._known.push(r[s].id);return n}async getIdColumnDictionary(t,r,n,s){if(n<t._known.length-1){const i=this._maxQueryRate();if(\"GETPAGES\"===t._known[n+1])return await e(this._parent._expandPagedSet(t,i,0,0,s)),this.getIdColumnDictionary(t,r,n,s);let a=n+1;const o=[];for(;a<t._known.length&&\"GETPAGES\"!==t._known[a];)o.push(t._known[a]),a++;n+=o.length;const u=await e(this._parent._getFeatureBatch(o,s));this._checkCancelled(s);for(const e of u)r.push({id:e.attributes[this.objectIdField],feature:e});return this.getIdColumnDictionary(t,r,n,s)}return t._candidates.length>0?(await e(this._refineSetBlock(t,this._maxProcessingRate(),s)),this._checkCancelled(s),this.getIdColumnDictionary(t,r,n,s)):r}_isInFeatureSet(e){return this._parent._isInFeatureSet(e)}_getFeatures(e,t,r,n){return this._parent._getFeatures(e,t,r,n)}_featureFromCache(e){if(void 0===this._featureCache[e]){const t=this._parent._featureFromCache(e);if(void 0===t)return;return null===t?null:(this._featureCache[e]=t,t)}return this._featureCache[e]}async _fetchAndRefineFeatures(){throw new t(r.NeverReach)}async _getFilteredSet(e,t,r,n,i){await this._ensureLoaded();const a=await this._parent._getFilteredSet(e,t,r,null===n?this._orderbyclause:n,i);this._checkCancelled(i);const o=new s(a._candidates.slice(0),a._known.slice(0),a._ordered,this._clonePageDefinition(a.pagesDefinition));let u=!0;if(a._candidates.length>0&&(u=!1),!1===o._ordered){let e=await this.manualOrderSet(o,i);return!1===u&&(null===t&&null===r||(e=new s(e._candidates.slice(0).concat(e._known.slice(0)),[],e._ordered,this._clonePageDefinition(e.pagesDefinition)))),e}return o}static registerAction(){n._featuresetFunctions.orderBy=function(e){return\"\"===e?this:new a({parentfeatureset:this,orderbyclause:new i(e)})}}}export{a as default};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}