{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../../chunks/tslib.es6.js\";\nimport t from \"../../../../core/Accessor.js\";\nimport r from \"../../../../core/Evented.js\";\nimport s from \"../../../../core/Logger.js\";\nimport { isNone as o, unwrapOr as i, isSome as n } from \"../../../../core/maybe.js\";\nimport { isPromiseLike as u, isAbortError as a } from \"../../../../core/promiseUtils.js\";\nimport { property as h } from \"../../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../../core/arrayUtils.js\";\nimport \"../../../../core/has.js\";\nimport \"../../../../core/accessorSupport/ensureType.js\";\nimport { subclass as c } from \"../../../../core/accessorSupport/decorators/subclass.js\";\nimport { RenderRequestType as p } from \"./basicInterfaces.js\";\nimport { ContentObjectType as d } from \"./ContentObjectType.js\";\nimport { TextureTechnique as m } from \"./TextureTechnique.js\";\nimport { TextureTechniqueConfiguration as l } from \"./TextureTechniqueConfiguration.js\";\nimport { assert as _ } from \"./Util.js\";\nimport { TaskPriority as f } from \"../../../support/Scheduler.js\";\nconst g = s.getLogger(\"esri.views.3d.webgl-engine.lib.TextureRepository\");\nlet T = class extends t {\n  constructor(e, t, s) {\n    super({}), this._stage = e, this._techniqueRepository = t, this._rctx = s, this._textures = new Map(), this._loadingCount = 0, this._frameUpdates = new Map(), this.events = new r(), this._frameTask = e.resourceController.scheduler.registerTask(f.TEXTURE_UNLOAD);\n  }\n\n  normalizeCtorArgs() {\n    return {};\n  }\n\n  dispose() {\n    this._frameTask.remove(), this._stage.forEachOfType(d.Texture, e => e.unload());\n  }\n\n  get updating() {\n    return this._loadingCount > 0 || this._frameTask.updating;\n  }\n\n  get textureTechnique() {\n    return o(this._textureTechnique) && (this._textureTechnique = this._techniqueRepository.acquire(m, new l())), this._textureTechnique;\n  }\n\n  acquire(e) {\n    const t = this._textures.get(e);\n\n    return t ? (t.ref(), i(t.loadingPromise, t)) : this._createNewRef(e);\n  }\n\n  update() {\n    let e = !1;\n    this._frameUpdates.forEach(t => {\n      const r = t.texture.frameUpdate(this._rctx, this.textureTechnique, t.previousToken);\n      r >= 0 && r !== t.previousToken && (t.previousToken = r, e = !0);\n    }), e && this.events.emit(\"changed\", p.BACKGROUND);\n  }\n\n  _createNewRef(e) {\n    const t = this._stage.getObject(e);\n\n    if (o(t)) return _(void 0 !== t), null;\n    const r = t.events.on(\"unloaded\", () => {\n      r.remove(), this._onTextureUnloaded(e);\n    }),\n          s = new x(e, () => {\n      this._frameTask.schedule(() => {\n        s.isUnreferenced && t.unload();\n      });\n    });\n    return this._textures.set(e, s), s.ref(), n(t.glTexture) ? (this._updateGLTexture(s, t.glTexture), t.requiresFrameUpdates && this._frameUpdates.set(e, {\n      texture: t,\n      previousToken: -1\n    }), s) : (this._loadingCount++, s.loadingPromise = this._stage.schedule(() => {\n      const r = t.load(this._rctx, () => this.textureTechnique),\n            o = r => (this._loadingCount--, s.loadingPromise = null, this._updateGLTexture(s, r), t.requiresFrameUpdates && this._frameUpdates.set(e, {\n        texture: t,\n        previousToken: -1\n      }), s),\n            i = e => (this._loadingCount--, s.loadingPromise = null, a(e) || g.error(e), null);\n\n      return u(r) ? r.then(o, i) : o(r);\n    }), s.loadingPromise);\n  }\n\n  _updateGLTexture(e, t) {\n    e.glTexture = t, this.events.emit(\"changed\", p.UPDATE);\n  }\n\n  _onTextureUnloaded(e) {\n    this._textures.delete(e), this._frameUpdates.delete(e);\n  }\n\n};\ne([h()], T.prototype, \"_loadingCount\", void 0), e([h()], T.prototype, \"_frameTask\", void 0), e([h()], T.prototype, \"updating\", null), T = e([c(\"esri.views.3d.webgl-engine.lib.TextureRepository\")], T);\n\nclass x {\n  constructor(e, t) {\n    this.id = e, this._release = t, this._refCount = 0;\n  }\n\n  get isUnreferenced() {\n    return 0 === this._refCount;\n  }\n\n  ref() {\n    ++this._refCount;\n  }\n\n  release() {\n    --this._refCount, this._refCount > 0 || (0 !== this._refCount ? (g.error(\"Cannot dereference texture that has no references!\"), this._refCount = 0) : this._release());\n  }\n\n}\n\nexport { T as TextureRepository };","map":{"version":3,"names":["_","e","t","r","s","isNone","o","unwrapOr","i","isSome","n","isPromiseLike","u","isAbortError","a","property","h","subclass","c","RenderRequestType","p","ContentObjectType","d","TextureTechnique","m","TextureTechniqueConfiguration","l","assert","TaskPriority","f","g","getLogger","T","constructor","_stage","_techniqueRepository","_rctx","_textures","Map","_loadingCount","_frameUpdates","events","_frameTask","resourceController","scheduler","registerTask","TEXTURE_UNLOAD","normalizeCtorArgs","dispose","remove","forEachOfType","Texture","unload","updating","textureTechnique","_textureTechnique","acquire","get","ref","loadingPromise","_createNewRef","update","forEach","texture","frameUpdate","previousToken","emit","BACKGROUND","getObject","on","_onTextureUnloaded","x","schedule","isUnreferenced","set","glTexture","_updateGLTexture","requiresFrameUpdates","load","error","then","UPDATE","delete","prototype","id","_release","_refCount","release","TextureRepository"],"sources":["C:/Users/hp/Desktop/eco-friendly atmosphere/Atmosphere/eco-friendly/node_modules/@arcgis/core/views/3d/webgl-engine/lib/TextureRepository.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import t from\"../../../../core/Accessor.js\";import r from\"../../../../core/Evented.js\";import s from\"../../../../core/Logger.js\";import{isNone as o,unwrapOr as i,isSome as n}from\"../../../../core/maybe.js\";import{isPromiseLike as u,isAbortError as a}from\"../../../../core/promiseUtils.js\";import{property as h}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/arrayUtils.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import{subclass as c}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{RenderRequestType as p}from\"./basicInterfaces.js\";import{ContentObjectType as d}from\"./ContentObjectType.js\";import{TextureTechnique as m}from\"./TextureTechnique.js\";import{TextureTechniqueConfiguration as l}from\"./TextureTechniqueConfiguration.js\";import{assert as _}from\"./Util.js\";import{TaskPriority as f}from\"../../../support/Scheduler.js\";const g=s.getLogger(\"esri.views.3d.webgl-engine.lib.TextureRepository\");let T=class extends t{constructor(e,t,s){super({}),this._stage=e,this._techniqueRepository=t,this._rctx=s,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new r,this._frameTask=e.resourceController.scheduler.registerTask(f.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}dispose(){this._frameTask.remove(),this._stage.forEachOfType(d.Texture,(e=>e.unload()))}get updating(){return this._loadingCount>0||this._frameTask.updating}get textureTechnique(){return o(this._textureTechnique)&&(this._textureTechnique=this._techniqueRepository.acquire(m,new l)),this._textureTechnique}acquire(e){const t=this._textures.get(e);return t?(t.ref(),i(t.loadingPromise,t)):this._createNewRef(e)}update(){let e=!1;this._frameUpdates.forEach((t=>{const r=t.texture.frameUpdate(this._rctx,this.textureTechnique,t.previousToken);r>=0&&r!==t.previousToken&&(t.previousToken=r,e=!0)})),e&&this.events.emit(\"changed\",p.BACKGROUND)}_createNewRef(e){const t=this._stage.getObject(e);if(o(t))return _(void 0!==t),null;const r=t.events.on(\"unloaded\",(()=>{r.remove(),this._onTextureUnloaded(e)})),s=new x(e,(()=>{this._frameTask.schedule((()=>{s.isUnreferenced&&t.unload()}))}));return this._textures.set(e,s),s.ref(),n(t.glTexture)?(this._updateGLTexture(s,t.glTexture),t.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:t,previousToken:-1}),s):(this._loadingCount++,s.loadingPromise=this._stage.schedule((()=>{const r=t.load(this._rctx,(()=>this.textureTechnique)),o=r=>(this._loadingCount--,s.loadingPromise=null,this._updateGLTexture(s,r),t.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:t,previousToken:-1}),s),i=e=>(this._loadingCount--,s.loadingPromise=null,a(e)||g.error(e),null);return u(r)?r.then(o,i):o(r)})),s.loadingPromise)}_updateGLTexture(e,t){e.glTexture=t,this.events.emit(\"changed\",p.UPDATE)}_onTextureUnloaded(e){this._textures.delete(e),this._frameUpdates.delete(e)}};e([h()],T.prototype,\"_loadingCount\",void 0),e([h()],T.prototype,\"_frameTask\",void 0),e([h()],T.prototype,\"updating\",null),T=e([c(\"esri.views.3d.webgl-engine.lib.TextureRepository\")],T);class x{constructor(e,t){this.id=e,this._release=t,this._refCount=0}get isUnreferenced(){return 0===this._refCount}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(0!==this._refCount?(g.error(\"Cannot dereference texture that has no references!\"),this._refCount=0):this._release())}}export{T as TextureRepository};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}