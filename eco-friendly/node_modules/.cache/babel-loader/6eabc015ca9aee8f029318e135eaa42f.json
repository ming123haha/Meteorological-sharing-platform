{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport { isSome as e, isNone as t } from \"../../../../core/maybe.js\";\nimport { ViewingMode as r } from \"../../../ViewingMode.js\";\nimport { isValidObb as i, isValidMbs as s } from \"./I3SUtil.js\";\nimport { intersectLine as n } from \"../../support/orientedBoundingBox.js\";\nimport { newIntersectorResult as o } from \"../../webgl-engine/lib/Intersector.js\";\nimport { IntersectorType as l, StoreResults as d } from \"../../webgl-engine/lib/IntersectorInterfaces.js\";\nimport { getVerticalOffsetI3S as a } from \"../../webgl-engine/lib/verticalOffsetUtils.js\";\n\nclass c {\n  constructor(e) {\n    this.type = l.I3S, this._needVerticalOffset = !1, this.layerUid = e.layerUid, this.sublayerUid = e.sublayerUid, this.collection = e.collection, this.traverseNodeHierarchy = e.traverseNodeHierarchy, this.slicePlaneEnabled = e.slicePlaneEnabled, this.isGround = e.isGround;\n  }\n\n  updateElevationAlignState(e, t) {\n    this._needVerticalOffset = e && t === r.Global;\n  }\n\n  intersect(r, l, c, u) {\n    const f = r.results,\n          m = r.options.store === d.ALL,\n          h = r.ray.direction,\n          p = r.tolerance;\n\n    let y = e => e,\n        g = e => e;\n\n    const O = a(e(r.verticalOffset) ? r.verticalOffset : this._needVerticalOffset ? 0 : null);\n    e(r.verticalOffset) && e(O) && (y = e => O.applyToMbs(e), g = e => O.applyToObb(e)), this.traverseNodeHierarchy((d, a) => {\n      if (0 === d.childrenLoaded) return !1;\n      const v = e(d.serviceObbInRenderSR) && i(d.serviceObbInRenderSR) ? d.serviceObbInRenderSR : null;\n      return !(e(v) && !n(g(v), c, h, p)) && (a && (e(v) || !s(d.renderMbs) || b(y(d.renderMbs), c, h, p)) && (t(d.geometryObb) || n(g(d.geometryObb), c, h, p)) && this.collection.intersect(a, c, u, p, O, (e, t, i, s) => {\n        if (t >= 0) {\n          if (null != l && !l(c, u, t)) return;\n\n          const n = r => {\n            const n = {\n              layerUid: this.layerUid,\n              sublayerUid: this.sublayerUid,\n              nodeIndex: d.index,\n              componentIndex: e,\n              triangleNr: s\n            };\n            r.set(this.type, n, t, i);\n          };\n\n          if (this.isGround && (null == f.ground.dist || t < f.ground.dist) && n(f.ground), r.options.isFiltered) return;\n\n          if ((null == f.min.dist || t < f.min.dist) && n(f.min), (null == f.max.dist || t > f.max.dist) && n(f.max), m) {\n            const e = o(r.ray);\n            n(e), r.results.all.push(e);\n          }\n        }\n      }), !0);\n    });\n  }\n\n}\n\nfunction b(e, t, r, i = 0) {\n  const s = e[3] + i,\n        n = t[0] - e[0],\n        o = t[1] - e[1],\n        l = t[2] - e[2],\n        d = r[0],\n        a = r[1],\n        c = r[2],\n        b = d * n + a * o + c * l;\n  return b * b - (d * d + a * a + c * c) * (n * n + o * o + l * l - s * s) >= 0;\n}\n\nexport { c as I3SIntersectionHandler };","map":{"version":3,"names":["isSome","e","isNone","t","ViewingMode","r","isValidObb","i","isValidMbs","s","intersectLine","n","newIntersectorResult","o","IntersectorType","l","StoreResults","d","getVerticalOffsetI3S","a","c","constructor","type","I3S","_needVerticalOffset","layerUid","sublayerUid","collection","traverseNodeHierarchy","slicePlaneEnabled","isGround","updateElevationAlignState","Global","intersect","u","f","results","m","options","store","ALL","h","ray","direction","p","tolerance","y","g","O","verticalOffset","applyToMbs","applyToObb","childrenLoaded","v","serviceObbInRenderSR","renderMbs","b","geometryObb","nodeIndex","index","componentIndex","triangleNr","set","ground","dist","isFiltered","min","max","all","push","I3SIntersectionHandler"],"sources":["C:/Users/hp/Desktop/eco-friendly atmosphere/Atmosphere/eco-friendly/node_modules/@arcgis/core/views/3d/layers/i3s/I3SIntersectionHandler.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport{isSome as e,isNone as t}from\"../../../../core/maybe.js\";import{ViewingMode as r}from\"../../../ViewingMode.js\";import{isValidObb as i,isValidMbs as s}from\"./I3SUtil.js\";import{intersectLine as n}from\"../../support/orientedBoundingBox.js\";import{newIntersectorResult as o}from\"../../webgl-engine/lib/Intersector.js\";import{IntersectorType as l,StoreResults as d}from\"../../webgl-engine/lib/IntersectorInterfaces.js\";import{getVerticalOffsetI3S as a}from\"../../webgl-engine/lib/verticalOffsetUtils.js\";class c{constructor(e){this.type=l.I3S,this._needVerticalOffset=!1,this.layerUid=e.layerUid,this.sublayerUid=e.sublayerUid,this.collection=e.collection,this.traverseNodeHierarchy=e.traverseNodeHierarchy,this.slicePlaneEnabled=e.slicePlaneEnabled,this.isGround=e.isGround}updateElevationAlignState(e,t){this._needVerticalOffset=e&&t===r.Global}intersect(r,l,c,u){const f=r.results,m=r.options.store===d.ALL,h=r.ray.direction,p=r.tolerance;let y=e=>e,g=e=>e;const O=a(e(r.verticalOffset)?r.verticalOffset:this._needVerticalOffset?0:null);e(r.verticalOffset)&&e(O)&&(y=e=>O.applyToMbs(e),g=e=>O.applyToObb(e)),this.traverseNodeHierarchy(((d,a)=>{if(0===d.childrenLoaded)return!1;const v=e(d.serviceObbInRenderSR)&&i(d.serviceObbInRenderSR)?d.serviceObbInRenderSR:null;return!(e(v)&&!n(g(v),c,h,p))&&(a&&(e(v)||!s(d.renderMbs)||b(y(d.renderMbs),c,h,p))&&(t(d.geometryObb)||n(g(d.geometryObb),c,h,p))&&this.collection.intersect(a,c,u,p,O,((e,t,i,s)=>{if(t>=0){if(null!=l&&!l(c,u,t))return;const n=r=>{const n={layerUid:this.layerUid,sublayerUid:this.sublayerUid,nodeIndex:d.index,componentIndex:e,triangleNr:s};r.set(this.type,n,t,i)};if(this.isGround&&(null==f.ground.dist||t<f.ground.dist)&&n(f.ground),r.options.isFiltered)return;if((null==f.min.dist||t<f.min.dist)&&n(f.min),(null==f.max.dist||t>f.max.dist)&&n(f.max),m){const e=o(r.ray);n(e),r.results.all.push(e)}}})),!0)}))}}function b(e,t,r,i=0){const s=e[3]+i,n=t[0]-e[0],o=t[1]-e[1],l=t[2]-e[2],d=r[0],a=r[1],c=r[2],b=d*n+a*o+c*l;return b*b-(d*d+a*a+c*c)*(n*n+o*o+l*l-s*s)>=0}export{c as I3SIntersectionHandler};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}