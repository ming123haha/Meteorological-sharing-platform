{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../chunks/tslib.es6.js\";\nimport t from \"../../../core/Accessor.js\";\nimport r from \"../../../core/Handles.js\";\nimport { destroyMaybe as s, removeMaybe as a } from \"../../../core/maybe.js\";\nimport { watch as o, sync as i } from \"../../../core/reactiveUtils.js\";\nimport { addFrameTask as h } from \"../../../core/scheduling.js\";\nimport { secondsFromMilliseconds as l } from \"../../../core/time.js\";\nimport { property as n } from \"../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../core/arrayUtils.js\";\nimport \"../../../core/has.js\";\nimport \"../../../core/accessorSupport/ensureType.js\";\nimport { subclass as m } from \"../../../core/accessorSupport/decorators/subclass.js\";\nimport { maxDownloadSlots as d, downloadSlotsPerClient as u } from \"./index.js\";\nimport { newMemoryController as c } from \"./MemoryController.js\";\nimport { StreamDataLoader as _ } from \"./StreamDataLoader.js\";\nimport { ImmediateTask as p, State as y, newScheduler as g, TaskPriority as C } from \"../../support/Scheduler.js\";\nlet T = class extends t {\n  constructor() {\n    super(...arguments), this.updating = !1;\n  }\n\n};\n\nfunction f(e) {\n  return new v.ResourceController({\n    view: e\n  });\n}\n\nvar v;\ne([n({\n  readOnly: !0\n})], T.prototype, \"updating\", void 0), T = e([m(\"esri.views.3d.support.ResourceController\")], T), function (t) {\n  let f = class extends T {\n    constructor() {\n      super(...arguments), this._scheduler = null, this._memoryController = null, this._streamDataLoader = null, this._scheduleTask = p, this._cameraChangeTime = 0, this._handles = new r(), this._frameTask = null, this._state = y.IDLE;\n    }\n\n    initialize() {\n      this._cameraChangeTime = performance.now(), this._scheduler = g(), this._memoryController = c(this.view), this._streamDataLoader = new _(), this._streamDataLoader.setup(d, u, this._scheduler), this._handles.add([o(() => this.view.state?.camera, (e, t) => this._cameraChangedHandler(e, t), i), o(() => this.view.stationary, () => this._stationaryChangedHandler())]), this._frameTask = h({\n        update: e => this._frame(e)\n      }), this._scheduleTask = this._scheduler.registerTask(C.RESOURCE_CONTROLLER);\n    }\n\n    destroy() {\n      this._handles = s(this._handles), this._scheduleTask.remove(), this._frameTask = a(this._frameTask), this._streamDataLoader = s(this._streamDataLoader), this._memoryController = s(this._memoryController), this._scheduler = s(this._scheduler);\n    }\n\n    get updating() {\n      return !!(this._memoryController?.updating || this._streamDataLoader?.updating || this._scheduleTask?.updating);\n    }\n\n    get scheduler() {\n      return this._scheduler;\n    }\n\n    get memoryController() {\n      return this._memoryController;\n    }\n\n    schedule(e, t, r) {\n      return this._scheduleTask.schedule(e, t, r);\n    }\n\n    createStreamDataRequester(e) {\n      const t = this._streamDataLoader;\n      return {\n        request: (r, s, a) => t.request(r, s, e, a),\n\n        get busy() {\n          return !t.hasDownloadSlots(e);\n        }\n\n      };\n    }\n\n    _frame(e) {\n      this.view.suspended || this.view.stateManager && (this.view.stateManager.step(l(e.deltaTime)), !this._scheduler) || (this._updateState(), this._scheduler.state = this._state, this._scheduler.updateBudget(e) ? (this._memoryController.update(), this._scheduler.frame()) : this._memoryController.updating && this._memoryController.update());\n    }\n\n    _cameraChangedHandler(e, t) {\n      e && t && e.almostEquals(t) || (this._cameraChangeTime = performance.now(), this._updateState(), this._scheduler.state = this._state);\n    }\n\n    _stationaryChangedHandler() {\n      this.memoryController.resetStableQuality();\n    }\n\n    _updateState() {\n      this.view.animation ? this._state = y.ANIMATING : this.view.interacting ? this._state = y.INTERACTING : (this._state === y.ANIMATING && (this._cameraChangeTime = 0), performance.now() - this._cameraChangeTime <= v ? this._state = y.INTERACTING : this._state = y.IDLE);\n    }\n\n    get test() {\n      return {\n        getQueueStats: e => this._streamDataLoader.test.loadQueue.getStatsForType(e),\n        state: this._state\n      };\n    }\n\n  };\n  e([n({\n    constructOnly: !0\n  })], f.prototype, \"view\", void 0), e([n()], f.prototype, \"_scheduler\", void 0), e([n()], f.prototype, \"_memoryController\", void 0), e([n()], f.prototype, \"_streamDataLoader\", void 0), e([n()], f.prototype, \"_scheduleTask\", void 0), e([n({\n    readOnly: !0\n  })], f.prototype, \"updating\", null), f = e([m(\"esri.views.3d.support.ResourceController\")], f), t.ResourceController = f;\n  const v = 300;\n}(v || (v = {}));\nexport { T as ResourceControllerMain, f as newResourceController };","map":{"version":3,"names":["_","e","t","r","destroyMaybe","s","removeMaybe","a","watch","o","sync","i","addFrameTask","h","secondsFromMilliseconds","l","property","n","subclass","m","maxDownloadSlots","d","downloadSlotsPerClient","u","newMemoryController","c","StreamDataLoader","ImmediateTask","p","State","y","newScheduler","g","TaskPriority","C","T","constructor","arguments","updating","f","v","ResourceController","view","readOnly","prototype","_scheduler","_memoryController","_streamDataLoader","_scheduleTask","_cameraChangeTime","_handles","_frameTask","_state","IDLE","initialize","performance","now","setup","add","state","camera","_cameraChangedHandler","stationary","_stationaryChangedHandler","update","_frame","registerTask","RESOURCE_CONTROLLER","destroy","remove","scheduler","memoryController","schedule","createStreamDataRequester","request","busy","hasDownloadSlots","suspended","stateManager","step","deltaTime","_updateState","updateBudget","frame","almostEquals","resetStableQuality","animation","ANIMATING","interacting","INTERACTING","test","getQueueStats","loadQueue","getStatsForType","constructOnly","ResourceControllerMain","newResourceController"],"sources":["C:/Users/hp/Desktop/eco-friendly atmosphere/Atmosphere/eco-friendly/node_modules/@arcgis/core/views/3d/support/ResourceController.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import t from\"../../../core/Accessor.js\";import r from\"../../../core/Handles.js\";import{destroyMaybe as s,removeMaybe as a}from\"../../../core/maybe.js\";import{watch as o,sync as i}from\"../../../core/reactiveUtils.js\";import{addFrameTask as h}from\"../../../core/scheduling.js\";import{secondsFromMilliseconds as l}from\"../../../core/time.js\";import{property as n}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/arrayUtils.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import{subclass as m}from\"../../../core/accessorSupport/decorators/subclass.js\";import{maxDownloadSlots as d,downloadSlotsPerClient as u}from\"./index.js\";import{newMemoryController as c}from\"./MemoryController.js\";import{StreamDataLoader as _}from\"./StreamDataLoader.js\";import{ImmediateTask as p,State as y,newScheduler as g,TaskPriority as C}from\"../../support/Scheduler.js\";let T=class extends t{constructor(){super(...arguments),this.updating=!1}};function f(e){return new v.ResourceController({view:e})}var v;e([n({readOnly:!0})],T.prototype,\"updating\",void 0),T=e([m(\"esri.views.3d.support.ResourceController\")],T),function(t){let f=class extends T{constructor(){super(...arguments),this._scheduler=null,this._memoryController=null,this._streamDataLoader=null,this._scheduleTask=p,this._cameraChangeTime=0,this._handles=new r,this._frameTask=null,this._state=y.IDLE}initialize(){this._cameraChangeTime=performance.now(),this._scheduler=g(),this._memoryController=c(this.view),this._streamDataLoader=new _,this._streamDataLoader.setup(d,u,this._scheduler),this._handles.add([o((()=>this.view.state?.camera),((e,t)=>this._cameraChangedHandler(e,t)),i),o((()=>this.view.stationary),(()=>this._stationaryChangedHandler()))]),this._frameTask=h({update:e=>this._frame(e)}),this._scheduleTask=this._scheduler.registerTask(C.RESOURCE_CONTROLLER)}destroy(){this._handles=s(this._handles),this._scheduleTask.remove(),this._frameTask=a(this._frameTask),this._streamDataLoader=s(this._streamDataLoader),this._memoryController=s(this._memoryController),this._scheduler=s(this._scheduler)}get updating(){return!!(this._memoryController?.updating||this._streamDataLoader?.updating||this._scheduleTask?.updating)}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}schedule(e,t,r){return this._scheduleTask.schedule(e,t,r)}createStreamDataRequester(e){const t=this._streamDataLoader;return{request:(r,s,a)=>t.request(r,s,e,a),get busy(){return!t.hasDownloadSlots(e)}}}_frame(e){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(l(e.deltaTime)),!this._scheduler)||(this._updateState(),this._scheduler.state=this._state,this._scheduler.updateBudget(e)?(this._memoryController.update(),this._scheduler.frame()):this._memoryController.updating&&this._memoryController.update())}_cameraChangedHandler(e,t){e&&t&&e.almostEquals(t)||(this._cameraChangeTime=performance.now(),this._updateState(),this._scheduler.state=this._state)}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}_updateState(){this.view.animation?this._state=y.ANIMATING:this.view.interacting?this._state=y.INTERACTING:(this._state===y.ANIMATING&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<=v?this._state=y.INTERACTING:this._state=y.IDLE)}get test(){return{getQueueStats:e=>this._streamDataLoader.test.loadQueue.getStatsForType(e),state:this._state}}};e([n({constructOnly:!0})],f.prototype,\"view\",void 0),e([n()],f.prototype,\"_scheduler\",void 0),e([n()],f.prototype,\"_memoryController\",void 0),e([n()],f.prototype,\"_streamDataLoader\",void 0),e([n()],f.prototype,\"_scheduleTask\",void 0),e([n({readOnly:!0})],f.prototype,\"updating\",null),f=e([m(\"esri.views.3d.support.ResourceController\")],f),t.ResourceController=f;const v=300}(v||(v={}));export{T as ResourceControllerMain,f as newResourceController};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}