{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport { i as e } from \"./vec3.js\";\nimport { ScreenSpacePass as r } from \"../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.js\";\nimport { ReadLinearDepth as o } from \"../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl.js\";\nimport { Float2DrawUniform as t } from \"../views/3d/webgl-engine/core/shaderModules/Float2DrawUniform.js\";\nimport { Float2PassUniform as a } from \"../views/3d/webgl-engine/core/shaderModules/Float2PassUniform.js\";\nimport { FloatPassUniform as n } from \"../views/3d/webgl-engine/core/shaderModules/FloatPassUniform.js\";\nimport { glsl as s } from \"../views/3d/webgl-engine/core/shaderModules/interfaces.js\";\nimport { ShaderBuilder as l } from \"../views/3d/webgl-engine/core/shaderModules/ShaderBuilder.js\";\nimport { Texture2DDrawUniform as i } from \"../views/3d/webgl-engine/core/shaderModules/Texture2DDrawUniform.js\";\nimport { Texture2DPassUniform as d } from \"../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform.js\";\nconst f = 4;\n\nfunction c() {\n  const c = new l(),\n        u = c.fragment;\n  c.include(r);\n  const m = (f + 1) / 2,\n        p = 1 / (2 * m * m);\n  return u.include(o), u.uniforms.add([new d(\"depthMap\", e => e.depthTexture), new i(\"tex\", e => e.colorTexture), new t(\"blurSize\", e => e.blurSize), new n(\"projScale\", (r, o) => {\n    const t = e(o.camera.eye, o.camera.center);\n    return t > 5e4 ? Math.max(0, r.projScale - (t - 5e4)) : r.projScale;\n  }), new a(\"nearFar\", (e, r) => r.camera.nearFar)]), u.code.add(s`\n    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {\n      float c = texture2D(tex, uv).r;\n      float d = linearDepthFromTexture(depthMap, uv, nearFar);\n\n      float ddiff = d - center_d;\n\n      float w = exp(-r * r * ${s.float(p)} - ddiff * ddiff * sharpness);\n      wTotal += w;\n      bTotal += w * c;\n    }\n  `), u.code.add(s`\n    void main(void) {\n      float b = 0.0;\n      float w_total = 0.0;\n\n      float center_d = linearDepthFromTexture(depthMap, uv, nearFar);\n\n      float sharpness = -0.05 * projScale / center_d;\n      for (int r = -${s.int(f)}; r <= ${s.int(f)}; ++r) {\n        float rf = float(r);\n        vec2 uvOffset = uv + rf * blurSize;\n        blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);\n      }\n\n      gl_FragColor = vec4(b / w_total);\n    }\n  `), c;\n}\n\nconst u = Object.freeze(Object.defineProperty({\n  __proto__: null,\n  build: c\n}, Symbol.toStringTag, {\n  value: \"Module\"\n}));\nexport { u as S, c as b };","map":{"version":3,"names":["i","e","ScreenSpacePass","r","ReadLinearDepth","o","Float2DrawUniform","t","Float2PassUniform","a","FloatPassUniform","n","glsl","s","ShaderBuilder","l","Texture2DDrawUniform","Texture2DPassUniform","d","f","c","u","fragment","include","m","p","uniforms","add","depthTexture","colorTexture","blurSize","camera","eye","center","Math","max","projScale","nearFar","code","float","int","Object","freeze","defineProperty","__proto__","build","Symbol","toStringTag","value","S","b"],"sources":["E:/各个学科/论文/毕业论文/Atmosphere/eco-friendly/node_modules/@arcgis/core/chunks/SSAOBlur.glsl.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{i as e}from\"./vec3.js\";import{ScreenSpacePass as r}from\"../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.js\";import{ReadLinearDepth as o}from\"../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl.js\";import{Float2DrawUniform as t}from\"../views/3d/webgl-engine/core/shaderModules/Float2DrawUniform.js\";import{Float2PassUniform as a}from\"../views/3d/webgl-engine/core/shaderModules/Float2PassUniform.js\";import{FloatPassUniform as n}from\"../views/3d/webgl-engine/core/shaderModules/FloatPassUniform.js\";import{glsl as s}from\"../views/3d/webgl-engine/core/shaderModules/interfaces.js\";import{ShaderBuilder as l}from\"../views/3d/webgl-engine/core/shaderModules/ShaderBuilder.js\";import{Texture2DDrawUniform as i}from\"../views/3d/webgl-engine/core/shaderModules/Texture2DDrawUniform.js\";import{Texture2DPassUniform as d}from\"../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform.js\";const f=4;function c(){const c=new l,u=c.fragment;c.include(r);const m=(f+1)/2,p=1/(2*m*m);return u.include(o),u.uniforms.add([new d(\"depthMap\",(e=>e.depthTexture)),new i(\"tex\",(e=>e.colorTexture)),new t(\"blurSize\",(e=>e.blurSize)),new n(\"projScale\",((r,o)=>{const t=e(o.camera.eye,o.camera.center);return t>5e4?Math.max(0,r.projScale-(t-5e4)):r.projScale})),new a(\"nearFar\",((e,r)=>r.camera.nearFar))]),u.code.add(s`\n    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {\n      float c = texture2D(tex, uv).r;\n      float d = linearDepthFromTexture(depthMap, uv, nearFar);\n\n      float ddiff = d - center_d;\n\n      float w = exp(-r * r * ${s.float(p)} - ddiff * ddiff * sharpness);\n      wTotal += w;\n      bTotal += w * c;\n    }\n  `),u.code.add(s`\n    void main(void) {\n      float b = 0.0;\n      float w_total = 0.0;\n\n      float center_d = linearDepthFromTexture(depthMap, uv, nearFar);\n\n      float sharpness = -0.05 * projScale / center_d;\n      for (int r = -${s.int(f)}; r <= ${s.int(f)}; ++r) {\n        float rf = float(r);\n        vec2 uvOffset = uv + rf * blurSize;\n        blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);\n      }\n\n      gl_FragColor = vec4(b / w_total);\n    }\n  `),c}const u=Object.freeze(Object.defineProperty({__proto__:null,build:c},Symbol.toStringTag,{value:\"Module\"}));export{u as S,c as b};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}