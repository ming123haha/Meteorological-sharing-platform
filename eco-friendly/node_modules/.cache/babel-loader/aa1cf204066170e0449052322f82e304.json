{"ast":null,"code":"import \"core-js/modules/es.array.includes.js\";\n\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport { _ as t } from \"../../chunks/tslib.es6.js\";\nimport { id as r } from \"../../kernel.js\";\nimport e from \"../../request.js\";\nimport { result as s } from \"../../core/asyncUtils.js\";\nimport o from \"../../core/Error.js\";\nimport i from \"../../core/Logger.js\";\nimport { isNone as a, isSome as l } from \"../../core/maybe.js\";\nimport { throwIfAborted as p, isAbortError as n, throwIfAbortError as m } from \"../../core/promiseUtils.js\";\nimport { normalize as c, hasSamePortal as u } from \"../../core/urlUtils.js\";\nimport { property as d } from \"../../core/accessorSupport/decorators/property.js\";\nimport \"../../core/arrayUtils.js\";\nimport \"../../core/has.js\";\nimport \"../../core/accessorSupport/ensureType.js\";\nimport { reader as h } from \"../../core/accessorSupport/decorators/reader.js\";\nimport { subclass as f } from \"../../core/accessorSupport/decorators/subclass.js\";\nimport { writer as y } from \"../../core/accessorSupport/decorators/writer.js\";\nimport g from \"../../portal/Portal.js\";\nimport I from \"../../portal/PortalItem.js\";\nimport j from \"../../portal/PortalUser.js\";\n\nconst w = i.getLogger(\"esri.layers.mixins.PortalLayer\"),\n      v = i => {\n  let v = class extends i {\n    constructor() {\n      super(...arguments), this.resourceReferences = {\n        portalItem: null,\n        paths: []\n      }, this.userHasEditingPrivileges = !0;\n    }\n\n    destroy() {\n      this.portalItem?.destroy(), this.portalItem = null;\n    }\n\n    set portalItem(t) {\n      t !== this._get(\"portalItem\") && (this.removeOrigin(\"portal-item\"), this._set(\"portalItem\", t));\n    }\n\n    readPortalItem(t, r, e) {\n      if (r.itemId) return new I({\n        id: r.itemId,\n        portal: e && e.portal\n      });\n    }\n\n    writePortalItem(t, r) {\n      t && t.id && (r.itemId = t.id);\n    }\n\n    async loadFromPortal(t, r) {\n      if (this.portalItem && this.portalItem.id) try {\n        const e = await import(\"../../portal/support/layersLoader.js\");\n        return p(r), await e.load({\n          instance: this,\n          supportedTypes: t.supportedTypes,\n          validateItem: t.validateItem,\n          supportsData: t.supportsData\n        }, r);\n      } catch (e) {\n        throw n(e) || w.warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})\\n  ${e}`), e;\n      }\n    }\n\n    async finishLoadEditablePortalLayer(t) {\n      this._set(\"userHasEditingPrivileges\", await this._fetchUserHasEditingPrivileges(t).catch(t => (m(t), !0)));\n    }\n\n    async _fetchUserHasEditingPrivileges(t) {\n      const e = this.url ? r?.findCredential(this.url) : null;\n      if (!e) return !0;\n      const s = P.credential === e ? P.user : await this._fetchEditingUser(t);\n      return P.credential = e, P.user = s, a(s) || null == s.privileges || s.privileges.includes(\"features:user:edit\");\n    }\n\n    async _fetchEditingUser(t) {\n      const o = this.portalItem?.portal?.user;\n      if (o) return o;\n      const i = r.findServerInfo(this.url);\n      if (!i?.owningSystemUrl) return null;\n      const a = `${i.owningSystemUrl}/sharing/rest`,\n            p = g.getDefault();\n      if (p && p.loaded && c(p.restUrl) === c(a)) return p.user;\n      const n = `${a}/community/self`,\n            m = l(t) ? t.signal : null,\n            u = await s(e(n, {\n        authMode: \"no-prompt\",\n        query: {\n          f: \"json\"\n        },\n        signal: m\n      }));\n      return u.ok ? j.fromJSON(u.value.data) : null;\n    }\n\n    read(t, r) {\n      r && (r.layer = this), super.read(t, r);\n    }\n\n    write(t, r) {\n      const e = r && r.portal,\n            s = this.portalItem && this.portalItem.id && (this.portalItem.portal || g.getDefault());\n      return e && s && !u(s.restUrl, e.restUrl) ? (r.messages && r.messages.push(new o(\"layer:cross-portal\", `The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`, {\n        layer: this\n      })), null) : super.write(t, { ...r,\n        layer: this\n      });\n    }\n\n  };\n  return t([d({\n    type: I\n  })], v.prototype, \"portalItem\", null), t([h(\"web-document\", \"portalItem\", [\"itemId\"])], v.prototype, \"readPortalItem\", null), t([y(\"web-document\", \"portalItem\", {\n    itemId: {\n      type: String\n    }\n  })], v.prototype, \"writePortalItem\", null), t([d({\n    clonable: !1\n  })], v.prototype, \"resourceReferences\", void 0), t([d({\n    readOnly: !0\n  })], v.prototype, \"userHasEditingPrivileges\", void 0), v = t([f(\"esri.layers.mixins.PortalLayer\")], v), v;\n},\n      P = {\n  credential: null,\n  user: null\n};\n\nexport { v as PortalLayer };","map":{"version":3,"names":["_","t","id","r","e","result","s","o","i","isNone","a","isSome","l","throwIfAborted","p","isAbortError","n","throwIfAbortError","m","normalize","c","hasSamePortal","u","property","d","reader","h","subclass","f","writer","y","g","I","j","w","getLogger","v","constructor","arguments","resourceReferences","portalItem","paths","userHasEditingPrivileges","destroy","_get","removeOrigin","_set","readPortalItem","itemId","portal","writePortalItem","loadFromPortal","load","instance","supportedTypes","validateItem","supportsData","warn","title","finishLoadEditablePortalLayer","_fetchUserHasEditingPrivileges","catch","url","findCredential","P","credential","user","_fetchEditingUser","privileges","includes","findServerInfo","owningSystemUrl","getDefault","loaded","restUrl","signal","authMode","query","ok","fromJSON","value","data","read","layer","write","messages","push","type","prototype","String","clonable","readOnly","PortalLayer"],"sources":["C:/Users/hp/Desktop/eco-friendly atmosphere/Atmosphere/eco-friendly/node_modules/@arcgis/core/layers/mixins/PortalLayer.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../chunks/tslib.es6.js\";import{id as r}from\"../../kernel.js\";import e from\"../../request.js\";import{result as s}from\"../../core/asyncUtils.js\";import o from\"../../core/Error.js\";import i from\"../../core/Logger.js\";import{isNone as a,isSome as l}from\"../../core/maybe.js\";import{throwIfAborted as p,isAbortError as n,throwIfAbortError as m}from\"../../core/promiseUtils.js\";import{normalize as c,hasSamePortal as u}from\"../../core/urlUtils.js\";import{property as d}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/arrayUtils.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import{reader as h}from\"../../core/accessorSupport/decorators/reader.js\";import{subclass as f}from\"../../core/accessorSupport/decorators/subclass.js\";import{writer as y}from\"../../core/accessorSupport/decorators/writer.js\";import g from\"../../portal/Portal.js\";import I from\"../../portal/PortalItem.js\";import j from\"../../portal/PortalUser.js\";const w=i.getLogger(\"esri.layers.mixins.PortalLayer\"),v=i=>{let v=class extends i{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0}destroy(){this.portalItem?.destroy(),this.portalItem=null}set portalItem(t){t!==this._get(\"portalItem\")&&(this.removeOrigin(\"portal-item\"),this._set(\"portalItem\",t))}readPortalItem(t,r,e){if(r.itemId)return new I({id:r.itemId,portal:e&&e.portal})}writePortalItem(t,r){t&&t.id&&(r.itemId=t.id)}async loadFromPortal(t,r){if(this.portalItem&&this.portalItem.id)try{const e=await import(\"../../portal/support/layersLoader.js\");return p(r),await e.load({instance:this,supportedTypes:t.supportedTypes,validateItem:t.validateItem,supportsData:t.supportsData},r)}catch(e){throw n(e)||w.warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})\\n  ${e}`),e}}async finishLoadEditablePortalLayer(t){this._set(\"userHasEditingPrivileges\",await this._fetchUserHasEditingPrivileges(t).catch((t=>(m(t),!0))))}async _fetchUserHasEditingPrivileges(t){const e=this.url?r?.findCredential(this.url):null;if(!e)return!0;const s=P.credential===e?P.user:await this._fetchEditingUser(t);return P.credential=e,P.user=s,a(s)||null==s.privileges||s.privileges.includes(\"features:user:edit\")}async _fetchEditingUser(t){const o=this.portalItem?.portal?.user;if(o)return o;const i=r.findServerInfo(this.url);if(!i?.owningSystemUrl)return null;const a=`${i.owningSystemUrl}/sharing/rest`,p=g.getDefault();if(p&&p.loaded&&c(p.restUrl)===c(a))return p.user;const n=`${a}/community/self`,m=l(t)?t.signal:null,u=await s(e(n,{authMode:\"no-prompt\",query:{f:\"json\"},signal:m}));return u.ok?j.fromJSON(u.value.data):null}read(t,r){r&&(r.layer=this),super.read(t,r)}write(t,r){const e=r&&r.portal,s=this.portalItem&&this.portalItem.id&&(this.portalItem.portal||g.getDefault());return e&&s&&!u(s.restUrl,e.restUrl)?(r.messages&&r.messages.push(new o(\"layer:cross-portal\",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(t,{...r,layer:this})}};return t([d({type:I})],v.prototype,\"portalItem\",null),t([h(\"web-document\",\"portalItem\",[\"itemId\"])],v.prototype,\"readPortalItem\",null),t([y(\"web-document\",\"portalItem\",{itemId:{type:String}})],v.prototype,\"writePortalItem\",null),t([d({clonable:!1})],v.prototype,\"resourceReferences\",void 0),t([d({readOnly:!0})],v.prototype,\"userHasEditingPrivileges\",void 0),v=t([f(\"esri.layers.mixins.PortalLayer\")],v),v},P={credential:null,user:null};export{v as PortalLayer};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}