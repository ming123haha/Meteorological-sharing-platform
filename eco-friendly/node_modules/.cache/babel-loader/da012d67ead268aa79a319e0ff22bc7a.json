{"ast":null,"code":"import \"core-js/modules/es.typed-array.at.js\";\nimport \"core-js/modules/es.typed-array.set.js\";\nimport \"core-js/modules/esnext.typed-array.find-last.js\";\nimport \"core-js/modules/esnext.typed-array.find-last-index.js\";\n\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport { isSome as t } from \"../../../../../core/maybe.js\";\nimport { HITTEST_RADIUS as e } from \"../definitions.js\";\nimport { Effect as s } from \"./Effect.js\";\nimport { PixelFormat as o, PixelType as r } from \"../../../../webgl/enums.js\";\n\nclass i extends s {\n  constructor() {\n    super(...arguments), this.name = this.constructor.name, this.defines = [\"id\"], this._lastSize = 0;\n  }\n\n  dispose() {\n    t(this._fbo) && this._fbo.dispose();\n  }\n\n  bind({\n    context: t,\n    painter: e\n  }) {\n    const {\n      width: s,\n      height: o\n    } = t.getViewport();\n    this._boundFBO = t.getBoundFramebufferObject();\n    const r = e.getFbos(s, o).effect0;\n    t.bindFramebuffer(r), t.setColorMask(!0, !0, !0, !0), t.setClearColor(0, 0, 0, 0), t.clear(t.gl.COLOR_BUFFER_BIT);\n  }\n\n  unbind({\n    context: t\n  }) {\n    t.bindFramebuffer(this._boundFBO), this._boundFBO = null;\n  }\n\n  draw(t, s, o = 2 * e) {\n    this._resolve(t, s, o);\n  }\n\n  async _resolve({\n    context: t,\n    state: e,\n    pixelRatio: s\n  }, i, n) {\n    const f = t.getBoundFramebufferObject(),\n          a = e.size[1] * s,\n          h = Math.round(n * s),\n          u = h / 2,\n          b = h / 2;\n    this._ensureBuffer(h), i.forEach(async (t, e) => {\n      const n = new Map(),\n            c = Math.floor(e.x * s - h / 2),\n            l = Math.floor(a - e.y * s - h / 2);\n      await f.readPixelsAsync(c, l, h, h, o.RGBA, r.UNSIGNED_BYTE, this._buf);\n\n      for (let s = 0; s < this._buf32.length; s++) {\n        const t = this._buf32[s];\n\n        if (4294967295 !== t && 0 !== t) {\n          const e = s % h,\n                o = h - Math.floor(s / h),\n                r = (u - e) * (u - e) + (b - o) * (b - o),\n                i = n.has(t) ? n.get(t) : 4294967295;\n          n.set(t, Math.min(r, i));\n        }\n      }\n\n      const _ = Array.from(n).sort((t, e) => t[1] - e[1]).map(t => t[0]);\n\n      t.resolve(_), i.delete(e);\n    });\n  }\n\n  _ensureBuffer(t) {\n    this._lastSize !== t && (this._lastSize = t, this._buf = new Uint8Array(4 * t * t), this._buf32 = new Uint32Array(this._buf.buffer));\n  }\n\n}\n\nexport { i as HittestEffectVTL };","map":{"version":3,"names":["isSome","t","HITTEST_RADIUS","e","Effect","s","PixelFormat","o","PixelType","r","i","constructor","arguments","name","defines","_lastSize","dispose","_fbo","bind","context","painter","width","height","getViewport","_boundFBO","getBoundFramebufferObject","getFbos","effect0","bindFramebuffer","setColorMask","setClearColor","clear","gl","COLOR_BUFFER_BIT","unbind","draw","_resolve","state","pixelRatio","n","f","a","size","h","Math","round","u","b","_ensureBuffer","forEach","Map","c","floor","x","l","y","readPixelsAsync","RGBA","UNSIGNED_BYTE","_buf","_buf32","length","has","get","set","min","_","Array","from","sort","map","resolve","delete","Uint8Array","Uint32Array","buffer","HittestEffectVTL"],"sources":["E:/各个学科/论文/毕业论文/Atmosphere/eco-friendly/node_modules/@arcgis/core/views/2d/engine/webgl/effects/HittestEffectVTL.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{isSome as t}from\"../../../../../core/maybe.js\";import{HITTEST_RADIUS as e}from\"../definitions.js\";import{Effect as s}from\"./Effect.js\";import{PixelFormat as o,PixelType as r}from\"../../../../webgl/enums.js\";class i extends s{constructor(){super(...arguments),this.name=this.constructor.name,this.defines=[\"id\"],this._lastSize=0}dispose(){t(this._fbo)&&this._fbo.dispose()}bind({context:t,painter:e}){const{width:s,height:o}=t.getViewport();this._boundFBO=t.getBoundFramebufferObject();const r=e.getFbos(s,o).effect0;t.bindFramebuffer(r),t.setColorMask(!0,!0,!0,!0),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT)}unbind({context:t}){t.bindFramebuffer(this._boundFBO),this._boundFBO=null}draw(t,s,o=2*e){this._resolve(t,s,o)}async _resolve({context:t,state:e,pixelRatio:s},i,n){const f=t.getBoundFramebufferObject(),a=e.size[1]*s,h=Math.round(n*s),u=h/2,b=h/2;this._ensureBuffer(h),i.forEach((async(t,e)=>{const n=new Map,c=Math.floor(e.x*s-h/2),l=Math.floor(a-e.y*s-h/2);await f.readPixelsAsync(c,l,h,h,o.RGBA,r.UNSIGNED_BYTE,this._buf);for(let s=0;s<this._buf32.length;s++){const t=this._buf32[s];if(4294967295!==t&&0!==t){const e=s%h,o=h-Math.floor(s/h),r=(u-e)*(u-e)+(b-o)*(b-o),i=n.has(t)?n.get(t):4294967295;n.set(t,Math.min(r,i))}}const _=Array.from(n).sort(((t,e)=>t[1]-e[1])).map((t=>t[0]));t.resolve(_),i.delete(e)}))}_ensureBuffer(t){this._lastSize!==t&&(this._lastSize=t,this._buf=new Uint8Array(4*t*t),this._buf32=new Uint32Array(this._buf.buffer))}}export{i as HittestEffectVTL};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}