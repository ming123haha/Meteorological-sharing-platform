{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport { isNone as t } from \"../../../../core/maybe.js\";\nimport { createScreenPoint as e } from \"../../../../core/screenUtils.js\";\nimport { g as s, m as r, h as o, d as a, r as i } from \"../../../../chunks/mat3.js\";\nimport { c as n } from \"../../../../chunks/mat3f32.js\";\nimport { f as c } from \"../../../../chunks/vec2f32.js\";\nimport { f as p } from \"../../../../chunks/vec3f32.js\";\nimport { normalizeMapX as d } from \"../../../../geometry/support/normalizeUtils.js\";\nimport { getInfo as h } from \"../../../../geometry/support/spatialReferenceUtils.js\";\nimport { getWorldWidth as l } from \"../../viewpointUtils.js\";\nimport { brushes as m } from \"../brushes.js\";\nimport { WGLDrawPhase as f } from \"./enums.js\";\nimport u from \"./WGLContainer.js\";\n\nclass M extends u {\n  constructor() {\n    super(...arguments), this._localOrigin = e(0, 0), this._viewStateId = -1, this._dvsMat3 = n(), this.requiresDedicatedFBO = !1;\n  }\n\n  get dvsMat3() {\n    return this._dvsMat3;\n  }\n\n  beforeRender(t) {\n    this._updateMatrices(t), this._updateOverlays(t, this.children);\n\n    for (const e of this.children) e.beforeRender(t);\n  }\n\n  prepareRenderPasses(t) {\n    const e = t.registerRenderPass({\n      name: \"overlay\",\n      brushes: [m.overlay],\n      target: () => this.children,\n      drawPhase: f.MAP\n    });\n    return [...super.prepareRenderPasses(t), e];\n  }\n\n  _updateMatrices(t) {\n    const {\n      state: e\n    } = t,\n          {\n      id: n,\n      size: h,\n      pixelRatio: l,\n      resolution: m,\n      rotation: f,\n      viewpoint: u,\n      displayMat3: M\n    } = e;\n    if (this._viewStateId === n) return;\n\n    const v = Math.PI / 180 * f,\n          _ = l * h[0],\n          w = l * h[1],\n          {\n      x: y,\n      y: g\n    } = u.targetGeometry,\n          j = d(y, e.spatialReference);\n\n    this._localOrigin.x = j, this._localOrigin.y = g;\n    const b = m * _,\n          R = m * w,\n          O = s(this._dvsMat3);\n    r(O, O, M), o(O, O, c(_ / 2, w / 2)), a(O, O, p(_ / b, -w / R, 1)), i(O, O, -v), this._viewStateId = n;\n  }\n\n  _updateOverlays(e, s) {\n    const {\n      state: r\n    } = e,\n          {\n      rotation: o,\n      spatialReference: a,\n      worldScreenWidth: i,\n      size: n,\n      viewpoint: c\n    } = r,\n          p = this._localOrigin;\n    let d = 0;\n\n    if (a.isWrappable) {\n      const e = n[0],\n            m = n[1],\n            f = 180 / Math.PI * o,\n            u = Math.abs(Math.cos(f)),\n            M = Math.abs(Math.sin(f)),\n            v = Math.round(e * u + m * M),\n            [_, w] = h(a).valid,\n            y = l(a),\n            {\n        x: g,\n        y: j\n      } = c.targetGeometry,\n            b = [g, j],\n            R = [0, 0];\n      r.toScreen(R, b);\n      const O = [0, 0];\n      let P;\n      P = v > i ? .5 * i : .5 * v;\n      const x = Math.floor((g + .5 * y) / y),\n            C = _ + x * y,\n            D = w + x * y,\n            I = [R[0] + P, 0];\n      r.toMap(O, I), O[0] > D && (d = y), I[0] = R[0] - P, r.toMap(O, I), O[0] < C && (d = -y);\n\n      for (const r of s) {\n        const e = r.elementView.bounds;\n        if (t(e)) continue;\n        const [s,, o] = e;\n        s < _ && o > _ ? r.updateDrawCoords(p, y) : o > w && s < w ? r.updateDrawCoords(p, -y) : r.updateDrawCoords(p, d);\n      }\n    } else for (const t of s) t.updateDrawCoords(p, d);\n  }\n\n}\n\nexport { M as default };","map":{"version":3,"names":["isNone","t","createScreenPoint","e","g","s","m","r","h","o","d","a","i","c","n","f","p","normalizeMapX","getInfo","getWorldWidth","l","brushes","WGLDrawPhase","u","M","constructor","arguments","_localOrigin","_viewStateId","_dvsMat3","requiresDedicatedFBO","dvsMat3","beforeRender","_updateMatrices","_updateOverlays","children","prepareRenderPasses","registerRenderPass","name","overlay","target","drawPhase","MAP","state","id","size","pixelRatio","resolution","rotation","viewpoint","displayMat3","v","Math","PI","_","w","x","y","targetGeometry","j","spatialReference","b","R","O","worldScreenWidth","isWrappable","abs","cos","sin","round","valid","toScreen","P","floor","C","D","I","toMap","elementView","bounds","updateDrawCoords","default"],"sources":["E:/各个学科/论文/毕业论文/Atmosphere/eco-friendly/node_modules/@arcgis/core/views/2d/engine/webgl/OverlayContainer.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{isNone as t}from\"../../../../core/maybe.js\";import{createScreenPoint as e}from\"../../../../core/screenUtils.js\";import{g as s,m as r,h as o,d as a,r as i}from\"../../../../chunks/mat3.js\";import{c as n}from\"../../../../chunks/mat3f32.js\";import{f as c}from\"../../../../chunks/vec2f32.js\";import{f as p}from\"../../../../chunks/vec3f32.js\";import{normalizeMapX as d}from\"../../../../geometry/support/normalizeUtils.js\";import{getInfo as h}from\"../../../../geometry/support/spatialReferenceUtils.js\";import{getWorldWidth as l}from\"../../viewpointUtils.js\";import{brushes as m}from\"../brushes.js\";import{WGLDrawPhase as f}from\"./enums.js\";import u from\"./WGLContainer.js\";class M extends u{constructor(){super(...arguments),this._localOrigin=e(0,0),this._viewStateId=-1,this._dvsMat3=n(),this.requiresDedicatedFBO=!1}get dvsMat3(){return this._dvsMat3}beforeRender(t){this._updateMatrices(t),this._updateOverlays(t,this.children);for(const e of this.children)e.beforeRender(t)}prepareRenderPasses(t){const e=t.registerRenderPass({name:\"overlay\",brushes:[m.overlay],target:()=>this.children,drawPhase:f.MAP});return[...super.prepareRenderPasses(t),e]}_updateMatrices(t){const{state:e}=t,{id:n,size:h,pixelRatio:l,resolution:m,rotation:f,viewpoint:u,displayMat3:M}=e;if(this._viewStateId===n)return;const v=Math.PI/180*f,_=l*h[0],w=l*h[1],{x:y,y:g}=u.targetGeometry,j=d(y,e.spatialReference);this._localOrigin.x=j,this._localOrigin.y=g;const b=m*_,R=m*w,O=s(this._dvsMat3);r(O,O,M),o(O,O,c(_/2,w/2)),a(O,O,p(_/b,-w/R,1)),i(O,O,-v),this._viewStateId=n}_updateOverlays(e,s){const{state:r}=e,{rotation:o,spatialReference:a,worldScreenWidth:i,size:n,viewpoint:c}=r,p=this._localOrigin;let d=0;if(a.isWrappable){const e=n[0],m=n[1],f=180/Math.PI*o,u=Math.abs(Math.cos(f)),M=Math.abs(Math.sin(f)),v=Math.round(e*u+m*M),[_,w]=h(a).valid,y=l(a),{x:g,y:j}=c.targetGeometry,b=[g,j],R=[0,0];r.toScreen(R,b);const O=[0,0];let P;P=v>i?.5*i:.5*v;const x=Math.floor((g+.5*y)/y),C=_+x*y,D=w+x*y,I=[R[0]+P,0];r.toMap(O,I),O[0]>D&&(d=y),I[0]=R[0]-P,r.toMap(O,I),O[0]<C&&(d=-y);for(const r of s){const e=r.elementView.bounds;if(t(e))continue;const[s,,o]=e;s<_&&o>_?r.updateDrawCoords(p,y):o>w&&s<w?r.updateDrawCoords(p,-y):r.updateDrawCoords(p,d)}}else for(const t of s)t.updateDrawCoords(p,d)}}export{M as default};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}