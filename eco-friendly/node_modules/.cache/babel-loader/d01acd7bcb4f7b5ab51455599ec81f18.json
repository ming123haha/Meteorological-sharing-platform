{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport { _ as r } from \"../../../chunks/tslib.es6.js\";\nimport t from \"../../../core/Error.js\";\nimport { isNone as s, isSome as e } from \"../../../core/maybe.js\";\nimport { property as o } from \"../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../core/arrayUtils.js\";\nimport \"../../../core/accessorSupport/ensureType.js\";\nimport { subclass as a } from \"../../../core/accessorSupport/decorators/subclass.js\";\nimport i from \"./BaseRaster.js\";\nlet n = class extends i {\n  constructor() {\n    super(...arguments), this.datasetFormat = \"Function\", this.tileType = \"Raster\", this.rasterFunction = null, this._primaryRasters = null;\n  }\n\n  async open(r) {\n    await this.init();\n    const {\n      rasterFunction: s\n    } = this,\n          {\n      rasters: e,\n      rasterIds: o\n    } = s.getPrimaryRasters(),\n          a = e.map(t => t.rasterInfo ? void 0 : t.open(r));\n    await Promise.all(a);\n    const i = e.map(({\n      rasterInfo: r\n    }) => r),\n          n = s.bind({\n      rasterInfos: i,\n      rasterIds: o\n    });\n    if (!n.success) throw new t(\"raster-function:open\", `cannot bind the function: ${n.error ?? \"\"}`);\n    await this.syncJobHandler(), this.set(\"sourceJSON\", e[0].sourceJSON), this.set(\"rasterInfo\", s.rasterInfo);\n  }\n\n  async syncJobHandler() {\n    const {\n      rasterFunction: r\n    } = this;\n    if (this._primaryRasters = r.getPrimaryRasters(), this.rasterJobHandler) return this.rasterJobHandler.updateRasterFunction(r);\n  }\n\n  async fetchPixels(r, t, o, a = {}) {\n    const {\n      rasters: i,\n      rasterIds: n\n    } = this._primaryRasters,\n          c = i.map(s => s.fetchPixels(r, t, o, a)),\n          p = await Promise.all(c),\n          l = p.map(r => r.pixelBlock);\n    if (l.every(r => s(r))) return p[0];\n    const m = p.find(r => e(r.pixelBlock))?.extent ?? r,\n          u = this.rasterJobHandler ? await this.rasterJobHandler.process({\n      extent: m,\n      primaryPixelBlocks: l,\n      primaryRasterIds: n\n    }) : this.rasterFunction.process({\n      extent: m,\n      primaryPixelBlocks: l,\n      primaryRasterIds: n\n    });\n    return { ...p[0],\n      pixelBlock: u\n    };\n  }\n\n};\nr([o({\n  type: String,\n  json: {\n    write: !0\n  }\n})], n.prototype, \"datasetFormat\", void 0), r([o()], n.prototype, \"tileType\", void 0), r([o()], n.prototype, \"rasterFunction\", void 0), n = r([a(\"esri.layers.support.rasterDatasets.FunctionRaster\")], n);\nconst c = n;\nexport { c as default };","map":{"version":3,"names":["_","r","t","isNone","s","isSome","e","property","o","subclass","a","i","n","constructor","arguments","datasetFormat","tileType","rasterFunction","_primaryRasters","open","init","rasters","rasterIds","getPrimaryRasters","map","rasterInfo","Promise","all","bind","rasterInfos","success","error","syncJobHandler","set","sourceJSON","rasterJobHandler","updateRasterFunction","fetchPixels","c","p","l","pixelBlock","every","m","find","extent","u","process","primaryPixelBlocks","primaryRasterIds","type","String","json","write","prototype","default"],"sources":["E:/各个学科/论文/毕业论文/Atmosphere/eco-friendly/node_modules/@arcgis/core/layers/support/rasterDatasets/FunctionRaster.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{_ as r}from\"../../../chunks/tslib.es6.js\";import t from\"../../../core/Error.js\";import{isNone as s,isSome as e}from\"../../../core/maybe.js\";import{property as o}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/arrayUtils.js\";import\"../../../core/accessorSupport/ensureType.js\";import{subclass as a}from\"../../../core/accessorSupport/decorators/subclass.js\";import i from\"./BaseRaster.js\";let n=class extends i{constructor(){super(...arguments),this.datasetFormat=\"Function\",this.tileType=\"Raster\",this.rasterFunction=null,this._primaryRasters=null}async open(r){await this.init();const{rasterFunction:s}=this,{rasters:e,rasterIds:o}=s.getPrimaryRasters(),a=e.map((t=>t.rasterInfo?void 0:t.open(r)));await Promise.all(a);const i=e.map((({rasterInfo:r})=>r)),n=s.bind({rasterInfos:i,rasterIds:o});if(!n.success)throw new t(\"raster-function:open\",`cannot bind the function: ${n.error??\"\"}`);await this.syncJobHandler(),this.set(\"sourceJSON\",e[0].sourceJSON),this.set(\"rasterInfo\",s.rasterInfo)}async syncJobHandler(){const{rasterFunction:r}=this;if(this._primaryRasters=r.getPrimaryRasters(),this.rasterJobHandler)return this.rasterJobHandler.updateRasterFunction(r)}async fetchPixels(r,t,o,a={}){const{rasters:i,rasterIds:n}=this._primaryRasters,c=i.map((s=>s.fetchPixels(r,t,o,a))),p=await Promise.all(c),l=p.map((r=>r.pixelBlock));if(l.every((r=>s(r))))return p[0];const m=p.find((r=>e(r.pixelBlock)))?.extent??r,u=this.rasterJobHandler?await this.rasterJobHandler.process({extent:m,primaryPixelBlocks:l,primaryRasterIds:n}):this.rasterFunction.process({extent:m,primaryPixelBlocks:l,primaryRasterIds:n});return{...p[0],pixelBlock:u}}};r([o({type:String,json:{write:!0}})],n.prototype,\"datasetFormat\",void 0),r([o()],n.prototype,\"tileType\",void 0),r([o()],n.prototype,\"rasterFunction\",void 0),n=r([a(\"esri.layers.support.rasterDatasets.FunctionRaster\")],n);const c=n;export{c as default};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}