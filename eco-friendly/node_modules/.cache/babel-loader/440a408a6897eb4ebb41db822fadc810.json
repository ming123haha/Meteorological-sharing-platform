{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport { clamp as t } from \"../../../../../core/mathUtils.js\";\nimport { StaticBitSet as s } from \"../../../layers/features/support/StaticBitSet.js\";\nconst e = 2,\n      i = 1,\n      o = 0,\n      h = 1,\n      r = 2;\n\nclass l {\n  constructor(t, e, o) {\n    this._debugMap = new Map(), this._width = t * o, this._height = e * o, this._pixelRatio = o;\n    const h = Math.ceil(this._width / i),\n          r = Math.ceil(this._height / i);\n    this._cols = h, this._rows = r, this._cells = s.create(h * r);\n  }\n\n  insertMetrics(t) {\n    const s = this._hasCollision(t);\n\n    return s === o && this._markMetrics(t), s;\n  }\n\n  getCellId(t, s) {\n    return t + s * this._cols;\n  }\n\n  has(t) {\n    return this._cells.has(t);\n  }\n\n  hasRange(t, s) {\n    return this._cells.hasRange(t, s);\n  }\n\n  set(t) {\n    this._cells.set(t);\n  }\n\n  setRange(t, s) {\n    this._cells.setRange(t, s);\n  }\n\n  _collide(s, e, l, n) {\n    const c = s - l / 2,\n          a = e - n / 2,\n          _ = c + l,\n          d = a + n;\n\n    if (_ < 0 || d < 0 || c > this._width || a > this._height) return h;\n    const u = t(Math.floor(c / i), 0, this._cols),\n          p = t(Math.floor(a / i), 0, this._rows),\n          M = t(Math.ceil(_ / i), 0, this._cols),\n          f = t(Math.ceil(d / i), 0, this._rows);\n\n    for (let t = p; t <= f; t++) for (let s = u; s <= M; s++) {\n      const e = this.getCellId(s, t);\n      if (this.has(e)) return r;\n    }\n\n    return o;\n  }\n\n  _mark(s, e, o, h, r) {\n    const l = s - o / 2,\n          n = e - h / 2,\n          c = l + o,\n          a = n + h,\n          _ = t(Math.floor(l / i), 0, this._cols),\n          d = t(Math.floor(n / i), 0, this._rows),\n          u = t(Math.ceil(c / i), 0, this._cols),\n          p = t(Math.ceil(a / i), 0, this._rows);\n\n    for (let t = d; t <= p; t++) for (let s = _; s <= u; s++) {\n      const e = this.getCellId(s, t);\n      this._debugMap.set(e, r), this.set(e);\n    }\n\n    return !1;\n  }\n\n  _hasCollision(t) {\n    const s = t.id;\n    let i = 0,\n        l = 0;\n    t.save();\n\n    do {\n      const s = t.boundsCount;\n      i += s;\n\n      for (let i = 0; i < s; i++) {\n        const s = t.boundsComputedAnchorX(i),\n              o = t.boundsComputedAnchorY(i),\n              n = (t.boundsWidth(i) + e) * this._pixelRatio,\n              c = (t.boundsHeight(i) + e) * this._pixelRatio;\n\n        switch (this._collide(s, o, n, c)) {\n          case r:\n            return r;\n\n          case h:\n            l++;\n        }\n      }\n    } while (t.peekId() === s && t.next());\n\n    return t.restore(), i === l ? h : o;\n  }\n\n  _markMetrics(t) {\n    const s = t.id;\n    t.save();\n\n    do {\n      const s = t.boundsCount;\n\n      for (let i = 0; i < s; i++) {\n        const s = t.boundsComputedAnchorX(i),\n              o = t.boundsComputedAnchorY(i),\n              h = (t.boundsWidth(i) + e) * this._pixelRatio,\n              r = (t.boundsHeight(i) + e) * this._pixelRatio;\n\n        this._mark(s, o, h, r, t.id);\n      }\n    } while (t.peekId() === s && t.next());\n\n    t.restore();\n  }\n\n}\n\nexport { l as CollisionBitsetGrid, r as HAS_COLLISION, o as NONE, h as OUTSIDE_EXTENT };","map":{"version":3,"names":["clamp","t","StaticBitSet","s","e","i","o","h","r","l","constructor","_debugMap","Map","_width","_height","_pixelRatio","Math","ceil","_cols","_rows","_cells","create","insertMetrics","_hasCollision","_markMetrics","getCellId","has","hasRange","set","setRange","_collide","n","c","a","_","d","u","floor","p","M","f","_mark","id","save","boundsCount","boundsComputedAnchorX","boundsComputedAnchorY","boundsWidth","boundsHeight","peekId","next","restore","CollisionBitsetGrid","HAS_COLLISION","NONE","OUTSIDE_EXTENT"],"sources":["E:/各个学科/论文/毕业论文/Atmosphere/eco-friendly/node_modules/@arcgis/core/views/2d/engine/webgl/collisions/CollisionGrid.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{clamp as t}from\"../../../../../core/mathUtils.js\";import{StaticBitSet as s}from\"../../../layers/features/support/StaticBitSet.js\";const e=2,i=1,o=0,h=1,r=2;class l{constructor(t,e,o){this._debugMap=new Map,this._width=t*o,this._height=e*o,this._pixelRatio=o;const h=Math.ceil(this._width/i),r=Math.ceil(this._height/i);this._cols=h,this._rows=r,this._cells=s.create(h*r)}insertMetrics(t){const s=this._hasCollision(t);return s===o&&this._markMetrics(t),s}getCellId(t,s){return t+s*this._cols}has(t){return this._cells.has(t)}hasRange(t,s){return this._cells.hasRange(t,s)}set(t){this._cells.set(t)}setRange(t,s){this._cells.setRange(t,s)}_collide(s,e,l,n){const c=s-l/2,a=e-n/2,_=c+l,d=a+n;if(_<0||d<0||c>this._width||a>this._height)return h;const u=t(Math.floor(c/i),0,this._cols),p=t(Math.floor(a/i),0,this._rows),M=t(Math.ceil(_/i),0,this._cols),f=t(Math.ceil(d/i),0,this._rows);for(let t=p;t<=f;t++)for(let s=u;s<=M;s++){const e=this.getCellId(s,t);if(this.has(e))return r}return o}_mark(s,e,o,h,r){const l=s-o/2,n=e-h/2,c=l+o,a=n+h,_=t(Math.floor(l/i),0,this._cols),d=t(Math.floor(n/i),0,this._rows),u=t(Math.ceil(c/i),0,this._cols),p=t(Math.ceil(a/i),0,this._rows);for(let t=d;t<=p;t++)for(let s=_;s<=u;s++){const e=this.getCellId(s,t);this._debugMap.set(e,r),this.set(e)}return!1}_hasCollision(t){const s=t.id;let i=0,l=0;t.save();do{const s=t.boundsCount;i+=s;for(let i=0;i<s;i++){const s=t.boundsComputedAnchorX(i),o=t.boundsComputedAnchorY(i),n=(t.boundsWidth(i)+e)*this._pixelRatio,c=(t.boundsHeight(i)+e)*this._pixelRatio;switch(this._collide(s,o,n,c)){case r:return r;case h:l++}}}while(t.peekId()===s&&t.next());return t.restore(),i===l?h:o}_markMetrics(t){const s=t.id;t.save();do{const s=t.boundsCount;for(let i=0;i<s;i++){const s=t.boundsComputedAnchorX(i),o=t.boundsComputedAnchorY(i),h=(t.boundsWidth(i)+e)*this._pixelRatio,r=(t.boundsHeight(i)+e)*this._pixelRatio;this._mark(s,o,h,r,t.id)}}while(t.peekId()===s&&t.next());t.restore()}}export{l as CollisionBitsetGrid,r as HAS_COLLISION,o as NONE,h as OUTSIDE_EXTENT};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}