{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport has from \"../../../../../../core/has.js\";\nimport { isSome as e, unwrap as t } from \"../../../../../../core/maybe.js\";\nimport r from \"../../../../../../core/workers/Connection.js\";\nimport { toQuantizationTransform as s } from \"../../../../../../geometry/support/quantizationUtils.js\";\nimport { convertFromFeatureSet as i, quantizeOptimizedFeatureSet as a } from \"../../../../../../layers/graphics/featureConversionUtils.js\";\nimport { queryOptimizedFeatureSet as o } from \"../../../../../../layers/ogc/ogcFeatureUtils.js\";\nimport { executeQueryPBFBuffer as n, executeQuery as c } from \"../../../../../../rest/query/operations/query.js\";\nimport { FeatureSetReaderJSON as u } from \"../../support/FeatureSetReaderJSON.js\";\nimport { FeatureSetReaderPBF as m } from \"../../support/FeatureSetReaderPBF.js\";\n\nclass p {\n  constructor(e) {\n    this.service = e;\n  }\n\n  destroy() {}\n\n}\n\nfunction f(e) {\n  return Array.isArray(e.source);\n}\n\nfunction l(e) {\n  return \"ogc-source\" === e?.type;\n}\n\nfunction y(e) {\n  const {\n    capabilities: t\n  } = e;\n  return l(e.source) ? new q(e) : f(e) ? new d(e) : t.query.supportsFormatPBF && has(\"featurelayer-pbf\") ? new v(e) : new F(e);\n}\n\nasync function h(e) {\n  const t = new r();\n  return await t.open(e, {}), t;\n}\n\nclass d extends p {\n  constructor(e) {\n    super(e), this._portsOpen = h(e.source).then(e => this.client = e);\n  }\n\n  destroy() {\n    this.client.close(), this.client = null;\n  }\n\n  async executeQuery(e, t) {\n    await this._portsOpen;\n    const r = await this.client.invoke(\"queryFeatures\", e.toJSON(), t);\n    return u.fromFeatureSet(r, this.service);\n  }\n\n}\n\nclass v extends p {\n  async executeQuery(e, t) {\n    const {\n      data: r\n    } = await n(this.service.source, e, t),\n          s = !e.quantizationParameters;\n    return m.fromBuffer(r, this.service, s);\n  }\n\n}\n\nclass F extends p {\n  async executeQuery(r, o) {\n    const {\n      source: n,\n      capabilities: m,\n      spatialReference: p,\n      objectIdField: f,\n      geometryType: l\n    } = this.service;\n\n    if (e(r.quantizationParameters) && !m.query.supportsQuantization) {\n      const e = r.clone(),\n            m = s(t(e.quantizationParameters));\n      e.quantizationParameters = null;\n      const {\n        data: l\n      } = await c(n, e, p, o),\n            y = i(l, f);\n      return a(m, y), u.fromOptimizedFeatureSet(y, this.service);\n    }\n\n    const {\n      data: y\n    } = await c(n, r, this.service.spatialReference, o);\n    return \"esriGeometryPoint\" === l && (y.features = y.features?.filter(t => {\n      if (e(t.geometry)) {\n        const e = t.geometry;\n        return Number.isFinite(e.x) && Number.isFinite(e.y);\n      }\n\n      return !0;\n    })), u.fromFeatureSet(y, this.service);\n  }\n\n}\n\nclass q extends p {\n  async executeQuery(e, r) {\n    const {\n      capabilities: i\n    } = this.service;\n\n    if (e.quantizationParameters && !i.query.supportsQuantization) {\n      const i = e.clone(),\n            n = s(t(i.quantizationParameters));\n      i.quantizationParameters = null;\n      const c = await o(this.service.source, e, r);\n      return a(n, c), u.fromOptimizedFeatureSet(c, this.service);\n    }\n\n    const n = await o(this.service.source, e, r);\n    return u.fromOptimizedFeatureSet(n, this.service);\n  }\n\n}\n\nexport { p as SourceAdapter, y as createSourceAdapter };","map":{"version":3,"names":["has","isSome","e","unwrap","t","r","toQuantizationTransform","s","convertFromFeatureSet","i","quantizeOptimizedFeatureSet","a","queryOptimizedFeatureSet","o","executeQueryPBFBuffer","n","executeQuery","c","FeatureSetReaderJSON","u","FeatureSetReaderPBF","m","p","constructor","service","destroy","f","Array","isArray","source","l","type","y","capabilities","q","d","query","supportsFormatPBF","v","F","h","open","_portsOpen","then","client","close","invoke","toJSON","fromFeatureSet","data","quantizationParameters","fromBuffer","spatialReference","objectIdField","geometryType","supportsQuantization","clone","fromOptimizedFeatureSet","features","filter","geometry","Number","isFinite","x","SourceAdapter","createSourceAdapter"],"sources":["E:/各个学科/论文/毕业论文/Atmosphere/eco-friendly/node_modules/@arcgis/core/views/2d/layers/features/controllers/support/sourceAdapters.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport has from\"../../../../../../core/has.js\";import{isSome as e,unwrap as t}from\"../../../../../../core/maybe.js\";import r from\"../../../../../../core/workers/Connection.js\";import{toQuantizationTransform as s}from\"../../../../../../geometry/support/quantizationUtils.js\";import{convertFromFeatureSet as i,quantizeOptimizedFeatureSet as a}from\"../../../../../../layers/graphics/featureConversionUtils.js\";import{queryOptimizedFeatureSet as o}from\"../../../../../../layers/ogc/ogcFeatureUtils.js\";import{executeQueryPBFBuffer as n,executeQuery as c}from\"../../../../../../rest/query/operations/query.js\";import{FeatureSetReaderJSON as u}from\"../../support/FeatureSetReaderJSON.js\";import{FeatureSetReaderPBF as m}from\"../../support/FeatureSetReaderPBF.js\";class p{constructor(e){this.service=e}destroy(){}}function f(e){return Array.isArray(e.source)}function l(e){return\"ogc-source\"===e?.type}function y(e){const{capabilities:t}=e;return l(e.source)?new q(e):f(e)?new d(e):t.query.supportsFormatPBF&&has(\"featurelayer-pbf\")?new v(e):new F(e)}async function h(e){const t=new r;return await t.open(e,{}),t}class d extends p{constructor(e){super(e),this._portsOpen=h(e.source).then((e=>this.client=e))}destroy(){this.client.close(),this.client=null}async executeQuery(e,t){await this._portsOpen;const r=await this.client.invoke(\"queryFeatures\",e.toJSON(),t);return u.fromFeatureSet(r,this.service)}}class v extends p{async executeQuery(e,t){const{data:r}=await n(this.service.source,e,t),s=!e.quantizationParameters;return m.fromBuffer(r,this.service,s)}}class F extends p{async executeQuery(r,o){const{source:n,capabilities:m,spatialReference:p,objectIdField:f,geometryType:l}=this.service;if(e(r.quantizationParameters)&&!m.query.supportsQuantization){const e=r.clone(),m=s(t(e.quantizationParameters));e.quantizationParameters=null;const{data:l}=await c(n,e,p,o),y=i(l,f);return a(m,y),u.fromOptimizedFeatureSet(y,this.service)}const{data:y}=await c(n,r,this.service.spatialReference,o);return\"esriGeometryPoint\"===l&&(y.features=y.features?.filter((t=>{if(e(t.geometry)){const e=t.geometry;return Number.isFinite(e.x)&&Number.isFinite(e.y)}return!0}))),u.fromFeatureSet(y,this.service)}}class q extends p{async executeQuery(e,r){const{capabilities:i}=this.service;if(e.quantizationParameters&&!i.query.supportsQuantization){const i=e.clone(),n=s(t(i.quantizationParameters));i.quantizationParameters=null;const c=await o(this.service.source,e,r);return a(n,c),u.fromOptimizedFeatureSet(c,this.service)}const n=await o(this.service.source,e,r);return u.fromOptimizedFeatureSet(n,this.service)}}export{p as SourceAdapter,y as createSourceAdapter};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}