{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport { isNone as e, isSome as i } from \"../../../../core/maybe.js\";\nimport o from \"../../../../core/PooledArray.js\";\nimport { NodeState as s } from \"./I3SNode.js\";\nimport { FadeDirection as d } from \"../support/I3SLayerView.js\";\n\nclass t {\n  constructor(e) {\n    this.layerView = e, this._lodGlobalDirty = !1;\n  }\n\n  startNodeLoading(e, i, o, s) {\n    this._maxLodLevel = s.maxLodLevel, this._index = o, this._isNodeInScaleBounds = e, this._removeNodes = i;\n  }\n\n  shouldLoadNode(i) {\n    if (e(i)) return !1;\n\n    const o = this._index.nodeTraversalState(i);\n\n    return !!this._isChosenMaxLOD(o) || !!o.isChosen && this._childrenRequireLoading(i);\n  }\n\n  setLodGlobalDirty() {\n    this._lodGlobalDirty = !0;\n  }\n\n  get requiresLODGlobalHandling() {\n    return null != this._index && !0 === this._lodGlobalDirty;\n  }\n\n  lodGlobalHandling(e) {\n    if (!this.requiresLODGlobalHandling) return !1;\n    this._lodGlobalDirty = !1;\n    const i = this.layerView.view.resourceController.memoryController.usedMemory,\n          o = Math.max(0, Math.floor(10 * (i - 1)));\n    r.clear(), this._lodGlobalHandling(this._index.rootNode, o, !1, this.layerView.nodeCrossfadingEnabled);\n    const s = r.length;\n\n    this._removeNodes(r, e);\n\n    const d = r.length < s;\n    return 0 !== r.length && (this._lodGlobalDirty = !0), r.clear(), d;\n  }\n\n  _lodGlobalHandling(o, t, l, n) {\n    if (e(o)) return !1;\n\n    const a = o.index,\n          h = this._index,\n          u = this.layerView,\n          c = h.nodeTraversalState(o),\n          _ = this._isChosenMaxLOD(c),\n          x = !o.resources.hasFeatureData;\n\n    if (_ && x) return o.childrenLoaded > 0 && this._removeChildrenRecursive(o), !0;\n    const L = u.isNodeLoaded(a);\n\n    if (n && L && _) {\n      const e = !l && this.hasNoVisibleChildren(o);\n      u.fadeNode(a, d.FadeIn, !e);\n    }\n\n    const N = L && (!u.isNodeFullyFadedIn || u.isNodeFullyFadedIn(a));\n    if (L && (u.updateNodeState(a, _ ? s.Leaf : s.Hole), _)) return N && this._removeChildrenRecursive(o), N;\n    const m = o.childCount > 0;\n    let y = m;\n    if (m) for (let e = 0; e < o.childCount; e++) {\n      const o = h.getChildIndex(a, e),\n            s = h.getNode(o);\n\n      if (i(s)) {\n        !(!h.isGeometryVisible(o) || this._lodGlobalHandling(s, t, l || N, n)) && this._isNodeInScaleBounds(s) && (y = !1);\n      } else h.isNodeVisible(o) && (y = !1);\n    }\n    const b = L && !_ && (y || r.length < t);\n    b && r.push(a), !n || b || !L || l || y || u.fadeNode(a, d.FadeIn, !1);\n    const f = !o.resources.hasFeatureData;\n    return y || N && !b || f;\n  }\n\n  _removeChildrenRecursive(e) {\n    this._index.traverseChildren(e, e => ((this.layerView.isNodeLoaded(e.index) || this.layerView.isNodeReloading(e.index)) && r.push(e.index), e.childrenLoaded > 0));\n  }\n\n  hasNoVisibleChildren(e) {\n    let i = !0;\n    return this._index.traverseChildren(e, e => !(!i || !this._index.isNodeVisible(e.index)) && (this.layerView.isNodeLoaded(e.index) ? (i = !1, !1) : e.childrenLoaded > 0)), i;\n  }\n\n  _childrenRequireLoading(e) {\n    let i = !1,\n        o = !0;\n    return this._index.traverseChildren(e, e => {\n      if (!o || !this._index.isNodeVisible(e.index)) return !1;\n\n      const s = this._index.nodeTraversalState(e);\n\n      return this._isChosenMaxLOD(s) && this._index.isGeometryVisible(e.index) && (i = !0), this.layerView.isNodeLoaded(e.index) ? (o = !1, !1) : e.childrenLoaded > 0;\n    }), o && i;\n  }\n\n  _isChosenMaxLOD(e) {\n    return e.isChosen && (!e.nodeHasLOD || e.lodLevel === this._maxLodLevel);\n  }\n\n}\n\nconst r = new o({\n  deallocator: null\n});\nexport { t as default };","map":{"version":3,"names":["isNone","e","isSome","i","o","NodeState","s","FadeDirection","d","t","constructor","layerView","_lodGlobalDirty","startNodeLoading","_maxLodLevel","maxLodLevel","_index","_isNodeInScaleBounds","_removeNodes","shouldLoadNode","nodeTraversalState","_isChosenMaxLOD","isChosen","_childrenRequireLoading","setLodGlobalDirty","requiresLODGlobalHandling","lodGlobalHandling","view","resourceController","memoryController","usedMemory","Math","max","floor","r","clear","_lodGlobalHandling","rootNode","nodeCrossfadingEnabled","length","l","n","a","index","h","u","c","_","x","resources","hasFeatureData","childrenLoaded","_removeChildrenRecursive","L","isNodeLoaded","hasNoVisibleChildren","fadeNode","FadeIn","N","isNodeFullyFadedIn","updateNodeState","Leaf","Hole","m","childCount","y","getChildIndex","getNode","isGeometryVisible","isNodeVisible","b","push","f","traverseChildren","isNodeReloading","nodeHasLOD","lodLevel","deallocator","default"],"sources":["C:/Users/hp/Desktop/eco-friendly atmosphere/Atmosphere/eco-friendly/node_modules/@arcgis/core/views/3d/layers/i3s/I3SLodHandling.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport{isNone as e,isSome as i}from\"../../../../core/maybe.js\";import o from\"../../../../core/PooledArray.js\";import{NodeState as s}from\"./I3SNode.js\";import{FadeDirection as d}from\"../support/I3SLayerView.js\";class t{constructor(e){this.layerView=e,this._lodGlobalDirty=!1}startNodeLoading(e,i,o,s){this._maxLodLevel=s.maxLodLevel,this._index=o,this._isNodeInScaleBounds=e,this._removeNodes=i}shouldLoadNode(i){if(e(i))return!1;const o=this._index.nodeTraversalState(i);return!!this._isChosenMaxLOD(o)||!!o.isChosen&&this._childrenRequireLoading(i)}setLodGlobalDirty(){this._lodGlobalDirty=!0}get requiresLODGlobalHandling(){return null!=this._index&&!0===this._lodGlobalDirty}lodGlobalHandling(e){if(!this.requiresLODGlobalHandling)return!1;this._lodGlobalDirty=!1;const i=this.layerView.view.resourceController.memoryController.usedMemory,o=Math.max(0,Math.floor(10*(i-1)));r.clear(),this._lodGlobalHandling(this._index.rootNode,o,!1,this.layerView.nodeCrossfadingEnabled);const s=r.length;this._removeNodes(r,e);const d=r.length<s;return 0!==r.length&&(this._lodGlobalDirty=!0),r.clear(),d}_lodGlobalHandling(o,t,l,n){if(e(o))return!1;const a=o.index,h=this._index,u=this.layerView,c=h.nodeTraversalState(o),_=this._isChosenMaxLOD(c),x=!o.resources.hasFeatureData;if(_&&x)return o.childrenLoaded>0&&this._removeChildrenRecursive(o),!0;const L=u.isNodeLoaded(a);if(n&&L&&_){const e=!l&&this.hasNoVisibleChildren(o);u.fadeNode(a,d.FadeIn,!e)}const N=L&&(!u.isNodeFullyFadedIn||u.isNodeFullyFadedIn(a));if(L&&(u.updateNodeState(a,_?s.Leaf:s.Hole),_))return N&&this._removeChildrenRecursive(o),N;const m=o.childCount>0;let y=m;if(m)for(let e=0;e<o.childCount;e++){const o=h.getChildIndex(a,e),s=h.getNode(o);if(i(s)){!(!h.isGeometryVisible(o)||this._lodGlobalHandling(s,t,l||N,n))&&this._isNodeInScaleBounds(s)&&(y=!1)}else h.isNodeVisible(o)&&(y=!1)}const b=L&&!_&&(y||r.length<t);b&&r.push(a),!n||b||!L||l||y||u.fadeNode(a,d.FadeIn,!1);const f=!o.resources.hasFeatureData;return y||N&&!b||f}_removeChildrenRecursive(e){this._index.traverseChildren(e,(e=>((this.layerView.isNodeLoaded(e.index)||this.layerView.isNodeReloading(e.index))&&r.push(e.index),e.childrenLoaded>0)))}hasNoVisibleChildren(e){let i=!0;return this._index.traverseChildren(e,(e=>!(!i||!this._index.isNodeVisible(e.index))&&(this.layerView.isNodeLoaded(e.index)?(i=!1,!1):e.childrenLoaded>0))),i}_childrenRequireLoading(e){let i=!1,o=!0;return this._index.traverseChildren(e,(e=>{if(!o||!this._index.isNodeVisible(e.index))return!1;const s=this._index.nodeTraversalState(e);return this._isChosenMaxLOD(s)&&this._index.isGeometryVisible(e.index)&&(i=!0),this.layerView.isNodeLoaded(e.index)?(o=!1,!1):e.childrenLoaded>0})),o&&i}_isChosenMaxLOD(e){return e.isChosen&&(!e.nodeHasLOD||e.lodLevel===this._maxLodLevel)}}const r=new o({deallocator:null});export{t as default};\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA,SAAOA,MAAM,IAAIC,CAAjB,EAAmBC,MAAM,IAAIC,CAA7B,QAAmC,2BAAnC;AAA+D,OAAOC,CAAP,MAAa,iCAAb;AAA+C,SAAOC,SAAS,IAAIC,CAApB,QAA0B,cAA1B;AAAyC,SAAOC,aAAa,IAAIC,CAAxB,QAA8B,4BAA9B;;AAA2D,MAAMC,CAAN,CAAO;EAACC,WAAW,CAACT,CAAD,EAAG;IAAC,KAAKU,SAAL,GAAeV,CAAf,EAAiB,KAAKW,eAAL,GAAqB,CAAC,CAAvC;EAAyC;;EAAAC,gBAAgB,CAACZ,CAAD,EAAGE,CAAH,EAAKC,CAAL,EAAOE,CAAP,EAAS;IAAC,KAAKQ,YAAL,GAAkBR,CAAC,CAACS,WAApB,EAAgC,KAAKC,MAAL,GAAYZ,CAA5C,EAA8C,KAAKa,oBAAL,GAA0BhB,CAAxE,EAA0E,KAAKiB,YAAL,GAAkBf,CAA5F;EAA8F;;EAAAgB,cAAc,CAAChB,CAAD,EAAG;IAAC,IAAGF,CAAC,CAACE,CAAD,CAAJ,EAAQ,OAAM,CAAC,CAAP;;IAAS,MAAMC,CAAC,GAAC,KAAKY,MAAL,CAAYI,kBAAZ,CAA+BjB,CAA/B,CAAR;;IAA0C,OAAM,CAAC,CAAC,KAAKkB,eAAL,CAAqBjB,CAArB,CAAF,IAA2B,CAAC,CAACA,CAAC,CAACkB,QAAJ,IAAc,KAAKC,uBAAL,CAA6BpB,CAA7B,CAA/C;EAA+E;;EAAAqB,iBAAiB,GAAE;IAAC,KAAKZ,eAAL,GAAqB,CAAC,CAAtB;EAAwB;;EAA6B,IAAzBa,yBAAyB,GAAE;IAAC,OAAO,QAAM,KAAKT,MAAX,IAAmB,CAAC,CAAD,KAAK,KAAKJ,eAApC;EAAoD;;EAAAc,iBAAiB,CAACzB,CAAD,EAAG;IAAC,IAAG,CAAC,KAAKwB,yBAAT,EAAmC,OAAM,CAAC,CAAP;IAAS,KAAKb,eAAL,GAAqB,CAAC,CAAtB;IAAwB,MAAMT,CAAC,GAAC,KAAKQ,SAAL,CAAegB,IAAf,CAAoBC,kBAApB,CAAuCC,gBAAvC,CAAwDC,UAAhE;IAAA,MAA2E1B,CAAC,GAAC2B,IAAI,CAACC,GAAL,CAAS,CAAT,EAAWD,IAAI,CAACE,KAAL,CAAW,MAAI9B,CAAC,GAAC,CAAN,CAAX,CAAX,CAA7E;IAA8G+B,CAAC,CAACC,KAAF,IAAU,KAAKC,kBAAL,CAAwB,KAAKpB,MAAL,CAAYqB,QAApC,EAA6CjC,CAA7C,EAA+C,CAAC,CAAhD,EAAkD,KAAKO,SAAL,CAAe2B,sBAAjE,CAAV;IAAmG,MAAMhC,CAAC,GAAC4B,CAAC,CAACK,MAAV;;IAAiB,KAAKrB,YAAL,CAAkBgB,CAAlB,EAAoBjC,CAApB;;IAAuB,MAAMO,CAAC,GAAC0B,CAAC,CAACK,MAAF,GAASjC,CAAjB;IAAmB,OAAO,MAAI4B,CAAC,CAACK,MAAN,KAAe,KAAK3B,eAAL,GAAqB,CAAC,CAArC,GAAwCsB,CAAC,CAACC,KAAF,EAAxC,EAAkD3B,CAAzD;EAA2D;;EAAA4B,kBAAkB,CAAChC,CAAD,EAAGK,CAAH,EAAK+B,CAAL,EAAOC,CAAP,EAAS;IAAC,IAAGxC,CAAC,CAACG,CAAD,CAAJ,EAAQ,OAAM,CAAC,CAAP;;IAAS,MAAMsC,CAAC,GAACtC,CAAC,CAACuC,KAAV;IAAA,MAAgBC,CAAC,GAAC,KAAK5B,MAAvB;IAAA,MAA8B6B,CAAC,GAAC,KAAKlC,SAArC;IAAA,MAA+CmC,CAAC,GAACF,CAAC,CAACxB,kBAAF,CAAqBhB,CAArB,CAAjD;IAAA,MAAyE2C,CAAC,GAAC,KAAK1B,eAAL,CAAqByB,CAArB,CAA3E;IAAA,MAAmGE,CAAC,GAAC,CAAC5C,CAAC,CAAC6C,SAAF,CAAYC,cAAlH;;IAAiI,IAAGH,CAAC,IAAEC,CAAN,EAAQ,OAAO5C,CAAC,CAAC+C,cAAF,GAAiB,CAAjB,IAAoB,KAAKC,wBAAL,CAA8BhD,CAA9B,CAApB,EAAqD,CAAC,CAA7D;IAA+D,MAAMiD,CAAC,GAACR,CAAC,CAACS,YAAF,CAAeZ,CAAf,CAAR;;IAA0B,IAAGD,CAAC,IAAEY,CAAH,IAAMN,CAAT,EAAW;MAAC,MAAM9C,CAAC,GAAC,CAACuC,CAAD,IAAI,KAAKe,oBAAL,CAA0BnD,CAA1B,CAAZ;MAAyCyC,CAAC,CAACW,QAAF,CAAWd,CAAX,EAAalC,CAAC,CAACiD,MAAf,EAAsB,CAACxD,CAAvB;IAA0B;;IAAA,MAAMyD,CAAC,GAACL,CAAC,KAAG,CAACR,CAAC,CAACc,kBAAH,IAAuBd,CAAC,CAACc,kBAAF,CAAqBjB,CAArB,CAA1B,CAAT;IAA4D,IAAGW,CAAC,KAAGR,CAAC,CAACe,eAAF,CAAkBlB,CAAlB,EAAoBK,CAAC,GAACzC,CAAC,CAACuD,IAAH,GAAQvD,CAAC,CAACwD,IAA/B,GAAqCf,CAAxC,CAAJ,EAA+C,OAAOW,CAAC,IAAE,KAAKN,wBAAL,CAA8BhD,CAA9B,CAAH,EAAoCsD,CAA3C;IAA6C,MAAMK,CAAC,GAAC3D,CAAC,CAAC4D,UAAF,GAAa,CAArB;IAAuB,IAAIC,CAAC,GAACF,CAAN;IAAQ,IAAGA,CAAH,EAAK,KAAI,IAAI9D,CAAC,GAAC,CAAV,EAAYA,CAAC,GAACG,CAAC,CAAC4D,UAAhB,EAA2B/D,CAAC,EAA5B,EAA+B;MAAC,MAAMG,CAAC,GAACwC,CAAC,CAACsB,aAAF,CAAgBxB,CAAhB,EAAkBzC,CAAlB,CAAR;MAAA,MAA6BK,CAAC,GAACsC,CAAC,CAACuB,OAAF,CAAU/D,CAAV,CAA/B;;MAA4C,IAAGD,CAAC,CAACG,CAAD,CAAJ,EAAQ;QAAC,EAAE,CAACsC,CAAC,CAACwB,iBAAF,CAAoBhE,CAApB,CAAD,IAAyB,KAAKgC,kBAAL,CAAwB9B,CAAxB,EAA0BG,CAA1B,EAA4B+B,CAAC,IAAEkB,CAA/B,EAAiCjB,CAAjC,CAA3B,KAAiE,KAAKxB,oBAAL,CAA0BX,CAA1B,CAAjE,KAAgG2D,CAAC,GAAC,CAAC,CAAnG;MAAsG,CAA/G,MAAoHrB,CAAC,CAACyB,aAAF,CAAgBjE,CAAhB,MAAqB6D,CAAC,GAAC,CAAC,CAAxB;IAA2B;IAAA,MAAMK,CAAC,GAACjB,CAAC,IAAE,CAACN,CAAJ,KAAQkB,CAAC,IAAE/B,CAAC,CAACK,MAAF,GAAS9B,CAApB,CAAR;IAA+B6D,CAAC,IAAEpC,CAAC,CAACqC,IAAF,CAAO7B,CAAP,CAAH,EAAa,CAACD,CAAD,IAAI6B,CAAJ,IAAO,CAACjB,CAAR,IAAWb,CAAX,IAAcyB,CAAd,IAAiBpB,CAAC,CAACW,QAAF,CAAWd,CAAX,EAAalC,CAAC,CAACiD,MAAf,EAAsB,CAAC,CAAvB,CAA9B;IAAwD,MAAMe,CAAC,GAAC,CAACpE,CAAC,CAAC6C,SAAF,CAAYC,cAArB;IAAoC,OAAOe,CAAC,IAAEP,CAAC,IAAE,CAACY,CAAP,IAAUE,CAAjB;EAAmB;;EAAApB,wBAAwB,CAACnD,CAAD,EAAG;IAAC,KAAKe,MAAL,CAAYyD,gBAAZ,CAA6BxE,CAA7B,EAAgCA,CAAC,KAAG,CAAC,KAAKU,SAAL,CAAe2C,YAAf,CAA4BrD,CAAC,CAAC0C,KAA9B,KAAsC,KAAKhC,SAAL,CAAe+D,eAAf,CAA+BzE,CAAC,CAAC0C,KAAjC,CAAvC,KAAiFT,CAAC,CAACqC,IAAF,CAAOtE,CAAC,CAAC0C,KAAT,CAAjF,EAAiG1C,CAAC,CAACkD,cAAF,GAAiB,CAArH,CAAjC;EAA2J;;EAAAI,oBAAoB,CAACtD,CAAD,EAAG;IAAC,IAAIE,CAAC,GAAC,CAAC,CAAP;IAAS,OAAO,KAAKa,MAAL,CAAYyD,gBAAZ,CAA6BxE,CAA7B,EAAgCA,CAAC,IAAE,EAAE,CAACE,CAAD,IAAI,CAAC,KAAKa,MAAL,CAAYqD,aAAZ,CAA0BpE,CAAC,CAAC0C,KAA5B,CAAP,MAA6C,KAAKhC,SAAL,CAAe2C,YAAf,CAA4BrD,CAAC,CAAC0C,KAA9B,KAAsCxC,CAAC,GAAC,CAAC,CAAH,EAAK,CAAC,CAA5C,IAA+CF,CAAC,CAACkD,cAAF,GAAiB,CAA7G,CAAnC,GAAqJhD,CAA5J;EAA8J;;EAAAoB,uBAAuB,CAACtB,CAAD,EAAG;IAAC,IAAIE,CAAC,GAAC,CAAC,CAAP;IAAA,IAASC,CAAC,GAAC,CAAC,CAAZ;IAAc,OAAO,KAAKY,MAAL,CAAYyD,gBAAZ,CAA6BxE,CAA7B,EAAgCA,CAAC,IAAE;MAAC,IAAG,CAACG,CAAD,IAAI,CAAC,KAAKY,MAAL,CAAYqD,aAAZ,CAA0BpE,CAAC,CAAC0C,KAA5B,CAAR,EAA2C,OAAM,CAAC,CAAP;;MAAS,MAAMrC,CAAC,GAAC,KAAKU,MAAL,CAAYI,kBAAZ,CAA+BnB,CAA/B,CAAR;;MAA0C,OAAO,KAAKoB,eAAL,CAAqBf,CAArB,KAAyB,KAAKU,MAAL,CAAYoD,iBAAZ,CAA8BnE,CAAC,CAAC0C,KAAhC,CAAzB,KAAkExC,CAAC,GAAC,CAAC,CAArE,GAAwE,KAAKQ,SAAL,CAAe2C,YAAf,CAA4BrD,CAAC,CAAC0C,KAA9B,KAAsCvC,CAAC,GAAC,CAAC,CAAH,EAAK,CAAC,CAA5C,IAA+CH,CAAC,CAACkD,cAAF,GAAiB,CAA/I;IAAiJ,CAAnR,GAAsR/C,CAAC,IAAED,CAAhS;EAAkS;;EAAAkB,eAAe,CAACpB,CAAD,EAAG;IAAC,OAAOA,CAAC,CAACqB,QAAF,KAAa,CAACrB,CAAC,CAAC0E,UAAH,IAAe1E,CAAC,CAAC2E,QAAF,KAAa,KAAK9D,YAA9C,CAAP;EAAmE;;AAAvgF;;AAAwgF,MAAMoB,CAAC,GAAC,IAAI9B,CAAJ,CAAM;EAACyE,WAAW,EAAC;AAAb,CAAN,CAAR;AAAkC,SAAOpE,CAAC,IAAIqE,OAAZ"},"metadata":{},"sourceType":"module"}