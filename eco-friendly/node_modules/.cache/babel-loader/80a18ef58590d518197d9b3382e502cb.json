{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport { result as r } from \"../../core/asyncUtils.js\";\nimport e from \"../../core/Error.js\";\nimport { isSome as o } from \"../../core/maybe.js\";\nimport { eachAlways as s, throwIfAborted as t } from \"../../core/promiseUtils.js\";\nimport { generateUUID as c } from \"../../core/uuid.js\";\nimport { getSiblingOfSameTypeI as p } from \"../../portal/support/resourceUtils.js\";\n\nasync function a(r, o, a) {\n  if (!o || !o.resources) return;\n  const h = o.portalItem === r.portalItem ? new Set(r.paths) : new Set();\n  r.paths.length = 0, r.portalItem = o.portalItem;\n  const i = new Set(o.resources.toKeep.map(r => r.resource.path)),\n        m = new Set(),\n        f = [];\n  i.forEach(e => {\n    h.delete(e), r.paths.push(e);\n  });\n\n  for (const e of o.resources.toUpdate) if (h.delete(e.resource.path), i.has(e.resource.path) || m.has(e.resource.path)) {\n    const {\n      resource: o,\n      content: s,\n      finish: t,\n      error: u\n    } = e,\n          h = p(o, c());\n    r.paths.push(h.path), f.push(n({\n      resource: h,\n      content: s,\n      compress: e.compress,\n      finish: t,\n      error: u\n    }, a));\n  } else r.paths.push(e.resource.path), f.push(u(e, a)), m.add(e.resource.path);\n\n  for (const e of o.resources.toAdd) f.push(n(e, a)), r.paths.push(e.resource.path);\n\n  if (h.forEach(r => {\n    const e = o.portalItem.resourceFromPath(r);\n    f.push(e.portalItem.removeResource(e).catch(() => {}));\n  }), 0 === f.length) return;\n  const l = await s(f);\n  t(a);\n  const d = l.filter(r => \"error\" in r).map(r => r.error);\n  if (d.length > 0) throw new e(\"save:resources\", \"Failed to save one or more resources\", {\n    errors: d\n  });\n}\n\nasync function n(e, s) {\n  const t = { ...(o(s) ? s : {}),\n    compress: e.compress\n  },\n        c = await r(e.resource.portalItem.addResource(e.resource, e.content, t));\n  if (!0 !== c.ok) throw e.error && e.error(c.error), c.error;\n  e.finish && e.finish(e.resource);\n}\n\nasync function u(e, o) {\n  const s = await r(e.resource.update(e.content, o));\n  if (!0 !== s.ok) throw e.error(s.error), s.error;\n  e.finish(e.resource);\n}\n\nexport { a as saveResources };","map":{"version":3,"names":["result","r","e","isSome","o","eachAlways","s","throwIfAborted","t","generateUUID","c","getSiblingOfSameTypeI","p","a","resources","h","portalItem","Set","paths","length","i","toKeep","map","resource","path","m","f","forEach","delete","push","toUpdate","has","content","finish","error","u","n","compress","add","toAdd","resourceFromPath","removeResource","catch","l","d","filter","errors","addResource","ok","update","saveResources"],"sources":["E:/各个学科/论文/毕业论文/Atmosphere/eco-friendly/node_modules/@arcgis/core/webdoc/support/saveUtils.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{result as r}from\"../../core/asyncUtils.js\";import e from\"../../core/Error.js\";import{isSome as o}from\"../../core/maybe.js\";import{eachAlways as s,throwIfAborted as t}from\"../../core/promiseUtils.js\";import{generateUUID as c}from\"../../core/uuid.js\";import{getSiblingOfSameTypeI as p}from\"../../portal/support/resourceUtils.js\";async function a(r,o,a){if(!o||!o.resources)return;const h=o.portalItem===r.portalItem?new Set(r.paths):new Set;r.paths.length=0,r.portalItem=o.portalItem;const i=new Set(o.resources.toKeep.map((r=>r.resource.path))),m=new Set,f=[];i.forEach((e=>{h.delete(e),r.paths.push(e)}));for(const e of o.resources.toUpdate)if(h.delete(e.resource.path),i.has(e.resource.path)||m.has(e.resource.path)){const{resource:o,content:s,finish:t,error:u}=e,h=p(o,c());r.paths.push(h.path),f.push(n({resource:h,content:s,compress:e.compress,finish:t,error:u},a))}else r.paths.push(e.resource.path),f.push(u(e,a)),m.add(e.resource.path);for(const e of o.resources.toAdd)f.push(n(e,a)),r.paths.push(e.resource.path);if(h.forEach((r=>{const e=o.portalItem.resourceFromPath(r);f.push(e.portalItem.removeResource(e).catch((()=>{})))})),0===f.length)return;const l=await s(f);t(a);const d=l.filter((r=>\"error\"in r)).map((r=>r.error));if(d.length>0)throw new e(\"save:resources\",\"Failed to save one or more resources\",{errors:d})}async function n(e,s){const t={...o(s)?s:{},compress:e.compress},c=await r(e.resource.portalItem.addResource(e.resource,e.content,t));if(!0!==c.ok)throw e.error&&e.error(c.error),c.error;e.finish&&e.finish(e.resource)}async function u(e,o){const s=await r(e.resource.update(e.content,o));if(!0!==s.ok)throw e.error(s.error),s.error;e.finish(e.resource)}export{a as saveResources};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}