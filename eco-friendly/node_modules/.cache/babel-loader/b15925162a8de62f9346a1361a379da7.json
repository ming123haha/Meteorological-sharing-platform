{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport has from \"../../../../../../core/has.js\";\nimport { createResolver as e } from \"../../../../../../core/promiseUtils.js\";\nimport { brushes as t } from \"../../../../engine/brushes.js\";\nimport { FeatureContainer as s } from \"../../../../engine/FeatureContainer.js\";\nimport { WGLDrawPhase as i } from \"../../../../engine/webgl/enums.js\";\nconst r = has(\"featurelayer-order-by-server-enabled\");\n\nclass a extends s {\n  constructor(e, t, s, i) {\n    super(e), this._hitTestsRequests = [], this._layer = s, this._layerView = t, this._onUpdate = i;\n  }\n\n  renderChildren(e) {\n    if (this.attributeView.update(), this.hasAnimation) {\n      e.painter.effects.integrate.draw(e, e.attributeView);\n    }\n\n    super.renderChildren(e);\n  }\n\n  hasEmptyAttributeView() {\n    return this.attributeView.isEmpty();\n  }\n\n  isUpdating() {\n    return this.attributeView.isUpdating();\n  }\n\n  hitTest(t) {\n    let s = this._hitTestsRequests.find(({\n      x: e,\n      y: s\n    }) => e === t.x && s === t.y);\n\n    const i = e();\n    return s ? s.resolvers.push(i) : (s = {\n      x: t.x,\n      y: t.y,\n      resolvers: [i]\n    }, this._hitTestsRequests.push(s)), this.requestRender(), i.promise;\n  }\n\n  onTileData(e, t) {\n    const s = r && \"orderBy\" in this._layer && this._layer.orderBy,\n          i = s?.length && !s[0].valueExpression && s[0].field,\n          a = s && this._layerView.orderByFields === i;\n    e.patch(t, a), this.contains(e) || this.addChild(e), this.requestRender();\n  }\n\n  onTileError(e) {\n    this.contains(e) || this.addChild(e);\n  }\n\n  updateTransitionProperties(e, t) {\n    super.updateTransitionProperties(e, t), this._layerView.featureEffectView.transitionStep(e, t), this._layerView.featureEffectView.transitioning && this.requestRender();\n  }\n\n  doRender(e) {\n    const {\n      minScale: t,\n      maxScale: s\n    } = this._layer,\n          i = e.state.scale;\n    i <= (t || 1 / 0) && i >= s && super.doRender(e);\n  }\n\n  afterRender(e) {\n    super.afterRender(e), this._hitTestsRequests.length && this.requestRender();\n  }\n\n  onAttributeStoreUpdate() {\n    this.hasLabels && this._layerView.view.labelManager.requestUpdate(), this._onUpdate();\n  }\n\n  get hasAnimation() {\n    return this.hasLabels;\n  }\n\n  setStencilReference(e) {\n    const {\n      rendererSchema: t\n    } = e.rendererInfo;\n\n    if (\"dot-density\" === t?.type && t?.dotSize > 1 || \"heatmap\" === t?.type) {\n      const e = 1;\n\n      for (const t of this.children) t.stencilRef = t.key.level + e;\n    } else super.setStencilReference(e);\n  }\n\n  get hasLabels() {\n    if (\"sublayers\" in this._layer) return this._layer.sublayers.some(e => e.labelingInfo && e.labelingInfo.length && e.labelsVisible);\n    const e = this._layer.featureReduction,\n          t = e && \"labelingInfo\" in e && e.labelsVisible && e.labelingInfo && e.labelingInfo.length;\n    return this._layer.labelingInfo && this._layer.labelingInfo.length && this._layer.labelsVisible || !!t;\n  }\n\n  prepareRenderPasses(e) {\n    const s = e.registerRenderPass({\n      name: \"label\",\n      brushes: [t.label],\n      target: () => this.hasLabels ? this.children : null,\n      drawPhase: i.LABEL | i.LABEL_ALPHA\n    }),\n          r = e.registerRenderPass({\n      name: \"geometry\",\n      brushes: [t.fill, t.dotDensity, t.line, t.marker, t.heatmap, t.pieChart, t.text],\n      target: () => this.children,\n      enableDefaultDraw: () => !this._layerView.featureEffectView.hasEffects,\n      effects: [{\n        apply: e.effects.outsideEffect,\n        enable: () => this._layerView.featureEffectView.hasEffects,\n        args: () => this._layerView.featureEffectView.excludedEffects\n      }, {\n        apply: e.effects.insideEffect,\n        enable: () => this._layerView.featureEffectView.hasEffects,\n        args: () => this._layerView.featureEffectView.includedEffects\n      }, {\n        apply: e.effects.hittest,\n        enable: () => !!this._hitTestsRequests.length,\n        args: () => this._hitTestsRequests\n      }]\n    }),\n          a = e.registerRenderPass({\n      name: \"highlight\",\n      brushes: [t.fill, t.dotDensity, t.line, t.marker, t.pieChart, t.text],\n      target: () => this.children,\n      drawPhase: i.HIGHLIGHT,\n      enableDefaultDraw: () => !1,\n      effects: [{\n        apply: e.effects.highlight,\n        enable: () => !!this._layerView.hasHighlight()\n      }]\n    });\n    return [...super.prepareRenderPasses(e), r, a, s];\n  }\n\n}\n\nexport { a as WGLFeatureView };","map":{"version":3,"names":["has","createResolver","e","brushes","t","FeatureContainer","s","WGLDrawPhase","i","r","a","constructor","_hitTestsRequests","_layer","_layerView","_onUpdate","renderChildren","attributeView","update","hasAnimation","painter","effects","integrate","draw","hasEmptyAttributeView","isEmpty","isUpdating","hitTest","find","x","y","resolvers","push","requestRender","promise","onTileData","orderBy","length","valueExpression","field","orderByFields","patch","contains","addChild","onTileError","updateTransitionProperties","featureEffectView","transitionStep","transitioning","doRender","minScale","maxScale","state","scale","afterRender","onAttributeStoreUpdate","hasLabels","view","labelManager","requestUpdate","setStencilReference","rendererSchema","rendererInfo","type","dotSize","children","stencilRef","key","level","sublayers","some","labelingInfo","labelsVisible","featureReduction","prepareRenderPasses","registerRenderPass","name","label","target","drawPhase","LABEL","LABEL_ALPHA","fill","dotDensity","line","marker","heatmap","pieChart","text","enableDefaultDraw","hasEffects","apply","outsideEffect","enable","args","excludedEffects","insideEffect","includedEffects","hittest","HIGHLIGHT","highlight","hasHighlight","WGLFeatureView"],"sources":["E:/各个学科/论文/毕业论文/Atmosphere/eco-friendly/node_modules/@arcgis/core/views/2d/layers/features/tileRenderers/support/WGLFeatureView.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport has from\"../../../../../../core/has.js\";import{createResolver as e}from\"../../../../../../core/promiseUtils.js\";import{brushes as t}from\"../../../../engine/brushes.js\";import{FeatureContainer as s}from\"../../../../engine/FeatureContainer.js\";import{WGLDrawPhase as i}from\"../../../../engine/webgl/enums.js\";const r=has(\"featurelayer-order-by-server-enabled\");class a extends s{constructor(e,t,s,i){super(e),this._hitTestsRequests=[],this._layer=s,this._layerView=t,this._onUpdate=i}renderChildren(e){if(this.attributeView.update(),this.hasAnimation){e.painter.effects.integrate.draw(e,e.attributeView)}super.renderChildren(e)}hasEmptyAttributeView(){return this.attributeView.isEmpty()}isUpdating(){return this.attributeView.isUpdating()}hitTest(t){let s=this._hitTestsRequests.find((({x:e,y:s})=>e===t.x&&s===t.y));const i=e();return s?s.resolvers.push(i):(s={x:t.x,y:t.y,resolvers:[i]},this._hitTestsRequests.push(s)),this.requestRender(),i.promise}onTileData(e,t){const s=r&&\"orderBy\"in this._layer&&this._layer.orderBy,i=s?.length&&!s[0].valueExpression&&s[0].field,a=s&&this._layerView.orderByFields===i;e.patch(t,a),this.contains(e)||this.addChild(e),this.requestRender()}onTileError(e){this.contains(e)||this.addChild(e)}updateTransitionProperties(e,t){super.updateTransitionProperties(e,t),this._layerView.featureEffectView.transitionStep(e,t),this._layerView.featureEffectView.transitioning&&this.requestRender()}doRender(e){const{minScale:t,maxScale:s}=this._layer,i=e.state.scale;i<=(t||1/0)&&i>=s&&super.doRender(e)}afterRender(e){super.afterRender(e),this._hitTestsRequests.length&&this.requestRender()}onAttributeStoreUpdate(){this.hasLabels&&this._layerView.view.labelManager.requestUpdate(),this._onUpdate()}get hasAnimation(){return this.hasLabels}setStencilReference(e){const{rendererSchema:t}=e.rendererInfo;if(\"dot-density\"===t?.type&&t?.dotSize>1||\"heatmap\"===t?.type){const e=1;for(const t of this.children)t.stencilRef=t.key.level+e}else super.setStencilReference(e)}get hasLabels(){if(\"sublayers\"in this._layer)return this._layer.sublayers.some((e=>e.labelingInfo&&e.labelingInfo.length&&e.labelsVisible));const e=this._layer.featureReduction,t=e&&\"labelingInfo\"in e&&e.labelsVisible&&e.labelingInfo&&e.labelingInfo.length;return this._layer.labelingInfo&&this._layer.labelingInfo.length&&this._layer.labelsVisible||!!t}prepareRenderPasses(e){const s=e.registerRenderPass({name:\"label\",brushes:[t.label],target:()=>this.hasLabels?this.children:null,drawPhase:i.LABEL|i.LABEL_ALPHA}),r=e.registerRenderPass({name:\"geometry\",brushes:[t.fill,t.dotDensity,t.line,t.marker,t.heatmap,t.pieChart,t.text],target:()=>this.children,enableDefaultDraw:()=>!this._layerView.featureEffectView.hasEffects,effects:[{apply:e.effects.outsideEffect,enable:()=>this._layerView.featureEffectView.hasEffects,args:()=>this._layerView.featureEffectView.excludedEffects},{apply:e.effects.insideEffect,enable:()=>this._layerView.featureEffectView.hasEffects,args:()=>this._layerView.featureEffectView.includedEffects},{apply:e.effects.hittest,enable:()=>!!this._hitTestsRequests.length,args:()=>this._hitTestsRequests}]}),a=e.registerRenderPass({name:\"highlight\",brushes:[t.fill,t.dotDensity,t.line,t.marker,t.pieChart,t.text],target:()=>this.children,drawPhase:i.HIGHLIGHT,enableDefaultDraw:()=>!1,effects:[{apply:e.effects.highlight,enable:()=>!!this._layerView.hasHighlight()}]});return[...super.prepareRenderPasses(e),r,a,s]}}export{a as WGLFeatureView};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}