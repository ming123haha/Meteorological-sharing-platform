{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport e from \"../../../core/Logger.js\";\nimport { eachAlways as r } from \"../../../core/promiseUtils.js\";\nimport t from \"../../../layers/FeatureLayer.js\";\nimport { applyTextFormattingHTML as a, htmlEntities as i } from \"./featureUtils.js\";\nconst s = [\"$datastore\", \"$map\", \"$layer\", \"$aggregatedfeatures\"],\n      n = \"esri.widgets.Feature.support.arcadeFeatureUtils\",\n      o = e.getLogger(n);\n\nfunction c(e) {\n  return \"string\" == typeof e ? a(i(e)) : Array.isArray(e) ? p(e) : \"esri.arcade.Dictionary\" === e?.declaredClass ? l(e) : e;\n}\n\nfunction p(e) {\n  return `<ul class=\"esri-widget__list\">${e.map(e => `<li>${\"string\" == typeof e ? a(i(e)) : e}</li>`).join(\"\")}</ul>`;\n}\n\nfunction l(e) {\n  return `<table class=\"esri-widget__table\">${e.keys().map(r => {\n    const t = e.field(r);\n    return `<tr><th>${r}</th><td>${\"string\" == typeof t ? a(i(t)) : t}</td></tr>`;\n  }).join(\"\")}</table>`;\n}\n\nfunction u({\n  aggregatedFeatures: e,\n  arcadeUtils: r,\n  featureSetVars: a,\n  context: i,\n  viewInfo: s,\n  map: n,\n  graphic: o,\n  interceptor: c\n}) {\n  a.forEach(a => {\n    const p = a.toLowerCase(),\n          l = {\n      map: n,\n      spatialReference: s.sr,\n      interceptor: c\n    };\n\n    if (\"$map\" === p && (i.vars[p] = r.convertMapToFeatureSetCollection(l)), \"$layer\" === p && (i.vars[p] = r.convertFeatureLayerToFeatureSet({\n      layer: o.sourceLayer,\n      spatialReference: s.sr,\n      interceptor: c\n    })), \"$datastore\" === p && (i.vars[p] = r.convertServiceUrlToWorkspace({\n      url: o.sourceLayer.url,\n      spatialReference: s.sr,\n      interceptor: c\n    })), \"$aggregatedfeatures\" === p) {\n      const a = o.layer,\n            {\n        fields: n,\n        objectIdField: l,\n        geometryType: u,\n        spatialReference: f,\n        displayField: g\n      } = a,\n            y = new t({\n        fields: n,\n        objectIdField: l,\n        geometryType: u,\n        spatialReference: f,\n        displayField: g,\n        ...(\"feature\" === a.type ? {\n          templates: a.templates,\n          typeIdField: a.typeIdField,\n          types: a.types\n        } : null),\n        source: e\n      });\n      i.vars[p] = r.convertFeatureLayerToFeatureSet({\n        layer: y,\n        spatialReference: s.sr,\n        interceptor: c\n      });\n    }\n  });\n}\n\nfunction f() {\n  return import(\"../../../support/arcadeUtils.js\");\n}\n\nasync function g({\n  graphic: e,\n  view: r\n}) {\n  const {\n    isAggregate: t,\n    layer: a\n  } = e;\n  if (!t || !a || \"2d\" !== r?.type) return [];\n  const i = await r.whenLayerView(a);\n  if (!i.createQuery || !i.queryFeatures) return [];\n  const s = i.createQuery();\n  s.aggregateIds = [e.getObjectId()];\n  const {\n    features: n\n  } = await i.queryFeatures(s);\n  return n;\n}\n\nasync function y({\n  expressionInfo: e,\n  arcadeUtils: r,\n  interceptor: t,\n  spatialReference: a,\n  map: i,\n  graphic: n,\n  view: c\n}) {\n  if (!e || !e.expression) return null;\n  const p = r.createSyntaxTree(e.expression),\n        l = s.filter(e => r.hasVariable(p, e)),\n        [f] = await Promise.all([g({\n    graphic: n,\n    view: c\n  }), r.loadScriptDependencies(p, !0, l)]),\n        y = r.getViewInfo({\n    spatialReference: a\n  }),\n        d = r.createExecContext(n, y);\n  d.interceptor = t, d.useAsync = !0, u({\n    aggregatedFeatures: f,\n    arcadeUtils: r,\n    featureSetVars: l,\n    context: d,\n    viewInfo: y,\n    map: i,\n    graphic: n,\n    interceptor: t\n  });\n  const m = r.createFunction(p, d);\n  return r.executeAsyncFunction(m, d).catch(r => o.error(\"arcade-execution-error\", {\n    error: r,\n    graphic: n,\n    expressionInfo: e\n  }));\n}\n\nasync function d({\n  expressionInfos: e,\n  spatialReference: t,\n  graphic: a,\n  interceptor: i,\n  map: s,\n  view: n\n}) {\n  if (!e || !e.length) return {};\n  const o = await f(),\n        p = {};\n\n  for (const r of e) p[`expression/${r.name}`] = y({\n    expressionInfo: r,\n    arcadeUtils: o,\n    interceptor: i,\n    spatialReference: t,\n    map: s,\n    graphic: a,\n    view: n\n  });\n\n  const l = await r(p),\n        u = {};\n\n  for (const r in l) u[r] = c(l[r].value);\n\n  return u;\n}\n\nexport { y as createCompiledExpression, d as createCompiledExpressions, f as loadArcadeUtils };","map":{"version":3,"names":["e","eachAlways","r","t","applyTextFormattingHTML","a","htmlEntities","i","s","n","o","getLogger","c","Array","isArray","p","declaredClass","l","map","join","keys","field","u","aggregatedFeatures","arcadeUtils","featureSetVars","context","viewInfo","graphic","interceptor","forEach","toLowerCase","spatialReference","sr","vars","convertMapToFeatureSetCollection","convertFeatureLayerToFeatureSet","layer","sourceLayer","convertServiceUrlToWorkspace","url","fields","objectIdField","geometryType","f","displayField","g","y","type","templates","typeIdField","types","source","view","isAggregate","whenLayerView","createQuery","queryFeatures","aggregateIds","getObjectId","features","expressionInfo","expression","createSyntaxTree","filter","hasVariable","Promise","all","loadScriptDependencies","getViewInfo","d","createExecContext","useAsync","m","createFunction","executeAsyncFunction","catch","error","expressionInfos","length","name","value","createCompiledExpression","createCompiledExpressions","loadArcadeUtils"],"sources":["C:/Users/hp/Desktop/eco-friendly atmosphere/Atmosphere/eco-friendly/node_modules/@arcgis/core/widgets/Feature/support/arcadeFeatureUtils.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport e from\"../../../core/Logger.js\";import{eachAlways as r}from\"../../../core/promiseUtils.js\";import t from\"../../../layers/FeatureLayer.js\";import{applyTextFormattingHTML as a,htmlEntities as i}from\"./featureUtils.js\";const s=[\"$datastore\",\"$map\",\"$layer\",\"$aggregatedfeatures\"],n=\"esri.widgets.Feature.support.arcadeFeatureUtils\",o=e.getLogger(n);function c(e){return\"string\"==typeof e?a(i(e)):Array.isArray(e)?p(e):\"esri.arcade.Dictionary\"===e?.declaredClass?l(e):e}function p(e){return`<ul class=\"esri-widget__list\">${e.map((e=>`<li>${\"string\"==typeof e?a(i(e)):e}</li>`)).join(\"\")}</ul>`}function l(e){return`<table class=\"esri-widget__table\">${e.keys().map((r=>{const t=e.field(r);return`<tr><th>${r}</th><td>${\"string\"==typeof t?a(i(t)):t}</td></tr>`})).join(\"\")}</table>`}function u({aggregatedFeatures:e,arcadeUtils:r,featureSetVars:a,context:i,viewInfo:s,map:n,graphic:o,interceptor:c}){a.forEach((a=>{const p=a.toLowerCase(),l={map:n,spatialReference:s.sr,interceptor:c};if(\"$map\"===p&&(i.vars[p]=r.convertMapToFeatureSetCollection(l)),\"$layer\"===p&&(i.vars[p]=r.convertFeatureLayerToFeatureSet({layer:o.sourceLayer,spatialReference:s.sr,interceptor:c})),\"$datastore\"===p&&(i.vars[p]=r.convertServiceUrlToWorkspace({url:o.sourceLayer.url,spatialReference:s.sr,interceptor:c})),\"$aggregatedfeatures\"===p){const a=o.layer,{fields:n,objectIdField:l,geometryType:u,spatialReference:f,displayField:g}=a,y=new t({fields:n,objectIdField:l,geometryType:u,spatialReference:f,displayField:g,...\"feature\"===a.type?{templates:a.templates,typeIdField:a.typeIdField,types:a.types}:null,source:e});i.vars[p]=r.convertFeatureLayerToFeatureSet({layer:y,spatialReference:s.sr,interceptor:c})}}))}function f(){return import(\"../../../support/arcadeUtils.js\")}async function g({graphic:e,view:r}){const{isAggregate:t,layer:a}=e;if(!t||!a||\"2d\"!==r?.type)return[];const i=await r.whenLayerView(a);if(!i.createQuery||!i.queryFeatures)return[];const s=i.createQuery();s.aggregateIds=[e.getObjectId()];const{features:n}=await i.queryFeatures(s);return n}async function y({expressionInfo:e,arcadeUtils:r,interceptor:t,spatialReference:a,map:i,graphic:n,view:c}){if(!e||!e.expression)return null;const p=r.createSyntaxTree(e.expression),l=s.filter((e=>r.hasVariable(p,e))),[f]=await Promise.all([g({graphic:n,view:c}),r.loadScriptDependencies(p,!0,l)]),y=r.getViewInfo({spatialReference:a}),d=r.createExecContext(n,y);d.interceptor=t,d.useAsync=!0,u({aggregatedFeatures:f,arcadeUtils:r,featureSetVars:l,context:d,viewInfo:y,map:i,graphic:n,interceptor:t});const m=r.createFunction(p,d);return r.executeAsyncFunction(m,d).catch((r=>o.error(\"arcade-execution-error\",{error:r,graphic:n,expressionInfo:e})))}async function d({expressionInfos:e,spatialReference:t,graphic:a,interceptor:i,map:s,view:n}){if(!e||!e.length)return{};const o=await f(),p={};for(const r of e)p[`expression/${r.name}`]=y({expressionInfo:r,arcadeUtils:o,interceptor:i,spatialReference:t,map:s,graphic:a,view:n});const l=await r(p),u={};for(const r in l)u[r]=c(l[r].value);return u}export{y as createCompiledExpression,d as createCompiledExpressions,f as loadArcadeUtils};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}