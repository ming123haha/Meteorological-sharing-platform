{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport \"../geometry.js\";\nimport e from \"../core/Error.js\";\nimport r from \"../core/Logger.js\";\nimport { isSome as t } from \"../core/maybe.js\";\nimport a from \"../geometry/SpatialReference.js\";\nconst s = r.getLogger(\"esri.support.arcadeOnDemand\");\nlet c;\n\nfunction i() {\n  return c || (c = (async () => {\n    const e = await import(\"./arcadeUtils.js\");\n    return {\n      arcade: e.arcade,\n      arcadeUtils: e,\n      Dictionary: e.Dictionary,\n      Feature: e.arcadeFeature\n    };\n  })()), c;\n}\n\nconst n = (e, r, t) => p.create(e, r, t, null, [\"$feature\"]),\n      o = (e, r, t) => p.create(e, r, t, null, [\"$feature\", \"$view\"]),\n      l = o,\n      u = (e, r, t, a) => p.create(e, r, t, a, [\"$feature\", \"$view\"]);\n\nclass p {\n  constructor(e, r, t, a, s, c, i, n) {\n    this.script = e, this.evaluate = s;\n    const o = Array.isArray(i) ? i : i.fields;\n    this.fields = o, this._syntaxTree = a, this._arcade = r, this._arcadeDictionary = t, this._arcadeFeature = c, this._spatialReference = n, this._referencesGeometry = r.scriptTouchesGeometry(this._syntaxTree), this._referencesScale = this._arcade.referencesMember(this._syntaxTree, \"scale\");\n  }\n\n  static async create(r, c, n, o, l, u) {\n    const {\n      arcade: d,\n      Feature: m,\n      Dictionary: f\n    } = await i(),\n          y = a.fromJSON(c);\n    let h = null;\n\n    try {\n      h = d.parseScript(r, u);\n    } catch (R) {\n      return s.error(new e(\"arcade-bad-expression\", \"Failed to parse arcade script\", {\n        script: r,\n        error: R\n      })), null;\n    }\n\n    const _ = l.reduce((e, r) => ({ ...e,\n      [r]: null\n    }), {});\n\n    let w = null;\n    t(o) && (w = new f(o), w.immutable = !0, _.$config = null);\n    const F = d.scriptUsesGeometryEngine(h),\n          g = F && d.enableGeometrySupport(),\n          S = d.scriptUsesFeatureSet(h) && d.enableFeatureSetSupport(),\n          b = d.scriptIsAsync(h),\n          x = b && d.enableAsyncSupport(),\n          $ = {\n      vars: _,\n      spatialReference: y,\n      useAsync: !!x\n    };\n    await Promise.all([g, S, x]);\n    const v = new Set();\n    await d.loadDependentModules(v, h, null, b, F);\n    const D = new f();\n    D.immutable = !1, D.setField(\"scale\", 0);\n\n    const j = d.compileScript(h, $),\n          G = e => (\"$view\" in e && e.$view && (D.setField(\"scale\", e.$view.scale), e.$view = D), w && (e.$config = w), j({\n      vars: e,\n      spatialReference: y\n    }));\n\n    return new p(r, d, f, h, G, new m(), n, y);\n  }\n\n  repurposeFeature(e) {\n    return e.geometry && !e.geometry.spatialReference && (e.geometry.spatialReference = this._spatialReference), this._arcadeFeature.repurposeFromGraphicLikeObject(e.geometry, e.attributes, {\n      fields: this.fields\n    }), this._arcadeFeature;\n  }\n\n  createDictionary() {\n    return new this._arcadeDictionary();\n  }\n\n  referencesMember(e) {\n    return this._arcade.referencesMember(this._syntaxTree, e);\n  }\n\n  referencesFunction(e) {\n    return this._arcade.referencesFunction(this._syntaxTree, e);\n  }\n\n  referencesGeometry() {\n    return this._referencesGeometry;\n  }\n\n  referencesScale() {\n    return this._referencesScale;\n  }\n\n  extractFieldLiterals() {\n    return this._arcade.extractExpectedFieldLiterals(this._syntaxTree);\n  }\n\n}\n\nexport { p as ArcadeExpression, u as createDictionaryExpression, n as createLabelExpression, o as createRendererExpression, l as createVVExpression, i as loadArcade };","map":{"version":3,"names":["e","r","isSome","t","a","s","getLogger","c","i","arcade","arcadeUtils","Dictionary","Feature","arcadeFeature","n","p","create","o","l","u","constructor","script","evaluate","Array","isArray","fields","_syntaxTree","_arcade","_arcadeDictionary","_arcadeFeature","_spatialReference","_referencesGeometry","scriptTouchesGeometry","_referencesScale","referencesMember","d","m","f","y","fromJSON","h","parseScript","R","error","_","reduce","w","immutable","$config","F","scriptUsesGeometryEngine","g","enableGeometrySupport","S","scriptUsesFeatureSet","enableFeatureSetSupport","b","scriptIsAsync","x","enableAsyncSupport","$","vars","spatialReference","useAsync","Promise","all","v","Set","loadDependentModules","D","setField","j","compileScript","G","$view","scale","repurposeFeature","geometry","repurposeFromGraphicLikeObject","attributes","createDictionary","referencesFunction","referencesGeometry","referencesScale","extractFieldLiterals","extractExpectedFieldLiterals","ArcadeExpression","createDictionaryExpression","createLabelExpression","createRendererExpression","createVVExpression","loadArcade"],"sources":["E:/各个学科/论文/毕业论文/Atmosphere/eco-friendly/node_modules/@arcgis/core/support/arcadeOnDemand.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport\"../geometry.js\";import e from\"../core/Error.js\";import r from\"../core/Logger.js\";import{isSome as t}from\"../core/maybe.js\";import a from\"../geometry/SpatialReference.js\";const s=r.getLogger(\"esri.support.arcadeOnDemand\");let c;function i(){return c||(c=(async()=>{const e=await import(\"./arcadeUtils.js\");return{arcade:e.arcade,arcadeUtils:e,Dictionary:e.Dictionary,Feature:e.arcadeFeature}})()),c}const n=(e,r,t)=>p.create(e,r,t,null,[\"$feature\"]),o=(e,r,t)=>p.create(e,r,t,null,[\"$feature\",\"$view\"]),l=o,u=(e,r,t,a)=>p.create(e,r,t,a,[\"$feature\",\"$view\"]);class p{constructor(e,r,t,a,s,c,i,n){this.script=e,this.evaluate=s;const o=Array.isArray(i)?i:i.fields;this.fields=o,this._syntaxTree=a,this._arcade=r,this._arcadeDictionary=t,this._arcadeFeature=c,this._spatialReference=n,this._referencesGeometry=r.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,\"scale\")}static async create(r,c,n,o,l,u){const{arcade:d,Feature:m,Dictionary:f}=await i(),y=a.fromJSON(c);let h=null;try{h=d.parseScript(r,u)}catch(R){return s.error(new e(\"arcade-bad-expression\",\"Failed to parse arcade script\",{script:r,error:R})),null}const _=l.reduce(((e,r)=>({...e,[r]:null})),{});let w=null;t(o)&&(w=new f(o),w.immutable=!0,_.$config=null);const F=d.scriptUsesGeometryEngine(h),g=F&&d.enableGeometrySupport(),S=d.scriptUsesFeatureSet(h)&&d.enableFeatureSetSupport(),b=d.scriptIsAsync(h),x=b&&d.enableAsyncSupport(),$={vars:_,spatialReference:y,useAsync:!!x};await Promise.all([g,S,x]);const v=new Set;await d.loadDependentModules(v,h,null,b,F);const D=new f;D.immutable=!1,D.setField(\"scale\",0);const j=d.compileScript(h,$),G=e=>(\"$view\"in e&&e.$view&&(D.setField(\"scale\",e.$view.scale),e.$view=D),w&&(e.$config=w),j({vars:e,spatialReference:y}));return new p(r,d,f,h,G,new m,n,y)}repurposeFeature(e){return e.geometry&&!e.geometry.spatialReference&&(e.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(e.geometry,e.attributes,{fields:this.fields}),this._arcadeFeature}createDictionary(){return new this._arcadeDictionary}referencesMember(e){return this._arcade.referencesMember(this._syntaxTree,e)}referencesFunction(e){return this._arcade.referencesFunction(this._syntaxTree,e)}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}extractFieldLiterals(){return this._arcade.extractExpectedFieldLiterals(this._syntaxTree)}}export{p as ArcadeExpression,u as createDictionaryExpression,n as createLabelExpression,o as createRendererExpression,l as createVVExpression,i as loadArcade};\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA,OAAM,gBAAN;AAAuB,OAAOA,CAAP,MAAa,kBAAb;AAAgC,OAAOC,CAAP,MAAa,mBAAb;AAAiC,SAAOC,MAAM,IAAIC,CAAjB,QAAuB,kBAAvB;AAA0C,OAAOC,CAAP,MAAa,iCAAb;AAA+C,MAAMC,CAAC,GAACJ,CAAC,CAACK,SAAF,CAAY,6BAAZ,CAAR;AAAmD,IAAIC,CAAJ;;AAAM,SAASC,CAAT,GAAY;EAAC,OAAOD,CAAC,KAAGA,CAAC,GAAC,CAAC,YAAS;IAAC,MAAMP,CAAC,GAAC,MAAM,OAAO,kBAAP,CAAd;IAAyC,OAAM;MAACS,MAAM,EAACT,CAAC,CAACS,MAAV;MAAiBC,WAAW,EAACV,CAA7B;MAA+BW,UAAU,EAACX,CAAC,CAACW,UAA5C;MAAuDC,OAAO,EAACZ,CAAC,CAACa;IAAjE,CAAN;EAAsF,CAA1I,GAAL,CAAD,EAAqJN,CAA5J;AAA8J;;AAAA,MAAMO,CAAC,GAAC,CAACd,CAAD,EAAGC,CAAH,EAAKE,CAAL,KAASY,CAAC,CAACC,MAAF,CAAShB,CAAT,EAAWC,CAAX,EAAaE,CAAb,EAAe,IAAf,EAAoB,CAAC,UAAD,CAApB,CAAjB;AAAA,MAAmDc,CAAC,GAAC,CAACjB,CAAD,EAAGC,CAAH,EAAKE,CAAL,KAASY,CAAC,CAACC,MAAF,CAAShB,CAAT,EAAWC,CAAX,EAAaE,CAAb,EAAe,IAAf,EAAoB,CAAC,UAAD,EAAY,OAAZ,CAApB,CAA9D;AAAA,MAAwGe,CAAC,GAACD,CAA1G;AAAA,MAA4GE,CAAC,GAAC,CAACnB,CAAD,EAAGC,CAAH,EAAKE,CAAL,EAAOC,CAAP,KAAWW,CAAC,CAACC,MAAF,CAAShB,CAAT,EAAWC,CAAX,EAAaE,CAAb,EAAeC,CAAf,EAAiB,CAAC,UAAD,EAAY,OAAZ,CAAjB,CAAzH;;AAAgK,MAAMW,CAAN,CAAO;EAACK,WAAW,CAACpB,CAAD,EAAGC,CAAH,EAAKE,CAAL,EAAOC,CAAP,EAASC,CAAT,EAAWE,CAAX,EAAaC,CAAb,EAAeM,CAAf,EAAiB;IAAC,KAAKO,MAAL,GAAYrB,CAAZ,EAAc,KAAKsB,QAAL,GAAcjB,CAA5B;IAA8B,MAAMY,CAAC,GAACM,KAAK,CAACC,OAAN,CAAchB,CAAd,IAAiBA,CAAjB,GAAmBA,CAAC,CAACiB,MAA7B;IAAoC,KAAKA,MAAL,GAAYR,CAAZ,EAAc,KAAKS,WAAL,GAAiBtB,CAA/B,EAAiC,KAAKuB,OAAL,GAAa1B,CAA9C,EAAgD,KAAK2B,iBAAL,GAAuBzB,CAAvE,EAAyE,KAAK0B,cAAL,GAAoBtB,CAA7F,EAA+F,KAAKuB,iBAAL,GAAuBhB,CAAtH,EAAwH,KAAKiB,mBAAL,GAAyB9B,CAAC,CAAC+B,qBAAF,CAAwB,KAAKN,WAA7B,CAAjJ,EAA2L,KAAKO,gBAAL,GAAsB,KAAKN,OAAL,CAAaO,gBAAb,CAA8B,KAAKR,WAAnC,EAA+C,OAA/C,CAAjN;EAAyQ;;EAAmB,aAANV,MAAM,CAACf,CAAD,EAAGM,CAAH,EAAKO,CAAL,EAAOG,CAAP,EAASC,CAAT,EAAWC,CAAX,EAAa;IAAC,MAAK;MAACV,MAAM,EAAC0B,CAAR;MAAUvB,OAAO,EAACwB,CAAlB;MAAoBzB,UAAU,EAAC0B;IAA/B,IAAkC,MAAM7B,CAAC,EAA9C;IAAA,MAAiD8B,CAAC,GAAClC,CAAC,CAACmC,QAAF,CAAWhC,CAAX,CAAnD;IAAiE,IAAIiC,CAAC,GAAC,IAAN;;IAAW,IAAG;MAACA,CAAC,GAACL,CAAC,CAACM,WAAF,CAAcxC,CAAd,EAAgBkB,CAAhB,CAAF;IAAqB,CAAzB,CAAyB,OAAMuB,CAAN,EAAQ;MAAC,OAAOrC,CAAC,CAACsC,KAAF,CAAQ,IAAI3C,CAAJ,CAAM,uBAAN,EAA8B,+BAA9B,EAA8D;QAACqB,MAAM,EAACpB,CAAR;QAAU0C,KAAK,EAACD;MAAhB,CAA9D,CAAR,GAA2F,IAAlG;IAAuG;;IAAA,MAAME,CAAC,GAAC1B,CAAC,CAAC2B,MAAF,CAAU,CAAC7C,CAAD,EAAGC,CAAH,MAAQ,EAAC,GAAGD,CAAJ;MAAM,CAACC,CAAD,GAAI;IAAV,CAAR,CAAV,EAAoC,EAApC,CAAR;;IAAgD,IAAI6C,CAAC,GAAC,IAAN;IAAW3C,CAAC,CAACc,CAAD,CAAD,KAAO6B,CAAC,GAAC,IAAIT,CAAJ,CAAMpB,CAAN,CAAF,EAAW6B,CAAC,CAACC,SAAF,GAAY,CAAC,CAAxB,EAA0BH,CAAC,CAACI,OAAF,GAAU,IAA3C;IAAiD,MAAMC,CAAC,GAACd,CAAC,CAACe,wBAAF,CAA2BV,CAA3B,CAAR;IAAA,MAAsCW,CAAC,GAACF,CAAC,IAAEd,CAAC,CAACiB,qBAAF,EAA3C;IAAA,MAAqEC,CAAC,GAAClB,CAAC,CAACmB,oBAAF,CAAuBd,CAAvB,KAA2BL,CAAC,CAACoB,uBAAF,EAAlG;IAAA,MAA8HC,CAAC,GAACrB,CAAC,CAACsB,aAAF,CAAgBjB,CAAhB,CAAhI;IAAA,MAAmJkB,CAAC,GAACF,CAAC,IAAErB,CAAC,CAACwB,kBAAF,EAAxJ;IAAA,MAA+KC,CAAC,GAAC;MAACC,IAAI,EAACjB,CAAN;MAAQkB,gBAAgB,EAACxB,CAAzB;MAA2ByB,QAAQ,EAAC,CAAC,CAACL;IAAtC,CAAjL;IAA0N,MAAMM,OAAO,CAACC,GAAR,CAAY,CAACd,CAAD,EAAGE,CAAH,EAAKK,CAAL,CAAZ,CAAN;IAA2B,MAAMQ,CAAC,GAAC,IAAIC,GAAJ,EAAR;IAAgB,MAAMhC,CAAC,CAACiC,oBAAF,CAAuBF,CAAvB,EAAyB1B,CAAzB,EAA2B,IAA3B,EAAgCgB,CAAhC,EAAkCP,CAAlC,CAAN;IAA2C,MAAMoB,CAAC,GAAC,IAAIhC,CAAJ,EAAR;IAAcgC,CAAC,CAACtB,SAAF,GAAY,CAAC,CAAb,EAAesB,CAAC,CAACC,QAAF,CAAW,OAAX,EAAmB,CAAnB,CAAf;;IAAqC,MAAMC,CAAC,GAACpC,CAAC,CAACqC,aAAF,CAAgBhC,CAAhB,EAAkBoB,CAAlB,CAAR;IAAA,MAA6Ba,CAAC,GAACzE,CAAC,KAAG,WAAUA,CAAV,IAAaA,CAAC,CAAC0E,KAAf,KAAuBL,CAAC,CAACC,QAAF,CAAW,OAAX,EAAmBtE,CAAC,CAAC0E,KAAF,CAAQC,KAA3B,GAAkC3E,CAAC,CAAC0E,KAAF,GAAQL,CAAjE,GAAoEvB,CAAC,KAAG9C,CAAC,CAACgD,OAAF,GAAUF,CAAb,CAArE,EAAqFyB,CAAC,CAAC;MAACV,IAAI,EAAC7D,CAAN;MAAQ8D,gBAAgB,EAACxB;IAAzB,CAAD,CAAzF,CAAhC;;IAAwJ,OAAO,IAAIvB,CAAJ,CAAMd,CAAN,EAAQkC,CAAR,EAAUE,CAAV,EAAYG,CAAZ,EAAciC,CAAd,EAAgB,IAAIrC,CAAJ,EAAhB,EAAsBtB,CAAtB,EAAwBwB,CAAxB,CAAP;EAAkC;;EAAAsC,gBAAgB,CAAC5E,CAAD,EAAG;IAAC,OAAOA,CAAC,CAAC6E,QAAF,IAAY,CAAC7E,CAAC,CAAC6E,QAAF,CAAWf,gBAAxB,KAA2C9D,CAAC,CAAC6E,QAAF,CAAWf,gBAAX,GAA4B,KAAKhC,iBAA5E,GAA+F,KAAKD,cAAL,CAAoBiD,8BAApB,CAAmD9E,CAAC,CAAC6E,QAArD,EAA8D7E,CAAC,CAAC+E,UAAhE,EAA2E;MAACtD,MAAM,EAAC,KAAKA;IAAb,CAA3E,CAA/F,EAAgM,KAAKI,cAA5M;EAA2N;;EAAAmD,gBAAgB,GAAE;IAAC,OAAO,IAAI,KAAKpD,iBAAT,EAAP;EAAkC;;EAAAM,gBAAgB,CAAClC,CAAD,EAAG;IAAC,OAAO,KAAK2B,OAAL,CAAaO,gBAAb,CAA8B,KAAKR,WAAnC,EAA+C1B,CAA/C,CAAP;EAAyD;;EAAAiF,kBAAkB,CAACjF,CAAD,EAAG;IAAC,OAAO,KAAK2B,OAAL,CAAasD,kBAAb,CAAgC,KAAKvD,WAArC,EAAiD1B,CAAjD,CAAP;EAA2D;;EAAAkF,kBAAkB,GAAE;IAAC,OAAO,KAAKnD,mBAAZ;EAAgC;;EAAAoD,eAAe,GAAE;IAAC,OAAO,KAAKlD,gBAAZ;EAA6B;;EAAAmD,oBAAoB,GAAE;IAAC,OAAO,KAAKzD,OAAL,CAAa0D,4BAAb,CAA0C,KAAK3D,WAA/C,CAAP;EAAmE;;AAAx2D;;AAAy2D,SAAOX,CAAC,IAAIuE,gBAAZ,EAA6BnE,CAAC,IAAIoE,0BAAlC,EAA6DzE,CAAC,IAAI0E,qBAAlE,EAAwFvE,CAAC,IAAIwE,wBAA7F,EAAsHvE,CAAC,IAAIwE,kBAA3H,EAA8IlF,CAAC,IAAImF,UAAnJ"},"metadata":{},"sourceType":"module"}