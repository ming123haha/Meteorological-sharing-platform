{"ast":null,"code":"import \"core-js/modules/es.array.includes.js\";\nimport \"core-js/modules/es.typed-array.at.js\";\nimport \"core-js/modules/es.typed-array.set.js\";\nimport \"core-js/modules/esnext.typed-array.find-last.js\";\nimport \"core-js/modules/esnext.typed-array.find-last-index.js\";\n\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../chunks/tslib.es6.js\";\nimport \"../../../geometry.js\";\nimport t from \"../../../core/Error.js\";\nimport { unwrap as r, isSome as i, isNone as s } from \"../../../core/maybe.js\";\nimport { property as a } from \"../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../core/arrayUtils.js\";\nimport \"../../../core/accessorSupport/ensureType.js\";\nimport { subclass as n } from \"../../../core/accessorSupport/decorators/subclass.js\";\nimport o from \"../RasterInfo.js\";\nimport f from \"../RasterStorageInfo.js\";\nimport l from \"./BaseRaster.js\";\nimport u from \"./DBFParser.js\";\nimport { parseSpatialReference as p, parsePAMInfo as m } from \"./pamParser.js\";\nimport { parseSignature as c, getImageInfo as h, parseIFD as d, parseFieldValues as y, isBSQConfig as g } from \"../rasterFormats/TiffDecoder.js\";\nimport x from \"../rasterFormats/TiffTags.js\";\nimport { estimateStatisticsFromHistograms as T } from \"../rasterFunctions/stretchUtils.js\";\nimport I from \"../rasterTransforms/PolynomialTransform.js\";\nimport w from \"../../../rest/support/FeatureSet.js\";\nimport b from \"../../../geometry/SpatialReference.js\";\nimport _ from \"../../../geometry/Extent.js\";\nimport S from \"../../../geometry/Point.js\";\n\nconst E = (e, t) => e.get(t)?.values,\n      F = (e, t) => e.get(t)?.values?.[0];\n\nlet R = class extends l {\n  constructor() {\n    super(...arguments), this._files = null, this._headerInfo = null, this._bufferSize = 1048576, this.datasetFormat = \"TIFF\";\n  }\n\n  async open(e) {\n    await this.init();\n    const s = e ? r(e.signal) : null,\n          {\n      data: a\n    } = await this.request(this.url, {\n      range: {\n        from: 0,\n        to: this._bufferSize\n      },\n      responseType: \"array-buffer\",\n      signal: s\n    });\n    if (!a) throw new t(\"tiffraster:open\", \"failed to open url \" + this.url);\n    this.datasetName = this.url.slice(this.url.lastIndexOf(\"/\") + 1);\n    const {\n      littleEndian: n,\n      firstIFDPos: o,\n      isBigTiff: f\n    } = c(a),\n          l = [];\n    await this._readIFDs(l, a, n, o, 0, f ? 8 : 4, s);\n\n    const {\n      imageInfo: u,\n      rasterInfo: p\n    } = this._parseIFDs(l);\n\n    if (this._headerInfo = {\n      littleEndian: n,\n      isBigTiff: f,\n      ifds: l,\n      ...u\n    }, this._set(\"rasterInfo\", p), !u.isSupported) throw new t(\"tiffraster:open\", \"this tiff is not supported: \" + u.message);\n    if (!u.tileWidth) throw new t(\"tiffraster:open\", \"none-tiled tiff is not optimized for access, convert to COG and retry.\");\n    const {\n      skipExtensions: m = []\n    } = this.ioConfig;\n\n    if (!m.includes(\"aux.xml\")) {\n      const t = await this._fetchAuxiliaryMetaData(e);\n      null != t && this._processPAMInfo(t, p);\n    }\n\n    m.includes(\"vat.dbf\") || 1 !== p.bandCount || \"u8\" !== p.pixelType || (p.attributeTable = await this._fetchAuxiliaryTable(e), i(p.attributeTable) && (p.keyProperties.DataType = \"thematic\")), this.updateTileInfo();\n  }\n\n  async fetchRawTile(e, t, r, i = {}) {\n    if (!this._headerInfo?.isSupported || this.isBlockOutside(e, t, r)) return null;\n\n    const s = this._getTileLocation(e, t, r);\n\n    if (!s) return null;\n    const {\n      ranges: a,\n      actualTileWidth: n,\n      actualTileHeight: o,\n      ifd: f\n    } = s,\n          l = a.map(e => this.request(this.url, {\n      range: e,\n      responseType: \"array-buffer\",\n      signal: i.signal\n    })),\n          u = await Promise.all(l),\n          p = u.map(e => e.data.byteLength).reduce((e, t) => e + t),\n          m = 1 === u.length ? u[0].data : new ArrayBuffer(p),\n          c = [0],\n          h = [0];\n\n    if (u.length > 1) {\n      const e = new Uint8Array(m);\n\n      for (let t = 0, r = 0; t < u.length; t++) {\n        const i = u[t].data;\n        e.set(new Uint8Array(i), r), c[t] = r, r += i.byteLength, h[t] = i.byteLength;\n      }\n    }\n\n    const {\n      blockWidth: d,\n      blockHeight: y\n    } = this.getBlockWidthHeight(e),\n          g = await this.decodePixelBlock(m, {\n      format: \"tiff\",\n      customOptions: {\n        headerInfo: this._headerInfo,\n        ifd: f,\n        offsets: c,\n        sizes: h\n      },\n      width: d,\n      height: y,\n      planes: null,\n      pixelType: null\n    });\n    let x, T, I;\n\n    if (n !== d || o !== y) {\n      let e = g.mask;\n      if (e) {\n        for (x = 0; x < y; x++) if (I = x * d, x < o) for (T = n; T < d; T++) e[I + T] = 0;else for (T = 0; T < d; T++) e[I + T] = 0;\n      } else for (e = new Uint8Array(d * y), g.mask = e, x = 0; x < o; x++) for (I = x * d, T = 0; T < n; T++) e[I + T] = 1;\n    }\n\n    return g;\n  }\n\n  _parseIFDs(e) {\n    const t = h(e),\n          {\n      width: r,\n      height: i,\n      tileWidth: s,\n      tileHeight: a,\n      planes: n,\n      pixelType: l,\n      compression: u,\n      firstPyramidLevel: m,\n      maximumPyramidLevel: c,\n      pyramidBlockWidth: d,\n      pyramidBlockHeight: y,\n      tileBoundary: g,\n      affine: x,\n      metadata: T\n    } = t,\n          w = t.extent.spatialReference?.wkt || t.extent.spatialReference?.wkid;\n    let R = p(w),\n        v = !1;\n    null == R && (v = !0, R = new b({\n      wkid: 3857\n    }));\n    const k = new _({ ...t.extent,\n      spatialReference: R\n    }),\n          D = new S(k ? {\n      x: k.xmin,\n      y: k.ymax,\n      spatialReference: R\n    } : {\n      x: 0,\n      y: 0\n    }),\n          j = new f({\n      blockWidth: s,\n      blockHeight: a,\n      pyramidBlockWidth: d,\n      pyramidBlockHeight: y,\n      compression: u,\n      origin: D,\n      firstPyramidLevel: m,\n      maximumPyramidLevel: c,\n      blockBoundary: g\n    }),\n          O = new S({\n      x: (k.xmax - k.xmin) / r,\n      y: (k.ymax - k.ymin) / i,\n      spatialReference: R\n    }),\n          P = T ? {\n      BandProperties: T.bandProperties,\n      DataType: T.dataType\n    } : {};\n    let B = null;\n    const L = F(e[0], \"PHOTOMETRICINTERPRETATION\"),\n          A = E(e[0], \"COLORMAP\");\n\n    if (3 === L && A?.length > 3 && A.length % 3 == 0) {\n      B = [];\n      const e = A.length / 3;\n\n      for (let t = 0; t < e; t++) B.push([t, A[t] >>> 8, A[t + e] >>> 8, A[t + 2 * e] >>> 8]);\n    }\n\n    const z = new o({\n      width: r,\n      height: i,\n      bandCount: n,\n      pixelType: l,\n      pixelSize: O,\n      storageInfo: j,\n      spatialReference: R,\n      isPseudoSpatialReference: v,\n      keyProperties: P,\n      extent: k,\n      colormap: B,\n      statistics: T ? T.statistics : null\n    });\n    return x?.length && (z.nativeExtent = new _({\n      xmin: -.5,\n      ymin: .5 - i,\n      xmax: r - .5,\n      ymax: .5,\n      spatialReference: R\n    }), z.transform = new I({\n      polynomialOrder: 1,\n      forwardCoefficients: [x[2] + x[0] / 2, x[5] - x[3] / 2, x[0], x[3], -x[1], -x[4]]\n    }), z.extent = z.transform.forwardTransform(z.nativeExtent), z.pixelSize = new S({\n      x: (k.xmax - k.xmin) / r,\n      y: (k.ymax - k.ymin) / i,\n      spatialReference: R\n    }), j.origin.x = -.5, j.origin.y = .5), {\n      imageInfo: t,\n      rasterInfo: z\n    };\n  }\n\n  _processPAMInfo(e, t) {\n    if (t.statistics = e.statistics ?? t.statistics, t.histograms = e.histograms, e.histograms && s(t.statistics) && (t.statistics = T(e.histograms)), e.transform && s(t.transform)) {\n      t.transform = e.transform, t.nativeExtent = t.extent;\n      const r = t.transform.forwardTransform(t.nativeExtent);\n      t.pixelSize = new S({\n        x: (r.xmax - r.xmin) / t.width,\n        y: (r.ymax - r.ymin) / t.height,\n        spatialReference: t.spatialReference\n      }), t.extent = r;\n    }\n\n    t.spatialReference || (t.spatialReference = e.spatialReference);\n  }\n\n  async _readIFDs(e, t, r, i, s, a = 4, n) {\n    if (!i) return null;\n\n    if (i >= t.byteLength || i < 0) {\n      t = (await this.request(this.url, {\n        range: {\n          from: i + s,\n          to: i + s + this._bufferSize\n        },\n        responseType: \"array-buffer\",\n        signal: n\n      })).data, s = i + s, i = 0;\n    }\n\n    const o = await this._readIFD(t, r, i, s, x.TIFF_TAGS, a, n);\n    if (e.push(o.ifd), !o.nextIFD) return null;\n    await this._readIFDs(e, t, r, o.nextIFD - s, s, a, n);\n  }\n\n  async _readIFD(e, t, r, s, a = x.TIFF_TAGS, n = 4, o) {\n    if (!e) return null;\n    const f = d(e, t, r, s, a, n);\n\n    if (f.success) {\n      const r = [];\n\n      if (f.ifd?.forEach(e => {\n        e.values || r.push(e);\n      }), r.length > 0) {\n        const a = r.map(e => e.offlineOffsetSize).filter(i),\n              n = Math.min.apply(null, a.map(e => e[0]));\n\n        if (Math.min.apply(null, a.map(e => e[0] + e[1])) - n <= this._bufferSize) {\n          const {\n            data: i\n          } = await this.request(this.url, {\n            range: {\n              from: n,\n              to: n + this._bufferSize\n            },\n            responseType: \"array-buffer\",\n            signal: o\n          });\n          e = i, s = n, r.forEach(r => y(e, t, r, s));\n        }\n      }\n\n      if (f.ifd?.has(\"GEOKEYDIRECTORY\")) {\n        const r = f.ifd.get(\"GEOKEYDIRECTORY\"),\n              i = r?.values;\n\n        if (i && i.length > 4) {\n          const a = i[0] + \".\" + i[1] + \".\" + i[2],\n                n = await this._readIFD(e, t, r.valueOffset + 6 - s, s, x.GEO_KEYS, 2, o);\n          r.data = n.ifd, r.data && r.data.set(\"GEOTIFFVersion\", {\n            id: 0,\n            type: 2,\n            valueCount: 1,\n            valueOffset: null,\n            values: [a]\n          });\n        }\n      }\n\n      return f;\n    }\n\n    if (f.requiredBufferSize && f.requiredBufferSize !== e.byteLength) {\n      const r = await this.request(this.url, {\n        range: {\n          from: s,\n          to: s + f.requiredBufferSize + 4\n        },\n        responseType: \"array-buffer\",\n        signal: o\n      });\n      return (e = r.data).byteLength < f.requiredBufferSize ? null : this._readIFD(e, t, 0, s, x.TIFF_TAGS, 4, o);\n    }\n  }\n\n  _getTileLocation(e, t, r) {\n    const {\n      firstPyramidLevel: i,\n      blockBoundary: s\n    } = this.rasterInfo.storageInfo,\n          a = 0 === e ? 0 : e - (i - 1),\n          n = this._headerInfo?.ifds[a];\n    if (!n) return null;\n    const o = g(n, this._headerInfo),\n          f = E(n, \"TILEOFFSETS\");\n    if (void 0 === f) return null;\n    const l = E(n, \"TILEBYTECOUNTS\"),\n          {\n      minRow: u,\n      minCol: p,\n      maxRow: m,\n      maxCol: c\n    } = s[a];\n    if (t > m || r > c || t < u || r < p) return null;\n    const h = F(n, \"IMAGEWIDTH\"),\n          d = F(n, \"IMAGELENGTH\"),\n          y = F(n, \"TILEWIDTH\"),\n          x = F(n, \"TILELENGTH\"),\n          T = o ? this.rasterInfo.bandCount : 1,\n          I = T * t * (c + 1) + r,\n          w = [{\n      from: f[I],\n      to: f[I + T - 1] + l[I + T - 1] - 1\n    }];\n\n    if (o) {\n      let e = !0;\n\n      for (let t = 0; t < T; t++) if (f[I + t] + l[I + t] !== f[I + t + 1]) {\n        e = !1;\n        break;\n      }\n\n      if (!e) for (let t = 0; t < T; t++) w[t] = {\n        from: f[I + t],\n        to: f[I + t] + l[I + t] - 1\n      };\n    }\n\n    const b = f[I],\n          _ = l[I];\n    if (null == b || null == _) return null;\n    return {\n      ranges: w,\n      ifd: n,\n      actualTileWidth: r === c && h % y || y,\n      actualTileHeight: t === m && d % x || x\n    };\n  }\n\n  async _fetchAuxiliaryMetaData(e) {\n    try {\n      const {\n        data: t\n      } = await this.request(this.url + \".aux.xml\", {\n        responseType: \"xml\",\n        signal: e?.signal\n      });\n      return m(t);\n    } catch {\n      return null;\n    }\n  }\n\n  async _fetchAuxiliaryTable(e) {\n    try {\n      const {\n        data: t\n      } = await this.request(this.url + \".vat.dbf\", {\n        responseType: \"array-buffer\",\n        signal: e?.signal\n      }),\n            r = u.parse(t);\n      return r?.recordSet ? w.fromJSON(r.recordSet) : null;\n    } catch {\n      return null;\n    }\n  }\n\n};\ne([a()], R.prototype, \"_files\", void 0), e([a()], R.prototype, \"_headerInfo\", void 0), e([a()], R.prototype, \"_bufferSize\", void 0), e([a({\n  type: String,\n  json: {\n    write: !0\n  }\n})], R.prototype, \"datasetFormat\", void 0), R = e([n(\"esri.layers.support.rasterDatasets.TIFFRaster\")], R);\nconst v = R;\nexport { v as default };","map":{"version":3,"names":["_","e","t","unwrap","r","isSome","i","isNone","s","property","a","subclass","n","o","f","l","u","parseSpatialReference","p","parsePAMInfo","m","parseSignature","c","getImageInfo","h","parseIFD","d","parseFieldValues","y","isBSQConfig","g","x","estimateStatisticsFromHistograms","T","I","w","b","S","E","get","values","F","R","constructor","arguments","_files","_headerInfo","_bufferSize","datasetFormat","open","init","signal","data","request","url","range","from","to","responseType","datasetName","slice","lastIndexOf","littleEndian","firstIFDPos","isBigTiff","_readIFDs","imageInfo","rasterInfo","_parseIFDs","ifds","_set","isSupported","message","tileWidth","skipExtensions","ioConfig","includes","_fetchAuxiliaryMetaData","_processPAMInfo","bandCount","pixelType","attributeTable","_fetchAuxiliaryTable","keyProperties","DataType","updateTileInfo","fetchRawTile","isBlockOutside","_getTileLocation","ranges","actualTileWidth","actualTileHeight","ifd","map","Promise","all","byteLength","reduce","length","ArrayBuffer","Uint8Array","set","blockWidth","blockHeight","getBlockWidthHeight","decodePixelBlock","format","customOptions","headerInfo","offsets","sizes","width","height","planes","mask","tileHeight","compression","firstPyramidLevel","maximumPyramidLevel","pyramidBlockWidth","pyramidBlockHeight","tileBoundary","affine","metadata","extent","spatialReference","wkt","wkid","v","k","D","xmin","ymax","j","origin","blockBoundary","O","xmax","ymin","P","BandProperties","bandProperties","dataType","B","L","A","push","z","pixelSize","storageInfo","isPseudoSpatialReference","colormap","statistics","nativeExtent","transform","polynomialOrder","forwardCoefficients","forwardTransform","histograms","_readIFD","TIFF_TAGS","nextIFD","success","forEach","offlineOffsetSize","filter","Math","min","apply","has","valueOffset","GEO_KEYS","id","type","valueCount","requiredBufferSize","minRow","minCol","maxRow","maxCol","parse","recordSet","fromJSON","prototype","String","json","write","default"],"sources":["E:/各个学科/论文/毕业论文/Atmosphere/eco-friendly/node_modules/@arcgis/core/layers/support/rasterDatasets/TIFFRaster.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import\"../../../geometry.js\";import t from\"../../../core/Error.js\";import{unwrap as r,isSome as i,isNone as s}from\"../../../core/maybe.js\";import{property as a}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/arrayUtils.js\";import\"../../../core/accessorSupport/ensureType.js\";import{subclass as n}from\"../../../core/accessorSupport/decorators/subclass.js\";import o from\"../RasterInfo.js\";import f from\"../RasterStorageInfo.js\";import l from\"./BaseRaster.js\";import u from\"./DBFParser.js\";import{parseSpatialReference as p,parsePAMInfo as m}from\"./pamParser.js\";import{parseSignature as c,getImageInfo as h,parseIFD as d,parseFieldValues as y,isBSQConfig as g}from\"../rasterFormats/TiffDecoder.js\";import x from\"../rasterFormats/TiffTags.js\";import{estimateStatisticsFromHistograms as T}from\"../rasterFunctions/stretchUtils.js\";import I from\"../rasterTransforms/PolynomialTransform.js\";import w from\"../../../rest/support/FeatureSet.js\";import b from\"../../../geometry/SpatialReference.js\";import _ from\"../../../geometry/Extent.js\";import S from\"../../../geometry/Point.js\";const E=(e,t)=>e.get(t)?.values,F=(e,t)=>e.get(t)?.values?.[0];let R=class extends l{constructor(){super(...arguments),this._files=null,this._headerInfo=null,this._bufferSize=1048576,this.datasetFormat=\"TIFF\"}async open(e){await this.init();const s=e?r(e.signal):null,{data:a}=await this.request(this.url,{range:{from:0,to:this._bufferSize},responseType:\"array-buffer\",signal:s});if(!a)throw new t(\"tiffraster:open\",\"failed to open url \"+this.url);this.datasetName=this.url.slice(this.url.lastIndexOf(\"/\")+1);const{littleEndian:n,firstIFDPos:o,isBigTiff:f}=c(a),l=[];await this._readIFDs(l,a,n,o,0,f?8:4,s);const{imageInfo:u,rasterInfo:p}=this._parseIFDs(l);if(this._headerInfo={littleEndian:n,isBigTiff:f,ifds:l,...u},this._set(\"rasterInfo\",p),!u.isSupported)throw new t(\"tiffraster:open\",\"this tiff is not supported: \"+u.message);if(!u.tileWidth)throw new t(\"tiffraster:open\",\"none-tiled tiff is not optimized for access, convert to COG and retry.\");const{skipExtensions:m=[]}=this.ioConfig;if(!m.includes(\"aux.xml\")){const t=await this._fetchAuxiliaryMetaData(e);null!=t&&this._processPAMInfo(t,p)}m.includes(\"vat.dbf\")||1!==p.bandCount||\"u8\"!==p.pixelType||(p.attributeTable=await this._fetchAuxiliaryTable(e),i(p.attributeTable)&&(p.keyProperties.DataType=\"thematic\")),this.updateTileInfo()}async fetchRawTile(e,t,r,i={}){if(!this._headerInfo?.isSupported||this.isBlockOutside(e,t,r))return null;const s=this._getTileLocation(e,t,r);if(!s)return null;const{ranges:a,actualTileWidth:n,actualTileHeight:o,ifd:f}=s,l=a.map((e=>this.request(this.url,{range:e,responseType:\"array-buffer\",signal:i.signal}))),u=await Promise.all(l),p=u.map((e=>e.data.byteLength)).reduce(((e,t)=>e+t)),m=1===u.length?u[0].data:new ArrayBuffer(p),c=[0],h=[0];if(u.length>1){const e=new Uint8Array(m);for(let t=0,r=0;t<u.length;t++){const i=u[t].data;e.set(new Uint8Array(i),r),c[t]=r,r+=i.byteLength,h[t]=i.byteLength}}const{blockWidth:d,blockHeight:y}=this.getBlockWidthHeight(e),g=await this.decodePixelBlock(m,{format:\"tiff\",customOptions:{headerInfo:this._headerInfo,ifd:f,offsets:c,sizes:h},width:d,height:y,planes:null,pixelType:null});let x,T,I;if(n!==d||o!==y){let e=g.mask;if(e)for(x=0;x<y;x++)if(I=x*d,x<o)for(T=n;T<d;T++)e[I+T]=0;else for(T=0;T<d;T++)e[I+T]=0;else for(e=new Uint8Array(d*y),g.mask=e,x=0;x<o;x++)for(I=x*d,T=0;T<n;T++)e[I+T]=1}return g}_parseIFDs(e){const t=h(e),{width:r,height:i,tileWidth:s,tileHeight:a,planes:n,pixelType:l,compression:u,firstPyramidLevel:m,maximumPyramidLevel:c,pyramidBlockWidth:d,pyramidBlockHeight:y,tileBoundary:g,affine:x,metadata:T}=t,w=t.extent.spatialReference?.wkt||t.extent.spatialReference?.wkid;let R=p(w),v=!1;null==R&&(v=!0,R=new b({wkid:3857}));const k=new _({...t.extent,spatialReference:R}),D=new S(k?{x:k.xmin,y:k.ymax,spatialReference:R}:{x:0,y:0}),j=new f({blockWidth:s,blockHeight:a,pyramidBlockWidth:d,pyramidBlockHeight:y,compression:u,origin:D,firstPyramidLevel:m,maximumPyramidLevel:c,blockBoundary:g}),O=new S({x:(k.xmax-k.xmin)/r,y:(k.ymax-k.ymin)/i,spatialReference:R}),P=T?{BandProperties:T.bandProperties,DataType:T.dataType}:{};let B=null;const L=F(e[0],\"PHOTOMETRICINTERPRETATION\"),A=E(e[0],\"COLORMAP\");if(3===L&&A?.length>3&&A.length%3==0){B=[];const e=A.length/3;for(let t=0;t<e;t++)B.push([t,A[t]>>>8,A[t+e]>>>8,A[t+2*e]>>>8])}const z=new o({width:r,height:i,bandCount:n,pixelType:l,pixelSize:O,storageInfo:j,spatialReference:R,isPseudoSpatialReference:v,keyProperties:P,extent:k,colormap:B,statistics:T?T.statistics:null});return x?.length&&(z.nativeExtent=new _({xmin:-.5,ymin:.5-i,xmax:r-.5,ymax:.5,spatialReference:R}),z.transform=new I({polynomialOrder:1,forwardCoefficients:[x[2]+x[0]/2,x[5]-x[3]/2,x[0],x[3],-x[1],-x[4]]}),z.extent=z.transform.forwardTransform(z.nativeExtent),z.pixelSize=new S({x:(k.xmax-k.xmin)/r,y:(k.ymax-k.ymin)/i,spatialReference:R}),j.origin.x=-.5,j.origin.y=.5),{imageInfo:t,rasterInfo:z}}_processPAMInfo(e,t){if(t.statistics=e.statistics??t.statistics,t.histograms=e.histograms,e.histograms&&s(t.statistics)&&(t.statistics=T(e.histograms)),e.transform&&s(t.transform)){t.transform=e.transform,t.nativeExtent=t.extent;const r=t.transform.forwardTransform(t.nativeExtent);t.pixelSize=new S({x:(r.xmax-r.xmin)/t.width,y:(r.ymax-r.ymin)/t.height,spatialReference:t.spatialReference}),t.extent=r}t.spatialReference||(t.spatialReference=e.spatialReference)}async _readIFDs(e,t,r,i,s,a=4,n){if(!i)return null;if(i>=t.byteLength||i<0){t=(await this.request(this.url,{range:{from:i+s,to:i+s+this._bufferSize},responseType:\"array-buffer\",signal:n})).data,s=i+s,i=0}const o=await this._readIFD(t,r,i,s,x.TIFF_TAGS,a,n);if(e.push(o.ifd),!o.nextIFD)return null;await this._readIFDs(e,t,r,o.nextIFD-s,s,a,n)}async _readIFD(e,t,r,s,a=x.TIFF_TAGS,n=4,o){if(!e)return null;const f=d(e,t,r,s,a,n);if(f.success){const r=[];if(f.ifd?.forEach((e=>{e.values||r.push(e)})),r.length>0){const a=r.map((e=>e.offlineOffsetSize)).filter(i),n=Math.min.apply(null,a.map((e=>e[0])));if(Math.min.apply(null,a.map((e=>e[0]+e[1])))-n<=this._bufferSize){const{data:i}=await this.request(this.url,{range:{from:n,to:n+this._bufferSize},responseType:\"array-buffer\",signal:o});e=i,s=n,r.forEach((r=>y(e,t,r,s)))}}if(f.ifd?.has(\"GEOKEYDIRECTORY\")){const r=f.ifd.get(\"GEOKEYDIRECTORY\"),i=r?.values;if(i&&i.length>4){const a=i[0]+\".\"+i[1]+\".\"+i[2],n=await this._readIFD(e,t,r.valueOffset+6-s,s,x.GEO_KEYS,2,o);r.data=n.ifd,r.data&&r.data.set(\"GEOTIFFVersion\",{id:0,type:2,valueCount:1,valueOffset:null,values:[a]})}}return f}if(f.requiredBufferSize&&f.requiredBufferSize!==e.byteLength){const r=await this.request(this.url,{range:{from:s,to:s+f.requiredBufferSize+4},responseType:\"array-buffer\",signal:o});return(e=r.data).byteLength<f.requiredBufferSize?null:this._readIFD(e,t,0,s,x.TIFF_TAGS,4,o)}}_getTileLocation(e,t,r){const{firstPyramidLevel:i,blockBoundary:s}=this.rasterInfo.storageInfo,a=0===e?0:e-(i-1),n=this._headerInfo?.ifds[a];if(!n)return null;const o=g(n,this._headerInfo),f=E(n,\"TILEOFFSETS\");if(void 0===f)return null;const l=E(n,\"TILEBYTECOUNTS\"),{minRow:u,minCol:p,maxRow:m,maxCol:c}=s[a];if(t>m||r>c||t<u||r<p)return null;const h=F(n,\"IMAGEWIDTH\"),d=F(n,\"IMAGELENGTH\"),y=F(n,\"TILEWIDTH\"),x=F(n,\"TILELENGTH\"),T=o?this.rasterInfo.bandCount:1,I=T*t*(c+1)+r,w=[{from:f[I],to:f[I+T-1]+l[I+T-1]-1}];if(o){let e=!0;for(let t=0;t<T;t++)if(f[I+t]+l[I+t]!==f[I+t+1]){e=!1;break}if(!e)for(let t=0;t<T;t++)w[t]={from:f[I+t],to:f[I+t]+l[I+t]-1}}const b=f[I],_=l[I];if(null==b||null==_)return null;return{ranges:w,ifd:n,actualTileWidth:r===c&&h%y||y,actualTileHeight:t===m&&d%x||x}}async _fetchAuxiliaryMetaData(e){try{const{data:t}=await this.request(this.url+\".aux.xml\",{responseType:\"xml\",signal:e?.signal});return m(t)}catch{return null}}async _fetchAuxiliaryTable(e){try{const{data:t}=await this.request(this.url+\".vat.dbf\",{responseType:\"array-buffer\",signal:e?.signal}),r=u.parse(t);return r?.recordSet?w.fromJSON(r.recordSet):null}catch{return null}}};e([a()],R.prototype,\"_files\",void 0),e([a()],R.prototype,\"_headerInfo\",void 0),e([a()],R.prototype,\"_bufferSize\",void 0),e([a({type:String,json:{write:!0}})],R.prototype,\"datasetFormat\",void 0),R=e([n(\"esri.layers.support.rasterDatasets.TIFFRaster\")],R);const v=R;export{v as default};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}