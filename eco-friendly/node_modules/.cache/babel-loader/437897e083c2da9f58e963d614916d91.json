{"ast":null,"code":"import \"core-js/modules/es.typed-array.at.js\";\nimport \"core-js/modules/es.typed-array.set.js\";\nimport \"core-js/modules/esnext.typed-array.find-last.js\";\nimport \"core-js/modules/esnext.typed-array.find-last-index.js\";\n\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport { nextPowerOfTwo as t } from \"../../../../../core/mathUtils.js\";\nimport { isSome as r } from \"../../../../../core/maybe.js\";\nimport { c as e } from \"../../../../../chunks/mat3f32.js\";\nimport { f as o } from \"../../../../../chunks/vec4f32.js\";\nimport { VTL_TEXTURE_BINDING_UNIT_SPRITES as i, VTL_HIGH_RES_CUTOFF as s } from \"../definitions.js\";\nimport { WGLDrawPhase as a } from \"../enums.js\";\nimport { u32to4Xu8 as n } from \"../number.js\";\nimport c from \"./WGLBrush.js\";\nimport { BufferObject as m } from \"../../../../webgl/BufferObject.js\";\nimport { TextureSamplingMode as f, CompareFunction as l, PrimitiveType as u, Usage as p } from \"../../../../webgl/enums.js\";\nimport { VertexArrayObject as _ } from \"../../../../webgl/VertexArrayObject.js\";\n\nclass d extends c {\n  constructor() {\n    super(...arguments), this._color = o(1, 0, 0, 1), this._patternMatrix = e(), this._programOptions = {\n      id: !1,\n      pattern: !1\n    };\n  }\n\n  dispose() {\n    this._vao && (this._vao.dispose(), this._vao = null);\n  }\n\n  drawMany(e, o) {\n    const {\n      context: c,\n      painter: m,\n      styleLayerUID: p,\n      requestRender: _,\n      allowDelayedRender: d\n    } = e;\n\n    this._loadWGLResources(e);\n\n    const h = e.displayLevel,\n          g = e.styleLayer,\n          v = g.backgroundMaterial,\n          y = m.vectorTilesMaterialManager,\n          b = g.getPaintValue(\"background-color\", h),\n          M = g.getPaintValue(\"background-opacity\", h),\n          x = g.getPaintValue(\"background-pattern\", h),\n          j = void 0 !== x,\n          U = b[3] * M,\n          w = 1 | window.devicePixelRatio,\n          L = e.spriteMosaic;\n    let A, P;\n    const I = w > s ? 2 : 1,\n          R = e.drawPhase === a.HITTEST,\n          k = this._programOptions;\n    k.id = R, k.pattern = j;\n    const T = y.getMaterialProgram(c, v, k);\n    if (d && r(_) && !T.isCompiled) _();else {\n      if (c.bindVAO(this._vao), c.useProgram(T), j) {\n        const t = L.getMosaicItemPosition(x, !0);\n\n        if (r(t)) {\n          const {\n            tl: e,\n            br: o,\n            page: s\n          } = t;\n          A = o[0] - e[0], P = o[1] - e[1];\n          const a = L.getPageSize(s);\n          r(a) && (L.bind(c, f.LINEAR, s, i), T.setUniform4f(\"u_tlbr\", e[0], e[1], o[0], o[1]), T.setUniform2fv(\"u_mosaicSize\", a), T.setUniform1i(\"u_texture\", i));\n        }\n\n        T.setUniform1f(\"u_opacity\", M);\n      } else this._color[0] = U * b[0], this._color[1] = U * b[1], this._color[2] = U * b[2], this._color[3] = U, T.setUniform4fv(\"u_color\", this._color);\n\n      if (T.setUniform1f(\"u_depth\", g.z || 0), R) {\n        const t = n(p + 1);\n        T.setUniform4fv(\"u_id\", t);\n      }\n\n      for (const r of o) {\n        if (T.setUniform1f(\"u_coord_range\", r.rangeX), T.setUniformMatrix3fv(\"u_dvsMat3\", r.transforms.dvs), j) {\n          const e = Math.max(2 ** (Math.round(h) - r.key.level), 1),\n                o = I * r.width * e,\n                i = o / t(A),\n                s = o / t(P);\n          this._patternMatrix[0] = i, this._patternMatrix[4] = s, T.setUniformMatrix3fv(\"u_pattern_matrix\", this._patternMatrix);\n        }\n\n        c.setStencilFunction(l.EQUAL, 0, 255), c.drawArrays(u.TRIANGLE_STRIP, 0, 4);\n      }\n    }\n  }\n\n  _loadWGLResources(t) {\n    if (this._vao) return;\n    const {\n      context: r,\n      styleLayer: e\n    } = t,\n          o = e.backgroundMaterial,\n          i = new Int8Array([0, 0, 1, 0, 0, 1, 1, 1]),\n          s = m.createVertex(r, p.STATIC_DRAW, i),\n          a = new _(r, o.getAttributeLocations(), o.getLayoutInfo(), {\n      geometry: s\n    });\n    this._vao = a;\n  }\n\n}\n\nexport { d as WGLBrushVTLBackground };","map":{"version":3,"names":["nextPowerOfTwo","t","isSome","r","c","e","f","o","VTL_TEXTURE_BINDING_UNIT_SPRITES","i","VTL_HIGH_RES_CUTOFF","s","WGLDrawPhase","a","u32to4Xu8","n","BufferObject","m","TextureSamplingMode","CompareFunction","l","PrimitiveType","u","Usage","p","VertexArrayObject","_","d","constructor","arguments","_color","_patternMatrix","_programOptions","id","pattern","dispose","_vao","drawMany","context","painter","styleLayerUID","requestRender","allowDelayedRender","_loadWGLResources","h","displayLevel","g","styleLayer","v","backgroundMaterial","y","vectorTilesMaterialManager","b","getPaintValue","M","x","j","U","w","window","devicePixelRatio","L","spriteMosaic","A","P","I","R","drawPhase","HITTEST","k","T","getMaterialProgram","isCompiled","bindVAO","useProgram","getMosaicItemPosition","tl","br","page","getPageSize","bind","LINEAR","setUniform4f","setUniform2fv","setUniform1i","setUniform1f","setUniform4fv","z","rangeX","setUniformMatrix3fv","transforms","dvs","Math","max","round","key","level","width","setStencilFunction","EQUAL","drawArrays","TRIANGLE_STRIP","Int8Array","createVertex","STATIC_DRAW","getAttributeLocations","getLayoutInfo","geometry","WGLBrushVTLBackground"],"sources":["E:/各个学科/论文/毕业论文/Atmosphere/eco-friendly/node_modules/@arcgis/core/views/2d/engine/webgl/brushes/WGLBrushVTLBackground.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{nextPowerOfTwo as t}from\"../../../../../core/mathUtils.js\";import{isSome as r}from\"../../../../../core/maybe.js\";import{c as e}from\"../../../../../chunks/mat3f32.js\";import{f as o}from\"../../../../../chunks/vec4f32.js\";import{VTL_TEXTURE_BINDING_UNIT_SPRITES as i,VTL_HIGH_RES_CUTOFF as s}from\"../definitions.js\";import{WGLDrawPhase as a}from\"../enums.js\";import{u32to4Xu8 as n}from\"../number.js\";import c from\"./WGLBrush.js\";import{BufferObject as m}from\"../../../../webgl/BufferObject.js\";import{TextureSamplingMode as f,CompareFunction as l,PrimitiveType as u,Usage as p}from\"../../../../webgl/enums.js\";import{VertexArrayObject as _}from\"../../../../webgl/VertexArrayObject.js\";class d extends c{constructor(){super(...arguments),this._color=o(1,0,0,1),this._patternMatrix=e(),this._programOptions={id:!1,pattern:!1}}dispose(){this._vao&&(this._vao.dispose(),this._vao=null)}drawMany(e,o){const{context:c,painter:m,styleLayerUID:p,requestRender:_,allowDelayedRender:d}=e;this._loadWGLResources(e);const h=e.displayLevel,g=e.styleLayer,v=g.backgroundMaterial,y=m.vectorTilesMaterialManager,b=g.getPaintValue(\"background-color\",h),M=g.getPaintValue(\"background-opacity\",h),x=g.getPaintValue(\"background-pattern\",h),j=void 0!==x,U=b[3]*M,w=1|window.devicePixelRatio,L=e.spriteMosaic;let A,P;const I=w>s?2:1,R=e.drawPhase===a.HITTEST,k=this._programOptions;k.id=R,k.pattern=j;const T=y.getMaterialProgram(c,v,k);if(d&&r(_)&&!T.isCompiled)_();else{if(c.bindVAO(this._vao),c.useProgram(T),j){const t=L.getMosaicItemPosition(x,!0);if(r(t)){const{tl:e,br:o,page:s}=t;A=o[0]-e[0],P=o[1]-e[1];const a=L.getPageSize(s);r(a)&&(L.bind(c,f.LINEAR,s,i),T.setUniform4f(\"u_tlbr\",e[0],e[1],o[0],o[1]),T.setUniform2fv(\"u_mosaicSize\",a),T.setUniform1i(\"u_texture\",i))}T.setUniform1f(\"u_opacity\",M)}else this._color[0]=U*b[0],this._color[1]=U*b[1],this._color[2]=U*b[2],this._color[3]=U,T.setUniform4fv(\"u_color\",this._color);if(T.setUniform1f(\"u_depth\",g.z||0),R){const t=n(p+1);T.setUniform4fv(\"u_id\",t)}for(const r of o){if(T.setUniform1f(\"u_coord_range\",r.rangeX),T.setUniformMatrix3fv(\"u_dvsMat3\",r.transforms.dvs),j){const e=Math.max(2**(Math.round(h)-r.key.level),1),o=I*r.width*e,i=o/t(A),s=o/t(P);this._patternMatrix[0]=i,this._patternMatrix[4]=s,T.setUniformMatrix3fv(\"u_pattern_matrix\",this._patternMatrix)}c.setStencilFunction(l.EQUAL,0,255),c.drawArrays(u.TRIANGLE_STRIP,0,4)}}}_loadWGLResources(t){if(this._vao)return;const{context:r,styleLayer:e}=t,o=e.backgroundMaterial,i=new Int8Array([0,0,1,0,0,1,1,1]),s=m.createVertex(r,p.STATIC_DRAW,i),a=new _(r,o.getAttributeLocations(),o.getLayoutInfo(),{geometry:s});this._vao=a}}export{d as WGLBrushVTLBackground};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}