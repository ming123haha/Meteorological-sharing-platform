{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport t from \"../../../../../core/Evented.js\";\nimport { isSome as e } from \"../../../../../core/maybe.js\";\nimport { DECLUTTER_BUDGET as i, FADE_DURATION as s } from \"./config.js\";\nimport { VTLUniqueSymbol as o } from \"./core.js\";\nimport { CollisionJob as r } from \"./jobs.js\";\nimport { SymbolDeclutterer as l } from \"./SymbolDeclutterer.js\";\nimport { SymbolRepository as a } from \"./SymbolRepository.js\";\nimport { writeOpacityToBuffers as h } from \"./util.js\";\nimport { Visibility as c } from \"../style/StyleDefinition.js\";\nconst n = .5,\n      _ = 1e-6;\n\nclass m extends t {\n  constructor(t, e) {\n    super(), this.styleRepository = t, this._tileToHandle = new Map(), this._viewState = {\n      scale: 0,\n      rotation: 0,\n      center: [0, 0],\n      size: [0, 0]\n    }, this._declutterViewState = {\n      scale: 0,\n      rotation: 0,\n      center: [0, 0],\n      size: [0, 0]\n    }, this._completed = !1, this._symbolRepository = new a(4096, e, () => new o()), this._symbolDeclutterer = new l(e, this._symbolRepository, (t, e, i) => new r(t, e, i, this.styleRepository, this._zoom, this._viewState.rotation), (t, e) => {\n      t.allSymbolsFadingOut = !0, t.lastOpacityUpdate = e, h(t, e, !0), t.decluttered = !0, t.requestRender();\n    }, (t, e) => this.styleRepository.getStyleLayerByUID(t.styleLayerUID).z - this.styleRepository.getStyleLayerByUID(e.styleLayerUID).z, t => {\n      const e = this.styleRepository.getStyleLayerByUID(t);\n      if (this._zoom + _ < e.minzoom || this._zoom - _ >= e.maxzoom) return !1;\n      const i = e.getLayoutProperty(\"visibility\");\n      return !i || i.getValue() !== c.NONE;\n    });\n  }\n\n  addTile(t) {\n    t.decluttered = !1, this._tileToHandle.set(t, t.on(\"symbols-changed\", () => {\n      this._symbolRepository.add(t), this.restartDeclutter();\n    })), this._symbolRepository.add(t), this.restartDeclutter();\n  }\n\n  removeTile(t) {\n    const e = this._tileToHandle.get(t);\n\n    e && (this._symbolRepository.removeTile(t), this.restartDeclutter(), e.remove(), this._tileToHandle.delete(t));\n  }\n\n  update(t, e) {\n    return this._zoom = t, this._viewState = {\n      scale: e.scale,\n      rotation: e.rotation,\n      center: [e.center[0], e.center[1]],\n      size: [e.size[0], e.size[1]]\n    }, this._continueDeclutter(), this._completed;\n  }\n\n  restartDeclutter() {\n    this._completed = !1, this._symbolDeclutterer.restart(), this._notifyUnstable();\n  }\n\n  clear() {\n    this._completed = !1, this._symbolRepository = null, this._symbolDeclutterer.restart(), this._tileToHandle.forEach(t => t.remove()), this._tileToHandle.clear();\n  }\n\n  get stale() {\n    return this._zoom !== this._declutterZoom || this._viewState.size[0] !== this._declutterViewState.size[0] || this._viewState.size[1] !== this._declutterViewState.size[1] || this._viewState.scale !== this._declutterViewState.scale || this._viewState.rotation !== this._declutterViewState.rotation;\n  }\n\n  deleteStyleLayers(t) {\n    this._symbolRepository.deleteStyleLayers(t);\n  }\n\n  _continueDeclutter() {\n    this._completed && !this.stale || (this._symbolDeclutterer.running || (this._declutterZoom = this._zoom, this._declutterViewState.center[0] = this._viewState.center[0], this._declutterViewState.center[1] = this._viewState.center[1], this._declutterViewState.rotation = this._viewState.rotation, this._declutterViewState.scale = this._viewState.scale, this._declutterViewState.size[0] = this._viewState.size[0], this._declutterViewState.size[1] = this._viewState.size[1], this._symbolDeclutterer.restart()), this._symbolDeclutterer.setScreenSize(this._viewState.size[0], this._viewState.size[1]), this._completed = this._symbolDeclutterer.continue(i), this._completed && this._scheduleNotifyStable());\n  }\n\n  _scheduleNotifyStable() {\n    e(this._stableNotificationHandle) && clearTimeout(this._stableNotificationHandle), this._stableNotificationHandle = setTimeout(() => {\n      this._stableNotificationHandle = null, this.emit(\"fade-complete\");\n    }, (1 + n) * s);\n  }\n\n  _notifyUnstable() {\n    e(this._stableNotificationHandle) && (clearTimeout(this._stableNotificationHandle), this._stableNotificationHandle = null), this.emit(\"fade-start\");\n  }\n\n}\n\nexport { m as SymbolFader };","map":{"version":3,"names":["t","isSome","e","DECLUTTER_BUDGET","i","FADE_DURATION","s","VTLUniqueSymbol","o","CollisionJob","r","SymbolDeclutterer","l","SymbolRepository","a","writeOpacityToBuffers","h","Visibility","c","n","_","m","constructor","styleRepository","_tileToHandle","Map","_viewState","scale","rotation","center","size","_declutterViewState","_completed","_symbolRepository","_symbolDeclutterer","_zoom","allSymbolsFadingOut","lastOpacityUpdate","decluttered","requestRender","getStyleLayerByUID","styleLayerUID","z","minzoom","maxzoom","getLayoutProperty","getValue","NONE","addTile","set","on","add","restartDeclutter","removeTile","get","remove","delete","update","_continueDeclutter","restart","_notifyUnstable","clear","forEach","stale","_declutterZoom","deleteStyleLayers","running","setScreenSize","continue","_scheduleNotifyStable","_stableNotificationHandle","clearTimeout","setTimeout","emit","SymbolFader"],"sources":["E:/各个学科/论文/毕业论文/Atmosphere/eco-friendly/node_modules/@arcgis/core/views/2d/engine/vectorTiles/decluttering/SymbolFader.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport t from\"../../../../../core/Evented.js\";import{isSome as e}from\"../../../../../core/maybe.js\";import{DECLUTTER_BUDGET as i,FADE_DURATION as s}from\"./config.js\";import{VTLUniqueSymbol as o}from\"./core.js\";import{CollisionJob as r}from\"./jobs.js\";import{SymbolDeclutterer as l}from\"./SymbolDeclutterer.js\";import{SymbolRepository as a}from\"./SymbolRepository.js\";import{writeOpacityToBuffers as h}from\"./util.js\";import{Visibility as c}from\"../style/StyleDefinition.js\";const n=.5,_=1e-6;class m extends t{constructor(t,e){super(),this.styleRepository=t,this._tileToHandle=new Map,this._viewState={scale:0,rotation:0,center:[0,0],size:[0,0]},this._declutterViewState={scale:0,rotation:0,center:[0,0],size:[0,0]},this._completed=!1,this._symbolRepository=new a(4096,e,(()=>new o)),this._symbolDeclutterer=new l(e,this._symbolRepository,((t,e,i)=>new r(t,e,i,this.styleRepository,this._zoom,this._viewState.rotation)),((t,e)=>{t.allSymbolsFadingOut=!0,t.lastOpacityUpdate=e,h(t,e,!0),t.decluttered=!0,t.requestRender()}),((t,e)=>this.styleRepository.getStyleLayerByUID(t.styleLayerUID).z-this.styleRepository.getStyleLayerByUID(e.styleLayerUID).z),(t=>{const e=this.styleRepository.getStyleLayerByUID(t);if(this._zoom+_<e.minzoom||this._zoom-_>=e.maxzoom)return!1;const i=e.getLayoutProperty(\"visibility\");return!i||i.getValue()!==c.NONE}))}addTile(t){t.decluttered=!1,this._tileToHandle.set(t,t.on(\"symbols-changed\",(()=>{this._symbolRepository.add(t),this.restartDeclutter()}))),this._symbolRepository.add(t),this.restartDeclutter()}removeTile(t){const e=this._tileToHandle.get(t);e&&(this._symbolRepository.removeTile(t),this.restartDeclutter(),e.remove(),this._tileToHandle.delete(t))}update(t,e){return this._zoom=t,this._viewState={scale:e.scale,rotation:e.rotation,center:[e.center[0],e.center[1]],size:[e.size[0],e.size[1]]},this._continueDeclutter(),this._completed}restartDeclutter(){this._completed=!1,this._symbolDeclutterer.restart(),this._notifyUnstable()}clear(){this._completed=!1,this._symbolRepository=null,this._symbolDeclutterer.restart(),this._tileToHandle.forEach((t=>t.remove())),this._tileToHandle.clear()}get stale(){return this._zoom!==this._declutterZoom||this._viewState.size[0]!==this._declutterViewState.size[0]||this._viewState.size[1]!==this._declutterViewState.size[1]||this._viewState.scale!==this._declutterViewState.scale||this._viewState.rotation!==this._declutterViewState.rotation}deleteStyleLayers(t){this._symbolRepository.deleteStyleLayers(t)}_continueDeclutter(){this._completed&&!this.stale||(this._symbolDeclutterer.running||(this._declutterZoom=this._zoom,this._declutterViewState.center[0]=this._viewState.center[0],this._declutterViewState.center[1]=this._viewState.center[1],this._declutterViewState.rotation=this._viewState.rotation,this._declutterViewState.scale=this._viewState.scale,this._declutterViewState.size[0]=this._viewState.size[0],this._declutterViewState.size[1]=this._viewState.size[1],this._symbolDeclutterer.restart()),this._symbolDeclutterer.setScreenSize(this._viewState.size[0],this._viewState.size[1]),this._completed=this._symbolDeclutterer.continue(i),this._completed&&this._scheduleNotifyStable())}_scheduleNotifyStable(){e(this._stableNotificationHandle)&&clearTimeout(this._stableNotificationHandle),this._stableNotificationHandle=setTimeout((()=>{this._stableNotificationHandle=null,this.emit(\"fade-complete\")}),(1+n)*s)}_notifyUnstable(){e(this._stableNotificationHandle)&&(clearTimeout(this._stableNotificationHandle),this._stableNotificationHandle=null),this.emit(\"fade-start\")}}export{m as SymbolFader};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}