{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport \"../../../../core/has.js\";\nimport e from \"../../../../core/LRUCache.js\";\nimport { getOrCreateMapValue as t } from \"../../../../core/MapUtils.js\";\nimport { isSome as s, isNone as n } from \"../../../../core/maybe.js\";\nimport { throwIfAborted as o } from \"../../../../core/promiseUtils.js\";\nimport { getMetersPerVerticalUnitForSR as i } from \"../../../../core/unitUtils.js\";\nimport { getMetersPerUnit as a } from \"../../../../symbols/support/unitConversionUtils.js\";\n\nfunction r(e = !1, t) {\n  if (e) {\n    const {\n      elevationInfo: e,\n      alignPointsInFeatures: s,\n      spatialReference: n\n    } = t;\n    return new l(e, s, n);\n  }\n\n  return new c();\n}\n\nclass c {\n  async alignCandidates(e, t) {\n    return e;\n  }\n\n  notifyElevationSourceChange() {}\n\n}\n\nconst h = 1024;\n\nclass l {\n  constructor(t, s, n) {\n    this._elevationInfo = t, this._alignPointsInFeatures = s, this.spatialReference = n, this._alignmentsCache = new e(h), this._cacheVersion = 0, this._metersPerVerticalUnit = i(n);\n  }\n\n  async alignCandidates(e, t) {\n    const n = this._elevationInfo;\n    return s(n) && \"absolute-height\" === n.mode && !n.featureExpressionInfo ? (this._alignAbsoluteElevationCandidates(e, n), e) : this._alignComputedElevationCandidates(e, t);\n  }\n\n  notifyElevationSourceChange() {\n    this._alignmentsCache.clear(), this._cacheVersion++;\n  }\n\n  _alignAbsoluteElevationCandidates(e, t) {\n    const {\n      offset: s,\n      unit: o\n    } = t;\n    if (n(s)) return;\n\n    const i = s * (a(o ?? \"meters\") / this._metersPerVerticalUnit);\n\n    for (const n of e) switch (n.type) {\n      case \"edge\":\n        n.start.z += i, n.end.z += i;\n        continue;\n\n      case \"vertex\":\n        n.target.z += i;\n        continue;\n    }\n  }\n\n  async _alignComputedElevationCandidates(e, s) {\n    const n = new Map();\n\n    for (const o of e) t(n, o.objectId, p).push(o);\n\n    const [i, a, r] = this._prepareQuery(n),\n          c = await this._alignPointsInFeatures(i, s);\n\n    o(s);\n    if (r !== this._cacheVersion) return this._alignComputedElevationCandidates(e, s);\n\n    this._applyCacheAndResponse(i, c, a);\n\n    const {\n      drapedObjectIds: h,\n      failedObjectIds: l\n    } = c,\n          d = [];\n\n    for (const t of e) {\n      const {\n        objectId: e\n      } = t;\n      h.has(e) && \"edge\" === t.type && (t.draped = !0), l.has(e) || d.push(t);\n    }\n\n    return d;\n  }\n\n  _prepareQuery(e) {\n    const t = [],\n          s = [];\n\n    for (const [n, o] of e) {\n      const e = [];\n\n      for (const t of o) this._addToQueriesOrCachedResult(n, t.target, e, s), \"edge\" === t.type && (this._addToQueriesOrCachedResult(n, t.start, e, s), this._addToQueriesOrCachedResult(n, t.end, e, s));\n\n      0 !== e.length && t.push({\n        objectId: n,\n        points: e\n      });\n    }\n\n    return [t, s, this._cacheVersion];\n  }\n\n  _addToQueriesOrCachedResult(e, t, n, o) {\n    const i = u(e, t),\n          a = this._alignmentsCache.get(i);\n\n    s(a) ? o.push(new d(t, a)) : n.push(t);\n  }\n\n  _applyCacheAndResponse(e, {\n    elevations: t,\n    drapedObjectIds: s,\n    failedObjectIds: n\n  }, o) {\n    for (const r of o) r.apply();\n\n    let i = 0;\n    const a = this._alignmentsCache;\n\n    for (const {\n      objectId: r,\n      points: c\n    } of e) {\n      if (n.has(r)) {\n        i += c.length;\n        continue;\n      }\n\n      const e = !s.has(r);\n\n      for (const s of c) {\n        const n = u(r, s),\n              o = t[i++];\n        s.z = o, e && a.put(n, o, 1);\n      }\n    }\n  }\n\n}\n\nclass d {\n  constructor(e, t) {\n    this.point = e, this.z = t;\n  }\n\n  apply() {\n    this.point.z = this.z;\n  }\n\n}\n\nfunction u(e, {\n  x: t,\n  y: s,\n  z: n\n}) {\n  return `${e}-${t}-${s}-${n ?? 0}}`;\n}\n\nfunction p() {\n  return [];\n}\n\nexport { r as getSnappingCandidateElevationAligner };","map":{"version":3,"names":["e","getOrCreateMapValue","t","isSome","s","isNone","n","throwIfAborted","o","getMetersPerVerticalUnitForSR","i","getMetersPerUnit","a","r","elevationInfo","alignPointsInFeatures","spatialReference","l","c","alignCandidates","notifyElevationSourceChange","h","constructor","_elevationInfo","_alignPointsInFeatures","_alignmentsCache","_cacheVersion","_metersPerVerticalUnit","mode","featureExpressionInfo","_alignAbsoluteElevationCandidates","_alignComputedElevationCandidates","clear","offset","unit","type","start","z","end","target","Map","objectId","p","push","_prepareQuery","_applyCacheAndResponse","drapedObjectIds","failedObjectIds","d","has","draped","_addToQueriesOrCachedResult","length","points","u","get","elevations","apply","put","point","x","y","getSnappingCandidateElevationAligner"],"sources":["E:/各个学科/论文/毕业论文/Atmosphere/eco-friendly/node_modules/@arcgis/core/views/interactive/snapping/featureSources/snappingCandidateElevationAlignment.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport\"../../../../core/has.js\";import e from\"../../../../core/LRUCache.js\";import{getOrCreateMapValue as t}from\"../../../../core/MapUtils.js\";import{isSome as s,isNone as n}from\"../../../../core/maybe.js\";import{throwIfAborted as o}from\"../../../../core/promiseUtils.js\";import{getMetersPerVerticalUnitForSR as i}from\"../../../../core/unitUtils.js\";import{getMetersPerUnit as a}from\"../../../../symbols/support/unitConversionUtils.js\";function r(e=!1,t){if(e){const{elevationInfo:e,alignPointsInFeatures:s,spatialReference:n}=t;return new l(e,s,n)}return new c}class c{async alignCandidates(e,t){return e}notifyElevationSourceChange(){}}const h=1024;class l{constructor(t,s,n){this._elevationInfo=t,this._alignPointsInFeatures=s,this.spatialReference=n,this._alignmentsCache=new e(h),this._cacheVersion=0,this._metersPerVerticalUnit=i(n)}async alignCandidates(e,t){const n=this._elevationInfo;return s(n)&&\"absolute-height\"===n.mode&&!n.featureExpressionInfo?(this._alignAbsoluteElevationCandidates(e,n),e):this._alignComputedElevationCandidates(e,t)}notifyElevationSourceChange(){this._alignmentsCache.clear(),this._cacheVersion++}_alignAbsoluteElevationCandidates(e,t){const{offset:s,unit:o}=t;if(n(s))return;const i=s*(a(o??\"meters\")/this._metersPerVerticalUnit);for(const n of e)switch(n.type){case\"edge\":n.start.z+=i,n.end.z+=i;continue;case\"vertex\":n.target.z+=i;continue}}async _alignComputedElevationCandidates(e,s){const n=new Map;for(const o of e)t(n,o.objectId,p).push(o);const[i,a,r]=this._prepareQuery(n),c=await this._alignPointsInFeatures(i,s);o(s);if(r!==this._cacheVersion)return this._alignComputedElevationCandidates(e,s);this._applyCacheAndResponse(i,c,a);const{drapedObjectIds:h,failedObjectIds:l}=c,d=[];for(const t of e){const{objectId:e}=t;h.has(e)&&\"edge\"===t.type&&(t.draped=!0),l.has(e)||d.push(t)}return d}_prepareQuery(e){const t=[],s=[];for(const[n,o]of e){const e=[];for(const t of o)this._addToQueriesOrCachedResult(n,t.target,e,s),\"edge\"===t.type&&(this._addToQueriesOrCachedResult(n,t.start,e,s),this._addToQueriesOrCachedResult(n,t.end,e,s));0!==e.length&&t.push({objectId:n,points:e})}return[t,s,this._cacheVersion]}_addToQueriesOrCachedResult(e,t,n,o){const i=u(e,t),a=this._alignmentsCache.get(i);s(a)?o.push(new d(t,a)):n.push(t)}_applyCacheAndResponse(e,{elevations:t,drapedObjectIds:s,failedObjectIds:n},o){for(const r of o)r.apply();let i=0;const a=this._alignmentsCache;for(const{objectId:r,points:c}of e){if(n.has(r)){i+=c.length;continue}const e=!s.has(r);for(const s of c){const n=u(r,s),o=t[i++];s.z=o,e&&a.put(n,o,1)}}}}class d{constructor(e,t){this.point=e,this.z=t}apply(){this.point.z=this.z}}function u(e,{x:t,y:s,z:n}){return`${e}-${t}-${s}-${n??0}}`}function p(){return[]}export{r as getSnappingCandidateElevationAligner};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}