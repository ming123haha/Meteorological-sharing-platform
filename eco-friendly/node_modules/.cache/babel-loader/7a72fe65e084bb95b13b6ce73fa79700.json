{"ast":null,"code":"import \"core-js/modules/es.typed-array.at.js\";\nimport \"core-js/modules/es.typed-array.set.js\";\nimport \"core-js/modules/esnext.typed-array.find-last.js\";\nimport \"core-js/modules/esnext.typed-array.find-last-index.js\";\n\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport { isSome as e, isNone as t } from \"../../../../../core/maybe.js\";\nimport { TranslateAnchor as i } from \"../../vectorTiles/style/StyleDefinition.js\";\nimport { VTL_TEXTURE_BINDING_UNIT_SPRITES as n } from \"../definitions.js\";\nimport { WGLDrawPhase as r } from \"../enums.js\";\nimport { u32to4Xu8 as a } from \"../number.js\";\nimport o from \"./WGLBrush.js\";\nimport { TextureSamplingMode as s, CompareFunction as l, PrimitiveType as f, DataType as m } from \"../../../../webgl/enums.js\";\n\nclass u extends o {\n  constructor() {\n    super(...arguments), this._programOptions = {\n      id: !1,\n      pattern: !1,\n      sdf: !1\n    };\n  }\n\n  dispose() {}\n\n  drawMany(o, u) {\n    const {\n      context: c,\n      displayLevel: d,\n      state: p,\n      drawPhase: y,\n      painter: g,\n      pixelRatio: E,\n      spriteMosaic: M,\n      styleLayerUID: _,\n      requestRender: v,\n      allowDelayedRender: U\n    } = o;\n    if (!u.some(e => e.layerData.get(_)?.lineIndexCount ?? !1)) return;\n    const I = o.styleLayer,\n          P = I.lineMaterial,\n          x = g.vectorTilesMaterialManager,\n          T = I.getPaintValue(\"line-translate\", d),\n          D = I.getPaintValue(\"line-translate-anchor\", d),\n          S = I.getPaintProperty(\"line-pattern\"),\n          L = void 0 !== S,\n          N = L && S.isDataDriven;\n    let R, V;\n\n    if (L && !N) {\n      const e = S.getValue(d);\n      R = M.getMosaicItemPosition(e);\n    }\n\n    let h = !1;\n\n    if (!L) {\n      const e = I.getPaintProperty(\"line-dasharray\");\n\n      if (V = void 0 !== e, h = V && e.isDataDriven, V && !h) {\n        const t = e.getValue(d),\n              i = I.getDashKey(t, I.getLayoutValue(\"line-cap\", d));\n        R = M.getMosaicItemPosition(i);\n      }\n    }\n\n    const w = 1 / E,\n          A = y === r.HITTEST,\n          j = this._programOptions;\n    j.id = A, j.pattern = L, j.sdf = V;\n    const b = x.getMaterialProgram(c, P, j);\n    if (U && e(v) && !b.isCompiled) return void v();\n\n    if (c.useProgram(b), b.setUniformMatrix3fv(\"u_displayViewMat3\", p.displayViewMat3), b.setUniformMatrix3fv(\"u_displayMat3\", D === i.VIEWPORT ? p.displayMat3 : p.displayViewMat3), b.setUniform2fv(\"u_lineTranslation\", T), b.setUniform1f(\"u_depth\", I.z), b.setUniform1f(\"u_antialiasing\", w), A) {\n      const e = a(_ + 1);\n      b.setUniform4fv(\"u_id\", e);\n    }\n\n    if (R && e(R)) {\n      const {\n        page: t\n      } = R,\n            i = M.getPageSize(t);\n      e(i) && (M.bind(c, s.LINEAR, t, n), b.setUniform2fv(\"u_mosaicSize\", i), b.setUniform1i(\"u_texture\", n));\n    }\n\n    let z = -1;\n\n    for (const i of u) {\n      if (!i.layerData.has(_)) continue;\n      i.key.level !== z && (z = i.key.level, P.setDataUniforms(b, d, I, z, M));\n      const r = 2 ** (d - z) / E;\n      b.setUniform1f(\"u_zoomFactor\", r);\n      const a = i.layerData.get(_);\n      if (!a.lineIndexCount) continue;\n      a.prepareForRendering(c);\n      const o = a.lineVertexArrayObject;\n\n      if (!t(o)) {\n        if (c.bindVAO(o), b.setUniformMatrix3fv(\"u_dvsMat3\", i.transforms.dvs), c.setStencilFunction(l.EQUAL, i.stencilRef, 255), N || h) {\n          const t = a.patternMap;\n          if (!t) continue;\n\n          for (const [i, r] of t) {\n            const t = M.getPageSize(i);\n            e(t) && (M.bind(c, s.LINEAR, i, n), b.setUniform2fv(\"u_mosaicSize\", t), b.setUniform1i(\"u_texture\", n), c.drawElements(f.TRIANGLES, r[1], m.UNSIGNED_INT, Uint32Array.BYTES_PER_ELEMENT * r[0]));\n          }\n        } else c.drawElements(f.TRIANGLES, a.lineIndexCount, m.UNSIGNED_INT, Uint32Array.BYTES_PER_ELEMENT * a.lineIndexStart);\n\n        i.triangleCount += a.lineIndexCount / 3;\n      }\n    }\n  }\n\n}\n\nexport { u as WGLBrushVTLLine };","map":{"version":3,"names":["isSome","e","isNone","t","TranslateAnchor","i","VTL_TEXTURE_BINDING_UNIT_SPRITES","n","WGLDrawPhase","r","u32to4Xu8","a","o","TextureSamplingMode","s","CompareFunction","l","PrimitiveType","f","DataType","m","u","constructor","arguments","_programOptions","id","pattern","sdf","dispose","drawMany","context","c","displayLevel","d","state","p","drawPhase","y","painter","g","pixelRatio","E","spriteMosaic","M","styleLayerUID","_","requestRender","v","allowDelayedRender","U","some","layerData","get","lineIndexCount","I","styleLayer","P","lineMaterial","x","vectorTilesMaterialManager","T","getPaintValue","D","S","getPaintProperty","L","N","isDataDriven","R","V","getValue","getMosaicItemPosition","h","getDashKey","getLayoutValue","w","A","HITTEST","j","b","getMaterialProgram","isCompiled","useProgram","setUniformMatrix3fv","displayViewMat3","VIEWPORT","displayMat3","setUniform2fv","setUniform1f","z","setUniform4fv","page","getPageSize","bind","LINEAR","setUniform1i","has","key","level","setDataUniforms","prepareForRendering","lineVertexArrayObject","bindVAO","transforms","dvs","setStencilFunction","EQUAL","stencilRef","patternMap","drawElements","TRIANGLES","UNSIGNED_INT","Uint32Array","BYTES_PER_ELEMENT","lineIndexStart","triangleCount","WGLBrushVTLLine"],"sources":["E:/各个学科/论文/毕业论文/Atmosphere/eco-friendly/node_modules/@arcgis/core/views/2d/engine/webgl/brushes/WGLBrushVTLLine.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{isSome as e,isNone as t}from\"../../../../../core/maybe.js\";import{TranslateAnchor as i}from\"../../vectorTiles/style/StyleDefinition.js\";import{VTL_TEXTURE_BINDING_UNIT_SPRITES as n}from\"../definitions.js\";import{WGLDrawPhase as r}from\"../enums.js\";import{u32to4Xu8 as a}from\"../number.js\";import o from\"./WGLBrush.js\";import{TextureSamplingMode as s,CompareFunction as l,PrimitiveType as f,DataType as m}from\"../../../../webgl/enums.js\";class u extends o{constructor(){super(...arguments),this._programOptions={id:!1,pattern:!1,sdf:!1}}dispose(){}drawMany(o,u){const{context:c,displayLevel:d,state:p,drawPhase:y,painter:g,pixelRatio:E,spriteMosaic:M,styleLayerUID:_,requestRender:v,allowDelayedRender:U}=o;if(!u.some((e=>e.layerData.get(_)?.lineIndexCount??!1)))return;const I=o.styleLayer,P=I.lineMaterial,x=g.vectorTilesMaterialManager,T=I.getPaintValue(\"line-translate\",d),D=I.getPaintValue(\"line-translate-anchor\",d),S=I.getPaintProperty(\"line-pattern\"),L=void 0!==S,N=L&&S.isDataDriven;let R,V;if(L&&!N){const e=S.getValue(d);R=M.getMosaicItemPosition(e)}let h=!1;if(!L){const e=I.getPaintProperty(\"line-dasharray\");if(V=void 0!==e,h=V&&e.isDataDriven,V&&!h){const t=e.getValue(d),i=I.getDashKey(t,I.getLayoutValue(\"line-cap\",d));R=M.getMosaicItemPosition(i)}}const w=1/E,A=y===r.HITTEST,j=this._programOptions;j.id=A,j.pattern=L,j.sdf=V;const b=x.getMaterialProgram(c,P,j);if(U&&e(v)&&!b.isCompiled)return void v();if(c.useProgram(b),b.setUniformMatrix3fv(\"u_displayViewMat3\",p.displayViewMat3),b.setUniformMatrix3fv(\"u_displayMat3\",D===i.VIEWPORT?p.displayMat3:p.displayViewMat3),b.setUniform2fv(\"u_lineTranslation\",T),b.setUniform1f(\"u_depth\",I.z),b.setUniform1f(\"u_antialiasing\",w),A){const e=a(_+1);b.setUniform4fv(\"u_id\",e)}if(R&&e(R)){const{page:t}=R,i=M.getPageSize(t);e(i)&&(M.bind(c,s.LINEAR,t,n),b.setUniform2fv(\"u_mosaicSize\",i),b.setUniform1i(\"u_texture\",n))}let z=-1;for(const i of u){if(!i.layerData.has(_))continue;i.key.level!==z&&(z=i.key.level,P.setDataUniforms(b,d,I,z,M));const r=2**(d-z)/E;b.setUniform1f(\"u_zoomFactor\",r);const a=i.layerData.get(_);if(!a.lineIndexCount)continue;a.prepareForRendering(c);const o=a.lineVertexArrayObject;if(!t(o)){if(c.bindVAO(o),b.setUniformMatrix3fv(\"u_dvsMat3\",i.transforms.dvs),c.setStencilFunction(l.EQUAL,i.stencilRef,255),N||h){const t=a.patternMap;if(!t)continue;for(const[i,r]of t){const t=M.getPageSize(i);e(t)&&(M.bind(c,s.LINEAR,i,n),b.setUniform2fv(\"u_mosaicSize\",t),b.setUniform1i(\"u_texture\",n),c.drawElements(f.TRIANGLES,r[1],m.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*r[0]))}}else c.drawElements(f.TRIANGLES,a.lineIndexCount,m.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*a.lineIndexStart);i.triangleCount+=a.lineIndexCount/3}}}}export{u as WGLBrushVTLLine};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}