{"ast":null,"code":"import \"core-js/modules/es.error.cause.js\";\n\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../../../chunks/tslib.es6.js\";\nimport { equals as t } from \"../../../../../core/arrayUtils.js\";\nimport { AsyncSequence as i } from \"../../../../../core/AsyncSequence.js\";\nimport { HandleOwner as s } from \"../../../../../core/HandleOwner.js\";\nimport { makeHandle as r } from \"../../../../../core/handleUtils.js\";\nimport o from \"../../../../../core/Logger.js\";\nimport { isSome as n, isNone as a, unwrap as l } from \"../../../../../core/maybe.js\";\nimport { createTask as u, throwIfAbortError as c } from \"../../../../../core/promiseUtils.js\";\nimport { sync as d } from \"../../../../../core/reactiveUtils.js\";\nimport { property as h } from \"../../../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../../../core/has.js\";\nimport \"../../../../../core/accessorSupport/ensureType.js\";\nimport { subclass as p } from \"../../../../../core/accessorSupport/decorators/subclass.js\";\nimport f from \"../../../../../geometry/Extent.js\";\nimport { toExtent as y } from \"../../../../../geometry/support/aaBoundingRect.js\";\nimport { unquantizeOptimizedFeatureSet as g, convertFromFeatureSet as m } from \"../../../../../layers/graphics/featureConversionUtils.js\";\nimport { isHostedAgolService as _ } from \"../../../../../layers/support/arcgisLayerUrl.js\";\nimport { OptimizedFeatureSetParserContext as F } from \"../../../../../rest/query/operations/pbfOptimizedFeatureSet.js\";\nimport { executeQueryForExtent as b, executeQueryPBF as T, executeQuery as P } from \"../../../../../rest/query/operations/query.js\";\nimport v from \"../../../../../rest/support/Query.js\";\nimport { StateType as I, PendingFeatureTile as O } from \"./PendingFeatureTile.js\";\nconst S = o.getLogger(\"esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiledFetcher\");\nlet C = class extends s {\n  constructor(e) {\n    super(e), this.tilesOfInterest = [], this.availability = 0, this.pendingTiles = new Map(), this.pendingEdits = new i(), this.pendingEditsAbortController = new AbortController();\n  }\n\n  get minimumVerticesPerFeature() {\n    switch (this.store?.featureStore.geometryType) {\n      case \"esriGeometryPoint\":\n      case \"esriGeometryMultipoint\":\n        return 1;\n\n      case \"esriGeometryPolygon\":\n        return 4;\n\n      case \"esriGeometryPolyline\":\n        return 2;\n    }\n  }\n\n  set filter(e) {\n    const t = this._get(\"filter\"),\n          i = this._filterProperties(e);\n\n    JSON.stringify(t) !== JSON.stringify(i) && this._set(\"filter\", i);\n  }\n\n  set customParameters(e) {\n    const t = this._get(\"customParameters\");\n\n    JSON.stringify(t) !== JSON.stringify(e) && this._set(\"customParameters\", e);\n  }\n\n  get configuration() {\n    return {\n      filter: this.filter,\n      customParameters: this.customParameters,\n      tileInfo: this.tileInfo,\n      tileSize: this.tileSize\n    };\n  }\n\n  set tileInfo(e) {\n    const t = this._get(\"tileInfo\");\n\n    t !== e && (n(e) && n(t) && JSON.stringify(e) === JSON.stringify(t) || (this._set(\"tileInfo\", e), this.store.tileInfo = e));\n  }\n\n  set tileSize(e) {\n    this._get(\"tileSize\") !== e && this._set(\"tileSize\", e);\n  }\n\n  get updating() {\n    return this.updatingHandles.updating || this.pendingEdits.updating;\n  }\n\n  initialize() {\n    this._initializeFetchExtent(), this.updatingHandles.add(() => this.configuration, () => this.refresh()), this.updatingHandles.add(() => this.tilesOfInterest, (e, i) => {\n      t(e, i, ({\n        id: e\n      }, {\n        id: t\n      }) => e === t) || this._process();\n    }, d);\n  }\n\n  destroy() {\n    this.pendingTiles.forEach(e => this._deletePendingTile(e)), this.pendingTiles.clear(), this.store.destroy(), this.tilesOfInterest.length = 0, this.pendingEditsAbortController.abort(), this.pendingEditsAbortController = null;\n  }\n\n  refresh() {\n    this.store.refresh(), this.pendingTiles.forEach(e => this._deletePendingTile(e)), this._process();\n  }\n\n  applyEdits(e) {\n    this.pendingEdits.push(e, async e => {\n      if (0 === e.addedFeatures.length && 0 === e.updatedFeatures.length && 0 === e.deletedFeatures.length) return;\n\n      for (const [, i] of this.pendingTiles) i.reset();\n\n      const t = { ...e,\n        deletedFeatures: e.deletedFeatures.map(({\n          objectId: e,\n          globalId: t\n        }) => e && -1 !== e ? e : this._lookupObjectIdByGlobalId(t))\n      };\n      await this.updatingHandles.addPromise(this.store.processEdits(t, (e, t) => this._queryFeaturesById(e, t), this.pendingEditsAbortController.signal)), this._processPendingTiles();\n    });\n  }\n\n  _initializeFetchExtent() {\n    if (!this.capabilities.query.supportsExtent || !_(this.url)) return;\n    const e = u(async e => {\n      try {\n        const t = await b(this.url, new v({\n          where: \"1=1\",\n          outSpatialReference: this.spatialReference,\n          cacheHint: !!this.capabilities.query.supportsCacheHint || void 0\n        }), {\n          query: this.configuration.customParameters,\n          signal: e\n        });\n        this.store.extent = f.fromJSON(t.data?.extent);\n      } catch (t) {\n        c(t), S.warn(\"Failed to fetch data extent\", t);\n      }\n    });\n    this.updatingHandles.addPromise(e.promise.then(() => this._process())), this.handles.add(r(() => e.abort()));\n  }\n\n  get debugInfo() {\n    return {\n      numberOfFeatures: this.store.featureStore.numFeatures,\n      tilesOfInterest: this.tilesOfInterest,\n      pendingTiles: Array.from(this.pendingTiles.values()).map(e => e.debugInfo),\n      storedTiles: this.store.debugInfo\n    };\n  }\n\n  _process() {\n    this._markTilesNotAlive(), this._createPendingTiles(), this._deletePendingTiles(), this._processPendingTiles();\n  }\n\n  _markTilesNotAlive() {\n    for (const [, e] of this.pendingTiles) e.alive = !1;\n  }\n\n  _createPendingTiles() {\n    const e = this._collectMissingTilesInfo();\n\n    if (this._setAvailability(a(e) ? 1 : e.coveredArea / e.fullArea), !a(e)) for (const {\n      data: t,\n      resolution: i\n    } of e.missingTiles) {\n      const e = this.pendingTiles.get(t.id);\n      e ? (e.resolution = i, e.alive = !0) : this._createPendingTile(t, i);\n    }\n  }\n\n  _collectMissingTilesInfo() {\n    let e = null;\n\n    for (let t = this.tilesOfInterest.length - 1; t >= 0; t--) {\n      const i = this.tilesOfInterest[t],\n            s = this.store.process(i, (e, t) => this._verifyTileComplexity(e, t));\n      a(e) ? e = s : e.prepend(s);\n    }\n\n    return e;\n  }\n\n  _deletePendingTiles() {\n    for (const [, e] of this.pendingTiles) e.alive || this._deletePendingTile(e);\n  }\n\n  _processPendingTiles() {\n    const e = {\n      fetchCount: (e, t) => this._fetchCount(e, t),\n      fetchFeatures: (e, t, i) => this._fetchFeatures(e, t, i),\n      finish: (e, t) => this._finishPendingTile(e, t),\n      resume: () => this._processPendingTiles()\n    };\n    if (this._ensureFetchAllCounts(e)) for (const [, t] of this.pendingTiles) this._verifyTileComplexity(this.store.getFeatureCount(t.data), t.resolution) && this.updatingHandles.addPromise(t.process(e));\n  }\n\n  _verifyTileComplexity(e, t) {\n    return this._verifyVertexComplexity(e) && this._verifyFeatureDensity(e, t);\n  }\n\n  _verifyVertexComplexity(e) {\n    return e * this.minimumVerticesPerFeature < E;\n  }\n\n  _verifyFeatureDensity(e, t) {\n    if (a(this.tileInfo)) return !1;\n    const i = this.tileSize * t;\n    return e * (w / (i * i)) < q;\n  }\n\n  _ensureFetchAllCounts(e) {\n    let t = !0;\n\n    for (const [, i] of this.pendingTiles) i.state.type < I.FETCHED_COUNT && this.updatingHandles.addPromise(i.process(e)), i.state.type <= I.FETCH_COUNT && (t = !1);\n\n    return t;\n  }\n\n  _finishPendingTile(e, t) {\n    this.store.add(e.data, t), this._deletePendingTile(e), this._updateAvailability();\n  }\n\n  _updateAvailability() {\n    const e = this._collectMissingTilesInfo();\n\n    this._setAvailability(a(e) ? 1 : e.coveredArea / e.fullArea);\n  }\n\n  _setAvailability(e) {\n    this._set(\"availability\", e);\n  }\n\n  _createPendingTile(e, t) {\n    const i = new O(e, t);\n    return this.pendingTiles.set(e.id, i), i;\n  }\n\n  _deletePendingTile(e) {\n    e.reset(), this.pendingTiles.delete(e.data.id);\n  }\n\n  async _fetchCount(e, t) {\n    return this.store.fetchCount(e.data, this.url, this._createCountQuery(e), {\n      query: this.customParameters,\n      timeout: x,\n      signal: t\n    });\n  }\n\n  async _fetchFeatures(e, t, i) {\n    let s,\n        r = 0,\n        o = 0,\n        n = t;\n\n    for (;;) {\n      const a = this._createFeaturesQuery(e),\n            u = this._setPagingParameters(a, r, n),\n            {\n        features: c,\n        exceededTransferLimit: d\n      } = await this._queryFeatures(a, i);\n\n      if (u && (r += l(a.num)), o += c.length, s = s ? s.concat(c) : c, n = t - o, !u || !d || n <= 0) return s;\n    }\n  }\n\n  _filterProperties(e) {\n    return a(e) ? {\n      where: \"1=1\",\n      gdbVersion: void 0,\n      timeExtent: void 0\n    } : {\n      where: e.where || \"1=1\",\n      timeExtent: e.timeExtent,\n      gdbVersion: e.gdbVersion\n    };\n  }\n\n  _lookupObjectIdByGlobalId(e) {\n    const t = this.globalIdField,\n          i = this.objectIdField;\n    if (a(t)) throw new Error(\"Expected globalIdField to be defined\");\n    let s = null;\n    if (this.store.featureStore.forEach(r => {\n      e === r.attributes[t] && (s = r.objectId ?? r.attributes[i]);\n    }), a(s)) throw new Error(`Expected to find a feature with globalId ${e}`);\n    return s;\n  }\n\n  _queryFeaturesById(e, t) {\n    const i = this._createFeaturesQuery(null);\n\n    return i.objectIds = e, this._queryFeatures(i, t);\n  }\n\n  _queryFeatures(e, t) {\n    return this.capabilities.query.supportsFormatPBF ? this._queryFeaturesPBF(e, t) : this._queryFeaturesJSON(e, t);\n  }\n\n  async _queryFeaturesPBF(e, t) {\n    const {\n      sourceSpatialReference: i\n    } = this,\n          {\n      data: s\n    } = await T(this.url, e, new F({\n      sourceSpatialReference: i\n    }), {\n      query: this.configuration.customParameters,\n      timeout: x,\n      signal: t\n    });\n    return g(s);\n  }\n\n  async _queryFeaturesJSON(e, t) {\n    const {\n      sourceSpatialReference: i\n    } = this,\n          {\n      data: s\n    } = await P(this.url, e, i, {\n      query: this.configuration.customParameters,\n      timeout: x,\n      signal: t\n    });\n    return m(s, this.objectIdField);\n  }\n\n  _createCountQuery(e) {\n    const t = this._createBaseQuery(e);\n\n    return this.capabilities.query.supportsCacheHint && (t.cacheHint = !0), t;\n  }\n\n  _createFeaturesQuery(e) {\n    const t = this._createBaseQuery(e);\n\n    return t.outFields = this.globalIdField ? [this.globalIdField, this.objectIdField] : [this.objectIdField], t.returnGeometry = !0, n(e) && (this.capabilities.query.supportsResultType ? t.resultType = \"tile\" : this.capabilities.query.supportsCacheHint && (t.cacheHint = !0)), t;\n  }\n\n  _createBaseQuery(e) {\n    const t = new v({\n      returnZ: !1,\n      returnM: !1,\n      geometry: n(this.tileInfo) && n(e) ? y(e.data.extent, this.tileInfo.spatialReference) : void 0\n    }),\n          i = this.configuration.filter;\n    return n(i) && (t.where = i.where, t.gdbVersion = i.gdbVersion, t.timeExtent = i.timeExtent), t.outSpatialReference = this.spatialReference, t;\n  }\n\n  _setPagingParameters(e, t, i) {\n    if (!this.capabilities.query.supportsPagination) return !1;\n    const {\n      supportsMaxRecordCountFactor: s,\n      supportsCacheHint: r,\n      tileMaxRecordCount: o,\n      maxRecordCount: n,\n      supportsResultType: a\n    } = this.capabilities.query,\n          l = s ? v.MAX_MAX_RECORD_COUNT_FACTOR : 1,\n          u = l * ((a || r) && o ? o : n || j);\n    return e.start = t, s ? (e.maxRecordCountFactor = Math.min(l, Math.ceil(i / u)), e.num = Math.min(i, e.maxRecordCountFactor * u)) : e.num = Math.min(i, u), !0;\n  }\n\n};\ne([h({\n  constructOnly: !0\n})], C.prototype, \"url\", void 0), e([h({\n  constructOnly: !0\n})], C.prototype, \"objectIdField\", void 0), e([h({\n  constructOnly: !0\n})], C.prototype, \"globalIdField\", void 0), e([h({\n  constructOnly: !0\n})], C.prototype, \"capabilities\", void 0), e([h({\n  constructOnly: !0\n})], C.prototype, \"sourceSpatialReference\", void 0), e([h({\n  constructOnly: !0\n})], C.prototype, \"spatialReference\", void 0), e([h({\n  constructOnly: !0\n})], C.prototype, \"store\", void 0), e([h({\n  readOnly: !0\n})], C.prototype, \"minimumVerticesPerFeature\", null), e([h()], C.prototype, \"filter\", null), e([h()], C.prototype, \"customParameters\", null), e([h({\n  readOnly: !0\n})], C.prototype, \"configuration\", null), e([h()], C.prototype, \"tileInfo\", null), e([h()], C.prototype, \"tileSize\", null), e([h()], C.prototype, \"tilesOfInterest\", void 0), e([h({\n  readOnly: !0\n})], C.prototype, \"updating\", null), e([h({\n  readOnly: !0\n})], C.prototype, \"availability\", void 0), C = e([p(\"esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiledFetcher\")], C);\nconst j = 2e3,\n      x = 6e5,\n      E = 1e6,\n      w = 25,\n      q = 1;\nexport { C as FeatureServiceTiledFetcher };","map":{"version":3,"names":["_","e","equals","t","AsyncSequence","i","HandleOwner","s","makeHandle","r","o","isSome","n","isNone","a","unwrap","l","createTask","u","throwIfAbortError","c","sync","d","property","h","subclass","p","f","toExtent","y","unquantizeOptimizedFeatureSet","g","convertFromFeatureSet","m","isHostedAgolService","OptimizedFeatureSetParserContext","F","executeQueryForExtent","b","executeQueryPBF","T","executeQuery","P","v","StateType","I","PendingFeatureTile","O","S","getLogger","C","constructor","tilesOfInterest","availability","pendingTiles","Map","pendingEdits","pendingEditsAbortController","AbortController","minimumVerticesPerFeature","store","featureStore","geometryType","filter","_get","_filterProperties","JSON","stringify","_set","customParameters","configuration","tileInfo","tileSize","updating","updatingHandles","initialize","_initializeFetchExtent","add","refresh","id","_process","destroy","forEach","_deletePendingTile","clear","length","abort","applyEdits","push","addedFeatures","updatedFeatures","deletedFeatures","reset","map","objectId","globalId","_lookupObjectIdByGlobalId","addPromise","processEdits","_queryFeaturesById","signal","_processPendingTiles","capabilities","query","supportsExtent","url","where","outSpatialReference","spatialReference","cacheHint","supportsCacheHint","extent","fromJSON","data","warn","promise","then","handles","debugInfo","numberOfFeatures","numFeatures","Array","from","values","storedTiles","_markTilesNotAlive","_createPendingTiles","_deletePendingTiles","alive","_collectMissingTilesInfo","_setAvailability","coveredArea","fullArea","resolution","missingTiles","get","_createPendingTile","process","_verifyTileComplexity","prepend","fetchCount","_fetchCount","fetchFeatures","_fetchFeatures","finish","_finishPendingTile","resume","_ensureFetchAllCounts","getFeatureCount","_verifyVertexComplexity","_verifyFeatureDensity","E","w","q","state","type","FETCHED_COUNT","FETCH_COUNT","_updateAvailability","set","delete","_createCountQuery","timeout","x","_createFeaturesQuery","_setPagingParameters","features","exceededTransferLimit","_queryFeatures","num","concat","gdbVersion","timeExtent","globalIdField","objectIdField","Error","attributes","objectIds","supportsFormatPBF","_queryFeaturesPBF","_queryFeaturesJSON","sourceSpatialReference","_createBaseQuery","outFields","returnGeometry","supportsResultType","resultType","returnZ","returnM","geometry","supportsPagination","supportsMaxRecordCountFactor","tileMaxRecordCount","maxRecordCount","MAX_MAX_RECORD_COUNT_FACTOR","j","start","maxRecordCountFactor","Math","min","ceil","constructOnly","prototype","readOnly","FeatureServiceTiledFetcher"],"sources":["C:/Users/hp/Desktop/eco-friendly atmosphere/Atmosphere/eco-friendly/node_modules/@arcgis/core/views/interactive/snapping/featureSources/featureServiceSource/FeatureServiceTiledFetcher.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../../chunks/tslib.es6.js\";import{equals as t}from\"../../../../../core/arrayUtils.js\";import{AsyncSequence as i}from\"../../../../../core/AsyncSequence.js\";import{HandleOwner as s}from\"../../../../../core/HandleOwner.js\";import{makeHandle as r}from\"../../../../../core/handleUtils.js\";import o from\"../../../../../core/Logger.js\";import{isSome as n,isNone as a,unwrap as l}from\"../../../../../core/maybe.js\";import{createTask as u,throwIfAbortError as c}from\"../../../../../core/promiseUtils.js\";import{sync as d}from\"../../../../../core/reactiveUtils.js\";import{property as h}from\"../../../../../core/accessorSupport/decorators/property.js\";import\"../../../../../core/has.js\";import\"../../../../../core/accessorSupport/ensureType.js\";import{subclass as p}from\"../../../../../core/accessorSupport/decorators/subclass.js\";import f from\"../../../../../geometry/Extent.js\";import{toExtent as y}from\"../../../../../geometry/support/aaBoundingRect.js\";import{unquantizeOptimizedFeatureSet as g,convertFromFeatureSet as m}from\"../../../../../layers/graphics/featureConversionUtils.js\";import{isHostedAgolService as _}from\"../../../../../layers/support/arcgisLayerUrl.js\";import{OptimizedFeatureSetParserContext as F}from\"../../../../../rest/query/operations/pbfOptimizedFeatureSet.js\";import{executeQueryForExtent as b,executeQueryPBF as T,executeQuery as P}from\"../../../../../rest/query/operations/query.js\";import v from\"../../../../../rest/support/Query.js\";import{StateType as I,PendingFeatureTile as O}from\"./PendingFeatureTile.js\";const S=o.getLogger(\"esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiledFetcher\");let C=class extends s{constructor(e){super(e),this.tilesOfInterest=[],this.availability=0,this.pendingTiles=new Map,this.pendingEdits=new i,this.pendingEditsAbortController=new AbortController}get minimumVerticesPerFeature(){switch(this.store?.featureStore.geometryType){case\"esriGeometryPoint\":case\"esriGeometryMultipoint\":return 1;case\"esriGeometryPolygon\":return 4;case\"esriGeometryPolyline\":return 2}}set filter(e){const t=this._get(\"filter\"),i=this._filterProperties(e);JSON.stringify(t)!==JSON.stringify(i)&&this._set(\"filter\",i)}set customParameters(e){const t=this._get(\"customParameters\");JSON.stringify(t)!==JSON.stringify(e)&&this._set(\"customParameters\",e)}get configuration(){return{filter:this.filter,customParameters:this.customParameters,tileInfo:this.tileInfo,tileSize:this.tileSize}}set tileInfo(e){const t=this._get(\"tileInfo\");t!==e&&(n(e)&&n(t)&&JSON.stringify(e)===JSON.stringify(t)||(this._set(\"tileInfo\",e),this.store.tileInfo=e))}set tileSize(e){this._get(\"tileSize\")!==e&&this._set(\"tileSize\",e)}get updating(){return this.updatingHandles.updating||this.pendingEdits.updating}initialize(){this._initializeFetchExtent(),this.updatingHandles.add((()=>this.configuration),(()=>this.refresh())),this.updatingHandles.add((()=>this.tilesOfInterest),((e,i)=>{t(e,i,(({id:e},{id:t})=>e===t))||this._process()}),d)}destroy(){this.pendingTiles.forEach((e=>this._deletePendingTile(e))),this.pendingTiles.clear(),this.store.destroy(),this.tilesOfInterest.length=0,this.pendingEditsAbortController.abort(),this.pendingEditsAbortController=null}refresh(){this.store.refresh(),this.pendingTiles.forEach((e=>this._deletePendingTile(e))),this._process()}applyEdits(e){this.pendingEdits.push(e,(async e=>{if(0===e.addedFeatures.length&&0===e.updatedFeatures.length&&0===e.deletedFeatures.length)return;for(const[,i]of this.pendingTiles)i.reset();const t={...e,deletedFeatures:e.deletedFeatures.map((({objectId:e,globalId:t})=>e&&-1!==e?e:this._lookupObjectIdByGlobalId(t)))};await this.updatingHandles.addPromise(this.store.processEdits(t,((e,t)=>this._queryFeaturesById(e,t)),this.pendingEditsAbortController.signal)),this._processPendingTiles()}))}_initializeFetchExtent(){if(!this.capabilities.query.supportsExtent||!_(this.url))return;const e=u((async e=>{try{const t=await b(this.url,new v({where:\"1=1\",outSpatialReference:this.spatialReference,cacheHint:!!this.capabilities.query.supportsCacheHint||void 0}),{query:this.configuration.customParameters,signal:e});this.store.extent=f.fromJSON(t.data?.extent)}catch(t){c(t),S.warn(\"Failed to fetch data extent\",t)}}));this.updatingHandles.addPromise(e.promise.then((()=>this._process()))),this.handles.add(r((()=>e.abort())))}get debugInfo(){return{numberOfFeatures:this.store.featureStore.numFeatures,tilesOfInterest:this.tilesOfInterest,pendingTiles:Array.from(this.pendingTiles.values()).map((e=>e.debugInfo)),storedTiles:this.store.debugInfo}}_process(){this._markTilesNotAlive(),this._createPendingTiles(),this._deletePendingTiles(),this._processPendingTiles()}_markTilesNotAlive(){for(const[,e]of this.pendingTiles)e.alive=!1}_createPendingTiles(){const e=this._collectMissingTilesInfo();if(this._setAvailability(a(e)?1:e.coveredArea/e.fullArea),!a(e))for(const{data:t,resolution:i}of e.missingTiles){const e=this.pendingTiles.get(t.id);e?(e.resolution=i,e.alive=!0):this._createPendingTile(t,i)}}_collectMissingTilesInfo(){let e=null;for(let t=this.tilesOfInterest.length-1;t>=0;t--){const i=this.tilesOfInterest[t],s=this.store.process(i,((e,t)=>this._verifyTileComplexity(e,t)));a(e)?e=s:e.prepend(s)}return e}_deletePendingTiles(){for(const[,e]of this.pendingTiles)e.alive||this._deletePendingTile(e)}_processPendingTiles(){const e={fetchCount:(e,t)=>this._fetchCount(e,t),fetchFeatures:(e,t,i)=>this._fetchFeatures(e,t,i),finish:(e,t)=>this._finishPendingTile(e,t),resume:()=>this._processPendingTiles()};if(this._ensureFetchAllCounts(e))for(const[,t]of this.pendingTiles)this._verifyTileComplexity(this.store.getFeatureCount(t.data),t.resolution)&&this.updatingHandles.addPromise(t.process(e))}_verifyTileComplexity(e,t){return this._verifyVertexComplexity(e)&&this._verifyFeatureDensity(e,t)}_verifyVertexComplexity(e){return e*this.minimumVerticesPerFeature<E}_verifyFeatureDensity(e,t){if(a(this.tileInfo))return!1;const i=this.tileSize*t;return e*(w/(i*i))<q}_ensureFetchAllCounts(e){let t=!0;for(const[,i]of this.pendingTiles)i.state.type<I.FETCHED_COUNT&&this.updatingHandles.addPromise(i.process(e)),i.state.type<=I.FETCH_COUNT&&(t=!1);return t}_finishPendingTile(e,t){this.store.add(e.data,t),this._deletePendingTile(e),this._updateAvailability()}_updateAvailability(){const e=this._collectMissingTilesInfo();this._setAvailability(a(e)?1:e.coveredArea/e.fullArea)}_setAvailability(e){this._set(\"availability\",e)}_createPendingTile(e,t){const i=new O(e,t);return this.pendingTiles.set(e.id,i),i}_deletePendingTile(e){e.reset(),this.pendingTiles.delete(e.data.id)}async _fetchCount(e,t){return this.store.fetchCount(e.data,this.url,this._createCountQuery(e),{query:this.customParameters,timeout:x,signal:t})}async _fetchFeatures(e,t,i){let s,r=0,o=0,n=t;for(;;){const a=this._createFeaturesQuery(e),u=this._setPagingParameters(a,r,n),{features:c,exceededTransferLimit:d}=await this._queryFeatures(a,i);if(u&&(r+=l(a.num)),o+=c.length,s=s?s.concat(c):c,n=t-o,!u||!d||n<=0)return s}}_filterProperties(e){return a(e)?{where:\"1=1\",gdbVersion:void 0,timeExtent:void 0}:{where:e.where||\"1=1\",timeExtent:e.timeExtent,gdbVersion:e.gdbVersion}}_lookupObjectIdByGlobalId(e){const t=this.globalIdField,i=this.objectIdField;if(a(t))throw new Error(\"Expected globalIdField to be defined\");let s=null;if(this.store.featureStore.forEach((r=>{e===r.attributes[t]&&(s=r.objectId??r.attributes[i])})),a(s))throw new Error(`Expected to find a feature with globalId ${e}`);return s}_queryFeaturesById(e,t){const i=this._createFeaturesQuery(null);return i.objectIds=e,this._queryFeatures(i,t)}_queryFeatures(e,t){return this.capabilities.query.supportsFormatPBF?this._queryFeaturesPBF(e,t):this._queryFeaturesJSON(e,t)}async _queryFeaturesPBF(e,t){const{sourceSpatialReference:i}=this,{data:s}=await T(this.url,e,new F({sourceSpatialReference:i}),{query:this.configuration.customParameters,timeout:x,signal:t});return g(s)}async _queryFeaturesJSON(e,t){const{sourceSpatialReference:i}=this,{data:s}=await P(this.url,e,i,{query:this.configuration.customParameters,timeout:x,signal:t});return m(s,this.objectIdField)}_createCountQuery(e){const t=this._createBaseQuery(e);return this.capabilities.query.supportsCacheHint&&(t.cacheHint=!0),t}_createFeaturesQuery(e){const t=this._createBaseQuery(e);return t.outFields=this.globalIdField?[this.globalIdField,this.objectIdField]:[this.objectIdField],t.returnGeometry=!0,n(e)&&(this.capabilities.query.supportsResultType?t.resultType=\"tile\":this.capabilities.query.supportsCacheHint&&(t.cacheHint=!0)),t}_createBaseQuery(e){const t=new v({returnZ:!1,returnM:!1,geometry:n(this.tileInfo)&&n(e)?y(e.data.extent,this.tileInfo.spatialReference):void 0}),i=this.configuration.filter;return n(i)&&(t.where=i.where,t.gdbVersion=i.gdbVersion,t.timeExtent=i.timeExtent),t.outSpatialReference=this.spatialReference,t}_setPagingParameters(e,t,i){if(!this.capabilities.query.supportsPagination)return!1;const{supportsMaxRecordCountFactor:s,supportsCacheHint:r,tileMaxRecordCount:o,maxRecordCount:n,supportsResultType:a}=this.capabilities.query,l=s?v.MAX_MAX_RECORD_COUNT_FACTOR:1,u=l*((a||r)&&o?o:n||j);return e.start=t,s?(e.maxRecordCountFactor=Math.min(l,Math.ceil(i/u)),e.num=Math.min(i,e.maxRecordCountFactor*u)):e.num=Math.min(i,u),!0}};e([h({constructOnly:!0})],C.prototype,\"url\",void 0),e([h({constructOnly:!0})],C.prototype,\"objectIdField\",void 0),e([h({constructOnly:!0})],C.prototype,\"globalIdField\",void 0),e([h({constructOnly:!0})],C.prototype,\"capabilities\",void 0),e([h({constructOnly:!0})],C.prototype,\"sourceSpatialReference\",void 0),e([h({constructOnly:!0})],C.prototype,\"spatialReference\",void 0),e([h({constructOnly:!0})],C.prototype,\"store\",void 0),e([h({readOnly:!0})],C.prototype,\"minimumVerticesPerFeature\",null),e([h()],C.prototype,\"filter\",null),e([h()],C.prototype,\"customParameters\",null),e([h({readOnly:!0})],C.prototype,\"configuration\",null),e([h()],C.prototype,\"tileInfo\",null),e([h()],C.prototype,\"tileSize\",null),e([h()],C.prototype,\"tilesOfInterest\",void 0),e([h({readOnly:!0})],C.prototype,\"updating\",null),e([h({readOnly:!0})],C.prototype,\"availability\",void 0),C=e([p(\"esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiledFetcher\")],C);const j=2e3,x=6e5,E=1e6,w=25,q=1;export{C as FeatureServiceTiledFetcher};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}