{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../../chunks/tslib.es6.js\";\nimport t from \"../../../../core/Accessor.js\";\nimport s from \"../../../../core/Handles.js\";\nimport i from \"../../../../core/Logger.js\";\nimport { someMap as r } from \"../../../../core/MapUtils.js\";\nimport { isSome as a, destroyMaybe as n, isNone as o, unwrap as u } from \"../../../../core/maybe.js\";\nimport { isAbortError as l, eachAlways as h, throwIfAborted as c } from \"../../../../core/promiseUtils.js\";\nimport { on as d } from \"../../../../core/reactiveUtils.js\";\nimport { schedule as p } from \"../../../../core/scheduling.js\";\nimport { property as f } from \"../../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../../core/arrayUtils.js\";\nimport \"../../../../core/has.js\";\nimport \"../../../../core/accessorSupport/ensureType.js\";\nimport { subclass as m } from \"../../../../core/accessorSupport/decorators/subclass.js\";\nimport { create as g, equals as F, clone as y, expand as _, toExtent as T } from \"../../../../geometry/support/aaBoundingRect.js\";\nimport { getObjectId as x, hasVertices as E } from \"../../../../layers/graphics/dehydratedFeatures.js\";\nimport C from \"../../../../rest/support/QuantizationParameters.js\";\nimport R from \"../../../../rest/support/Query.js\";\nimport { ViewingMode as b } from \"../../../ViewingMode.js\";\nimport { MultiFeatureReference as v, SingleFeatureReference as M } from \"./featureReference.js\";\nimport { FAILED_FEATURE_COUNT as D, FetchStatus as w, FeatureTile as j } from \"./FeatureTile.js\";\nimport { tilesAreRelated as O } from \"../../terrain/tileUtils.js\";\nimport { ImmediateTask as P, TaskPriority as N } from \"../../../support/Scheduler.js\";\nconst U = i.getLogger(\"esri.views.3d.layers.support.FeatureTileFetcher3D\");\nlet I = class extends t {\n  constructor(e) {\n    super(e), this._useTileCount = !1, this.updating = !1, this.updatingTotal = 0, this.updatingRemaining = 0, this.expectedFeatureDiff = 0, this.maximumNumberOfFeaturesExceeded = !1, this.maximumNumberOfFeaturesExceededThrottle = 1e3, this._fullRatio = 1, this._farRatio = 1, this.changes = {\n      updates: {\n        adds: new Array(),\n        removes: new Array()\n      },\n      adds: new Array(),\n      removes: new Array()\n    }, this.handles = new s(), this._frameTask = P, this._dirty = !1, this.featureTiles = new Map(), this.displayingFeatureReferences = new Map(), this.numDisplayingFeatureReferences = 0, this.suspended = !0, this.pendingEdits = null;\n  }\n\n  set maximumNumberOfFeatures(e) {\n    e = e || 1 / 0;\n\n    const t = this._get(\"maximumNumberOfFeatures\");\n\n    e === t || e < 1 || (this._set(\"maximumNumberOfFeatures\", e), this._maximumFeaturesUpdated(t, e));\n  }\n\n  set memoryFactor(e) {\n    this.memoryFactor !== e && (this._set(\"memoryFactor\", e), this._setDirty());\n  }\n\n  set lodFactor(e) {\n    this.lodFactor !== e && (this._set(\"lodFactor\", e), this.supportsResolution && this.refetch());\n  }\n\n  get useTileCount() {\n    return this._useTileCount && a(this.context.query.queryFeatureCount);\n  }\n\n  set useTileCount(e) {\n    this._useTileCount = e, this.notifyChange(\"useTileCount\");\n  }\n\n  get memoryForUnusedFeatures() {\n    let e = 0;\n    return this.featureTiles.forEach(t => e += t.estimatedUnusedSize), e;\n  }\n\n  get totalVertices() {\n    let e = 0;\n    return this.featureTiles.forEach(t => e += t.numVertices), e;\n  }\n\n  get totalFeatures() {\n    let e = 0;\n    return this.featureTiles.forEach(t => e += t.numFeatures), e;\n  }\n\n  set filterExtent(e) {\n    if (e && this.context.tilingScheme && !e.spatialReference.equals(this.context.tilingScheme.spatialReference)) return void U.error(\"#filterExtent=\", \"extent needs to be in the same spatial reference as the tiling scheme\");\n\n    const t = this._get(\"filterExtent\");\n\n    if (t === e || t && e && t.equals(e)) return;\n    const s = e ? e.clone() : null;\n    this._set(\"filterExtent\", s), this._reclip(s, t);\n  }\n\n  initialize() {\n    this.handles.add(d(() => this.tileDescriptors, \"change\", () => this._setDirty(), {\n      onListenerAdd: () => this._setDirty()\n    })), this.objectIdField = this.context.objectIdField, this.FeatureReferenceClass = this.context.capabilities.supportsMultipleResolutions ? v : M;\n    const e = this.context.scheduler;\n    a(e) && (this._frameTask = e.registerTask(N.FEATURE_TILE_FETCHER, this)), this._setDirty();\n  }\n\n  destroy() {\n    this._frameTask.remove(), this.handles = n(this.handles), this.featureTiles.forEach(e => {\n      this._cancelFetchTile(e), this._removeTile(e);\n    }), this.featureTiles.clear(), this.displayingFeatureReferences.clear(), this.pendingEdits && (this.pendingEdits.controller.abort(), this.pendingEdits = null);\n  }\n\n  get paused() {\n    return this.suspended || !!this.pendingEdits;\n  }\n\n  restart() {\n    this.featureTiles.forEach(e => {\n      this._cancelFetchTile(e), this._clearTile(e), this._resetFetchTile(e);\n    }), a(this.context.memoryCache) && this.context.memoryCache.clear(), this._setDirty();\n  }\n\n  refetch() {\n    this.featureTiles.forEach(e => {\n      this._cancelFetchTile(e), this._resetFetchTile(e);\n    }), a(this.context.memoryCache) && this.context.memoryCache.clear(), this._setDirty();\n  }\n\n  suspend() {\n    this.suspended || (this.suspended = !0, this._pause(), this._setDirty());\n  }\n\n  resume() {\n    this.suspended && (this.suspended = !1, this._unpause());\n  }\n\n  _pause() {\n    this.paused && (this.featureTiles.forEach(e => this._cancelFetchTile(e)), this._updated());\n  }\n\n  _unpause() {\n    this.paused || (this._setDirty(), this._updated());\n  }\n\n  get availableFields() {\n    let e = null;\n    return this.featureTiles.forEach(t => {\n      o(t.displayingFeatures) || 0 === t.displayingFeatures.length || (o(e) ? e = new Set(t.availableFields) : e.forEach(s => {\n        t.availableFields.has(s) || u(e).delete(s);\n      }));\n    }), a(e) ? e : new Set();\n  }\n\n  applyEdits(e) {\n    this.pendingEdits || (this.pendingEdits = {\n      edits: Promise.resolve(),\n      count: 0,\n      controller: new AbortController()\n    }, this._pause());\n    const t = this.pendingEdits;\n    t.count++;\n    const s = t.edits.then(() => e.result.catch(e => {\n      if (l(e)) throw e;\n      return null;\n    }).then(e => e ? (this._applyEditsDeleteFeatures(e.deletedFeatures), this._applyEditsAddUpdateFeatures(e.addedFeatures, e.updatedFeatures, t.controller.signal).then(() => e)) : e).then(e => (0 == --t.count && (this.pendingEdits === t && (this.pendingEdits = null), a(this.context.memoryCache) && this.context.memoryCache.clear(), this._unpause(), this._updated()), e)));\n    return t.edits = s, this._updated(), s;\n  }\n\n  _applyEditsDeleteFeatures(e) {\n    if (0 === e.length) return;\n    const t = this.context.globalIdField,\n          s = t && this.availableFields.has(t),\n          i = new Set(),\n          r = this.objectIdField;\n    e.forEach(({\n      objectId: e,\n      globalId: a\n    }) => {\n      if ((!e || e < 0) && t) {\n        s || U.errorOncePerTick(`Editing the specified service requires the layer's globalIdField, ${t} to be included the layer's outFields for updates to be reflected in the view`);\n        const e = this.features.find(e => e.attributes && e.attributes[t] === a);\n        e && i.add(x(e, r));\n      } else i.add(e);\n    }), this.featureTiles.forEach(e => {\n      if (!e.features) return;\n      const t = e.features.filter(e => !i.has(x(e, this.objectIdField)));\n      t.length !== e.features.length && (e.setFeatures(t, 0, e.availableFields), this._invalidateCounts());\n    });\n  }\n\n  async _applyEditsAddUpdateFeatures(e, t, s) {\n    const i = [],\n          r = new Set();\n    if (e.forEach(e => i.push(e.objectId)), t.forEach(e => {\n      i.push(e.objectId), r.add(e.objectId);\n    }), 0 === i.length) return;\n    const a = [];\n    this.featureTiles.forEach(e => {\n      const t = this._applyEditsAddUpdateTile(e, i, r, s);\n\n      t && a.push(t);\n    }), await h(a);\n  }\n\n  async _applyEditsAddUpdateTile(e, t, s, i) {\n    if (!e.features) return;\n\n    const r = this._createQuery(e);\n\n    r.resultType = void 0, r.cacheHint = !1, r.objectIds = t;\n    const a = await this._queryFeatures(r, i);\n    let n = null;\n\n    if (s.size > 0) {\n      const t = e.features.filter(e => !s.has(x(e, this.objectIdField)));\n      t.length !== e.features.length && (n = t);\n    }\n\n    if (a.features.length > 0) {\n      n || (n = e.features.slice());\n\n      for (const e of a.features) n.push(e);\n    }\n\n    n && (e.hasPreciseFeatureCount && (e.numFeatures = Math.max(e.numFeatures, n.length)), e.setFeatures(n, 0, k(e.availableFields, a.fields)), this._invalidateCounts());\n  }\n\n  _queryFeatures(e, t) {\n    return this.context.query.queryFeaturesDehydrated(e, {\n      signal: t,\n      timeout: G\n    });\n  }\n\n  _setDirty() {\n    this._dirty = !0, this._updated();\n  }\n\n  get running() {\n    return this.updating;\n  }\n\n  runTask(e) {\n    if (this._frameTask.processQueue(e), !this._dirty || !this.constructed) return;\n    this._dirty = !1;\n\n    const t = this._getListOfTiles();\n\n    if (this._markTilesNotAlive(t), !e.run(() => this._addTiles(t, e)) || !e.run(() => this._filterExtentTiles(t, e)) || !e.run(() => this._removeTiles(t, e)) || e.done) return void this._setDirty();\n\n    const s = this._sortTiles(t);\n\n    e.run(() => this._displayTiles(s, e)) && e.run(() => this._fetchTiles(s, e)) && e.run(() => this._updateMemoryEstimates(s, e)) || this._setDirty(), this._updated(), this.updating || this._updateMaximumNumberOfFeaturesExceeded();\n  }\n\n  _markTilesNotAlive(e) {\n    for (const t of e) t.alive = !1;\n  }\n\n  _addTiles(e, t) {\n    return !this.suspended && (this.tileDescriptors.forEach(s => {\n      const i = this.featureTiles.get(s.id);\n      i ? i.alive = !0 : t.done || (e.push(this._addTile(s)), t.madeProgress());\n    }), t.hasProgressed);\n  }\n\n  _filterExtentTiles(e, t) {\n    for (const s of e) {\n      if (t.done) break;\n      s.alive && (s.filtered = !s.intersects(this.filterExtent), s.filtered && (this._clearTile(s), t.madeProgress()));\n    }\n\n    return t.hasProgressed;\n  }\n\n  _removeTiles(e, t) {\n    for (let s = e.length - 1; s >= 0 && !t.done; s--) {\n      const i = e[s];\n      i.alive || (this._removeTile(i), s !== e.length - 1 && (e[s] = e[e.length - 1]), e.pop(), t.madeProgress());\n    }\n\n    return t.hasProgressed;\n  }\n\n  _sortTiles(e) {\n    return e.sort((e, t) => e.descriptor.loadPriority - t.descriptor.loadPriority), e;\n  }\n\n  _displayTiles(e, t) {\n    const s = this._updateRatio(e),\n          i = e => {\n      const t = this._fullRatio < 1 ? s(e) * this._farRatio : 1;\n      return e.reduceFeatures(t, this.memoryFactor, this.objectIdField) && this._setDirty(), this._showTile(e);\n    };\n\n    for (const r of e) if (!t.run(() => i(r))) {\n      this._setDirty();\n\n      break;\n    }\n\n    return t.hasProgressed;\n  }\n\n  _fetchTiles(e, t) {\n    if (this.paused) return !1;\n    let s = !1;\n\n    for (const i of e) {\n      if (!i.needsFetching) continue;\n      const e = a(this.context.memoryCache) ? this.context.memoryCache.pop(i.id) : null;\n      if (a(e)) i.cache = e, this._setDirty(), this._scheduleUpdated(), t.madeProgress();else {\n        if (this._needsNumFeatures(i)) {\n          const e = new AbortController(),\n                r = this._fetchTileCount(i, e.signal);\n\n          this._handleRequest(i, r, e, () => i.numFeatures = D), s = !0, t.madeProgress();\n        }\n\n        if (t.done) return !0;\n      }\n    }\n\n    if (s) return t.hasProgressed;\n\n    for (const i of e) if (i.needsFetching) {\n      const e = new AbortController(),\n            s = this._fetchTile(i, e.signal);\n\n      if (this._handleRequest(i, s, e, e => {\n        i.setFeatures([], 0, null), this._invalidateCounts(), i.featuresMissing = !1, this.context.logFetchError(U, e);\n      }), t.madeProgress(), t.done) return !0;\n    }\n\n    return t.hasProgressed;\n  }\n\n  _updateMemoryEstimates(e, t) {\n    return e.some(e => !t.run(() => e.updateMemoryEstimates()) && (this._setDirty(), !0)), t.hasProgressed;\n  }\n\n  _reclip(e, t) {\n    if (!this.constructed) return;\n    const s = new Array();\n    this.featureTiles.forEach(i => {\n      o(i.displayingFeatures) || 0 === i.displayingFeatures.length || (i.intersectionIncludingBorrowed(t, z), i.intersectionIncludingBorrowed(e, B), F(z, B) || s.push(i));\n    }), this._refreshDisplayingFeatures(s), this._updated();\n  }\n\n  _refreshDisplayingFeatures(e) {\n    const t = new Set(),\n          s = this.changes.updates;\n\n    for (const i of e) if (!o(i.displayingFeatures)) for (const e of i.displayingFeatures) {\n      const i = x(e, this.objectIdField);\n      if (t.has(i)) continue;\n      t.add(i);\n      const {\n        feature: r\n      } = this.displayingFeatureReferences.get(i);\n      s.removes.push(r), s.adds.push(r);\n    }\n\n    this._applyChanges();\n  }\n\n  _updated() {\n    let e = 0;\n    this.paused || this.featureTiles.forEach(t => t.isFetching ? ++e : 0);\n    const t = this._dirty || e > 0 || !!this.pendingEdits;\n\n    if (this._set(\"updating\", t), t) {\n      let t = 0,\n          s = 0,\n          i = 0,\n          r = 0,\n          n = 0;\n      const o = this.displayingFeatureReferences.size / this.numDisplayingFeatureReferences;\n      this.featureTiles.forEach(e => {\n        if (++s, e.isFetching && e.hasPreciseFeatureCount) {\n          const t = this._maximumFeaturesForTile(e) * (1 - e.emptyFeatureRatio),\n                s = a(e.displayingFeatures) ? e.displayingFeatures.length * o : 0;\n          n += t - s;\n        }\n\n        e.needsFetching ? ++r : e.numFeatures > 0 && (++i, t += e.numFeatures);\n      }), r += e;\n      let u = 0,\n          l = 0;\n      t ? (l = t, u = Math.min(r * t / i, t)) : (l = s, u = r), n = Math.min(this.maximumNumberOfFeatures - this.features.length, n), this._set(\"updatingTotal\", l), this._set(\"updatingRemaining\", u), this._set(\"expectedFeatureDiff\", n);\n    } else this._set(\"updatingTotal\", 0), this._set(\"updatingRemaining\", 0), this._set(\"expectedFeatureDiff\", 0);\n\n    this.debugger && this.debugger.update();\n  }\n\n  _updateMaximumNumberOfFeaturesExceeded() {\n    const e = r(this.featureTiles, e => e.perTileMaximumNumberOfFeaturesExceeded);\n\n    this._set(\"maximumNumberOfFeaturesExceeded\", e);\n  }\n\n  _updateRatio(e) {\n    const t = A(e),\n          s = e => 1 / (1 << Math.max(0, t - e.descriptor.lij[0]));\n\n    let i = 0,\n        r = 0;\n\n    for (const a of e) {\n      const e = a.numFeatures;\n      i += e, r += e * s(a);\n    }\n\n    return this._fullRatio = Math.min(1, this.maximumNumberOfFeatures / i), this._farRatio = this.maximumNumberOfFeatures / r, this._scheduleUpdated(), s;\n  }\n\n  _maximumFeaturesUpdated(e, t) {\n    e !== t && (t > e && this.featureTiles.forEach(e => {\n      if (!e.featuresMissing) return;\n\n      const t = this._maximumFeaturesForTile(e);\n\n      e.features && (e.features.length >= t || e.fetchStatus === w.FULL) || (this._cancelFetchTile(e), this._resetFetchTile(e));\n    }), this._setDirty());\n  }\n\n  _addTile(e) {\n    const t = new j(e);\n    return this.featureTiles.set(t.id, t), this._resetFetchTile(t), this._referenceDisplayingFeaturesFromRelatedTiles(t), t;\n  }\n\n  _referenceDisplayingFeaturesFromRelatedTiles(e) {\n    const t = e.descriptor.resolution;\n    this.featureTiles.forEach(s => {\n      if (!(o(s.displayingFeatures) || e === s || e.descriptor.lij && s.descriptor.lij && !O(e.descriptor.lij, s.descriptor.lij))) {\n        o(e.displayingFeatures) && (e.displayingFeatures = []), e.descriptor.extent && s.descriptor.extent && (o(e.extentIncludingBorrowedFeatures) && (e.extentIncludingBorrowedFeatures = y(e.descriptor.extent)), _(e.extentIncludingBorrowedFeatures, s.descriptor.extent, e.extentIncludingBorrowedFeatures));\n\n        for (const i of s.displayingFeatures) {\n          e.displayingFeatures.push(i);\n          const s = this.displayingFeatureReferences.get(x(i, this.objectIdField));\n          s.ref(s.feature, t), this.numDisplayingFeatureReferences++;\n        }\n      }\n    }), e.featureLimit = a(e.displayingFeatures) ? e.displayingFeatures.length : 0;\n  }\n\n  _removeTile(e) {\n    this._clearTile(e), this.featureTiles.delete(e.id);\n  }\n\n  _resetFetchTile(e) {\n    e.filtered = !e.intersects(this.filterExtent), e.filtered ? e.needsFetching && (e.fetchStatus = w.DONE) : e.fetchStatus = w.FETCH_NEEDED;\n  }\n\n  _cancelFetchTile(e) {\n    const t = e.requestController;\n    a(t) && (e.requestController = null, e.resetFetching(), t.abort());\n  }\n\n  async _fetchTileCount(e, t) {\n    return e.numFeatures = await this._fetchCount(e, t), this._updateRatio(this._getListOfTiles()), e.fetchStatus === w.REFETCHING ? w.REFETCH_NEEDED : w.FETCH_NEEDED;\n  }\n\n  async _fetchTile(e, t) {\n    const s = this._maximumFeaturesForTile(e);\n\n    if (s <= 0) return Q(e);\n\n    const i = this._getMaxRecordCount(e),\n          r = Math.ceil(s / i);\n\n    if (q(e) || !this.context.capabilities.supportsMaxRecordCountFactor || e.numFeatures <= s && r > R.MAX_MAX_RECORD_COUNT_FACTOR) return this._fetchPagedTile(e, t);\n\n    const a = this._createQuery(e);\n\n    if (a.maxRecordCountFactor = Math.ceil(s / i), e.isRefetching && e.features && e.features.length > 0) {\n      const t = Math.ceil(e.features.length / (1 - e.emptyFeatureRatio) / i);\n      a.maxRecordCountFactor = Math.max(t + 1, a.maxRecordCountFactor);\n    }\n\n    const {\n      features: n,\n      exceededTransferLimit: o,\n      fields: u\n    } = await this._queryFeatures(a, t),\n          l = o ? a.maxRecordCountFactor >= R.MAX_MAX_RECORD_COUNT_FACTOR ? w.FULL : w.DONE : w.FULL;\n    return await this._frameTask.schedule(() => {\n      e.featuresMissing = n.length < e.numFeatures || o;\n\n      const t = this._removeEmptyFeatures(n);\n\n      e.setFeatures(n, t, H(u));\n    }, t), c(t), this._invalidateCounts(), l;\n  }\n\n  async _fetchCount(e, t) {\n    return this.context.query.queryFeatureCount(this._createFeatureCountQuery(e), {\n      signal: t\n    });\n  }\n\n  async _fetchPagedTile(e, t) {\n    let s,\n        i = 0,\n        r = 0,\n        a = 0,\n        n = this._maximumFeaturesForTile(e) - a;\n\n    const o = this._getMaxRecordCount(e);\n\n    let l = null;\n\n    for (;;) {\n      const h = this._createQuery(e),\n            d = this._setPagingParameters(h, i, n, o),\n            {\n        features: p,\n        exceededTransferLimit: f,\n        fields: m\n      } = await this._queryFeatures(h, t);\n\n      if (await this._frameTask.schedule(() => {\n        d && (i += u(h.num)), a += p.length, r += this._removeEmptyFeatures(p), e.featuresMissing = i < e.numFeatures || f, s = s ? s.concat(p) : p, l = k(l, m), e.setFeatures(s, r, l);\n      }, t), c(t), this._invalidateCounts(), this._setDirty(), n = this._maximumFeaturesForTile(e) - a, !d || !f || n <= 0) return f ? w.DONE : w.FULL;\n    }\n  }\n\n  _createFeatureCountQuery(e) {\n    const t = this._createQuery(e);\n\n    return this.context.capabilities.supportsCacheHint && (t.resultType = void 0, t.cacheHint = !0), t;\n  }\n\n  _createQuery(e) {\n    const t = this.context.createQuery(),\n          s = e.descriptor.extent;\n\n    if (s) {\n      const e = this.context.tilingScheme.spatialReference;\n      t.geometry = T(s, e);\n    }\n\n    return this._setResolutionParams(t, e), this._useTileQuery(e) ? t.resultType = \"tile\" : this.context.capabilities.supportsCacheHint && (t.cacheHint = !0), t;\n  }\n\n  _setPagingParameters(e, t, s, i) {\n    return !!this.context.capabilities.supportsPagination && (e.start = t, s > 0 && this.context.capabilities.supportsMaxRecordCountFactor ? (e.maxRecordCountFactor = Math.ceil(s / i), e.num = Math.min(e.maxRecordCountFactor * i, s)) : e.num = Math.min(i), !0);\n  }\n\n  _getEffectiveTileResolution(e) {\n    if (null == e.descriptor.resolution) return null;\n    const t = this.context.viewingMode === b.Global ? this.context.tilingScheme.resolutionAtLevel(3) : 1 / 0;\n    return Math.min(e.descriptor.resolution, t) / this.lodFactor;\n  }\n\n  get supportsResolution() {\n    return this.context.capabilities.supportsMultipleResolutions && \"point\" !== this.context.geometryType;\n  }\n\n  _setResolutionParams(e, t) {\n    if (!this.supportsResolution) return;\n\n    const s = this._getEffectiveTileResolution(t);\n\n    null != s && (this.context.capabilities.supportsQuantization ? e.quantizationParameters = new C({\n      mode: \"view\",\n      originPosition: \"upper-left\",\n      tolerance: s,\n      extent: this.context.fullExtent\n    }) : \"polyline\" === this.context.geometryType && (e.maxAllowableOffset = s));\n  }\n\n  _removeEmptyFeatures(e) {\n    const t = e.length;\n\n    for (let s = 0; s < e.length;) {\n      const t = e[s];\n      E(t.geometry) ? ++s : (e[s] = e[e.length - 1], --e.length);\n    }\n\n    return t - e.length;\n  }\n\n  _needsNumFeatures(e) {\n    return this.useTileCount && e.needsFeatureCount && !q(e);\n  }\n\n  _getMaxRecordCount(e) {\n    const {\n      tileMaxRecordCount: t,\n      maxRecordCount: s\n    } = this.context;\n    return this._useTileQuery(e) && a(t) && t > 0 && this.context.capabilities.supportsResultType ? t : a(s) && s > 0 ? s : V;\n  }\n\n  _useTileQuery(e) {\n    return (!q(e) || !this.context.capabilities.supportsCacheHint) && this.context.capabilities.supportsResultType;\n  }\n\n  _handleRequest(e, t, s, i) {\n    e.fetchStatus = e.needsRefetching ? w.REFETCHING : w.FETCHING, e.requestController = s;\n    let r = !1;\n    t.then(t => {\n      e.requestController = null, e.fetchStatus = t;\n    }).catch(t => {\n      e.requestController === s && (e.requestController = null, e.fetchStatus = w.DONE), l(t) ? r = !0 : i(t);\n    }).then(() => {\n      r || this._setDirty(), this._scheduleUpdated();\n    });\n  }\n\n  _scheduleUpdated() {\n    this.handles && !this.handles.has(\"scheduleUpdated\") && this.handles.add(p(() => {\n      this.handles.remove(\"scheduleUpdated\"), this._updated();\n    }), \"scheduleUpdated\");\n  }\n\n  _showTile(e) {\n    if (a(e.displayingFeatures) && !e.needsDisplayUpdate) return !1;\n    const t = e.features;\n\n    if (0 === e.featureLimit || !t) {\n      const t = a(e.displayingFeatures) && e.displayingFeatures.length > 0;\n      return this._hideTileFeatures(e), e.displayingFeatures = [], t;\n    }\n\n    const s = e.descriptor.resolution,\n          i = this.changes.updates,\n          r = this.changes.adds,\n          n = Math.min(e.featureLimit, t.length);\n    e.featureLimit = n;\n\n    for (let a = 0; a < n; ++a) {\n      const e = t[a],\n            n = x(e, this.objectIdField),\n            o = this.displayingFeatureReferences.get(n);\n\n      if (o) {\n        const t = o.ref(e, s);\n        t.oldVersion !== t.newVersion && (i.removes.push(t.oldVersion), i.adds.push(t.newVersion));\n      } else this.displayingFeatureReferences.set(n, new this.FeatureReferenceClass(e, s)), r.push(e);\n\n      this.numDisplayingFeatureReferences++;\n    }\n\n    return this._hideTileFeatures(e), this._applyChanges(), e.displayingFeatures = t.slice(0, n), !0;\n  }\n\n  _hideTile(e) {\n    this._cancelFetchTile(e), this._hideTileFeatures(e);\n  }\n\n  _hideTileFeatures(e) {\n    if (o(e.displayingFeatures)) return;\n    const t = this.changes.updates,\n          s = this.changes.removes;\n\n    for (const i of e.displayingFeatures) {\n      const r = x(i, this.objectIdField),\n            a = this.displayingFeatureReferences.get(r);\n      if (!a) continue;\n      const n = a.unref(e.descriptor.resolution);\n      this.numDisplayingFeatureReferences--, n ? n.oldVersion !== n.newVersion && (null == n.newVersion ? (this.displayingFeatureReferences.delete(r), s.push(n.oldVersion)) : (t.adds.push(n.newVersion), t.removes.push(n.oldVersion))) : console.error(\"Hiding unreferenced feature\");\n    }\n\n    this._applyChanges(), e.displayingFeatures = null;\n  }\n\n  _applyChanges() {\n    const e = this.changes.updates;\n    e.removes.length > 0 && (this.features.removeMany(e.removes), e.removes.length = 0), e.adds.length > 0 && (this.features.addMany(e.adds), e.adds.length = 0);\n    const t = this.changes.adds,\n          s = this.changes.removes,\n          i = Math.min(t.length, s.length);\n    let r = 0;\n\n    for (; r < i;) {\n      const e = Math.min(r + X, i);\n      this.features.addMany(t.slice(r, e)), this.features.removeMany(s.slice(r, e)), r = e;\n    }\n\n    t.length > i && this.features.addMany(0 === r ? t : t.slice(r)), s.length > i && this.features.removeMany(0 === r ? s : s.slice(r)), t.length = 0, s.length = 0;\n  }\n\n  _clearTile(e) {\n    if (this._hideTile(e), e.features && a(this.context.memoryCache)) {\n      const t = 16 + e.estimatedSize;\n      this.context.memoryCache.put(e.id, e.cache, t);\n    }\n\n    e.setFeatures(null, 0, null), this._invalidateCounts();\n  }\n\n  _invalidateCounts() {\n    this.notifyChange(\"totalVertices\"), this.notifyChange(\"totalFeatures\"), this.notifyChange(\"memoryForUnusedFeatures\");\n  }\n\n  _getListOfTiles() {\n    return Array.from(this.featureTiles.values());\n  }\n\n  get storedFeatures() {\n    return this._getListOfTiles().reduce((e, t) => e + (t.features ? t.features.length : 0), 0);\n  }\n\n  _maximumFeaturesForTile(e) {\n    const t = e.hasPreciseFeatureCount ? e.numFeatures : 1 / 0,\n          s = e.hasPreciseFeatureCount ? t : this.maximumNumberOfFeatures,\n          i = this._fullRatio < 1 ? this._farRatio : 1;\n    return Math.min(Math.ceil(s * i / (1 - e.emptyFeatureRatio)), t);\n  }\n\n  get test() {\n    return {\n      process: e => this.runTask(e),\n      getFeatureTileById: e => this.featureTiles.get(e),\n      forEachFeatureTile: e => this.featureTiles.forEach(e)\n    };\n  }\n\n};\n\nfunction q(e) {\n  return \"dummy-tile-full-extent\" === e.id;\n}\n\nfunction A(e) {\n  let t = 0;\n\n  for (const s of e) s.features && s.features.length > 0 && s.alive && (t = Math.max(t, s.descriptor.lij[0]));\n\n  return t;\n}\n\nfunction S(e) {\n  const t = e.capabilities.query;\n  return {\n    supportsMultipleResolutions: L(e),\n    supportsPagination: !(!t || !t.supportsPagination),\n    supportsResultType: !(!t || !t.supportsResultType),\n    supportsCacheHint: !(!t || !t.supportsCacheHint),\n    supportsQuantization: !(!t || !t.supportsQuantization),\n    supportsQuantizationEditMode: !(!t || !t.supportsQuantizationEditMode),\n    supportsMaxRecordCountFactor: !(!t || !t.supportsMaxRecordCountFactor),\n    supportsFormatPBF: !(!t || !t.supportsFormatPBF)\n  };\n}\n\nfunction L(e) {\n  switch (e.geometryType) {\n    case \"polyline\":\n      return !0;\n\n    case \"polygon\":\n      return e.capabilities && e.capabilities.query && e.capabilities.query.supportsQuantization;\n\n    default:\n      return !1;\n  }\n}\n\nfunction Q(e) {\n  return e.setFeatures([], 0, null), e.featuresMissing = !1, w.DONE;\n}\n\nfunction H(e) {\n  return o(e) ? new Set() : new Set(e.map(e => e.name));\n}\n\nfunction k(e, t) {\n  if (o(e) || o(t)) return H(t);\n  const s = new Set();\n\n  for (const {\n    name: i\n  } of t) e.has(i) && s.add(i);\n\n  return s;\n}\n\ne([f({\n  constructOnly: !0\n})], I.prototype, \"features\", void 0), e([f()], I.prototype, \"tileDescriptors\", void 0), e([f({\n  value: 1 / 0\n})], I.prototype, \"maximumNumberOfFeatures\", null), e([f({\n  value: 1\n})], I.prototype, \"memoryFactor\", null), e([f({\n  value: 1\n})], I.prototype, \"lodFactor\", null), e([f()], I.prototype, \"useTileCount\", null), e([f({\n  readOnly: !0\n})], I.prototype, \"updating\", void 0), e([f({\n  readOnly: !0\n})], I.prototype, \"updatingTotal\", void 0), e([f({\n  readOnly: !0\n})], I.prototype, \"updatingRemaining\", void 0), e([f({\n  readOnly: !0\n})], I.prototype, \"expectedFeatureDiff\", void 0), e([f({\n  readOnly: !0\n})], I.prototype, \"memoryForUnusedFeatures\", null), e([f({\n  readOnly: !0\n})], I.prototype, \"maximumNumberOfFeaturesExceeded\", void 0), e([f({\n  constructOnly: !0\n})], I.prototype, \"maximumNumberOfFeaturesExceededThrottle\", void 0), e([f({\n  readOnly: !0\n})], I.prototype, \"totalVertices\", null), e([f({\n  readOnly: !0\n})], I.prototype, \"totalFeatures\", null), e([f()], I.prototype, \"filterExtent\", null), e([f({\n  constructOnly: !0\n})], I.prototype, \"context\", void 0), I = e([m(\"esri.views.3d.layers.support.FeatureTileFetcher3D\")], I);\nconst V = 2e3,\n      z = g(),\n      B = g(),\n      G = 6e5,\n      X = 200;\nexport { I as FeatureTileFetcher3D, S as contextCapabilitiesFromLayer };","map":{"version":3,"names":["_","e","t","s","i","someMap","r","isSome","a","destroyMaybe","n","isNone","o","unwrap","u","isAbortError","l","eachAlways","h","throwIfAborted","c","on","d","schedule","p","property","f","subclass","m","create","g","equals","F","clone","y","expand","toExtent","T","getObjectId","x","hasVertices","E","C","R","ViewingMode","b","MultiFeatureReference","v","SingleFeatureReference","M","FAILED_FEATURE_COUNT","D","FetchStatus","w","FeatureTile","j","tilesAreRelated","O","ImmediateTask","P","TaskPriority","N","U","getLogger","I","constructor","_useTileCount","updating","updatingTotal","updatingRemaining","expectedFeatureDiff","maximumNumberOfFeaturesExceeded","maximumNumberOfFeaturesExceededThrottle","_fullRatio","_farRatio","changes","updates","adds","Array","removes","handles","_frameTask","_dirty","featureTiles","Map","displayingFeatureReferences","numDisplayingFeatureReferences","suspended","pendingEdits","maximumNumberOfFeatures","_get","_set","_maximumFeaturesUpdated","memoryFactor","_setDirty","lodFactor","supportsResolution","refetch","useTileCount","context","query","queryFeatureCount","notifyChange","memoryForUnusedFeatures","forEach","estimatedUnusedSize","totalVertices","numVertices","totalFeatures","numFeatures","filterExtent","tilingScheme","spatialReference","error","_reclip","initialize","add","tileDescriptors","onListenerAdd","objectIdField","FeatureReferenceClass","capabilities","supportsMultipleResolutions","scheduler","registerTask","FEATURE_TILE_FETCHER","destroy","remove","_cancelFetchTile","_removeTile","clear","controller","abort","paused","restart","_clearTile","_resetFetchTile","memoryCache","suspend","_pause","resume","_unpause","_updated","availableFields","displayingFeatures","length","Set","has","delete","applyEdits","edits","Promise","resolve","count","AbortController","then","result","catch","_applyEditsDeleteFeatures","deletedFeatures","_applyEditsAddUpdateFeatures","addedFeatures","updatedFeatures","signal","globalIdField","objectId","globalId","errorOncePerTick","features","find","attributes","filter","setFeatures","_invalidateCounts","push","_applyEditsAddUpdateTile","_createQuery","resultType","cacheHint","objectIds","_queryFeatures","size","slice","hasPreciseFeatureCount","Math","max","k","fields","queryFeaturesDehydrated","timeout","G","running","runTask","processQueue","constructed","_getListOfTiles","_markTilesNotAlive","run","_addTiles","_filterExtentTiles","_removeTiles","done","_sortTiles","_displayTiles","_fetchTiles","_updateMemoryEstimates","_updateMaximumNumberOfFeaturesExceeded","alive","get","id","_addTile","madeProgress","hasProgressed","filtered","intersects","pop","sort","descriptor","loadPriority","_updateRatio","reduceFeatures","_showTile","needsFetching","cache","_scheduleUpdated","_needsNumFeatures","_fetchTileCount","_handleRequest","_fetchTile","featuresMissing","logFetchError","some","updateMemoryEstimates","intersectionIncludingBorrowed","z","B","_refreshDisplayingFeatures","feature","_applyChanges","isFetching","_maximumFeaturesForTile","emptyFeatureRatio","min","debugger","update","perTileMaximumNumberOfFeaturesExceeded","A","lij","fetchStatus","FULL","set","_referenceDisplayingFeaturesFromRelatedTiles","resolution","extent","extentIncludingBorrowedFeatures","ref","featureLimit","DONE","FETCH_NEEDED","requestController","resetFetching","_fetchCount","REFETCHING","REFETCH_NEEDED","Q","_getMaxRecordCount","ceil","q","supportsMaxRecordCountFactor","MAX_MAX_RECORD_COUNT_FACTOR","_fetchPagedTile","maxRecordCountFactor","isRefetching","exceededTransferLimit","_removeEmptyFeatures","H","_createFeatureCountQuery","_setPagingParameters","num","concat","supportsCacheHint","createQuery","geometry","_setResolutionParams","_useTileQuery","supportsPagination","start","_getEffectiveTileResolution","viewingMode","Global","resolutionAtLevel","geometryType","supportsQuantization","quantizationParameters","mode","originPosition","tolerance","fullExtent","maxAllowableOffset","needsFeatureCount","tileMaxRecordCount","maxRecordCount","supportsResultType","V","needsRefetching","FETCHING","needsDisplayUpdate","_hideTileFeatures","oldVersion","newVersion","_hideTile","unref","console","removeMany","addMany","X","estimatedSize","put","from","values","storedFeatures","reduce","test","process","getFeatureTileById","forEachFeatureTile","S","L","supportsQuantizationEditMode","supportsFormatPBF","map","name","constructOnly","prototype","value","readOnly","FeatureTileFetcher3D","contextCapabilitiesFromLayer"],"sources":["C:/Users/hp/Desktop/eco-friendly atmosphere/Atmosphere/eco-friendly/node_modules/@arcgis/core/views/3d/layers/support/FeatureTileFetcher3D.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import t from\"../../../../core/Accessor.js\";import s from\"../../../../core/Handles.js\";import i from\"../../../../core/Logger.js\";import{someMap as r}from\"../../../../core/MapUtils.js\";import{isSome as a,destroyMaybe as n,isNone as o,unwrap as u}from\"../../../../core/maybe.js\";import{isAbortError as l,eachAlways as h,throwIfAborted as c}from\"../../../../core/promiseUtils.js\";import{on as d}from\"../../../../core/reactiveUtils.js\";import{schedule as p}from\"../../../../core/scheduling.js\";import{property as f}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/arrayUtils.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import{subclass as m}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{create as g,equals as F,clone as y,expand as _,toExtent as T}from\"../../../../geometry/support/aaBoundingRect.js\";import{getObjectId as x,hasVertices as E}from\"../../../../layers/graphics/dehydratedFeatures.js\";import C from\"../../../../rest/support/QuantizationParameters.js\";import R from\"../../../../rest/support/Query.js\";import{ViewingMode as b}from\"../../../ViewingMode.js\";import{MultiFeatureReference as v,SingleFeatureReference as M}from\"./featureReference.js\";import{FAILED_FEATURE_COUNT as D,FetchStatus as w,FeatureTile as j}from\"./FeatureTile.js\";import{tilesAreRelated as O}from\"../../terrain/tileUtils.js\";import{ImmediateTask as P,TaskPriority as N}from\"../../../support/Scheduler.js\";const U=i.getLogger(\"esri.views.3d.layers.support.FeatureTileFetcher3D\");let I=class extends t{constructor(e){super(e),this._useTileCount=!1,this.updating=!1,this.updatingTotal=0,this.updatingRemaining=0,this.expectedFeatureDiff=0,this.maximumNumberOfFeaturesExceeded=!1,this.maximumNumberOfFeaturesExceededThrottle=1e3,this._fullRatio=1,this._farRatio=1,this.changes={updates:{adds:new Array,removes:new Array},adds:new Array,removes:new Array},this.handles=new s,this._frameTask=P,this._dirty=!1,this.featureTiles=new Map,this.displayingFeatureReferences=new Map,this.numDisplayingFeatureReferences=0,this.suspended=!0,this.pendingEdits=null}set maximumNumberOfFeatures(e){e=e||1/0;const t=this._get(\"maximumNumberOfFeatures\");e===t||e<1||(this._set(\"maximumNumberOfFeatures\",e),this._maximumFeaturesUpdated(t,e))}set memoryFactor(e){this.memoryFactor!==e&&(this._set(\"memoryFactor\",e),this._setDirty())}set lodFactor(e){this.lodFactor!==e&&(this._set(\"lodFactor\",e),this.supportsResolution&&this.refetch())}get useTileCount(){return this._useTileCount&&a(this.context.query.queryFeatureCount)}set useTileCount(e){this._useTileCount=e,this.notifyChange(\"useTileCount\")}get memoryForUnusedFeatures(){let e=0;return this.featureTiles.forEach((t=>e+=t.estimatedUnusedSize)),e}get totalVertices(){let e=0;return this.featureTiles.forEach((t=>e+=t.numVertices)),e}get totalFeatures(){let e=0;return this.featureTiles.forEach((t=>e+=t.numFeatures)),e}set filterExtent(e){if(e&&this.context.tilingScheme&&!e.spatialReference.equals(this.context.tilingScheme.spatialReference))return void U.error(\"#filterExtent=\",\"extent needs to be in the same spatial reference as the tiling scheme\");const t=this._get(\"filterExtent\");if(t===e||t&&e&&t.equals(e))return;const s=e?e.clone():null;this._set(\"filterExtent\",s),this._reclip(s,t)}initialize(){this.handles.add(d((()=>this.tileDescriptors),\"change\",(()=>this._setDirty()),{onListenerAdd:()=>this._setDirty()})),this.objectIdField=this.context.objectIdField,this.FeatureReferenceClass=this.context.capabilities.supportsMultipleResolutions?v:M;const e=this.context.scheduler;a(e)&&(this._frameTask=e.registerTask(N.FEATURE_TILE_FETCHER,this)),this._setDirty()}destroy(){this._frameTask.remove(),this.handles=n(this.handles),this.featureTiles.forEach((e=>{this._cancelFetchTile(e),this._removeTile(e)})),this.featureTiles.clear(),this.displayingFeatureReferences.clear(),this.pendingEdits&&(this.pendingEdits.controller.abort(),this.pendingEdits=null)}get paused(){return this.suspended||!!this.pendingEdits}restart(){this.featureTiles.forEach((e=>{this._cancelFetchTile(e),this._clearTile(e),this._resetFetchTile(e)})),a(this.context.memoryCache)&&this.context.memoryCache.clear(),this._setDirty()}refetch(){this.featureTiles.forEach((e=>{this._cancelFetchTile(e),this._resetFetchTile(e)})),a(this.context.memoryCache)&&this.context.memoryCache.clear(),this._setDirty()}suspend(){this.suspended||(this.suspended=!0,this._pause(),this._setDirty())}resume(){this.suspended&&(this.suspended=!1,this._unpause())}_pause(){this.paused&&(this.featureTiles.forEach((e=>this._cancelFetchTile(e))),this._updated())}_unpause(){this.paused||(this._setDirty(),this._updated())}get availableFields(){let e=null;return this.featureTiles.forEach((t=>{o(t.displayingFeatures)||0===t.displayingFeatures.length||(o(e)?e=new Set(t.availableFields):e.forEach((s=>{t.availableFields.has(s)||u(e).delete(s)})))})),a(e)?e:new Set}applyEdits(e){this.pendingEdits||(this.pendingEdits={edits:Promise.resolve(),count:0,controller:new AbortController},this._pause());const t=this.pendingEdits;t.count++;const s=t.edits.then((()=>e.result.catch((e=>{if(l(e))throw e;return null})).then((e=>e?(this._applyEditsDeleteFeatures(e.deletedFeatures),this._applyEditsAddUpdateFeatures(e.addedFeatures,e.updatedFeatures,t.controller.signal).then((()=>e))):e)).then((e=>(0==--t.count&&(this.pendingEdits===t&&(this.pendingEdits=null),a(this.context.memoryCache)&&this.context.memoryCache.clear(),this._unpause(),this._updated()),e)))));return t.edits=s,this._updated(),s}_applyEditsDeleteFeatures(e){if(0===e.length)return;const t=this.context.globalIdField,s=t&&this.availableFields.has(t),i=new Set,r=this.objectIdField;e.forEach((({objectId:e,globalId:a})=>{if((!e||e<0)&&t){s||U.errorOncePerTick(`Editing the specified service requires the layer's globalIdField, ${t} to be included the layer's outFields for updates to be reflected in the view`);const e=this.features.find((e=>e.attributes&&e.attributes[t]===a));e&&i.add(x(e,r))}else i.add(e)})),this.featureTiles.forEach((e=>{if(!e.features)return;const t=e.features.filter((e=>!i.has(x(e,this.objectIdField))));t.length!==e.features.length&&(e.setFeatures(t,0,e.availableFields),this._invalidateCounts())}))}async _applyEditsAddUpdateFeatures(e,t,s){const i=[],r=new Set;if(e.forEach((e=>i.push(e.objectId))),t.forEach((e=>{i.push(e.objectId),r.add(e.objectId)})),0===i.length)return;const a=[];this.featureTiles.forEach((e=>{const t=this._applyEditsAddUpdateTile(e,i,r,s);t&&a.push(t)})),await h(a)}async _applyEditsAddUpdateTile(e,t,s,i){if(!e.features)return;const r=this._createQuery(e);r.resultType=void 0,r.cacheHint=!1,r.objectIds=t;const a=await this._queryFeatures(r,i);let n=null;if(s.size>0){const t=e.features.filter((e=>!s.has(x(e,this.objectIdField))));t.length!==e.features.length&&(n=t)}if(a.features.length>0){n||(n=e.features.slice());for(const e of a.features)n.push(e)}n&&(e.hasPreciseFeatureCount&&(e.numFeatures=Math.max(e.numFeatures,n.length)),e.setFeatures(n,0,k(e.availableFields,a.fields)),this._invalidateCounts())}_queryFeatures(e,t){return this.context.query.queryFeaturesDehydrated(e,{signal:t,timeout:G})}_setDirty(){this._dirty=!0,this._updated()}get running(){return this.updating}runTask(e){if(this._frameTask.processQueue(e),!this._dirty||!this.constructed)return;this._dirty=!1;const t=this._getListOfTiles();if(this._markTilesNotAlive(t),!e.run((()=>this._addTiles(t,e)))||!e.run((()=>this._filterExtentTiles(t,e)))||!e.run((()=>this._removeTiles(t,e)))||e.done)return void this._setDirty();const s=this._sortTiles(t);e.run((()=>this._displayTiles(s,e)))&&e.run((()=>this._fetchTiles(s,e)))&&e.run((()=>this._updateMemoryEstimates(s,e)))||this._setDirty(),this._updated(),this.updating||this._updateMaximumNumberOfFeaturesExceeded()}_markTilesNotAlive(e){for(const t of e)t.alive=!1}_addTiles(e,t){return!this.suspended&&(this.tileDescriptors.forEach((s=>{const i=this.featureTiles.get(s.id);i?i.alive=!0:t.done||(e.push(this._addTile(s)),t.madeProgress())})),t.hasProgressed)}_filterExtentTiles(e,t){for(const s of e){if(t.done)break;s.alive&&(s.filtered=!s.intersects(this.filterExtent),s.filtered&&(this._clearTile(s),t.madeProgress()))}return t.hasProgressed}_removeTiles(e,t){for(let s=e.length-1;s>=0&&!t.done;s--){const i=e[s];i.alive||(this._removeTile(i),s!==e.length-1&&(e[s]=e[e.length-1]),e.pop(),t.madeProgress())}return t.hasProgressed}_sortTiles(e){return e.sort(((e,t)=>e.descriptor.loadPriority-t.descriptor.loadPriority)),e}_displayTiles(e,t){const s=this._updateRatio(e),i=e=>{const t=this._fullRatio<1?s(e)*this._farRatio:1;return e.reduceFeatures(t,this.memoryFactor,this.objectIdField)&&this._setDirty(),this._showTile(e)};for(const r of e)if(!t.run((()=>i(r)))){this._setDirty();break}return t.hasProgressed}_fetchTiles(e,t){if(this.paused)return!1;let s=!1;for(const i of e){if(!i.needsFetching)continue;const e=a(this.context.memoryCache)?this.context.memoryCache.pop(i.id):null;if(a(e))i.cache=e,this._setDirty(),this._scheduleUpdated(),t.madeProgress();else{if(this._needsNumFeatures(i)){const e=new AbortController,r=this._fetchTileCount(i,e.signal);this._handleRequest(i,r,e,(()=>i.numFeatures=D)),s=!0,t.madeProgress()}if(t.done)return!0}}if(s)return t.hasProgressed;for(const i of e)if(i.needsFetching){const e=new AbortController,s=this._fetchTile(i,e.signal);if(this._handleRequest(i,s,e,(e=>{i.setFeatures([],0,null),this._invalidateCounts(),i.featuresMissing=!1,this.context.logFetchError(U,e)})),t.madeProgress(),t.done)return!0}return t.hasProgressed}_updateMemoryEstimates(e,t){return e.some((e=>!t.run((()=>e.updateMemoryEstimates()))&&(this._setDirty(),!0))),t.hasProgressed}_reclip(e,t){if(!this.constructed)return;const s=new Array;this.featureTiles.forEach((i=>{o(i.displayingFeatures)||0===i.displayingFeatures.length||(i.intersectionIncludingBorrowed(t,z),i.intersectionIncludingBorrowed(e,B),F(z,B)||s.push(i))})),this._refreshDisplayingFeatures(s),this._updated()}_refreshDisplayingFeatures(e){const t=new Set,s=this.changes.updates;for(const i of e)if(!o(i.displayingFeatures))for(const e of i.displayingFeatures){const i=x(e,this.objectIdField);if(t.has(i))continue;t.add(i);const{feature:r}=this.displayingFeatureReferences.get(i);s.removes.push(r),s.adds.push(r)}this._applyChanges()}_updated(){let e=0;this.paused||this.featureTiles.forEach((t=>t.isFetching?++e:0));const t=this._dirty||e>0||!!this.pendingEdits;if(this._set(\"updating\",t),t){let t=0,s=0,i=0,r=0,n=0;const o=this.displayingFeatureReferences.size/this.numDisplayingFeatureReferences;this.featureTiles.forEach((e=>{if(++s,e.isFetching&&e.hasPreciseFeatureCount){const t=this._maximumFeaturesForTile(e)*(1-e.emptyFeatureRatio),s=a(e.displayingFeatures)?e.displayingFeatures.length*o:0;n+=t-s}e.needsFetching?++r:e.numFeatures>0&&(++i,t+=e.numFeatures)})),r+=e;let u=0,l=0;t?(l=t,u=Math.min(r*t/i,t)):(l=s,u=r),n=Math.min(this.maximumNumberOfFeatures-this.features.length,n),this._set(\"updatingTotal\",l),this._set(\"updatingRemaining\",u),this._set(\"expectedFeatureDiff\",n)}else this._set(\"updatingTotal\",0),this._set(\"updatingRemaining\",0),this._set(\"expectedFeatureDiff\",0);this.debugger&&this.debugger.update()}_updateMaximumNumberOfFeaturesExceeded(){const e=r(this.featureTiles,(e=>e.perTileMaximumNumberOfFeaturesExceeded));this._set(\"maximumNumberOfFeaturesExceeded\",e)}_updateRatio(e){const t=A(e),s=e=>1/(1<<Math.max(0,t-e.descriptor.lij[0]));let i=0,r=0;for(const a of e){const e=a.numFeatures;i+=e,r+=e*s(a)}return this._fullRatio=Math.min(1,this.maximumNumberOfFeatures/i),this._farRatio=this.maximumNumberOfFeatures/r,this._scheduleUpdated(),s}_maximumFeaturesUpdated(e,t){e!==t&&(t>e&&this.featureTiles.forEach((e=>{if(!e.featuresMissing)return;const t=this._maximumFeaturesForTile(e);e.features&&(e.features.length>=t||e.fetchStatus===w.FULL)||(this._cancelFetchTile(e),this._resetFetchTile(e))})),this._setDirty())}_addTile(e){const t=new j(e);return this.featureTiles.set(t.id,t),this._resetFetchTile(t),this._referenceDisplayingFeaturesFromRelatedTiles(t),t}_referenceDisplayingFeaturesFromRelatedTiles(e){const t=e.descriptor.resolution;this.featureTiles.forEach((s=>{if(!(o(s.displayingFeatures)||e===s||e.descriptor.lij&&s.descriptor.lij&&!O(e.descriptor.lij,s.descriptor.lij))){o(e.displayingFeatures)&&(e.displayingFeatures=[]),e.descriptor.extent&&s.descriptor.extent&&(o(e.extentIncludingBorrowedFeatures)&&(e.extentIncludingBorrowedFeatures=y(e.descriptor.extent)),_(e.extentIncludingBorrowedFeatures,s.descriptor.extent,e.extentIncludingBorrowedFeatures));for(const i of s.displayingFeatures){e.displayingFeatures.push(i);const s=this.displayingFeatureReferences.get(x(i,this.objectIdField));s.ref(s.feature,t),this.numDisplayingFeatureReferences++}}})),e.featureLimit=a(e.displayingFeatures)?e.displayingFeatures.length:0}_removeTile(e){this._clearTile(e),this.featureTiles.delete(e.id)}_resetFetchTile(e){e.filtered=!e.intersects(this.filterExtent),e.filtered?e.needsFetching&&(e.fetchStatus=w.DONE):e.fetchStatus=w.FETCH_NEEDED}_cancelFetchTile(e){const t=e.requestController;a(t)&&(e.requestController=null,e.resetFetching(),t.abort())}async _fetchTileCount(e,t){return e.numFeatures=await this._fetchCount(e,t),this._updateRatio(this._getListOfTiles()),e.fetchStatus===w.REFETCHING?w.REFETCH_NEEDED:w.FETCH_NEEDED}async _fetchTile(e,t){const s=this._maximumFeaturesForTile(e);if(s<=0)return Q(e);const i=this._getMaxRecordCount(e),r=Math.ceil(s/i);if(q(e)||!this.context.capabilities.supportsMaxRecordCountFactor||e.numFeatures<=s&&r>R.MAX_MAX_RECORD_COUNT_FACTOR)return this._fetchPagedTile(e,t);const a=this._createQuery(e);if(a.maxRecordCountFactor=Math.ceil(s/i),e.isRefetching&&e.features&&e.features.length>0){const t=Math.ceil(e.features.length/(1-e.emptyFeatureRatio)/i);a.maxRecordCountFactor=Math.max(t+1,a.maxRecordCountFactor)}const{features:n,exceededTransferLimit:o,fields:u}=await this._queryFeatures(a,t),l=o?a.maxRecordCountFactor>=R.MAX_MAX_RECORD_COUNT_FACTOR?w.FULL:w.DONE:w.FULL;return await this._frameTask.schedule((()=>{e.featuresMissing=n.length<e.numFeatures||o;const t=this._removeEmptyFeatures(n);e.setFeatures(n,t,H(u))}),t),c(t),this._invalidateCounts(),l}async _fetchCount(e,t){return this.context.query.queryFeatureCount(this._createFeatureCountQuery(e),{signal:t})}async _fetchPagedTile(e,t){let s,i=0,r=0,a=0,n=this._maximumFeaturesForTile(e)-a;const o=this._getMaxRecordCount(e);let l=null;for(;;){const h=this._createQuery(e),d=this._setPagingParameters(h,i,n,o),{features:p,exceededTransferLimit:f,fields:m}=await this._queryFeatures(h,t);if(await this._frameTask.schedule((()=>{d&&(i+=u(h.num)),a+=p.length,r+=this._removeEmptyFeatures(p),e.featuresMissing=i<e.numFeatures||f,s=s?s.concat(p):p,l=k(l,m),e.setFeatures(s,r,l)}),t),c(t),this._invalidateCounts(),this._setDirty(),n=this._maximumFeaturesForTile(e)-a,!d||!f||n<=0)return f?w.DONE:w.FULL}}_createFeatureCountQuery(e){const t=this._createQuery(e);return this.context.capabilities.supportsCacheHint&&(t.resultType=void 0,t.cacheHint=!0),t}_createQuery(e){const t=this.context.createQuery(),s=e.descriptor.extent;if(s){const e=this.context.tilingScheme.spatialReference;t.geometry=T(s,e)}return this._setResolutionParams(t,e),this._useTileQuery(e)?t.resultType=\"tile\":this.context.capabilities.supportsCacheHint&&(t.cacheHint=!0),t}_setPagingParameters(e,t,s,i){return!!this.context.capabilities.supportsPagination&&(e.start=t,s>0&&this.context.capabilities.supportsMaxRecordCountFactor?(e.maxRecordCountFactor=Math.ceil(s/i),e.num=Math.min(e.maxRecordCountFactor*i,s)):e.num=Math.min(i),!0)}_getEffectiveTileResolution(e){if(null==e.descriptor.resolution)return null;const t=this.context.viewingMode===b.Global?this.context.tilingScheme.resolutionAtLevel(3):1/0;return Math.min(e.descriptor.resolution,t)/this.lodFactor}get supportsResolution(){return this.context.capabilities.supportsMultipleResolutions&&\"point\"!==this.context.geometryType}_setResolutionParams(e,t){if(!this.supportsResolution)return;const s=this._getEffectiveTileResolution(t);null!=s&&(this.context.capabilities.supportsQuantization?e.quantizationParameters=new C({mode:\"view\",originPosition:\"upper-left\",tolerance:s,extent:this.context.fullExtent}):\"polyline\"===this.context.geometryType&&(e.maxAllowableOffset=s))}_removeEmptyFeatures(e){const t=e.length;for(let s=0;s<e.length;){const t=e[s];E(t.geometry)?++s:(e[s]=e[e.length-1],--e.length)}return t-e.length}_needsNumFeatures(e){return this.useTileCount&&e.needsFeatureCount&&!q(e)}_getMaxRecordCount(e){const{tileMaxRecordCount:t,maxRecordCount:s}=this.context;return this._useTileQuery(e)&&a(t)&&t>0&&this.context.capabilities.supportsResultType?t:a(s)&&s>0?s:V}_useTileQuery(e){return(!q(e)||!this.context.capabilities.supportsCacheHint)&&this.context.capabilities.supportsResultType}_handleRequest(e,t,s,i){e.fetchStatus=e.needsRefetching?w.REFETCHING:w.FETCHING,e.requestController=s;let r=!1;t.then((t=>{e.requestController=null,e.fetchStatus=t})).catch((t=>{e.requestController===s&&(e.requestController=null,e.fetchStatus=w.DONE),l(t)?r=!0:i(t)})).then((()=>{r||this._setDirty(),this._scheduleUpdated()}))}_scheduleUpdated(){this.handles&&!this.handles.has(\"scheduleUpdated\")&&this.handles.add(p((()=>{this.handles.remove(\"scheduleUpdated\"),this._updated()})),\"scheduleUpdated\")}_showTile(e){if(a(e.displayingFeatures)&&!e.needsDisplayUpdate)return!1;const t=e.features;if(0===e.featureLimit||!t){const t=a(e.displayingFeatures)&&e.displayingFeatures.length>0;return this._hideTileFeatures(e),e.displayingFeatures=[],t}const s=e.descriptor.resolution,i=this.changes.updates,r=this.changes.adds,n=Math.min(e.featureLimit,t.length);e.featureLimit=n;for(let a=0;a<n;++a){const e=t[a],n=x(e,this.objectIdField),o=this.displayingFeatureReferences.get(n);if(o){const t=o.ref(e,s);t.oldVersion!==t.newVersion&&(i.removes.push(t.oldVersion),i.adds.push(t.newVersion))}else this.displayingFeatureReferences.set(n,new this.FeatureReferenceClass(e,s)),r.push(e);this.numDisplayingFeatureReferences++}return this._hideTileFeatures(e),this._applyChanges(),e.displayingFeatures=t.slice(0,n),!0}_hideTile(e){this._cancelFetchTile(e),this._hideTileFeatures(e)}_hideTileFeatures(e){if(o(e.displayingFeatures))return;const t=this.changes.updates,s=this.changes.removes;for(const i of e.displayingFeatures){const r=x(i,this.objectIdField),a=this.displayingFeatureReferences.get(r);if(!a)continue;const n=a.unref(e.descriptor.resolution);this.numDisplayingFeatureReferences--,n?n.oldVersion!==n.newVersion&&(null==n.newVersion?(this.displayingFeatureReferences.delete(r),s.push(n.oldVersion)):(t.adds.push(n.newVersion),t.removes.push(n.oldVersion))):console.error(\"Hiding unreferenced feature\")}this._applyChanges(),e.displayingFeatures=null}_applyChanges(){const e=this.changes.updates;e.removes.length>0&&(this.features.removeMany(e.removes),e.removes.length=0),e.adds.length>0&&(this.features.addMany(e.adds),e.adds.length=0);const t=this.changes.adds,s=this.changes.removes,i=Math.min(t.length,s.length);let r=0;for(;r<i;){const e=Math.min(r+X,i);this.features.addMany(t.slice(r,e)),this.features.removeMany(s.slice(r,e)),r=e}t.length>i&&this.features.addMany(0===r?t:t.slice(r)),s.length>i&&this.features.removeMany(0===r?s:s.slice(r)),t.length=0,s.length=0}_clearTile(e){if(this._hideTile(e),e.features&&a(this.context.memoryCache)){const t=16+e.estimatedSize;this.context.memoryCache.put(e.id,e.cache,t)}e.setFeatures(null,0,null),this._invalidateCounts()}_invalidateCounts(){this.notifyChange(\"totalVertices\"),this.notifyChange(\"totalFeatures\"),this.notifyChange(\"memoryForUnusedFeatures\")}_getListOfTiles(){return Array.from(this.featureTiles.values())}get storedFeatures(){return this._getListOfTiles().reduce(((e,t)=>e+(t.features?t.features.length:0)),0)}_maximumFeaturesForTile(e){const t=e.hasPreciseFeatureCount?e.numFeatures:1/0,s=e.hasPreciseFeatureCount?t:this.maximumNumberOfFeatures,i=this._fullRatio<1?this._farRatio:1;return Math.min(Math.ceil(s*i/(1-e.emptyFeatureRatio)),t)}get test(){return{process:e=>this.runTask(e),getFeatureTileById:e=>this.featureTiles.get(e),forEachFeatureTile:e=>this.featureTiles.forEach(e)}}};function q(e){return\"dummy-tile-full-extent\"===e.id}function A(e){let t=0;for(const s of e)s.features&&s.features.length>0&&s.alive&&(t=Math.max(t,s.descriptor.lij[0]));return t}function S(e){const t=e.capabilities.query;return{supportsMultipleResolutions:L(e),supportsPagination:!(!t||!t.supportsPagination),supportsResultType:!(!t||!t.supportsResultType),supportsCacheHint:!(!t||!t.supportsCacheHint),supportsQuantization:!(!t||!t.supportsQuantization),supportsQuantizationEditMode:!(!t||!t.supportsQuantizationEditMode),supportsMaxRecordCountFactor:!(!t||!t.supportsMaxRecordCountFactor),supportsFormatPBF:!(!t||!t.supportsFormatPBF)}}function L(e){switch(e.geometryType){case\"polyline\":return!0;case\"polygon\":return e.capabilities&&e.capabilities.query&&e.capabilities.query.supportsQuantization;default:return!1}}function Q(e){return e.setFeatures([],0,null),e.featuresMissing=!1,w.DONE}function H(e){return o(e)?new Set:new Set(e.map((e=>e.name)))}function k(e,t){if(o(e)||o(t))return H(t);const s=new Set;for(const{name:i}of t)e.has(i)&&s.add(i);return s}e([f({constructOnly:!0})],I.prototype,\"features\",void 0),e([f()],I.prototype,\"tileDescriptors\",void 0),e([f({value:1/0})],I.prototype,\"maximumNumberOfFeatures\",null),e([f({value:1})],I.prototype,\"memoryFactor\",null),e([f({value:1})],I.prototype,\"lodFactor\",null),e([f()],I.prototype,\"useTileCount\",null),e([f({readOnly:!0})],I.prototype,\"updating\",void 0),e([f({readOnly:!0})],I.prototype,\"updatingTotal\",void 0),e([f({readOnly:!0})],I.prototype,\"updatingRemaining\",void 0),e([f({readOnly:!0})],I.prototype,\"expectedFeatureDiff\",void 0),e([f({readOnly:!0})],I.prototype,\"memoryForUnusedFeatures\",null),e([f({readOnly:!0})],I.prototype,\"maximumNumberOfFeaturesExceeded\",void 0),e([f({constructOnly:!0})],I.prototype,\"maximumNumberOfFeaturesExceededThrottle\",void 0),e([f({readOnly:!0})],I.prototype,\"totalVertices\",null),e([f({readOnly:!0})],I.prototype,\"totalFeatures\",null),e([f()],I.prototype,\"filterExtent\",null),e([f({constructOnly:!0})],I.prototype,\"context\",void 0),I=e([m(\"esri.views.3d.layers.support.FeatureTileFetcher3D\")],I);const V=2e3,z=g(),B=g(),G=6e5,X=200;export{I as FeatureTileFetcher3D,S as contextCapabilitiesFromLayer};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}