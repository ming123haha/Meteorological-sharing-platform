{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport e from \"../../../Graphic.js\";\nimport { W as t } from \"../../../chunks/languageUtils.js\";\nimport { SqlExpressionAdapted as i, OriginalField as s, AdaptedFeatureSet as n } from \"./Adapted.js\";\nimport r from \"./AttributeFilter.js\";\nimport a from \"./OrderBy.js\";\nimport l from \"../support/FeatureSet.js\";\nimport o from \"../support/IdSet.js\";\nimport d from \"../support/OrderbyClause.js\";\nimport { IdState as u, layerGeometryEsriConstants as f, FeatureServiceDatabaseType as c } from \"../support/shared.js\";\nimport { isSingleField as h, toWhereClause as p, predictType as g, scanForField as _, reformulateWithoutField as m } from \"../support/sqlUtils.js\";\nimport { calculateStat as y } from \"../support/stats.js\";\nimport b from \"../support/StatsField.js\";\nimport { createMD5Hash as w, outputTypes as F } from \"../../../core/MD5.js\";\nimport { WhereClause as I } from \"../../../core/sql/WhereClause.js\";\nimport S from \"../../../geometry/SpatialReference.js\";\nimport x from \"../../../layers/support/Field.js\";\nimport k from \"../../../layers/support/FieldsIndex.js\";\nimport { FeatureSetError as D, FeatureSetErrorCodes as A } from \"../support/errorsupport.js\";\n\nfunction j(e) {\n  if (!e) return \"COUNT\";\n\n  switch (e.toLowerCase()) {\n    case \"max\":\n      return \"MAX\";\n\n    case \"var\":\n    case \"variance\":\n      return \"VAR\";\n\n    case \"avg\":\n    case \"average\":\n    case \"mean\":\n      return \"AVG\";\n\n    case \"min\":\n      return \"MIN\";\n\n    case \"sum\":\n      return \"SUM\";\n\n    case \"stdev\":\n    case \"stddev\":\n      return \"STDDEV\";\n\n    case \"count\":\n      return \"COUNT\";\n  }\n\n  return \"COUNT\";\n}\n\nclass C extends l {\n  constructor(e) {\n    super(e), this._decodedStatsfield = [], this._decodedGroupbyfield = [], this._candosimplegroupby = !0, this.phsyicalgroupbyfields = [], this.objectIdField = \"ROW__ID\", this._internalObjectIdField = \"ROW__ID\", this._adaptedFields = [], this.declaredClass = \"esri.arcade.featureset.actions.Aggregate\", this._uniqueIds = 1, this._maxQuery = 10, this._maxProcessing = 10, this._parent = e.parentfeatureset, this._config = e;\n  }\n\n  isTable() {\n    return !0;\n  }\n\n  async _getSet(e) {\n    if (null === this._wset) {\n      const t = await this._getFilteredSet(\"\", null, null, null, e);\n      return this._wset = t, this._wset;\n    }\n\n    return this._wset;\n  }\n\n  _isInFeatureSet() {\n    return u.InFeatureSet;\n  }\n\n  _nextUniqueName(e) {\n    for (; 1 === e[\"T\" + this._uniqueIds.toString()];) this._uniqueIds++;\n\n    const t = \"T\" + this._uniqueIds.toString();\n\n    return e[t] = 1, t;\n  }\n\n  _convertToEsriFieldType(e) {\n    return e;\n  }\n\n  _initialiseFeatureSet() {\n    const e = {};\n    let t = !1,\n        n = 1;\n    const r = this._parent ? this._parent.getFieldsIndex() : new k([]);\n\n    for (this.objectIdField = \"ROW__ID\", this.globalIdField = \"\"; !1 === t;) {\n      let e = !1;\n\n      for (let t = 0; t < this._config.groupbyfields.length; t++) if (this._config.groupbyfields[t].name.toLowerCase() === this.objectIdField.toLowerCase()) {\n        e = !0;\n        break;\n      }\n\n      if (!1 === e) for (let t = 0; t < this._config.statsfields.length; t++) if (this._config.statsfields[t].name.toLowerCase() === this.objectIdField.toLowerCase()) {\n        e = !0;\n        break;\n      }\n      !1 === e ? t = !0 : (this.objectIdField = \"ROW__ID\" + n.toString(), n++);\n    }\n\n    for (const i of this._config.statsfields) {\n      const e = new b();\n      e.field = i.name, e.tofieldname = i.name, e.workingexpr = i.expression instanceof I ? i.expression : I.create(i.expression, r), e.typeofstat = j(i.statistic), this._decodedStatsfield.push(e);\n    }\n\n    this._decodedGroupbyfield = [];\n\n    for (const i of this._config.groupbyfields) {\n      const e = {\n        name: i.name,\n        singlefield: null,\n        tofieldname: i.name,\n        expression: i.expression instanceof I ? i.expression : I.create(i.expression, r)\n      };\n\n      this._decodedGroupbyfield.push(e);\n    }\n\n    if (null !== this._parent) {\n      this.geometryType = this._parent.geometryType, this.spatialReference = this._parent.spatialReference, this.hasM = this._parent.hasM, this.hasZ = this._parent.hasZ, this.typeIdField = \"\";\n\n      for (const t of this._parent.fields) e[t.name.toUpperCase()] = 1;\n\n      this.types = null;\n    } else this.geometryType = f.point, this.typeIdField = \"\", this.types = null, this.spatialReference = new S({\n      wkid: 4326\n    });\n\n    this.fields = [];\n    const a = new b();\n    a.field = this._nextUniqueName(e), a.tofieldname = this.objectIdField, a.workingexpr = I.create(this._parent.objectIdField, this._parent.getFieldsIndex()), a.typeofstat = \"MIN\", this._decodedStatsfield.push(a);\n\n    for (const s of this._decodedGroupbyfield) {\n      const t = new x();\n\n      if (s.name = this._nextUniqueName(e), t.name = s.tofieldname, t.alias = t.name, h(s.expression)) {\n        const e = this._parent.getField(p(s.expression, c.Standardised));\n\n        if (!e) throw new D(A.AggregationFieldNotFound);\n        s.name = e.name, s.singlefield = e.name, this.phsyicalgroupbyfields.push(e.name), t.type = e.type;\n      } else {\n        t.type = this._convertToEsriFieldType(g(s.expression, this._parent.fields));\n        const e = new x();\n        e.name = s.name, e.alias = e.name, this.phsyicalgroupbyfields.push(s.name), this._adaptedFields.push(new i(e, s.expression)), this._candosimplegroupby = !1;\n      }\n\n      this.fields.push(t);\n    }\n\n    if (this._adaptedFields.length > 0) for (const i of this._parent.fields) this._adaptedFields.push(new s(i));\n\n    for (let i = 0; i < this._decodedStatsfield.length; i++) {\n      const t = new x();\n      let s = null;\n      const n = this._decodedStatsfield[i];\n      n.field = this._nextUniqueName(e), n.tofieldname === this.objectIdField && (this._internalObjectIdField = n.field), t.name = n.tofieldname, t.alias = t.name;\n      const r = null !== n.workingexpr && h(n.workingexpr) ? p(n.workingexpr, c.Standardised) : \"\";\n\n      switch (this._decodedStatsfield[i].typeofstat) {\n        case \"SUM\":\n          if (\"\" !== r) {\n            if (s = this._parent.getField(r), !s) throw new D(A.AggregationFieldNotFound);\n            t.type = s.type;\n          } else t.type = \"double\";\n\n          break;\n\n        case \"MIN\":\n        case \"MAX\":\n          if (\"\" !== r) {\n            if (s = this._parent.getField(r), !s) throw new D(A.AggregationFieldNotFound);\n            t.type = s.type;\n          } else t.type = \"double\";\n\n          break;\n\n        case \"COUNT\":\n          t.type = \"integer\";\n          break;\n\n        case \"STDDEV\":\n        case \"VAR\":\n        case \"AVG\":\n          if (\"\" !== r && (s = this._parent.getField(r), !s)) throw new D(A.AggregationFieldNotFound);\n          t.type = \"double\";\n      }\n\n      this.fields.push(t);\n    }\n  }\n\n  async _canDoAggregates() {\n    return !1;\n  }\n\n  async _getFeatures(e, t, i, s) {\n    -1 !== t && this._featureCache[t];\n    const n = this._maxQuery;\n    return !0 === this._checkIfNeedToExpandKnownPage(e, n) ? (await this._expandPagedSet(e, n, 0, 0, s), this._getFeatures(e, t, i, s)) : \"success\";\n  }\n\n  async _getFilteredSet(e, t, i, s, l) {\n    if (\"\" !== e) return new o([], [], !0, null);\n    let u = null;\n    const f = {\n      ordered: !1,\n      nowhereclause: !1\n    };\n    if (await this._ensureLoaded(), null !== i) for (let n = 0; n < this._decodedStatsfield.length; n++) if (!0 === _(i, this._decodedStatsfield[n].tofieldname)) {\n      f.nowhereclause = !0, i = null;\n      break;\n    }\n\n    if (null !== s) {\n      f.ordered = !0;\n\n      for (let e = 0; e < this._decodedStatsfield.length; e++) if (!0 === s.scanForField(this._decodedStatsfield[e].tofieldname)) {\n        s = null, f.ordered = !1;\n        break;\n      }\n\n      if (null !== s) for (const e of this._decodedGroupbyfield) if (null === e.singlefield && !0 === s.scanForField(e.tofieldname)) {\n        s = null, f.ordered = !1;\n        break;\n      }\n    }\n\n    if (!1 !== this._candosimplegroupby && (await this._parent._canDoAggregates(this.phsyicalgroupbyfields, this._decodedStatsfield, \"\", null, null))) {\n      let e = null;\n      i && (e = this._reformulateWhereClauseWithoutGroupByFields(i));\n      let t = null;\n      s && (t = this._reformulateOrderClauseWithoutGroupByFields(s));\n      const n = await this._parent._getAggregatePagesDataSourceDefinition(this.phsyicalgroupbyfields, this._decodedStatsfield, \"\", null, e, t, this._internalObjectIdField);\n      return this._checkCancelled(l), u = !0 === f.nowhereclause ? new o(n._candidates.slice(0).concat(n._known.slice(0)), [], !0 === f.ordered && n._ordered, this._clonePageDefinition(n.pagesDefinition)) : new o(n._candidates.slice(0), n._known.slice(0), !0 === f.ordered && n._ordered, this._clonePageDefinition(n.pagesDefinition)), u;\n    }\n\n    let c = this._parent;\n    if (this._adaptedFields.length > 0 && (c = new n({\n      parentfeatureset: this._parent,\n      adaptedFields: this._adaptedFields,\n      extraFilter: null\n    })), !0 === f.nowhereclause) u = new o([\"GETPAGES\"], [], !1, {\n      aggregatefeaturesetpagedefinition: !0,\n      resultOffset: 0,\n      resultRecordCount: this._maxQuery,\n      internal: {\n        fullyResolved: !1,\n        workingItem: null,\n        type: \"manual\",\n        iterator: null,\n        set: [],\n        subfeatureset: new a({\n          parentfeatureset: c,\n          orderbyclause: new d(this.phsyicalgroupbyfields.join(\",\") + \",\" + this._parent.objectIdField + \" ASC\")\n        })\n      }\n    });else {\n      let e = c;\n\n      if (null !== i) {\n        let t = null;\n        i && (t = this._reformulateWhereClauseWithoutGroupByFields(i)), e = new r({\n          parentfeatureset: e,\n          whereclause: t\n        });\n      }\n\n      u = new o([\"GETPAGES\"], [], !1, {\n        aggregatefeaturesetpagedefinition: !0,\n        resultOffset: 0,\n        resultRecordCount: this._maxQuery,\n        internal: {\n          fullyResolved: !1,\n          workingItem: null,\n          type: \"manual\",\n          iterator: null,\n          set: [],\n          subfeatureset: new a({\n            parentfeatureset: e,\n            orderbyclause: new d(this.phsyicalgroupbyfields.join(\",\") + \",\" + this._parent.objectIdField + \" ASC\")\n          })\n        }\n      });\n    }\n    return u;\n  }\n\n  _reformulateWhereClauseWithoutStatsFields(e) {\n    for (const t of this._decodedStatsfield) e = m(e, t.tofieldname, p(t.workingexpr, c.Standardised), this._parent.getFieldsIndex());\n\n    return e;\n  }\n\n  _reformulateWhereClauseWithoutGroupByFields(e) {\n    for (const t of this._decodedGroupbyfield) t.tofieldname !== t.name && (e = m(e, t.tofieldname, p(t.expression, c.Standardised), this._parent.getFieldsIndex()));\n\n    return e;\n  }\n\n  _reformulateOrderClauseWithoutGroupByFields(e) {\n    const t = [];\n\n    for (const i of this._decodedGroupbyfield) i.tofieldname !== i.name && t.push({\n      field: i.tofieldname,\n      newfield: i.name\n    });\n\n    return t.length > 0 ? e.replaceFields(t) : e;\n  }\n\n  _clonePageDefinition(e) {\n    return null === e ? null : !0 === e.aggregatefeaturesetpagedefinition ? {\n      aggregatefeaturesetpagedefinition: !0,\n      resultRecordCount: e.resultRecordCount,\n      resultOffset: e.resultOffset,\n      internal: e.internal\n    } : this._parent._clonePageDefinition(e);\n  }\n\n  async _refineSetBlock(e, t, i) {\n    if (!0 === this._checkIfNeedToExpandCandidatePage(e, this._maxQuery)) return await this._expandPagedSet(e, this._maxQuery, 0, 0, i), this._refineSetBlock(e, t, i);\n\n    this._checkCancelled(i);\n\n    const s = e._candidates.length;\n\n    this._refineKnowns(e, t);\n\n    e._candidates.length;\n    return e._candidates.length, e;\n  }\n\n  _expandPagedSet(e, t, i, s, n) {\n    return this._expandPagedSetFeatureSet(e, t, i, s, n);\n  }\n\n  async _getPhysicalPage(t, i, s) {\n    if (!0 === t.pagesDefinition.aggregatefeaturesetpagedefinition) return this._sequentialGetPhysicalItem(t, t.pagesDefinition.resultRecordCount, s, []);\n    const n = await this._getAgregagtePhysicalPage(t, i, s);\n\n    for (const r of n) {\n      const t = {\n        geometry: r.geometry,\n        attributes: {}\n      };\n\n      for (const e of this._decodedGroupbyfield) t.attributes[e.tofieldname] = r.attributes[e.name];\n\n      for (const e of this._decodedStatsfield) t.attributes[e.tofieldname] = r.attributes[e.field];\n\n      this._featureCache[t.attributes[this.objectIdField]] = new e(t);\n    }\n\n    return n.length;\n  }\n\n  _sequentialGetPhysicalItem(e, t, i, s) {\n    return new Promise((n, r) => {\n      null === e.pagesDefinition.internal.iterator && (e.pagesDefinition.internal.iterator = e.pagesDefinition.internal.subfeatureset.iterator(i)), !0 === e.pagesDefinition.internal.fullyResolved || 0 === t ? n(s.length) : this._nextAggregateItem(e, t, i, s, r => {\n        null === r ? n(s.length) : (t -= 1, n(this._sequentialGetPhysicalItem(e, t, i, s)));\n      }, r);\n    });\n  }\n\n  _nextAggregateItem(e, i, s, n, r, a) {\n    try {\n      t(e.pagesDefinition.internal.iterator.next()).then(t => {\n        if (null === t) {\n          if (null !== e.pagesDefinition.internal.workingItem) {\n            const t = this._calculateAndAppendAggregateItem(e.pagesDefinition.internal.workingItem);\n\n            n.push(t), e.pagesDefinition.internal.workingItem = null, e.pagesDefinition.internal.set.push(t.attributes[this.objectIdField]), e.pagesDefinition.internal.fullyResolved = !0, r(null);\n          } else e.pagesDefinition.internal.fullyResolved = !0, r(null);\n        } else {\n          const l = this._generateAggregateHash(t);\n\n          if (null === e.pagesDefinition.internal.workingItem) e.pagesDefinition.internal.workingItem = {\n            features: [t],\n            id: l\n          };else {\n            if (l !== e.pagesDefinition.internal.workingItem.id) {\n              const s = this._calculateAndAppendAggregateItem(e.pagesDefinition.internal.workingItem);\n\n              return n.push(s), e.pagesDefinition.internal.workingItem = null, e.pagesDefinition.internal.set.push(s.attributes[this.objectIdField]), i -= 1, e.pagesDefinition.internal.workingItem = {\n                features: [t],\n                id: l\n              }, void r(s);\n            }\n\n            e.pagesDefinition.internal.workingItem.features.push(t);\n          }\n\n          this._nextAggregateItem(e, i, s, n, r, a);\n        }\n      }, a);\n    } catch (l) {\n      a(l);\n    }\n  }\n\n  _calculateFieldStat(e, t, i) {\n    const s = [];\n\n    for (let n = 0; n < e.features.length; n++) if (null !== t.workingexpr) {\n      const i = t.workingexpr.calculateValue(e.features[n]);\n      null !== i && s.push(i);\n    } else s.push(null);\n\n    switch (t.typeofstat) {\n      case \"MIN\":\n        i.attributes[t.tofieldname] = y(\"min\", s, -1);\n        break;\n\n      case \"MAX\":\n        i.attributes[t.tofieldname] = y(\"max\", s, -1);\n        break;\n\n      case \"SUM\":\n        i.attributes[t.tofieldname] = y(\"sum\", s, -1);\n        break;\n\n      case \"COUNT\":\n        i.attributes[t.tofieldname] = s.length;\n        break;\n\n      case \"VAR\":\n        i.attributes[t.tofieldname] = y(\"var\", s, -1);\n        break;\n\n      case \"STDDEV\":\n        i.attributes[t.tofieldname] = y(\"stddev\", s, -1);\n        break;\n\n      case \"AVG\":\n        i.attributes[t.tofieldname] = y(\"avg\", s, -1);\n    }\n\n    return !0;\n  }\n\n  _calculateAndAppendAggregateItem(t) {\n    const i = {\n      attributes: {},\n      geometry: null\n    };\n\n    for (const e of this._decodedGroupbyfield) {\n      const s = e.singlefield ? t.features[0].attributes[e.singlefield] : e.expression.calculateValue(t.features[0]);\n      i.attributes[e.tofieldname] = s;\n    }\n\n    for (const e of this._decodedStatsfield) this._calculateFieldStat(t, e, i);\n\n    const s = [];\n\n    for (let e = 0; e < this._decodedStatsfield.length; e++) s.push(this._calculateFieldStat(t, this._decodedStatsfield[e], i));\n\n    return this._featureCache[i.attributes[this.objectIdField]] = new e({\n      attributes: i.attributes,\n      geometry: i.geometry\n    }), i;\n  }\n\n  _generateAggregateHash(e) {\n    let t = \"\";\n\n    for (const i of this._decodedGroupbyfield) {\n      const s = i.singlefield ? e.attributes[i.singlefield] : i.expression.calculateValue(e);\n      t += null == s ? \":\" : \":\" + s.toString();\n    }\n\n    return w(t, F.String);\n  }\n\n  async _stat() {\n    return {\n      calculated: !1\n    };\n  }\n\n  async getFeatureByObjectId() {\n    return null;\n  }\n\n  static registerAction() {\n    l._featuresetFunctions.groupby = function (e, t) {\n      return new C({\n        parentfeatureset: this,\n        groupbyfields: e,\n        statsfields: t\n      });\n    };\n  }\n\n}\n\nexport { C as default };","map":{"version":3,"names":["e","W","t","SqlExpressionAdapted","i","OriginalField","s","AdaptedFeatureSet","n","r","a","l","o","d","IdState","u","layerGeometryEsriConstants","f","FeatureServiceDatabaseType","c","isSingleField","h","toWhereClause","p","predictType","g","scanForField","_","reformulateWithoutField","m","calculateStat","y","b","createMD5Hash","w","outputTypes","F","WhereClause","I","S","x","k","FeatureSetError","D","FeatureSetErrorCodes","A","j","toLowerCase","C","constructor","_decodedStatsfield","_decodedGroupbyfield","_candosimplegroupby","phsyicalgroupbyfields","objectIdField","_internalObjectIdField","_adaptedFields","declaredClass","_uniqueIds","_maxQuery","_maxProcessing","_parent","parentfeatureset","_config","isTable","_getSet","_wset","_getFilteredSet","_isInFeatureSet","InFeatureSet","_nextUniqueName","toString","_convertToEsriFieldType","_initialiseFeatureSet","getFieldsIndex","globalIdField","groupbyfields","length","name","statsfields","field","tofieldname","workingexpr","expression","create","typeofstat","statistic","push","singlefield","geometryType","spatialReference","hasM","hasZ","typeIdField","fields","toUpperCase","types","point","wkid","alias","getField","Standardised","AggregationFieldNotFound","type","_canDoAggregates","_getFeatures","_featureCache","_checkIfNeedToExpandKnownPage","_expandPagedSet","ordered","nowhereclause","_ensureLoaded","_reformulateWhereClauseWithoutGroupByFields","_reformulateOrderClauseWithoutGroupByFields","_getAggregatePagesDataSourceDefinition","_checkCancelled","_candidates","slice","concat","_known","_ordered","_clonePageDefinition","pagesDefinition","adaptedFields","extraFilter","aggregatefeaturesetpagedefinition","resultOffset","resultRecordCount","internal","fullyResolved","workingItem","iterator","set","subfeatureset","orderbyclause","join","whereclause","_reformulateWhereClauseWithoutStatsFields","newfield","replaceFields","_refineSetBlock","_checkIfNeedToExpandCandidatePage","_refineKnowns","_expandPagedSetFeatureSet","_getPhysicalPage","_sequentialGetPhysicalItem","_getAgregagtePhysicalPage","geometry","attributes","Promise","_nextAggregateItem","next","then","_calculateAndAppendAggregateItem","_generateAggregateHash","features","id","_calculateFieldStat","calculateValue","String","_stat","calculated","getFeatureByObjectId","registerAction","_featuresetFunctions","groupby","default"],"sources":["E:/各个学科/论文/毕业论文/Atmosphere/eco-friendly/node_modules/@arcgis/core/arcade/featureset/actions/GroupBy.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport e from\"../../../Graphic.js\";import{W as t}from\"../../../chunks/languageUtils.js\";import{SqlExpressionAdapted as i,OriginalField as s,AdaptedFeatureSet as n}from\"./Adapted.js\";import r from\"./AttributeFilter.js\";import a from\"./OrderBy.js\";import l from\"../support/FeatureSet.js\";import o from\"../support/IdSet.js\";import d from\"../support/OrderbyClause.js\";import{IdState as u,layerGeometryEsriConstants as f,FeatureServiceDatabaseType as c}from\"../support/shared.js\";import{isSingleField as h,toWhereClause as p,predictType as g,scanForField as _,reformulateWithoutField as m}from\"../support/sqlUtils.js\";import{calculateStat as y}from\"../support/stats.js\";import b from\"../support/StatsField.js\";import{createMD5Hash as w,outputTypes as F}from\"../../../core/MD5.js\";import{WhereClause as I}from\"../../../core/sql/WhereClause.js\";import S from\"../../../geometry/SpatialReference.js\";import x from\"../../../layers/support/Field.js\";import k from\"../../../layers/support/FieldsIndex.js\";import{FeatureSetError as D,FeatureSetErrorCodes as A}from\"../support/errorsupport.js\";function j(e){if(!e)return\"COUNT\";switch(e.toLowerCase()){case\"max\":return\"MAX\";case\"var\":case\"variance\":return\"VAR\";case\"avg\":case\"average\":case\"mean\":return\"AVG\";case\"min\":return\"MIN\";case\"sum\":return\"SUM\";case\"stdev\":case\"stddev\":return\"STDDEV\";case\"count\":return\"COUNT\"}return\"COUNT\"}class C extends l{constructor(e){super(e),this._decodedStatsfield=[],this._decodedGroupbyfield=[],this._candosimplegroupby=!0,this.phsyicalgroupbyfields=[],this.objectIdField=\"ROW__ID\",this._internalObjectIdField=\"ROW__ID\",this._adaptedFields=[],this.declaredClass=\"esri.arcade.featureset.actions.Aggregate\",this._uniqueIds=1,this._maxQuery=10,this._maxProcessing=10,this._parent=e.parentfeatureset,this._config=e}isTable(){return!0}async _getSet(e){if(null===this._wset){const t=await this._getFilteredSet(\"\",null,null,null,e);return this._wset=t,this._wset}return this._wset}_isInFeatureSet(){return u.InFeatureSet}_nextUniqueName(e){for(;1===e[\"T\"+this._uniqueIds.toString()];)this._uniqueIds++;const t=\"T\"+this._uniqueIds.toString();return e[t]=1,t}_convertToEsriFieldType(e){return e}_initialiseFeatureSet(){const e={};let t=!1,n=1;const r=this._parent?this._parent.getFieldsIndex():new k([]);for(this.objectIdField=\"ROW__ID\",this.globalIdField=\"\";!1===t;){let e=!1;for(let t=0;t<this._config.groupbyfields.length;t++)if(this._config.groupbyfields[t].name.toLowerCase()===this.objectIdField.toLowerCase()){e=!0;break}if(!1===e)for(let t=0;t<this._config.statsfields.length;t++)if(this._config.statsfields[t].name.toLowerCase()===this.objectIdField.toLowerCase()){e=!0;break}!1===e?t=!0:(this.objectIdField=\"ROW__ID\"+n.toString(),n++)}for(const i of this._config.statsfields){const e=new b;e.field=i.name,e.tofieldname=i.name,e.workingexpr=i.expression instanceof I?i.expression:I.create(i.expression,r),e.typeofstat=j(i.statistic),this._decodedStatsfield.push(e)}this._decodedGroupbyfield=[];for(const i of this._config.groupbyfields){const e={name:i.name,singlefield:null,tofieldname:i.name,expression:i.expression instanceof I?i.expression:I.create(i.expression,r)};this._decodedGroupbyfield.push(e)}if(null!==this._parent){this.geometryType=this._parent.geometryType,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=\"\";for(const t of this._parent.fields)e[t.name.toUpperCase()]=1;this.types=null}else this.geometryType=f.point,this.typeIdField=\"\",this.types=null,this.spatialReference=new S({wkid:4326});this.fields=[];const a=new b;a.field=this._nextUniqueName(e),a.tofieldname=this.objectIdField,a.workingexpr=I.create(this._parent.objectIdField,this._parent.getFieldsIndex()),a.typeofstat=\"MIN\",this._decodedStatsfield.push(a);for(const s of this._decodedGroupbyfield){const t=new x;if(s.name=this._nextUniqueName(e),t.name=s.tofieldname,t.alias=t.name,h(s.expression)){const e=this._parent.getField(p(s.expression,c.Standardised));if(!e)throw new D(A.AggregationFieldNotFound);s.name=e.name,s.singlefield=e.name,this.phsyicalgroupbyfields.push(e.name),t.type=e.type}else{t.type=this._convertToEsriFieldType(g(s.expression,this._parent.fields));const e=new x;e.name=s.name,e.alias=e.name,this.phsyicalgroupbyfields.push(s.name),this._adaptedFields.push(new i(e,s.expression)),this._candosimplegroupby=!1}this.fields.push(t)}if(this._adaptedFields.length>0)for(const i of this._parent.fields)this._adaptedFields.push(new s(i));for(let i=0;i<this._decodedStatsfield.length;i++){const t=new x;let s=null;const n=this._decodedStatsfield[i];n.field=this._nextUniqueName(e),n.tofieldname===this.objectIdField&&(this._internalObjectIdField=n.field),t.name=n.tofieldname,t.alias=t.name;const r=null!==n.workingexpr&&h(n.workingexpr)?p(n.workingexpr,c.Standardised):\"\";switch(this._decodedStatsfield[i].typeofstat){case\"SUM\":if(\"\"!==r){if(s=this._parent.getField(r),!s)throw new D(A.AggregationFieldNotFound);t.type=s.type}else t.type=\"double\";break;case\"MIN\":case\"MAX\":if(\"\"!==r){if(s=this._parent.getField(r),!s)throw new D(A.AggregationFieldNotFound);t.type=s.type}else t.type=\"double\";break;case\"COUNT\":t.type=\"integer\";break;case\"STDDEV\":case\"VAR\":case\"AVG\":if(\"\"!==r&&(s=this._parent.getField(r),!s))throw new D(A.AggregationFieldNotFound);t.type=\"double\"}this.fields.push(t)}}async _canDoAggregates(){return!1}async _getFeatures(e,t,i,s){-1!==t&&this._featureCache[t];const n=this._maxQuery;return!0===this._checkIfNeedToExpandKnownPage(e,n)?(await this._expandPagedSet(e,n,0,0,s),this._getFeatures(e,t,i,s)):\"success\"}async _getFilteredSet(e,t,i,s,l){if(\"\"!==e)return new o([],[],!0,null);let u=null;const f={ordered:!1,nowhereclause:!1};if(await this._ensureLoaded(),null!==i)for(let n=0;n<this._decodedStatsfield.length;n++)if(!0===_(i,this._decodedStatsfield[n].tofieldname)){f.nowhereclause=!0,i=null;break}if(null!==s){f.ordered=!0;for(let e=0;e<this._decodedStatsfield.length;e++)if(!0===s.scanForField(this._decodedStatsfield[e].tofieldname)){s=null,f.ordered=!1;break}if(null!==s)for(const e of this._decodedGroupbyfield)if(null===e.singlefield&&!0===s.scanForField(e.tofieldname)){s=null,f.ordered=!1;break}}if(!1!==this._candosimplegroupby&&await this._parent._canDoAggregates(this.phsyicalgroupbyfields,this._decodedStatsfield,\"\",null,null)){let e=null;i&&(e=this._reformulateWhereClauseWithoutGroupByFields(i));let t=null;s&&(t=this._reformulateOrderClauseWithoutGroupByFields(s));const n=await this._parent._getAggregatePagesDataSourceDefinition(this.phsyicalgroupbyfields,this._decodedStatsfield,\"\",null,e,t,this._internalObjectIdField);return this._checkCancelled(l),u=!0===f.nowhereclause?new o(n._candidates.slice(0).concat(n._known.slice(0)),[],!0===f.ordered&&n._ordered,this._clonePageDefinition(n.pagesDefinition)):new o(n._candidates.slice(0),n._known.slice(0),!0===f.ordered&&n._ordered,this._clonePageDefinition(n.pagesDefinition)),u}let c=this._parent;if(this._adaptedFields.length>0&&(c=new n({parentfeatureset:this._parent,adaptedFields:this._adaptedFields,extraFilter:null})),!0===f.nowhereclause)u=new o([\"GETPAGES\"],[],!1,{aggregatefeaturesetpagedefinition:!0,resultOffset:0,resultRecordCount:this._maxQuery,internal:{fullyResolved:!1,workingItem:null,type:\"manual\",iterator:null,set:[],subfeatureset:new a({parentfeatureset:c,orderbyclause:new d(this.phsyicalgroupbyfields.join(\",\")+\",\"+this._parent.objectIdField+\" ASC\")})}});else{let e=c;if(null!==i){let t=null;i&&(t=this._reformulateWhereClauseWithoutGroupByFields(i)),e=new r({parentfeatureset:e,whereclause:t})}u=new o([\"GETPAGES\"],[],!1,{aggregatefeaturesetpagedefinition:!0,resultOffset:0,resultRecordCount:this._maxQuery,internal:{fullyResolved:!1,workingItem:null,type:\"manual\",iterator:null,set:[],subfeatureset:new a({parentfeatureset:e,orderbyclause:new d(this.phsyicalgroupbyfields.join(\",\")+\",\"+this._parent.objectIdField+\" ASC\")})}})}return u}_reformulateWhereClauseWithoutStatsFields(e){for(const t of this._decodedStatsfield)e=m(e,t.tofieldname,p(t.workingexpr,c.Standardised),this._parent.getFieldsIndex());return e}_reformulateWhereClauseWithoutGroupByFields(e){for(const t of this._decodedGroupbyfield)t.tofieldname!==t.name&&(e=m(e,t.tofieldname,p(t.expression,c.Standardised),this._parent.getFieldsIndex()));return e}_reformulateOrderClauseWithoutGroupByFields(e){const t=[];for(const i of this._decodedGroupbyfield)i.tofieldname!==i.name&&t.push({field:i.tofieldname,newfield:i.name});return t.length>0?e.replaceFields(t):e}_clonePageDefinition(e){return null===e?null:!0===e.aggregatefeaturesetpagedefinition?{aggregatefeaturesetpagedefinition:!0,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,internal:e.internal}:this._parent._clonePageDefinition(e)}async _refineSetBlock(e,t,i){if(!0===this._checkIfNeedToExpandCandidatePage(e,this._maxQuery))return await this._expandPagedSet(e,this._maxQuery,0,0,i),this._refineSetBlock(e,t,i);this._checkCancelled(i);const s=e._candidates.length;this._refineKnowns(e,t);e._candidates.length;return e._candidates.length,e}_expandPagedSet(e,t,i,s,n){return this._expandPagedSetFeatureSet(e,t,i,s,n)}async _getPhysicalPage(t,i,s){if(!0===t.pagesDefinition.aggregatefeaturesetpagedefinition)return this._sequentialGetPhysicalItem(t,t.pagesDefinition.resultRecordCount,s,[]);const n=await this._getAgregagtePhysicalPage(t,i,s);for(const r of n){const t={geometry:r.geometry,attributes:{}};for(const e of this._decodedGroupbyfield)t.attributes[e.tofieldname]=r.attributes[e.name];for(const e of this._decodedStatsfield)t.attributes[e.tofieldname]=r.attributes[e.field];this._featureCache[t.attributes[this.objectIdField]]=new e(t)}return n.length}_sequentialGetPhysicalItem(e,t,i,s){return new Promise(((n,r)=>{null===e.pagesDefinition.internal.iterator&&(e.pagesDefinition.internal.iterator=e.pagesDefinition.internal.subfeatureset.iterator(i)),!0===e.pagesDefinition.internal.fullyResolved||0===t?n(s.length):this._nextAggregateItem(e,t,i,s,(r=>{null===r?n(s.length):(t-=1,n(this._sequentialGetPhysicalItem(e,t,i,s)))}),r)}))}_nextAggregateItem(e,i,s,n,r,a){try{t(e.pagesDefinition.internal.iterator.next()).then((t=>{if(null===t)if(null!==e.pagesDefinition.internal.workingItem){const t=this._calculateAndAppendAggregateItem(e.pagesDefinition.internal.workingItem);n.push(t),e.pagesDefinition.internal.workingItem=null,e.pagesDefinition.internal.set.push(t.attributes[this.objectIdField]),e.pagesDefinition.internal.fullyResolved=!0,r(null)}else e.pagesDefinition.internal.fullyResolved=!0,r(null);else{const l=this._generateAggregateHash(t);if(null===e.pagesDefinition.internal.workingItem)e.pagesDefinition.internal.workingItem={features:[t],id:l};else{if(l!==e.pagesDefinition.internal.workingItem.id){const s=this._calculateAndAppendAggregateItem(e.pagesDefinition.internal.workingItem);return n.push(s),e.pagesDefinition.internal.workingItem=null,e.pagesDefinition.internal.set.push(s.attributes[this.objectIdField]),i-=1,e.pagesDefinition.internal.workingItem={features:[t],id:l},void r(s)}e.pagesDefinition.internal.workingItem.features.push(t)}this._nextAggregateItem(e,i,s,n,r,a)}}),a)}catch(l){a(l)}}_calculateFieldStat(e,t,i){const s=[];for(let n=0;n<e.features.length;n++)if(null!==t.workingexpr){const i=t.workingexpr.calculateValue(e.features[n]);null!==i&&s.push(i)}else s.push(null);switch(t.typeofstat){case\"MIN\":i.attributes[t.tofieldname]=y(\"min\",s,-1);break;case\"MAX\":i.attributes[t.tofieldname]=y(\"max\",s,-1);break;case\"SUM\":i.attributes[t.tofieldname]=y(\"sum\",s,-1);break;case\"COUNT\":i.attributes[t.tofieldname]=s.length;break;case\"VAR\":i.attributes[t.tofieldname]=y(\"var\",s,-1);break;case\"STDDEV\":i.attributes[t.tofieldname]=y(\"stddev\",s,-1);break;case\"AVG\":i.attributes[t.tofieldname]=y(\"avg\",s,-1)}return!0}_calculateAndAppendAggregateItem(t){const i={attributes:{},geometry:null};for(const e of this._decodedGroupbyfield){const s=e.singlefield?t.features[0].attributes[e.singlefield]:e.expression.calculateValue(t.features[0]);i.attributes[e.tofieldname]=s}for(const e of this._decodedStatsfield)this._calculateFieldStat(t,e,i);const s=[];for(let e=0;e<this._decodedStatsfield.length;e++)s.push(this._calculateFieldStat(t,this._decodedStatsfield[e],i));return this._featureCache[i.attributes[this.objectIdField]]=new e({attributes:i.attributes,geometry:i.geometry}),i}_generateAggregateHash(e){let t=\"\";for(const i of this._decodedGroupbyfield){const s=i.singlefield?e.attributes[i.singlefield]:i.expression.calculateValue(e);t+=null==s?\":\":\":\"+s.toString()}return w(t,F.String)}async _stat(){return{calculated:!1}}async getFeatureByObjectId(){return null}static registerAction(){l._featuresetFunctions.groupby=function(e,t){return new C({parentfeatureset:this,groupbyfields:e,statsfields:t})}}}export{C as default};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}