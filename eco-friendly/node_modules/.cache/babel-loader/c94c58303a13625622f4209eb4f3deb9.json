{"ast":null,"code":"import \"core-js/modules/es.typed-array.at.js\";\nimport \"core-js/modules/es.typed-array.set.js\";\nimport \"core-js/modules/esnext.typed-array.find-last.js\";\nimport \"core-js/modules/esnext.typed-array.find-last-index.js\";\n\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport e from \"../request.js\";\nimport t from \"../core/has.js\";\nimport r from \"../core/Logger.js\";\nimport { isSome as s, removeMaybe as i } from \"../core/maybe.js\";\nimport { isAbortError as a } from \"../core/promiseUtils.js\";\nimport { watch as n } from \"../core/reactiveUtils.js\";\nimport { renderSRFromViewSR as o } from \"../geometry/support/coordinateSystem.js\";\nimport { PointIndex as l, PlaneIndex as h } from \"../geometry/support/frustum.js\";\nimport { WasmCullMode as _, VoxelRequestType as d, UpdateFlags as u } from \"../libs/vxl/enums.js\";\nimport { loadVoxelWASM as c } from \"../libs/vxl/VxlModule.js\";\nimport { ViewingMode as m } from \"../views/ViewingMode.js\";\nimport { Frustum as g } from \"../views/3d/state/Frustum.js\";\nimport { RenderCoordsHelper as x } from \"../views/3d/support/RenderCoordsHelper.js\";\nimport { RenderPass as f } from \"../views/3d/webgl-engine/lib/RenderPass.js\";\nimport { RenderSlot as p } from \"../views/3d/webgl-engine/lib/RenderSlot.js\";\nimport { ContextType as v } from \"../views/webgl/context-util.js\";\nimport { CompareFunction as y, Face as b, StencilOperation as T } from \"../views/webgl/enums.js\";\nconst w = r.getLogger(\"esri.layers.VoxelWasmPerSceneView\");\nvar R;\n!function (e) {\n  e[e.Lifetime = 1] = \"Lifetime\", e[e.RequestResponse = 2] = \"RequestResponse\", e[e.Rendering = 3] = \"Rendering\", e[e.Error = 4] = \"Error\";\n}(R || (R = {}));\n\nclass E {\n  constructor(e) {\n    this._halfIntTexturesAvailable = !1, this._textureFloatLinearAvailable = !1, this._havePreparedWithAllLayers = !1, this._renderPluginContext = null, this._vxl = null, this._pluginIsActive = !1, this._moreToLoad = !1, this._viewportWidth = -1, this._viewportHeight = -1, this._newLayers = [], this._layers = new Map(), this._renderPass = f.MATERIAL, this._renderSlot = p.VOXEL, this._rctx = null, this._renderTargetToRestore = null, this._lastFrameWasStationary = !1, this._wasmMemBlockSizes = [512, 1024, 2048, 4096, 8192, 16384, 32768, 65536], this._wasmMemBlocks = new Map(), this._dbgFlags = new Set(), this._captureFrustum = !1, this._frustum = null, this._frustumRenderableId = -1, this._renderCoordsHelper = null, this._view = e, this._initialize();\n  }\n\n  get canRender() {\n    return !!this._vxl && \"local\" === this._view.viewingMode;\n  }\n\n  _dbg(e, t) {\n    this._dbgFlags.has(e) && (e === R.Error ? w.error(t) : w.warn(t));\n  }\n\n  _removeRenderPlugin() {\n    this._pluginIsActive && this._view._stage && (this._dbg(R.Lifetime, \"--removeRenderPlugin--\"), this._view._stage.removeRenderPlugin(this)), this._pluginIsActive = !1;\n  }\n\n  _initialize() {\n    this._dbg(R.Lifetime, \"--initialize--\");\n\n    for (const e of this._wasmMemBlockSizes) this._wasmMemBlocks.set(e, 0);\n\n    this._readyWatchHandle = n(() => this._view.ready, e => {\n      e && \"local\" === this._view.viewingMode ? (this._dbg(R.Lifetime, \"view ready status changed to ready on a local view, calling addRenderPlugin\"), this._view._stage.addRenderPlugin([this._renderSlot], this), this._pluginIsActive = !0) : (this._dbg(R.Lifetime, \"view ready status changed, not ready or not a local view!\"), this._removeRenderPlugin());\n    }, {\n      initial: !0\n    }), this._qualityWatchHandle = n(() => this._view?.qualityProfile, e => {\n      this._dbg(R.Rendering, \"qualityProfile changed to \" + e), this._vxl && this._vxl.set_quality(this._toWasmQuality(e));\n    }, {\n      initial: !0\n    }), this._timeExtentWatchHandle = n(() => this._view?.timeExtent, () => {\n      if (this._vxl) {\n        const e = this._getTimeArgs(this._view?.timeExtent);\n\n        this._dbg(R.Rendering, \"sceneView timeExtent changed to useTime=\" + e.useTime + \" st=\" + e.startTime + \" et=\" + e.endTime), this._vxl.set_scene_time_extent(e.startTime, e.endTime, e.useTime), this._renderPluginContext.requestRender();\n      }\n    }, {\n      initial: !0\n    }), this._stationaryWatchHandle = n(() => this._view?.stationary, e => {\n      this._vxl && e && !this._lastFrameWasStationary && this._renderPluginContext.requestRender();\n    });\n  }\n\n  initializeRenderContext(e) {\n    this._dbg(R.Lifetime, \"--initializeRenderContext--\");\n\n    const t = e.renderContext.rctx;\n    t.type === v.WEBGL2 ? (this._renderPluginContext = e, this._rctx = e.renderContext.rctx, this._halfIntTexturesAvailable = !!this._rctx.capabilities.textureNorm16, this._textureFloatLinearAvailable = this._rctx.capabilities.textureFloatLinear, this._initializeWasm(t.gl)) : this._dbg(R.Error, \"WebGL 1 context only!\");\n  }\n\n  uninitializeRenderContext() {\n    this._renderPluginContext = null, this._rctx = null, this._dbg(R.Lifetime, \"--uninitializeRenderContext--\");\n  }\n\n  _restoreFramebuffer() {\n    if (!this._renderTargetToRestore) return;\n    const e = this._renderTargetToRestore.fbo;\n    if (!!!this._rctx) return void this._dbg(R.Error, \"no context in restoreFramebuffer!\");\n\n    this._rctx.bindFramebuffer(e, !0);\n\n    const t = this._renderTargetToRestore.viewport;\n\n    this._rctx.setViewport(t.x, t.y, t.width, t.height);\n  }\n\n  _bindPreviousDepthToSlot(e, t) {\n    const r = !!this._rctx,\n          s = !!this._renderTargetToRestore;\n    if (!r || !s) return 0;\n    const i = this._renderTargetToRestore.fbo.depthStencilTexture;\n    return i ? (0 === t ? this._rctx.bindTexture(null, e, !0) : this._rctx.bindTexture(i, e, !0), 1) : (this._dbg(R.Error, \"no depth/stencil texture exists!\"), 0);\n  }\n\n  _modifyResourceCount(e, t, r) {\n    if (!this._rctx) return void this._dbg(R.Error, \"modifyAllocation callback has no rendering context!\");\n    const s = e;\n    1 === r ? this._rctx.instanceCounter.increment(s, t) : this._rctx.instanceCounter.decrement(s, t);\n  }\n\n  _setBlendState(e, t, r, s) {\n    this._rctx ? (this._rctx.setBlendingEnabled(1 === e), this._rctx.setBlendFunction(t, r), this._rctx.setBlendEquation(s)) : this._dbg(R.Error, \"setBlendState callback has no rendering context!\");\n  }\n\n  _setFrontFace(e) {\n    this._rctx ? this._rctx.setFrontFace(e) : this._dbg(R.Error, \"setFrontFace callback has no rendering context!\");\n  }\n\n  _setDepthStencilStateFunction(e, t, r) {\n    this._rctx ? (this._rctx.setDepthFunction(r), this._rctx.setDepthTestEnabled(1 === e), this._rctx.setDepthWriteEnabled(1 === t), this._rctx.setStencilTestEnabled(!1), this._rctx.setStencilFunction(y.ALWAYS, 0, 255), this._rctx.setStencilOpSeparate(b.FRONT, T.KEEP, T.INCR, T.KEEP), this._rctx.setStencilOpSeparate(b.BACK, T.KEEP, T.DECR, T.KEEP)) : this._dbg(R.Error, \"setDepthStencilStateFunction callback has no rendering context!\");\n  }\n\n  _setRasterizerState(e) {\n    if (this._rctx) switch (e) {\n      case _.None:\n        this._rctx.setFaceCullingEnabled(!1);\n\n        break;\n\n      case _.Back:\n        this._rctx.setCullFace(b.BACK), this._rctx.setFaceCullingEnabled(!0);\n        break;\n\n      case _.Front:\n        this._rctx.setCullFace(b.FRONT), this._rctx.setFaceCullingEnabled(!0);\n    } else this._dbg(R.Error, \"setRasterizerState callback has no rendering context!\");\n  }\n\n  _setViewport(e, t, r, s) {\n    this._rctx ? this._rctx.setViewport(e, t, r, s) : this._dbg(R.Error, \"setViewport callback has no rendering context!\");\n  }\n\n  _updateMemoryUsage() {\n    this._layers.forEach((e, t) => {\n      if (e.needMemoryUsageUpdate) {\n        const r = this._vxl.estimate_memory_usage(t);\n\n        r >= 0 && (e.needMemoryUsageUpdate = !1, e.layerView.setUsedMemory(r));\n      }\n    });\n  }\n\n  _syncRequestsResponses() {\n    this._layers.forEach((t, r) => {\n      const s = [];\n      t.responses.forEach((e, i) => {\n        s.push(i), this._dbg(R.RequestResponse, \"responding for requestID:\" + i + \" size:\" + e.size), this._vxl.respond(r, i, e), e.requestType !== d.TreeIndex && e.requestType !== d.Section || (t.needMemoryUsageUpdate = !0);\n      });\n      const i = t.responses;\n\n      for (const e of s) i.delete(e);\n\n      const n = this._vxl.get_new_requests(r),\n            o = t.abortController.signal;\n\n      for (const l in n) {\n        t.outstandingRequestCount += 1, 1 === t.outstandingRequestCount && t.layerView.updatingFlagChanged();\n        const r = n[l],\n              s = {\n          responseType: \"array-buffer\",\n          signal: o\n        };\n        this._dbg(R.RequestResponse, \"making requestID:\" + l + \" url:\" + r.url), e(r.url, s).then(e => {\n          t.outstandingRequestCount -= 1, 0 === t.outstandingRequestCount && t.layerView.updatingFlagChanged(), this._dbg(R.RequestResponse, \"have response for requestID:\" + l);\n          let s = 0;\n\n          if (e.data.byteLength > 0) {\n            s = this._vxl._malloc(e.data.byteLength);\n            const t = new Uint8Array(this._vxl.HEAPU8.buffer, s, e.data.byteLength),\n                  r = new Uint8Array(e.data);\n\n            for (let s = 0; s < e.data.byteLength; ++s) t[s] = r[s];\n          }\n\n          i.set(+l, {\n            responseType: r.responseType,\n            ptr: s,\n            size: e.data.byteLength,\n            success: !0,\n            requestType: r.requestType\n          });\n        }).catch(e => {\n          t.outstandingRequestCount -= 1, 0 === t.outstandingRequestCount && t.layerView.updatingFlagChanged(), a(e) || (this._dbg(R.Error, `requestID:${l} failed, error=${e.toString()}`), i.set(+l, {\n            responseType: r.responseType,\n            ptr: 0,\n            size: 0,\n            success: !1,\n            requestType: r.requestType\n          }));\n        });\n      }\n    });\n  }\n\n  updateWasmCamera(e) {\n    this._vxl.set_projection_matrix.apply(this._vxl, e.projectionMatrix), this._vxl.set_view_matrix.apply(this._vxl, e.viewMatrix), this._vxl.set_near_far(e.near, e.far);\n  }\n\n  isUpdating(e) {\n    return !(this._vxl || !this._vxlPromise) || !!this._layers.has(e) && this._layers.get(e).outstandingRequestCount > 0;\n  }\n\n  setEnabled(e, t) {\n    this._layers.forEach((r, s) => {\n      r.layerView.wasmLayerId === e.wasmLayerId && (this._vxl.set_enabled(s, t), r.needMemoryUsageUpdate = !0, this._renderPluginContext.requestRender());\n    });\n  }\n\n  setSlices(e, t) {\n    const r = {\n      mask: u.Slices,\n      slices: {\n        planes: t,\n        currentEditPlane: -1\n      }\n    };\n    return this._doMaskedUIUpdate(e, r, !0);\n  }\n\n  setDynamicSections(e, t) {\n    const r = {\n      mask: u.DynamicSections,\n      dynamicSections: {\n        planes: t,\n        currentEditPlane: -1\n      }\n    };\n    return this._doMaskedUIUpdate(e, r, !0);\n  }\n\n  setStaticSections(e, t) {\n    const r = {\n      mask: u.StaticSections,\n      staticSections: t\n    };\n    return this._doMaskedUIUpdate(e, r, !0);\n  }\n\n  setCurrentVariable(e, t) {\n    const r = {\n      mask: u.CurrentVariable,\n      currentVariable: t\n    };\n    return this._doMaskedUIUpdate(e, r, !0);\n  }\n\n  setRenderMode(e, t) {\n    const r = {\n      mask: u.RenderMode,\n      renderMode: t\n    };\n    return this._doMaskedUIUpdate(e, r, !0);\n  }\n\n  setVerticalExaggerationAndOffset(e, t, r, s) {\n    const i = {\n      mask: u.ExaggerationAndOffset,\n      volStyleDesc: {\n        volumeId: t,\n        verticalExaggeration: r,\n        verticalOffset: s\n      }\n    };\n    return this._doMaskedUIUpdate(e, i, !0);\n  }\n\n  _doMaskedUIUpdate(e, t, r) {\n    if (!this._vxl) return !1;\n    let s = !1;\n    return this._layers.forEach((r, i) => {\n      if (r.layerView.wasmLayerId === e.wasmLayerId) {\n        const e = {\n          str: JSON.stringify(t),\n          byteCount: 0,\n          ptr: 0,\n          isReusable: !1\n        };\n        this._allocateBlock(e) && (s = 1 === this._vxl.handle_masked_ui_update(i, e.ptr, e.byteCount), e.isReusable || this._vxl._free(e.ptr));\n      }\n    }), s && r && this._renderPluginContext.requestRender(), s;\n  }\n\n  _addTriangleToWasmBuffer(e, t, r, s, i) {\n    return e[3 * t + 0] = r[0], e[3 * t + 1] = r[1], e[3 * t + 2] = r[2], e[3 * (t += 1) + 0] = s[0], e[3 * t + 1] = s[1], e[3 * t + 2] = s[2], e[3 * (t += 1) + 0] = i[0], e[3 * t + 1] = i[1], e[3 * t + 2] = i[2], t += 1;\n  }\n\n  _addNormalToWasmBuffer(e, t, r) {\n    return e[3 * t + 0] = r[0], e[3 * t + 1] = r[1], e[3 * t + 2] = r[2], t += 1;\n  }\n\n  _doCaptureFrustum() {\n    if (!this._vxl) return;\n\n    const e = 36,\n          t = e / 3,\n          r = this._vxl._malloc(3 * e * Float32Array.BYTES_PER_ELEMENT),\n          s = new Float32Array(this._vxl.HEAPF32.buffer, r, 3 * e),\n          i = this._vxl._malloc(3 * t * Float32Array.BYTES_PER_ELEMENT),\n          a = new Float32Array(this._vxl.HEAPF32.buffer, i, e),\n          n = this._frustum.points[l.NEAR_BOTTOM_LEFT],\n          o = this._frustum.points[l.NEAR_BOTTOM_RIGHT],\n          _ = this._frustum.points[l.NEAR_TOP_RIGHT],\n          d = this._frustum.points[l.NEAR_TOP_LEFT],\n          u = this._frustum.points[l.FAR_BOTTOM_LEFT],\n          c = this._frustum.points[l.FAR_BOTTOM_RIGHT],\n          m = this._frustum.points[l.FAR_TOP_RIGHT],\n          g = this._frustum.points[l.FAR_TOP_LEFT];\n\n    let x = 0,\n        f = 0;\n    const p = this._frustum.planes[h.NEAR];\n    x = this._addTriangleToWasmBuffer(s, x, _, o, n), f = this._addNormalToWasmBuffer(a, f, p), x = this._addTriangleToWasmBuffer(s, x, n, d, _), f = this._addNormalToWasmBuffer(a, f, p);\n    const v = this._frustum.planes[h.FAR];\n    x = this._addTriangleToWasmBuffer(s, x, u, c, m), f = this._addNormalToWasmBuffer(a, f, v), x = this._addTriangleToWasmBuffer(s, x, m, g, u), f = this._addNormalToWasmBuffer(a, f, v);\n    const y = this._frustum.planes[h.TOP];\n    x = this._addTriangleToWasmBuffer(s, x, m, _, d), f = this._addNormalToWasmBuffer(a, f, y), x = this._addTriangleToWasmBuffer(s, x, d, g, m), f = this._addNormalToWasmBuffer(a, f, y);\n    const b = this._frustum.planes[h.BOTTOM];\n    x = this._addTriangleToWasmBuffer(s, x, n, o, c), f = this._addNormalToWasmBuffer(a, f, b), x = this._addTriangleToWasmBuffer(s, x, c, u, n), f = this._addNormalToWasmBuffer(a, f, b);\n    const T = this._frustum.planes[h.LEFT];\n    x = this._addTriangleToWasmBuffer(s, x, d, n, u), f = this._addNormalToWasmBuffer(a, f, T), x = this._addTriangleToWasmBuffer(s, x, u, g, d), f = this._addNormalToWasmBuffer(a, f, T);\n    const w = this._frustum.planes[h.RIGHT];\n    x = this._addTriangleToWasmBuffer(s, x, _, m, c), f = this._addNormalToWasmBuffer(a, f, w), x = this._addTriangleToWasmBuffer(s, x, c, o, _), f = this._addNormalToWasmBuffer(a, f, w), -1 !== this._frustumRenderableId && this._vxl.remove_generic_mesh(this._frustumRenderableId), this._frustumRenderableId = this._vxl.add_generic_mesh(r, 3 * e, i, e, 255, 0, 0, 64), this._vxl._free(r), this._vxl._free(i), this._captureFrustum = !1, this._renderPluginContext.requestRender();\n  }\n\n  captureFrustum() {\n    null === this._renderCoordsHelper && (this._renderCoordsHelper = x.create(m.Local, o(!1, this._view.spatialReference))), null === this._frustum && (this._frustum = new g(this._renderCoordsHelper)), this._captureFrustum = !0, null !== this._renderPluginContext && this._renderPluginContext.requestRender();\n  }\n\n  toggleFullVolumeExtentDraw(e) {\n    this._vxl && this._layers.forEach((t, r) => {\n      t.layerView.wasmLayerId === e.wasmLayerId && (this._vxl.toggle_full_volume_extent_draw(r), this._renderPluginContext.requestRender());\n    });\n  }\n\n  addVoxelLayer(e) {\n    if (!this._vxl) {\n      const t = {\n        layerView: e,\n        resolveCallback: null,\n        rejectCallback: null\n      },\n            r = new Promise((e, r) => {\n        t.resolveCallback = e, t.rejectCallback = r;\n      });\n      return this._newLayers.push(t), r;\n    }\n\n    const t = this._addVoxelLayer(e);\n\n    return t < 0 ? Promise.reject(-1) : Promise.resolve(t);\n  }\n\n  removeVoxelLayer(e) {\n    if (!this._vxl) {\n      const t = this._newLayers.findIndex(t => e.uid === t.layerView.uid);\n\n      t >= 0 && (this._newLayers[t].resolveCallback(-1), this._newLayers.splice(t, 1));\n      const r = this._newLayers.length;\n      return 0 === r && (this._dbg(R.Lifetime, \" no voxel layers left after removing a layer, removing RenderPlugin and destroying\"), this.destroy()), r;\n    }\n\n    let t = -1;\n    this._layers.forEach((r, s) => {\n      r.layerView.wasmLayerId === e.wasmLayerId && (t = s, r.abortController.abort(), this._vxl.remove_layer(t));\n    }), t >= 0 && this._layers.delete(t);\n    const r = this._layers.size;\n    return 0 === r && (this._dbg(R.Lifetime, \" no voxel layers left after removing a layer, removing RenderPlugin and destroying\"), this.destroy()), r;\n  }\n\n  _getBlockSize(e) {\n    for (const t of this._wasmMemBlockSizes) if (e < t) return t;\n\n    return -1;\n  }\n\n  _allocateBlock(e) {\n    e.byteCount = this._vxl.lengthBytesUTF8(e.str) + 1;\n\n    const t = this._getBlockSize(e.byteCount);\n\n    return t < 0 ? (e.isReusable = !1, e.ptr = this._vxl._malloc(e.byteCount)) : (e.isReusable = !0, e.ptr = this._wasmMemBlocks.get(t), 0 === e.ptr && (e.ptr = this._vxl._malloc(t), this._wasmMemBlocks.set(t, e.ptr))), 0 !== e.ptr && (this._vxl.stringToUTF8(e.str, e.ptr, e.byteCount), !0);\n  }\n\n  _getTimeArgs(e) {\n    let t = -Number.MAX_VALUE,\n        r = Number.MAX_VALUE,\n        i = !1;\n    return s(e) && (e.isAllTime ? i = !0 : (s(e.start) && (i = !0, t = e.start.getTime() / 1e3), s(e.end) && (i = !0, r = e.end.getTime() / 1e3))), {\n      startTime: t,\n      endTime: r,\n      useTime: i\n    };\n  }\n\n  _addVoxelLayer(e) {\n    const r = e.layer;\n    let s = -1;\n    const i = r.getConfiguration();\n    if (i.length < 1) return -1;\n    const a = {\n      str: i,\n      byteCount: 0,\n      ptr: 0,\n      isReusable: !1\n    };\n    if (!this._allocateBlock(a)) return -1;\n\n    const n = this._getTimeArgs(this._view?.timeExtent),\n          o = this._view.spatialReference.isWGS84 && r.spatialReference.isWGS84 ? 111319.49079327357 : 1;\n\n    if (s = this._vxl.add_layer(r.serviceRoot, a.ptr, a.byteCount, o, o, n.startTime, n.endTime, n.useTime, this._toWasmQuality(this._view.qualityProfile)), a.isReusable || this._vxl._free(a.ptr), s >= 0) {\n      const r = new AbortController();\n\n      if (this._layers.set(s, {\n        layerView: e,\n        responses: new Map(),\n        outstandingRequestCount: 0,\n        abortController: r,\n        needMemoryUsageUpdate: !1\n      }), !this._halfIntTexturesAvailable || t(\"mac\")) {\n        const t = [];\n        let r = \"\";\n\n        for (const s of e.layer.variables) \"Int16\" !== s.renderingFormat.type && \"UInt16\" !== s.renderingFormat.type || (t.push(s.name), s.id === e.layer.currentVariableId && (r = s.name));\n\n        \"\" !== r && w.error(\"#addVoxelLayer_error()\", e.layer, `The voxel layer '${e.layer.title}' cannot render the current variable '${r}' in this browser`), t.length > 0 && w.warn(\"#addVoxelLayer_warning()\", e.layer, `The voxel layer '${e.layer.title}' cannot render the variables '${t.toString()}' in this browser`);\n      }\n\n      if (!this._textureFloatLinearAvailable) {\n        const t = [];\n        let r = \"\";\n\n        for (const s of e.layer.variables) \"Float32\" === s.renderingFormat.type && (t.push(s.name), s.id === e.layer.currentVariableId && (r = s.name));\n\n        \"\" !== r && w.error(\"#addVoxelLayer_error()\", e.layer, `The voxel layer '${e.layer.title}' cannot render the current variable '${r}' in this browser`), t.length > 0 && w.warn(\"#addVoxelLayer_warning()\", e.layer, `The voxel layer '${e.layer.title}' cannot render the variables '${t.toString()}' in this browser`);\n      }\n\n      return t(\"esri-mobile\") && w.warnOnce(\"Mobile support differs across devices. Voxel layer might not display as expected.\"), s;\n    }\n\n    return -1;\n  }\n\n  prepareRender(e) {\n    if (!this._vxl) return;\n    const t = e.bindParameters.camera.viewForward,\n          r = e.bindParameters.camera.eye;\n\n    this._vxl.update_camera_pos_and_direction(r[0], r[1], r[2], t[0], t[1], t[2]);\n\n    const s = this._vxl.cull();\n\n    this._dbg(R.RequestResponse, \"missingResourceCount=\" + s), this._moreToLoad = s > 0, this._havePreparedWithAllLayers = 0 === this._newLayers.length, this._updateMemoryUsage();\n  }\n\n  render(e) {\n    if (!this._vxl || e.pass !== this._renderPass || e.bindParameters.slot !== this._renderSlot) return;\n\n    for (const r of this._newLayers) {\n      const e = this._addVoxelLayer(r.layerView);\n\n      -1 === e ? r.rejectCallback(-1) : r.resolveCallback(e);\n    }\n\n    if (this._newLayers = [], 0 === this._layers.size) return void this._dbg(R.Error, \"No voxel layers but RenderPlugin instance is being asked to render!\");\n    this._renderTargetToRestore = {\n      fbo: this._rctx.getBoundFramebufferObject(),\n      viewport: this._rctx.getViewport()\n    }, this._syncRequestsResponses(), this._lastFrameWasStationary = this._view.stationary, this._rctx.setPolygonOffsetFillEnabled(!1), this._rctx.setScissorTestEnabled(!1), this._rctx.setColorMask(!0, !0, !0, !0), this._vxl.begin_color_frame(!this._view.stationary || this._moreToLoad, e.bindParameters.lighting.lightingMainDirection[0], e.bindParameters.lighting.lightingMainDirection[1], e.bindParameters.lighting.lightingMainDirection[2]);\n    const t = this._renderTargetToRestore.viewport;\n    t.width === this._viewportWidth && t.height === this._viewportHeight || (this._viewportWidth = t.width, this._viewportHeight = t.height, this._vxl.set_viewport(t.width, t.height), this._layers.forEach(e => {\n      e.needMemoryUsageUpdate = !0;\n    })), 0 === t.x && 0 === t.y || this._dbg(R.Error, \"Unsupported viewport parameters detected!\"), this.updateWasmCamera(e.bindParameters.camera), this._captureFrustum && (this._frustum.update(e.bindParameters.camera), this._doCaptureFrustum()), this._vxl.draw(), this._renderTargetToRestore.fbo = null, e.rctx.externalTextureUnitUpdate(this._vxl.get_texture_units_bound_in_frame(), this._vxl.get_active_texture_unit()), e.rctx.externalVertexArrayObjectUpdate(), e.rctx.externalVertexBufferUpdate(), this._rctx.externalProgramUpdate(), (this._moreToLoad || !this._havePreparedWithAllLayers && this._layers.size > 0) && this._renderPluginContext.requestRender();\n  }\n\n  destroy() {\n    this._dbg(R.Lifetime, \"--destroy--\"), this._removeRenderPlugin(), this._readyWatchHandle = i(this._readyWatchHandle), this._qualityWatchHandle = i(this._qualityWatchHandle), this._timeExtentWatchHandle = i(this._timeExtentWatchHandle), this._stationaryWatchHandle = i(this._stationaryWatchHandle), this._vxl && (this._layers.forEach(e => {\n      e.abortController.abort();\n    }), this._wasmMemBlocks.forEach(e => {\n      0 !== e && this._vxl._free(e);\n    }), this._vxl.uninitialize_voxel_wasm(), this._vxl = null);\n  }\n\n  _initializeWasm(e) {\n    return this._vxl ? Promise.resolve() : (this._vxlPromise || (this._vxlPromise = c(e).then(e => {\n      if (this._vxl = e, this._vxlPromise = null, this._newLayers.length <= 0) return this._dbg(R.Lifetime, \" no voxel layers left after WASM downloaded, removing RenderPlugin and destroying\"), void this.destroy();\n\n      const r = this._getTimeArgs(this._view?.timeExtent),\n            s = this._vxl.addFunction(this._restoreFramebuffer.bind(this), \"v\"),\n            i = this._vxl.addFunction(this._setBlendState.bind(this), \"viiii\"),\n            a = this._vxl.addFunction(this._setFrontFace.bind(this), \"vi\"),\n            n = this._vxl.addFunction(this._setRasterizerState.bind(this), \"vi\"),\n            o = this._vxl.addFunction(this._setDepthStencilStateFunction.bind(this), \"viii\"),\n            l = this._vxl.addFunction(this._setViewport.bind(this), \"viiii\"),\n            h = this._vxl.addFunction(this._bindPreviousDepthToSlot.bind(this), \"iii\"),\n            _ = this._vxl.addFunction(this._modifyResourceCount.bind(this), \"viii\"),\n            d = this._halfIntTexturesAvailable && !t(\"mac\"),\n            u = this._textureFloatLinearAvailable;\n\n      this._vxl.initialize_voxel_wasm(s, i, a, n, o, l, h, _, r.startTime, r.endTime, r.useTime, d, u), this._renderPluginContext && this._renderPluginContext.requestRender();\n    }).catch(() => {\n      for (const e of this._newLayers) e.rejectCallback(-2);\n\n      this._dbg(R.Error, \" WASM failed to download, removing RenderPlugin and destroying\"), this.destroy();\n    })), this._vxlPromise);\n  }\n\n  pickDepth(e, t, r) {\n    if (!this._vxl || !this._rctx || 0 === this._layers.size) return null;\n    const s = r.viewport[3] - t;\n    if (e < 0 || e > r.viewport[2] || t < 0 || t > r.viewport[3]) return this._dbg(R.Error, `pickDepth: outOfRange, screenXY=[${e}, ${s}], vp=[${r.viewport.toString()}]`), null;\n    this._renderTargetToRestore = {\n      fbo: this._rctx.getBoundFramebufferObject(),\n      viewport: this._rctx.getViewport()\n    };\n    const i = r.viewForward,\n          a = r.eye;\n    this._vxl.update_camera_pos_and_direction(a[0], a[1], a[2], i[0], i[1], i[2]), this.updateWasmCamera(r), this._vxl.begin_frame();\n\n    const n = this._vxl.pick_depth(e, s);\n\n    if (this._renderTargetToRestore.fbo = null, this._rctx.externalTextureUnitUpdate(this._vxl.get_texture_units_bound_in_frame(), this._vxl.get_active_texture_unit()), this._rctx.externalVertexArrayObjectUpdate(), this._rctx.externalVertexBufferUpdate(), this._rctx.externalProgramUpdate(), n.success) {\n      return n.distanceToCamera;\n    }\n\n    return null;\n  }\n\n  _toWasmQuality(e) {\n    switch (e) {\n      case \"low\":\n        return 0;\n\n      case \"medium\":\n        return 1;\n\n      case \"high\":\n        return 2;\n    }\n  }\n\n}\n\nexport { E as default };","map":{"version":3,"names":["e","t","r","isSome","s","removeMaybe","i","isAbortError","a","watch","n","renderSRFromViewSR","o","PointIndex","l","PlaneIndex","h","WasmCullMode","_","VoxelRequestType","d","UpdateFlags","u","loadVoxelWASM","c","ViewingMode","m","Frustum","g","RenderCoordsHelper","x","RenderPass","f","RenderSlot","p","ContextType","v","CompareFunction","y","Face","b","StencilOperation","T","w","getLogger","R","Lifetime","RequestResponse","Rendering","Error","E","constructor","_halfIntTexturesAvailable","_textureFloatLinearAvailable","_havePreparedWithAllLayers","_renderPluginContext","_vxl","_pluginIsActive","_moreToLoad","_viewportWidth","_viewportHeight","_newLayers","_layers","Map","_renderPass","MATERIAL","_renderSlot","VOXEL","_rctx","_renderTargetToRestore","_lastFrameWasStationary","_wasmMemBlockSizes","_wasmMemBlocks","_dbgFlags","Set","_captureFrustum","_frustum","_frustumRenderableId","_renderCoordsHelper","_view","_initialize","canRender","viewingMode","_dbg","has","error","warn","_removeRenderPlugin","_stage","removeRenderPlugin","set","_readyWatchHandle","ready","addRenderPlugin","initial","_qualityWatchHandle","qualityProfile","set_quality","_toWasmQuality","_timeExtentWatchHandle","timeExtent","_getTimeArgs","useTime","startTime","endTime","set_scene_time_extent","requestRender","_stationaryWatchHandle","stationary","initializeRenderContext","renderContext","rctx","type","WEBGL2","capabilities","textureNorm16","textureFloatLinear","_initializeWasm","gl","uninitializeRenderContext","_restoreFramebuffer","fbo","bindFramebuffer","viewport","setViewport","width","height","_bindPreviousDepthToSlot","depthStencilTexture","bindTexture","_modifyResourceCount","instanceCounter","increment","decrement","_setBlendState","setBlendingEnabled","setBlendFunction","setBlendEquation","_setFrontFace","setFrontFace","_setDepthStencilStateFunction","setDepthFunction","setDepthTestEnabled","setDepthWriteEnabled","setStencilTestEnabled","setStencilFunction","ALWAYS","setStencilOpSeparate","FRONT","KEEP","INCR","BACK","DECR","_setRasterizerState","None","setFaceCullingEnabled","Back","setCullFace","Front","_setViewport","_updateMemoryUsage","forEach","needMemoryUsageUpdate","estimate_memory_usage","layerView","setUsedMemory","_syncRequestsResponses","responses","push","size","respond","requestType","TreeIndex","Section","delete","get_new_requests","abortController","signal","outstandingRequestCount","updatingFlagChanged","responseType","url","then","data","byteLength","_malloc","Uint8Array","HEAPU8","buffer","ptr","success","catch","toString","updateWasmCamera","set_projection_matrix","apply","projectionMatrix","set_view_matrix","viewMatrix","set_near_far","near","far","isUpdating","_vxlPromise","get","setEnabled","wasmLayerId","set_enabled","setSlices","mask","Slices","slices","planes","currentEditPlane","_doMaskedUIUpdate","setDynamicSections","DynamicSections","dynamicSections","setStaticSections","StaticSections","staticSections","setCurrentVariable","CurrentVariable","currentVariable","setRenderMode","RenderMode","renderMode","setVerticalExaggerationAndOffset","ExaggerationAndOffset","volStyleDesc","volumeId","verticalExaggeration","verticalOffset","str","JSON","stringify","byteCount","isReusable","_allocateBlock","handle_masked_ui_update","_free","_addTriangleToWasmBuffer","_addNormalToWasmBuffer","_doCaptureFrustum","Float32Array","BYTES_PER_ELEMENT","HEAPF32","points","NEAR_BOTTOM_LEFT","NEAR_BOTTOM_RIGHT","NEAR_TOP_RIGHT","NEAR_TOP_LEFT","FAR_BOTTOM_LEFT","FAR_BOTTOM_RIGHT","FAR_TOP_RIGHT","FAR_TOP_LEFT","NEAR","FAR","TOP","BOTTOM","LEFT","RIGHT","remove_generic_mesh","add_generic_mesh","captureFrustum","create","Local","spatialReference","toggleFullVolumeExtentDraw","toggle_full_volume_extent_draw","addVoxelLayer","resolveCallback","rejectCallback","Promise","_addVoxelLayer","reject","resolve","removeVoxelLayer","findIndex","uid","splice","length","destroy","abort","remove_layer","_getBlockSize","lengthBytesUTF8","stringToUTF8","Number","MAX_VALUE","isAllTime","start","getTime","end","layer","getConfiguration","isWGS84","add_layer","serviceRoot","AbortController","variables","renderingFormat","name","id","currentVariableId","title","warnOnce","prepareRender","bindParameters","camera","viewForward","eye","update_camera_pos_and_direction","cull","render","pass","slot","getBoundFramebufferObject","getViewport","setPolygonOffsetFillEnabled","setScissorTestEnabled","setColorMask","begin_color_frame","lighting","lightingMainDirection","set_viewport","update","draw","externalTextureUnitUpdate","get_texture_units_bound_in_frame","get_active_texture_unit","externalVertexArrayObjectUpdate","externalVertexBufferUpdate","externalProgramUpdate","uninitialize_voxel_wasm","addFunction","bind","initialize_voxel_wasm","pickDepth","begin_frame","pick_depth","distanceToCamera","default"],"sources":["C:/Users/hp/Desktop/eco-friendly atmosphere/Atmosphere/eco-friendly/node_modules/@arcgis/core/layers/VoxelWasmPerSceneView.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport e from\"../request.js\";import t from\"../core/has.js\";import r from\"../core/Logger.js\";import{isSome as s,removeMaybe as i}from\"../core/maybe.js\";import{isAbortError as a}from\"../core/promiseUtils.js\";import{watch as n}from\"../core/reactiveUtils.js\";import{renderSRFromViewSR as o}from\"../geometry/support/coordinateSystem.js\";import{PointIndex as l,PlaneIndex as h}from\"../geometry/support/frustum.js\";import{WasmCullMode as _,VoxelRequestType as d,UpdateFlags as u}from\"../libs/vxl/enums.js\";import{loadVoxelWASM as c}from\"../libs/vxl/VxlModule.js\";import{ViewingMode as m}from\"../views/ViewingMode.js\";import{Frustum as g}from\"../views/3d/state/Frustum.js\";import{RenderCoordsHelper as x}from\"../views/3d/support/RenderCoordsHelper.js\";import{RenderPass as f}from\"../views/3d/webgl-engine/lib/RenderPass.js\";import{RenderSlot as p}from\"../views/3d/webgl-engine/lib/RenderSlot.js\";import{ContextType as v}from\"../views/webgl/context-util.js\";import{CompareFunction as y,Face as b,StencilOperation as T}from\"../views/webgl/enums.js\";const w=r.getLogger(\"esri.layers.VoxelWasmPerSceneView\");var R;!function(e){e[e.Lifetime=1]=\"Lifetime\",e[e.RequestResponse=2]=\"RequestResponse\",e[e.Rendering=3]=\"Rendering\",e[e.Error=4]=\"Error\"}(R||(R={}));class E{constructor(e){this._halfIntTexturesAvailable=!1,this._textureFloatLinearAvailable=!1,this._havePreparedWithAllLayers=!1,this._renderPluginContext=null,this._vxl=null,this._pluginIsActive=!1,this._moreToLoad=!1,this._viewportWidth=-1,this._viewportHeight=-1,this._newLayers=[],this._layers=new Map,this._renderPass=f.MATERIAL,this._renderSlot=p.VOXEL,this._rctx=null,this._renderTargetToRestore=null,this._lastFrameWasStationary=!1,this._wasmMemBlockSizes=[512,1024,2048,4096,8192,16384,32768,65536],this._wasmMemBlocks=new Map,this._dbgFlags=new Set,this._captureFrustum=!1,this._frustum=null,this._frustumRenderableId=-1,this._renderCoordsHelper=null,this._view=e,this._initialize()}get canRender(){return!!this._vxl&&\"local\"===this._view.viewingMode}_dbg(e,t){this._dbgFlags.has(e)&&(e===R.Error?w.error(t):w.warn(t))}_removeRenderPlugin(){this._pluginIsActive&&this._view._stage&&(this._dbg(R.Lifetime,\"--removeRenderPlugin--\"),this._view._stage.removeRenderPlugin(this)),this._pluginIsActive=!1}_initialize(){this._dbg(R.Lifetime,\"--initialize--\");for(const e of this._wasmMemBlockSizes)this._wasmMemBlocks.set(e,0);this._readyWatchHandle=n((()=>this._view.ready),(e=>{e&&\"local\"===this._view.viewingMode?(this._dbg(R.Lifetime,\"view ready status changed to ready on a local view, calling addRenderPlugin\"),this._view._stage.addRenderPlugin([this._renderSlot],this),this._pluginIsActive=!0):(this._dbg(R.Lifetime,\"view ready status changed, not ready or not a local view!\"),this._removeRenderPlugin())}),{initial:!0}),this._qualityWatchHandle=n((()=>this._view?.qualityProfile),(e=>{this._dbg(R.Rendering,\"qualityProfile changed to \"+e),this._vxl&&this._vxl.set_quality(this._toWasmQuality(e))}),{initial:!0}),this._timeExtentWatchHandle=n((()=>this._view?.timeExtent),(()=>{if(this._vxl){const e=this._getTimeArgs(this._view?.timeExtent);this._dbg(R.Rendering,\"sceneView timeExtent changed to useTime=\"+e.useTime+\" st=\"+e.startTime+\" et=\"+e.endTime),this._vxl.set_scene_time_extent(e.startTime,e.endTime,e.useTime),this._renderPluginContext.requestRender()}}),{initial:!0}),this._stationaryWatchHandle=n((()=>this._view?.stationary),(e=>{this._vxl&&e&&!this._lastFrameWasStationary&&this._renderPluginContext.requestRender()}))}initializeRenderContext(e){this._dbg(R.Lifetime,\"--initializeRenderContext--\");const t=e.renderContext.rctx;t.type===v.WEBGL2?(this._renderPluginContext=e,this._rctx=e.renderContext.rctx,this._halfIntTexturesAvailable=!!this._rctx.capabilities.textureNorm16,this._textureFloatLinearAvailable=this._rctx.capabilities.textureFloatLinear,this._initializeWasm(t.gl)):this._dbg(R.Error,\"WebGL 1 context only!\")}uninitializeRenderContext(){this._renderPluginContext=null,this._rctx=null,this._dbg(R.Lifetime,\"--uninitializeRenderContext--\")}_restoreFramebuffer(){if(!this._renderTargetToRestore)return;const e=this._renderTargetToRestore.fbo;if(!!!this._rctx)return void this._dbg(R.Error,\"no context in restoreFramebuffer!\");this._rctx.bindFramebuffer(e,!0);const t=this._renderTargetToRestore.viewport;this._rctx.setViewport(t.x,t.y,t.width,t.height)}_bindPreviousDepthToSlot(e,t){const r=!!this._rctx,s=!!this._renderTargetToRestore;if(!r||!s)return 0;const i=this._renderTargetToRestore.fbo.depthStencilTexture;return i?(0===t?this._rctx.bindTexture(null,e,!0):this._rctx.bindTexture(i,e,!0),1):(this._dbg(R.Error,\"no depth/stencil texture exists!\"),0)}_modifyResourceCount(e,t,r){if(!this._rctx)return void this._dbg(R.Error,\"modifyAllocation callback has no rendering context!\");const s=e;1===r?this._rctx.instanceCounter.increment(s,t):this._rctx.instanceCounter.decrement(s,t)}_setBlendState(e,t,r,s){this._rctx?(this._rctx.setBlendingEnabled(1===e),this._rctx.setBlendFunction(t,r),this._rctx.setBlendEquation(s)):this._dbg(R.Error,\"setBlendState callback has no rendering context!\")}_setFrontFace(e){this._rctx?this._rctx.setFrontFace(e):this._dbg(R.Error,\"setFrontFace callback has no rendering context!\")}_setDepthStencilStateFunction(e,t,r){this._rctx?(this._rctx.setDepthFunction(r),this._rctx.setDepthTestEnabled(1===e),this._rctx.setDepthWriteEnabled(1===t),this._rctx.setStencilTestEnabled(!1),this._rctx.setStencilFunction(y.ALWAYS,0,255),this._rctx.setStencilOpSeparate(b.FRONT,T.KEEP,T.INCR,T.KEEP),this._rctx.setStencilOpSeparate(b.BACK,T.KEEP,T.DECR,T.KEEP)):this._dbg(R.Error,\"setDepthStencilStateFunction callback has no rendering context!\")}_setRasterizerState(e){if(this._rctx)switch(e){case _.None:this._rctx.setFaceCullingEnabled(!1);break;case _.Back:this._rctx.setCullFace(b.BACK),this._rctx.setFaceCullingEnabled(!0);break;case _.Front:this._rctx.setCullFace(b.FRONT),this._rctx.setFaceCullingEnabled(!0)}else this._dbg(R.Error,\"setRasterizerState callback has no rendering context!\")}_setViewport(e,t,r,s){this._rctx?this._rctx.setViewport(e,t,r,s):this._dbg(R.Error,\"setViewport callback has no rendering context!\")}_updateMemoryUsage(){this._layers.forEach(((e,t)=>{if(e.needMemoryUsageUpdate){const r=this._vxl.estimate_memory_usage(t);r>=0&&(e.needMemoryUsageUpdate=!1,e.layerView.setUsedMemory(r))}}))}_syncRequestsResponses(){this._layers.forEach(((t,r)=>{const s=[];t.responses.forEach(((e,i)=>{s.push(i),this._dbg(R.RequestResponse,\"responding for requestID:\"+i+\" size:\"+e.size),this._vxl.respond(r,i,e),e.requestType!==d.TreeIndex&&e.requestType!==d.Section||(t.needMemoryUsageUpdate=!0)}));const i=t.responses;for(const e of s)i.delete(e);const n=this._vxl.get_new_requests(r),o=t.abortController.signal;for(const l in n){t.outstandingRequestCount+=1,1===t.outstandingRequestCount&&t.layerView.updatingFlagChanged();const r=n[l],s={responseType:\"array-buffer\",signal:o};this._dbg(R.RequestResponse,\"making requestID:\"+l+\" url:\"+r.url),e(r.url,s).then((e=>{t.outstandingRequestCount-=1,0===t.outstandingRequestCount&&t.layerView.updatingFlagChanged(),this._dbg(R.RequestResponse,\"have response for requestID:\"+l);let s=0;if(e.data.byteLength>0){s=this._vxl._malloc(e.data.byteLength);const t=new Uint8Array(this._vxl.HEAPU8.buffer,s,e.data.byteLength),r=new Uint8Array(e.data);for(let s=0;s<e.data.byteLength;++s)t[s]=r[s]}i.set(+l,{responseType:r.responseType,ptr:s,size:e.data.byteLength,success:!0,requestType:r.requestType})})).catch((e=>{t.outstandingRequestCount-=1,0===t.outstandingRequestCount&&t.layerView.updatingFlagChanged(),a(e)||(this._dbg(R.Error,`requestID:${l} failed, error=${e.toString()}`),i.set(+l,{responseType:r.responseType,ptr:0,size:0,success:!1,requestType:r.requestType}))}))}}))}updateWasmCamera(e){this._vxl.set_projection_matrix.apply(this._vxl,e.projectionMatrix),this._vxl.set_view_matrix.apply(this._vxl,e.viewMatrix),this._vxl.set_near_far(e.near,e.far)}isUpdating(e){return!(this._vxl||!this._vxlPromise)||!!this._layers.has(e)&&this._layers.get(e).outstandingRequestCount>0}setEnabled(e,t){this._layers.forEach(((r,s)=>{r.layerView.wasmLayerId===e.wasmLayerId&&(this._vxl.set_enabled(s,t),r.needMemoryUsageUpdate=!0,this._renderPluginContext.requestRender())}))}setSlices(e,t){const r={mask:u.Slices,slices:{planes:t,currentEditPlane:-1}};return this._doMaskedUIUpdate(e,r,!0)}setDynamicSections(e,t){const r={mask:u.DynamicSections,dynamicSections:{planes:t,currentEditPlane:-1}};return this._doMaskedUIUpdate(e,r,!0)}setStaticSections(e,t){const r={mask:u.StaticSections,staticSections:t};return this._doMaskedUIUpdate(e,r,!0)}setCurrentVariable(e,t){const r={mask:u.CurrentVariable,currentVariable:t};return this._doMaskedUIUpdate(e,r,!0)}setRenderMode(e,t){const r={mask:u.RenderMode,renderMode:t};return this._doMaskedUIUpdate(e,r,!0)}setVerticalExaggerationAndOffset(e,t,r,s){const i={mask:u.ExaggerationAndOffset,volStyleDesc:{volumeId:t,verticalExaggeration:r,verticalOffset:s}};return this._doMaskedUIUpdate(e,i,!0)}_doMaskedUIUpdate(e,t,r){if(!this._vxl)return!1;let s=!1;return this._layers.forEach(((r,i)=>{if(r.layerView.wasmLayerId===e.wasmLayerId){const e={str:JSON.stringify(t),byteCount:0,ptr:0,isReusable:!1};this._allocateBlock(e)&&(s=1===this._vxl.handle_masked_ui_update(i,e.ptr,e.byteCount),e.isReusable||this._vxl._free(e.ptr))}})),s&&r&&this._renderPluginContext.requestRender(),s}_addTriangleToWasmBuffer(e,t,r,s,i){return e[3*t+0]=r[0],e[3*t+1]=r[1],e[3*t+2]=r[2],e[3*(t+=1)+0]=s[0],e[3*t+1]=s[1],e[3*t+2]=s[2],e[3*(t+=1)+0]=i[0],e[3*t+1]=i[1],e[3*t+2]=i[2],t+=1}_addNormalToWasmBuffer(e,t,r){return e[3*t+0]=r[0],e[3*t+1]=r[1],e[3*t+2]=r[2],t+=1}_doCaptureFrustum(){if(!this._vxl)return;const e=36,t=e/3,r=this._vxl._malloc(3*e*Float32Array.BYTES_PER_ELEMENT),s=new Float32Array(this._vxl.HEAPF32.buffer,r,3*e),i=this._vxl._malloc(3*t*Float32Array.BYTES_PER_ELEMENT),a=new Float32Array(this._vxl.HEAPF32.buffer,i,e),n=this._frustum.points[l.NEAR_BOTTOM_LEFT],o=this._frustum.points[l.NEAR_BOTTOM_RIGHT],_=this._frustum.points[l.NEAR_TOP_RIGHT],d=this._frustum.points[l.NEAR_TOP_LEFT],u=this._frustum.points[l.FAR_BOTTOM_LEFT],c=this._frustum.points[l.FAR_BOTTOM_RIGHT],m=this._frustum.points[l.FAR_TOP_RIGHT],g=this._frustum.points[l.FAR_TOP_LEFT];let x=0,f=0;const p=this._frustum.planes[h.NEAR];x=this._addTriangleToWasmBuffer(s,x,_,o,n),f=this._addNormalToWasmBuffer(a,f,p),x=this._addTriangleToWasmBuffer(s,x,n,d,_),f=this._addNormalToWasmBuffer(a,f,p);const v=this._frustum.planes[h.FAR];x=this._addTriangleToWasmBuffer(s,x,u,c,m),f=this._addNormalToWasmBuffer(a,f,v),x=this._addTriangleToWasmBuffer(s,x,m,g,u),f=this._addNormalToWasmBuffer(a,f,v);const y=this._frustum.planes[h.TOP];x=this._addTriangleToWasmBuffer(s,x,m,_,d),f=this._addNormalToWasmBuffer(a,f,y),x=this._addTriangleToWasmBuffer(s,x,d,g,m),f=this._addNormalToWasmBuffer(a,f,y);const b=this._frustum.planes[h.BOTTOM];x=this._addTriangleToWasmBuffer(s,x,n,o,c),f=this._addNormalToWasmBuffer(a,f,b),x=this._addTriangleToWasmBuffer(s,x,c,u,n),f=this._addNormalToWasmBuffer(a,f,b);const T=this._frustum.planes[h.LEFT];x=this._addTriangleToWasmBuffer(s,x,d,n,u),f=this._addNormalToWasmBuffer(a,f,T),x=this._addTriangleToWasmBuffer(s,x,u,g,d),f=this._addNormalToWasmBuffer(a,f,T);const w=this._frustum.planes[h.RIGHT];x=this._addTriangleToWasmBuffer(s,x,_,m,c),f=this._addNormalToWasmBuffer(a,f,w),x=this._addTriangleToWasmBuffer(s,x,c,o,_),f=this._addNormalToWasmBuffer(a,f,w),-1!==this._frustumRenderableId&&this._vxl.remove_generic_mesh(this._frustumRenderableId),this._frustumRenderableId=this._vxl.add_generic_mesh(r,3*e,i,e,255,0,0,64),this._vxl._free(r),this._vxl._free(i),this._captureFrustum=!1,this._renderPluginContext.requestRender()}captureFrustum(){null===this._renderCoordsHelper&&(this._renderCoordsHelper=x.create(m.Local,o(!1,this._view.spatialReference))),null===this._frustum&&(this._frustum=new g(this._renderCoordsHelper)),this._captureFrustum=!0,null!==this._renderPluginContext&&this._renderPluginContext.requestRender()}toggleFullVolumeExtentDraw(e){this._vxl&&this._layers.forEach(((t,r)=>{t.layerView.wasmLayerId===e.wasmLayerId&&(this._vxl.toggle_full_volume_extent_draw(r),this._renderPluginContext.requestRender())}))}addVoxelLayer(e){if(!this._vxl){const t={layerView:e,resolveCallback:null,rejectCallback:null},r=new Promise(((e,r)=>{t.resolveCallback=e,t.rejectCallback=r}));return this._newLayers.push(t),r}const t=this._addVoxelLayer(e);return t<0?Promise.reject(-1):Promise.resolve(t)}removeVoxelLayer(e){if(!this._vxl){const t=this._newLayers.findIndex((t=>e.uid===t.layerView.uid));t>=0&&(this._newLayers[t].resolveCallback(-1),this._newLayers.splice(t,1));const r=this._newLayers.length;return 0===r&&(this._dbg(R.Lifetime,\" no voxel layers left after removing a layer, removing RenderPlugin and destroying\"),this.destroy()),r}let t=-1;this._layers.forEach(((r,s)=>{r.layerView.wasmLayerId===e.wasmLayerId&&(t=s,r.abortController.abort(),this._vxl.remove_layer(t))})),t>=0&&this._layers.delete(t);const r=this._layers.size;return 0===r&&(this._dbg(R.Lifetime,\" no voxel layers left after removing a layer, removing RenderPlugin and destroying\"),this.destroy()),r}_getBlockSize(e){for(const t of this._wasmMemBlockSizes)if(e<t)return t;return-1}_allocateBlock(e){e.byteCount=this._vxl.lengthBytesUTF8(e.str)+1;const t=this._getBlockSize(e.byteCount);return t<0?(e.isReusable=!1,e.ptr=this._vxl._malloc(e.byteCount)):(e.isReusable=!0,e.ptr=this._wasmMemBlocks.get(t),0===e.ptr&&(e.ptr=this._vxl._malloc(t),this._wasmMemBlocks.set(t,e.ptr))),0!==e.ptr&&(this._vxl.stringToUTF8(e.str,e.ptr,e.byteCount),!0)}_getTimeArgs(e){let t=-Number.MAX_VALUE,r=Number.MAX_VALUE,i=!1;return s(e)&&(e.isAllTime?i=!0:(s(e.start)&&(i=!0,t=e.start.getTime()/1e3),s(e.end)&&(i=!0,r=e.end.getTime()/1e3))),{startTime:t,endTime:r,useTime:i}}_addVoxelLayer(e){const r=e.layer;let s=-1;const i=r.getConfiguration();if(i.length<1)return-1;const a={str:i,byteCount:0,ptr:0,isReusable:!1};if(!this._allocateBlock(a))return-1;const n=this._getTimeArgs(this._view?.timeExtent),o=this._view.spatialReference.isWGS84&&r.spatialReference.isWGS84?111319.49079327357:1;if(s=this._vxl.add_layer(r.serviceRoot,a.ptr,a.byteCount,o,o,n.startTime,n.endTime,n.useTime,this._toWasmQuality(this._view.qualityProfile)),a.isReusable||this._vxl._free(a.ptr),s>=0){const r=new AbortController;if(this._layers.set(s,{layerView:e,responses:new Map,outstandingRequestCount:0,abortController:r,needMemoryUsageUpdate:!1}),!this._halfIntTexturesAvailable||t(\"mac\")){const t=[];let r=\"\";for(const s of e.layer.variables)\"Int16\"!==s.renderingFormat.type&&\"UInt16\"!==s.renderingFormat.type||(t.push(s.name),s.id===e.layer.currentVariableId&&(r=s.name));\"\"!==r&&w.error(\"#addVoxelLayer_error()\",e.layer,`The voxel layer '${e.layer.title}' cannot render the current variable '${r}' in this browser`),t.length>0&&w.warn(\"#addVoxelLayer_warning()\",e.layer,`The voxel layer '${e.layer.title}' cannot render the variables '${t.toString()}' in this browser`)}if(!this._textureFloatLinearAvailable){const t=[];let r=\"\";for(const s of e.layer.variables)\"Float32\"===s.renderingFormat.type&&(t.push(s.name),s.id===e.layer.currentVariableId&&(r=s.name));\"\"!==r&&w.error(\"#addVoxelLayer_error()\",e.layer,`The voxel layer '${e.layer.title}' cannot render the current variable '${r}' in this browser`),t.length>0&&w.warn(\"#addVoxelLayer_warning()\",e.layer,`The voxel layer '${e.layer.title}' cannot render the variables '${t.toString()}' in this browser`)}return t(\"esri-mobile\")&&w.warnOnce(\"Mobile support differs across devices. Voxel layer might not display as expected.\"),s}return-1}prepareRender(e){if(!this._vxl)return;const t=e.bindParameters.camera.viewForward,r=e.bindParameters.camera.eye;this._vxl.update_camera_pos_and_direction(r[0],r[1],r[2],t[0],t[1],t[2]);const s=this._vxl.cull();this._dbg(R.RequestResponse,\"missingResourceCount=\"+s),this._moreToLoad=s>0,this._havePreparedWithAllLayers=0===this._newLayers.length,this._updateMemoryUsage()}render(e){if(!this._vxl||e.pass!==this._renderPass||e.bindParameters.slot!==this._renderSlot)return;for(const r of this._newLayers){const e=this._addVoxelLayer(r.layerView);-1===e?r.rejectCallback(-1):r.resolveCallback(e)}if(this._newLayers=[],0===this._layers.size)return void this._dbg(R.Error,\"No voxel layers but RenderPlugin instance is being asked to render!\");this._renderTargetToRestore={fbo:this._rctx.getBoundFramebufferObject(),viewport:this._rctx.getViewport()},this._syncRequestsResponses(),this._lastFrameWasStationary=this._view.stationary,this._rctx.setPolygonOffsetFillEnabled(!1),this._rctx.setScissorTestEnabled(!1),this._rctx.setColorMask(!0,!0,!0,!0),this._vxl.begin_color_frame(!this._view.stationary||this._moreToLoad,e.bindParameters.lighting.lightingMainDirection[0],e.bindParameters.lighting.lightingMainDirection[1],e.bindParameters.lighting.lightingMainDirection[2]);const t=this._renderTargetToRestore.viewport;t.width===this._viewportWidth&&t.height===this._viewportHeight||(this._viewportWidth=t.width,this._viewportHeight=t.height,this._vxl.set_viewport(t.width,t.height),this._layers.forEach((e=>{e.needMemoryUsageUpdate=!0}))),0===t.x&&0===t.y||this._dbg(R.Error,\"Unsupported viewport parameters detected!\"),this.updateWasmCamera(e.bindParameters.camera),this._captureFrustum&&(this._frustum.update(e.bindParameters.camera),this._doCaptureFrustum()),this._vxl.draw(),this._renderTargetToRestore.fbo=null,e.rctx.externalTextureUnitUpdate(this._vxl.get_texture_units_bound_in_frame(),this._vxl.get_active_texture_unit()),e.rctx.externalVertexArrayObjectUpdate(),e.rctx.externalVertexBufferUpdate(),this._rctx.externalProgramUpdate(),(this._moreToLoad||!this._havePreparedWithAllLayers&&this._layers.size>0)&&this._renderPluginContext.requestRender()}destroy(){this._dbg(R.Lifetime,\"--destroy--\"),this._removeRenderPlugin(),this._readyWatchHandle=i(this._readyWatchHandle),this._qualityWatchHandle=i(this._qualityWatchHandle),this._timeExtentWatchHandle=i(this._timeExtentWatchHandle),this._stationaryWatchHandle=i(this._stationaryWatchHandle),this._vxl&&(this._layers.forEach((e=>{e.abortController.abort()})),this._wasmMemBlocks.forEach((e=>{0!==e&&this._vxl._free(e)})),this._vxl.uninitialize_voxel_wasm(),this._vxl=null)}_initializeWasm(e){return this._vxl?Promise.resolve():(this._vxlPromise||(this._vxlPromise=c(e).then((e=>{if(this._vxl=e,this._vxlPromise=null,this._newLayers.length<=0)return this._dbg(R.Lifetime,\" no voxel layers left after WASM downloaded, removing RenderPlugin and destroying\"),void this.destroy();const r=this._getTimeArgs(this._view?.timeExtent),s=this._vxl.addFunction(this._restoreFramebuffer.bind(this),\"v\"),i=this._vxl.addFunction(this._setBlendState.bind(this),\"viiii\"),a=this._vxl.addFunction(this._setFrontFace.bind(this),\"vi\"),n=this._vxl.addFunction(this._setRasterizerState.bind(this),\"vi\"),o=this._vxl.addFunction(this._setDepthStencilStateFunction.bind(this),\"viii\"),l=this._vxl.addFunction(this._setViewport.bind(this),\"viiii\"),h=this._vxl.addFunction(this._bindPreviousDepthToSlot.bind(this),\"iii\"),_=this._vxl.addFunction(this._modifyResourceCount.bind(this),\"viii\"),d=this._halfIntTexturesAvailable&&!t(\"mac\"),u=this._textureFloatLinearAvailable;this._vxl.initialize_voxel_wasm(s,i,a,n,o,l,h,_,r.startTime,r.endTime,r.useTime,d,u),this._renderPluginContext&&this._renderPluginContext.requestRender()})).catch((()=>{for(const e of this._newLayers)e.rejectCallback(-2);this._dbg(R.Error,\" WASM failed to download, removing RenderPlugin and destroying\"),this.destroy()}))),this._vxlPromise)}pickDepth(e,t,r){if(!this._vxl||!this._rctx||0===this._layers.size)return null;const s=r.viewport[3]-t;if(e<0||e>r.viewport[2]||t<0||t>r.viewport[3])return this._dbg(R.Error,`pickDepth: outOfRange, screenXY=[${e}, ${s}], vp=[${r.viewport.toString()}]`),null;this._renderTargetToRestore={fbo:this._rctx.getBoundFramebufferObject(),viewport:this._rctx.getViewport()};const i=r.viewForward,a=r.eye;this._vxl.update_camera_pos_and_direction(a[0],a[1],a[2],i[0],i[1],i[2]),this.updateWasmCamera(r),this._vxl.begin_frame();const n=this._vxl.pick_depth(e,s);if(this._renderTargetToRestore.fbo=null,this._rctx.externalTextureUnitUpdate(this._vxl.get_texture_units_bound_in_frame(),this._vxl.get_active_texture_unit()),this._rctx.externalVertexArrayObjectUpdate(),this._rctx.externalVertexBufferUpdate(),this._rctx.externalProgramUpdate(),n.success){return n.distanceToCamera}return null}_toWasmQuality(e){switch(e){case\"low\":return 0;case\"medium\":return 1;case\"high\":return 2}}}export{E as default};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}