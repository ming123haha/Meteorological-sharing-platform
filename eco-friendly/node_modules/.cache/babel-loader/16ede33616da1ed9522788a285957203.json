{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport e from \"../../../core/Error.js\";\nimport { isNone as t, isSome as a } from \"../../../core/maybe.js\";\nimport { throwIfAborted as i } from \"../../../core/promiseUtils.js\";\nimport { isTiledLayer as r, isBasemapSupportedLayer as n } from \"../../../layers/support/layerUtils.js\";\nimport { stringFromViewingMode as s, ViewingMode as o } from \"../../../views/ViewingMode.js\";\nimport { getTileInfoAndExtentFromWMTSLayer as l, checkIfTileInfoSupportedForView as p } from \"../../../views/3d/terrain/terrainUtils.js\";\nimport { TilingScheme as c } from \"../../../views/3d/terrain/TilingScheme.js\";\nimport { isSpatialReferenceSupported as m } from \"../../../views/support/spatialReferenceSupport.js\";\n\nasync function f(e, t = {}) {\n  await y(e, t), i(t);\n}\n\nasync function u(e, t = {}) {\n  const {\n    basemap: a,\n    view: n\n  } = e;\n  if (i(t), \"spatialReferenceLocked\" in n && !n.spatialReferenceLocked) return;\n  if (await a.load(t), i(t), 0 === a.baseLayers.length) return;\n  const s = a.baseLayers.getItemAt(0);\n  if (!r(s)) return;\n\n  if (a.spatialReference) {\n    if (n.spatialReference.equals(a.spatialReference)) return;\n    w();\n  }\n\n  await s.load(t), i(t);\n  const o = ((\"supportedSpatialReferences\" in s ? s.supportedSpatialReferences : null) || [\"tileInfo\" in s ? s.tileInfo.spatialReference : null]).filter(Boolean);\n  0 !== o.length && o.every(e => !n.spatialReference.equals(e)) && w();\n}\n\nfunction w() {\n  throw new e(\"basemap-compatibility:incompatible-spatial-reference\", \"Basemap spatial reference is not compatible with the view\");\n}\n\nasync function y(t, a) {\n  const {\n    basemap: i,\n    view: r\n  } = t;\n  if (await i.load(a), 0 === i.baseLayers.length) return;\n  const s = i.baseLayers.concat(i.referenceLayers).toArray().filter(e => !n(e)).map(t => new e(\"basemap-compatibility:unsupported-basemap-layer-type\", \"Unsupported basemap layer type ${operationalLayerType}\", {\n    layer: t,\n    operationalLayerType: t.operationalLayerType || \"unknown\"\n  }));\n  if (s.length) throw s[0];\n  const o = i.baseLayers.getItemAt(0);\n\n  if (n(o)) {\n    try {\n      await o.load(a);\n    } catch (l) {\n      const t = \"basemap-compatibility:unknown-error\",\n            a = \"Unknown basemap compatibility error\",\n            {\n        name: i = t,\n        message: r = a,\n        details: n\n      } = l;\n      throw new e(i, r, n);\n    }\n\n    b(o, r);\n  }\n}\n\nfunction b(i, r) {\n  const n = r.state.viewingMode;\n  if (!n) return;\n  let f, u;\n\n  if (\"wmts\" === i?.type) {\n    const a = l(i, r.spatialReference, n);\n    if (t(a.tileInfo)) throw new e(\"basemapgalleryitem:tiling-scheme-incompatible\", \"Basemap tiling scheme is incompatible with the view\");\n    f = a.tileInfo, u = a.fullExtent;\n  } else f = i.tileInfo, u = i.fullExtent;\n\n  if (t(f)) return;\n  if (!m(f.spatialReference, n)) throw new e(`basemapgalleryitem:spatial-reference-unsupported-${s(n)}`, `Basemap spatial reference is unsupported in ${s(n)} mode`);\n  const w = f.spatialReference.isGeographic,\n        y = \"vector-tile\" === i?.type ? f.getOrCreateCompatible(256, w ? 1 : 2) : null;\n\n  if (n === o.Global) {\n    let t = p(f, u, null, n);\n\n    if (t && \"vector-tile\" === i?.type && a(u) && y && !p(y, u, null, n) && (t = null), t) {\n      const a = f.spatialReference.isWebMercator ? \"web-mercator\" : \"wgs84\";\n      throw new e(`basemapgalleryitem:tiling-scheme-unsupported-${a}-global`, \"Basemap tiling scheme is unsupported in global mode\", {\n        error: t\n      });\n    }\n  } else if (c.checkUnsupported(f)) throw new e(\"basemapgalleryitem:tiling-scheme-unsupported-local\", \"Basemap tiling scheme is unsupported in local mode\");\n\n  const b = r.get(\"basemapTerrain.tilingScheme\");\n  if (b && !b.compatibleWith(f) && (\"vector-tile\" !== i?.type || !y || !b.compatibleWith(y))) throw new e(\"basemapgalleryitem:tiling-scheme-incompatible\", \"Basemap tiling scheme is incompatible with the view\");\n}\n\nexport { u as default2DCompatibility, f as default3DCompatibility };","map":{"version":3,"names":["e","isNone","t","isSome","a","throwIfAborted","i","isTiledLayer","r","isBasemapSupportedLayer","n","stringFromViewingMode","s","ViewingMode","o","getTileInfoAndExtentFromWMTSLayer","l","checkIfTileInfoSupportedForView","p","TilingScheme","c","isSpatialReferenceSupported","m","f","y","u","basemap","view","spatialReferenceLocked","load","baseLayers","length","getItemAt","spatialReference","equals","w","supportedSpatialReferences","tileInfo","filter","Boolean","every","concat","referenceLayers","toArray","map","layer","operationalLayerType","name","message","details","b","state","viewingMode","type","fullExtent","isGeographic","getOrCreateCompatible","Global","isWebMercator","error","checkUnsupported","get","compatibleWith","default2DCompatibility","default3DCompatibility"],"sources":["E:/各个学科/论文/毕业论文/Atmosphere/eco-friendly/node_modules/@arcgis/core/widgets/BasemapGallery/support/basemapCompatibilityUtils.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport e from\"../../../core/Error.js\";import{isNone as t,isSome as a}from\"../../../core/maybe.js\";import{throwIfAborted as i}from\"../../../core/promiseUtils.js\";import{isTiledLayer as r,isBasemapSupportedLayer as n}from\"../../../layers/support/layerUtils.js\";import{stringFromViewingMode as s,ViewingMode as o}from\"../../../views/ViewingMode.js\";import{getTileInfoAndExtentFromWMTSLayer as l,checkIfTileInfoSupportedForView as p}from\"../../../views/3d/terrain/terrainUtils.js\";import{TilingScheme as c}from\"../../../views/3d/terrain/TilingScheme.js\";import{isSpatialReferenceSupported as m}from\"../../../views/support/spatialReferenceSupport.js\";async function f(e,t={}){await y(e,t),i(t)}async function u(e,t={}){const{basemap:a,view:n}=e;if(i(t),\"spatialReferenceLocked\"in n&&!n.spatialReferenceLocked)return;if(await a.load(t),i(t),0===a.baseLayers.length)return;const s=a.baseLayers.getItemAt(0);if(!r(s))return;if(a.spatialReference){if(n.spatialReference.equals(a.spatialReference))return;w()}await s.load(t),i(t);const o=((\"supportedSpatialReferences\"in s?s.supportedSpatialReferences:null)||[\"tileInfo\"in s?s.tileInfo.spatialReference:null]).filter(Boolean);0!==o.length&&o.every((e=>!n.spatialReference.equals(e)))&&w()}function w(){throw new e(\"basemap-compatibility:incompatible-spatial-reference\",\"Basemap spatial reference is not compatible with the view\")}async function y(t,a){const{basemap:i,view:r}=t;if(await i.load(a),0===i.baseLayers.length)return;const s=i.baseLayers.concat(i.referenceLayers).toArray().filter((e=>!n(e))).map((t=>new e(\"basemap-compatibility:unsupported-basemap-layer-type\",\"Unsupported basemap layer type ${operationalLayerType}\",{layer:t,operationalLayerType:t.operationalLayerType||\"unknown\"})));if(s.length)throw s[0];const o=i.baseLayers.getItemAt(0);if(n(o)){try{await o.load(a)}catch(l){const t=\"basemap-compatibility:unknown-error\",a=\"Unknown basemap compatibility error\",{name:i=t,message:r=a,details:n}=l;throw new e(i,r,n)}b(o,r)}}function b(i,r){const n=r.state.viewingMode;if(!n)return;let f,u;if(\"wmts\"===i?.type){const a=l(i,r.spatialReference,n);if(t(a.tileInfo))throw new e(\"basemapgalleryitem:tiling-scheme-incompatible\",\"Basemap tiling scheme is incompatible with the view\");f=a.tileInfo,u=a.fullExtent}else f=i.tileInfo,u=i.fullExtent;if(t(f))return;if(!m(f.spatialReference,n))throw new e(`basemapgalleryitem:spatial-reference-unsupported-${s(n)}`,`Basemap spatial reference is unsupported in ${s(n)} mode`);const w=f.spatialReference.isGeographic,y=\"vector-tile\"===i?.type?f.getOrCreateCompatible(256,w?1:2):null;if(n===o.Global){let t=p(f,u,null,n);if(t&&\"vector-tile\"===i?.type&&a(u)&&y&&!p(y,u,null,n)&&(t=null),t){const a=f.spatialReference.isWebMercator?\"web-mercator\":\"wgs84\";throw new e(`basemapgalleryitem:tiling-scheme-unsupported-${a}-global`,\"Basemap tiling scheme is unsupported in global mode\",{error:t})}}else if(c.checkUnsupported(f))throw new e(\"basemapgalleryitem:tiling-scheme-unsupported-local\",\"Basemap tiling scheme is unsupported in local mode\");const b=r.get(\"basemapTerrain.tilingScheme\");if(b&&!b.compatibleWith(f)&&(\"vector-tile\"!==i?.type||!y||!b.compatibleWith(y)))throw new e(\"basemapgalleryitem:tiling-scheme-incompatible\",\"Basemap tiling scheme is incompatible with the view\")}export{u as default2DCompatibility,f as default3DCompatibility};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}