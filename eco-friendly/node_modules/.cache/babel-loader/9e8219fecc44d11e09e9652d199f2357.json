{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport { isSome as e } from \"../../../../core/maybe.js\";\nimport { createResolver as t, throwIfAborted as s, onAbortOrThrow as o } from \"../../../../core/promiseUtils.js\";\nimport { TEXTURE_UPLOAD_MANAGER_BUDGET as r, TEXTURE_UPLOAD_MANAGER_CHUNK_SIZE as u } from \"./definitions.js\";\nimport { ContextType as n } from \"../../../webgl/context-util.js\";\n\nclass i {\n  constructor(e, t) {\n    this._queue = [], this._context = e, this._refreshable = t;\n  }\n\n  destroy() {\n    this._queue = [];\n  }\n\n  enqueueTextureUpdate(e, r) {\n    const i = t(),\n          h = e,\n          a = u,\n          c = Math.ceil(h.height / a);\n    if (s(r), this._context.type === n.WEBGL1) this._queue.push({\n      type: \"no-chunk\",\n      request: e,\n      resolver: i,\n      options: r\n    });else for (let t = 0; t < c; t++) {\n      const s = t * a,\n            o = t === c - 1,\n            u = o ? h.height - a * t : a;\n\n      this._queue.push({\n        type: \"chunk\",\n        request: e,\n        resolver: i,\n        chunk: t,\n        chunkOffset: s,\n        destHeight: u,\n        chunkIsLast: o,\n        options: r\n      });\n    }\n    return o(r, e => i.reject(e)), i.promise;\n  }\n\n  upload() {\n    let t = 0;\n\n    for (; this._queue.length;) {\n      const s = performance.now(),\n            o = this._queue.shift();\n\n      if (o) {\n        if (e(o.options.signal) && o.options.signal.aborted) continue;\n\n        switch (o.type) {\n          case \"chunk\":\n            this._uploadChunk(o);\n\n            break;\n\n          case \"no-chunk\":\n            this._uploadNoChunk(o);\n\n        }\n\n        const u = performance.now() - s;\n        if (t += u, t + u >= r) break;\n      }\n    }\n\n    this._queue.length && this._refreshable.requestRender();\n  }\n\n  _uploadChunk(t) {\n    const {\n      request: s,\n      resolver: o,\n      chunkOffset: r,\n      chunkIsLast: u,\n      destHeight: n\n    } = t,\n          {\n      data: i,\n      texture: h,\n      width: a\n    } = s;\n    e(i) && (h.updateData(0, 0, r, a, n, i, r), u && o.resolve());\n  }\n\n  _uploadNoChunk(e) {\n    const {\n      request: t,\n      resolver: s\n    } = e,\n          {\n      data: o,\n      texture: r\n    } = t;\n    r.setData(o), s.resolve();\n  }\n\n}\n\nexport { i as TextureUploadManager };","map":{"version":3,"names":["isSome","e","createResolver","t","throwIfAborted","s","onAbortOrThrow","o","TEXTURE_UPLOAD_MANAGER_BUDGET","r","TEXTURE_UPLOAD_MANAGER_CHUNK_SIZE","u","ContextType","n","i","constructor","_queue","_context","_refreshable","destroy","enqueueTextureUpdate","h","a","c","Math","ceil","height","type","WEBGL1","push","request","resolver","options","chunk","chunkOffset","destHeight","chunkIsLast","reject","promise","upload","length","performance","now","shift","signal","aborted","_uploadChunk","_uploadNoChunk","requestRender","data","texture","width","updateData","resolve","setData","TextureUploadManager"],"sources":["E:/各个学科/论文/毕业论文/Atmosphere/eco-friendly/node_modules/@arcgis/core/views/2d/engine/webgl/TextureUploadManager.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{isSome as e}from\"../../../../core/maybe.js\";import{createResolver as t,throwIfAborted as s,onAbortOrThrow as o}from\"../../../../core/promiseUtils.js\";import{TEXTURE_UPLOAD_MANAGER_BUDGET as r,TEXTURE_UPLOAD_MANAGER_CHUNK_SIZE as u}from\"./definitions.js\";import{ContextType as n}from\"../../../webgl/context-util.js\";class i{constructor(e,t){this._queue=[],this._context=e,this._refreshable=t}destroy(){this._queue=[]}enqueueTextureUpdate(e,r){const i=t(),h=e,a=u,c=Math.ceil(h.height/a);if(s(r),this._context.type===n.WEBGL1)this._queue.push({type:\"no-chunk\",request:e,resolver:i,options:r});else for(let t=0;t<c;t++){const s=t*a,o=t===c-1,u=o?h.height-a*t:a;this._queue.push({type:\"chunk\",request:e,resolver:i,chunk:t,chunkOffset:s,destHeight:u,chunkIsLast:o,options:r})}return o(r,(e=>i.reject(e))),i.promise}upload(){let t=0;for(;this._queue.length;){const s=performance.now(),o=this._queue.shift();if(o){if(e(o.options.signal)&&o.options.signal.aborted)continue;switch(o.type){case\"chunk\":this._uploadChunk(o);break;case\"no-chunk\":this._uploadNoChunk(o)}const u=performance.now()-s;if(t+=u,t+u>=r)break}}this._queue.length&&this._refreshable.requestRender()}_uploadChunk(t){const{request:s,resolver:o,chunkOffset:r,chunkIsLast:u,destHeight:n}=t,{data:i,texture:h,width:a}=s;e(i)&&(h.updateData(0,0,r,a,n,i,r),u&&o.resolve())}_uploadNoChunk(e){const{request:t,resolver:s}=e,{data:o,texture:r}=t;r.setData(o),s.resolve()}}export{i as TextureUploadManager};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}