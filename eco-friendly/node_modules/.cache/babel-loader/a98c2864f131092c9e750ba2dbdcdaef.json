{"ast":null,"code":"import \"core-js/modules/es.typed-array.at.js\";\nimport \"core-js/modules/es.typed-array.set.js\";\nimport \"core-js/modules/esnext.typed-array.find-last.js\";\nimport \"core-js/modules/esnext.typed-array.find-last-index.js\";\n\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../../chunks/tslib.es6.js\";\nimport \"../../../../geometry.js\";\nimport { HandleOwner as t } from \"../../../../core/HandleOwner.js\";\nimport i from \"../../../../core/Logger.js\";\nimport { isSome as s, unwrap as r } from \"../../../../core/maybe.js\";\nimport { debounce as l, isAbortError as a, eachAlways as o } from \"../../../../core/promiseUtils.js\";\nimport { property as h } from \"../../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../../core/arrayUtils.js\";\nimport \"../../../../core/accessorSupport/ensureType.js\";\nimport { subclass as n } from \"../../../../core/accessorSupport/decorators/subclass.js\";\nimport c from \"../../../../geometry/Point.js\";\nimport u from \"../../../../layers/support/PixelBlock.js\";\nimport p from \"../../../../layers/support/TileInfo.js\";\nimport { update as y, unregister as d, register as g, getRasterId as m } from \"../../../../layers/support/rasterDatasets/RawBlockCache.js\";\nimport { extractBands as _ } from \"../../../../layers/support/rasterFunctions/pixelUtils.js\";\nimport { getWorldWidth as f, computeProjectedScales as b } from \"../../../../layers/support/rasterFunctions/rasterProjectionHelper.js\";\nimport \"../../tiling/PagedTileQueue.js\";\nimport w from \"../../tiling/TileInfoView.js\";\nimport \"../../tiling/TileKey.js\";\nimport P from \"../../tiling/TileQueue.js\";\nimport C from \"../../tiling/TileStrategy.js\";\nimport { getWebGLCapabilities as I } from \"../../../webgl/capabilities.js\";\nimport R from \"../../../../geometry/Extent.js\";\nconst v = [0, 0];\nlet T = class extends t {\n  constructor() {\n    super(...arguments), this._emptyTilePixelBlock = null, this._tileStrategy = null, this._tileInfoView = null, this._fetchQueue = null, this._blockCacheRegistryUrl = null, this._blockCacheRegistryId = null, this._srcResolutions = null, this.previousLOD = null, this._needBlockCacheUpdate = !1, this._globalSymbolizerParams = null, this._symbolizerParams = null, this._abortController = null, this._isCustomTilingScheme = !1, this._globalUpdateRequested = !1, this.attached = !1, this.container = null, this.layer = null, this.timeExtent = null, this.redrawOrRefetch = l((e, t) => !this.previousLOD || this.layerView.suspended ? Promise.resolve() : e ? this.updatingHandles.addPromise(this.doRefresh()) : this.updatingHandles.addPromise(this._redrawImage(t)));\n  }\n\n  get useWebGLForProcessing() {\n    return this._get(\"useWebGLForProcessing\") ?? !0;\n  }\n\n  set useWebGLForProcessing(e) {\n    this._set(\"useWebGLForProcessing\", e);\n  }\n\n  get useProgressiveUpdate() {\n    return null == this._get(\"useProgressiveUpdate\") || this._get(\"useProgressiveUpdate\");\n  }\n\n  set useProgressiveUpdate(e) {\n    if (this._tileStrategy && this.useProgressiveUpdate !== e) {\n      this._tileStrategy.destroy(), this.container.removeAllChildren();\n\n      const t = this._getCacheSize(e);\n\n      this._tileStrategy = new C({\n        cachePolicy: \"purge\",\n        acquireTile: e => this.acquireTile(e),\n        releaseTile: e => this.releaseTile(e),\n        cacheSize: t,\n        tileInfoView: this._tileInfoView\n      }), this._set(\"useProgressiveUpdate\", e), this.layerView.requestUpdate();\n    }\n  }\n\n  update(e) {\n    this._fetchQueue.pause(), this._fetchQueue.state = e.state, this._tileStrategy.update(e), this._fetchQueue.resume();\n\n    const {\n      extent: t,\n      resolution: i,\n      scale: s\n    } = e.state,\n          r = this._tileInfoView.getClosestInfoForScale(s);\n\n    if (this.layer.raster) {\n      if (!this.useProgressiveUpdate || this._needBlockCacheUpdate) {\n        const e = this._srcResolutions[r.level],\n              s = t.toJSON ? t : R.fromJSON(t);\n        y(this._blockCacheRegistryUrl, this._blockCacheRegistryId, s, i, e, this.layer.raster.ioConfig.sampling);\n      }\n\n      this._needBlockCacheUpdate = !1, this.previousLOD?.level !== r.level && (this.previousLOD = r, null == this._symbolizerParams || this.layerView.hasTilingEffects || this._updateSymbolizerParams(), this._tileStrategy.updateCacheSize(0));\n    }\n  }\n\n  moveEnd() {\n    !this.layerView.hasTilingEffects && this.useProgressiveUpdate || (this._abortController && this._abortController.abort(), this._abortController = new AbortController(), 0 === this._fetchQueue.length && this._redrawImage(this._abortController.signal).then(() => {\n      this._globalUpdateRequested = !1, this.layerView.requestUpdate();\n    }));\n\n    const e = this._getCacheSize(this.useProgressiveUpdate);\n\n    this._tileStrategy.updateCacheSize(e), this.layerView.requestUpdate();\n  }\n\n  get updating() {\n    return this._fetchQueue?.updating || this._globalUpdateRequested || !(!this.updatingHandles || !this.updatingHandles.updating);\n  }\n\n  attach() {\n    I(\"2d\").supportsTextureFloat || (this.useWebGLForProcessing = !1), this._initializeTileInfo(), this._tileInfoView = new w(this.layerView.tileInfo, this.layerView.fullExtent);\n\n    const e = this._computeFetchConcurrency();\n\n    this._fetchQueue = new P({\n      tileInfoView: this._tileInfoView,\n      concurrency: e,\n      process: (e, t) => this._fetchTile1(e, t)\n    });\n\n    const t = this._getCacheSize(this.useProgressiveUpdate);\n\n    this._tileStrategy = new C({\n      cachePolicy: \"purge\",\n      acquireTile: e => this.acquireTile(e),\n      releaseTile: e => this.releaseTile(e),\n      cacheSize: t,\n      tileInfoView: this._tileInfoView\n    }), this._updateBlockCacheRegistry();\n  }\n\n  detach() {\n    this._tileStrategy.destroy(), this._fetchQueue.clear(), this.container.removeAllChildren(), this._fetchQueue = this._tileStrategy = this._tileInfoView = null, d(this._blockCacheRegistryUrl, this._blockCacheRegistryId), this._blockCacheRegistryUrl = this._blockCacheRegistryId = null;\n  }\n\n  acquireTile(e) {\n    const t = this.container.createTile(e);\n    return this._enqueueTileFetch(t), this.layerView.requestUpdate(), this._needBlockCacheUpdate = !0, this._globalUpdateRequested = this.layerView.hasTilingEffects || !this.useProgressiveUpdate, t;\n  }\n\n  releaseTile(e) {\n    this._fetchQueue.abort(e.key.id), this.container.removeChild(e), e.once(\"detach\", () => {\n      e.destroy(), this.layerView.requestUpdate();\n    }), this.layerView.requestUpdate();\n  }\n\n  createEmptyTilePixelBlock(e = null) {\n    const t = null == e || e.join(\",\") === this._tileInfoView.tileInfo.size.join(\",\");\n\n    if (t && s(this._emptyTilePixelBlock)) return this._emptyTilePixelBlock;\n    e = e || this._tileInfoView.tileInfo.size;\n    const [i, r] = e,\n          l = new u({\n      width: i,\n      height: r,\n      pixels: [new Uint8Array(i * r)],\n      mask: new Uint8Array(i * r),\n      pixelType: \"u8\"\n    });\n    return t && (this._emptyTilePixelBlock = l), l;\n  }\n\n  _fetchTile1(e, t) {\n    const i = s(t) && t.signal,\n          l = this.canUseWebGLForProcessing(),\n          {\n      layerView: a\n    } = this,\n          o = !a.tileInfo.isWrappable && s(f(a.view.spatialReference)),\n          h = {\n      allowPartialFill: !0,\n      datumTransformation: a.datumTransformation,\n      interpolation: l ? \"nearest\" : this.layer.interpolation,\n      registryId: this._blockCacheRegistryId,\n      requestRawData: l,\n      signal: r(i),\n      srcResolution: this._srcResolutions[e.level],\n      timeExtent: a.timeExtent,\n      tileInfo: a.tileInfo,\n      disableWrapAround: o\n    };\n    return this.fetchTile(e, h);\n  }\n\n  _getCacheSize(e) {\n    return e ? 40 : 0;\n  }\n\n  _initializeTileInfo() {\n    const e = this.layerView.view.spatialReference,\n          t = new c({\n      x: this.layerView.fullExtent.xmin,\n      y: this.layerView.fullExtent.ymax,\n      spatialReference: e\n    }),\n          {\n      scales: i,\n      srcResolutions: s,\n      isCustomTilingScheme: r\n    } = b(this.layer.rasterInfo, e),\n          l = p.create({\n      spatialReference: e,\n      size: 512,\n      scales: i\n    });\n    (0 === l.origin.x || l.origin.x > t.x) && (l.origin = t), this._isCustomTilingScheme = r, this.layerView.set(\"tileInfo\", l), this._srcResolutions = s ?? [];\n  }\n\n  _computeFetchConcurrency() {\n    const {\n      blockBoundary: e\n    } = this.layer.rasterInfo.storageInfo,\n          t = e[e.length - 1];\n    return (t.maxCol - t.minCol + 1) * (t.maxRow - t.minRow + 1) > 64 ? 2 : 10;\n  }\n\n  async _enqueueTileFetch(e, t) {\n    this.updatingHandles.addPromise(this._enqueueTileFetch1(e, t));\n  }\n\n  async _enqueueTileFetch1(e, t) {\n    if (!this._fetchQueue.has(e.key.id)) {\n      try {\n        const t = await this._fetchQueue.push(e.key),\n              {\n          bandIds: r\n        } = this.layer;\n        let l = !this.useProgressiveUpdate || this.layerView.hasTilingEffects && !this._globalSymbolizerParams;\n\n        if (this._globalUpdateRequested && !this.layerView.moving && 0 === this._fetchQueue.length) {\n          l = !1;\n\n          try {\n            await this._redrawImage(this._abortController && this._abortController.signal);\n          } catch (s) {\n            a(s) && i.getLogger(this.declaredClass).error(s);\n          }\n\n          this._globalUpdateRequested = !1;\n        }\n\n        !this.canUseWebGLForProcessing() && \"rasterVF\" !== this.type || this.layerView.hasTilingEffects || null != this._symbolizerParams || this._updateSymbolizerParams();\n\n        const o = this._tileInfoView.getTileCoords(v, e.key),\n              h = this._tileInfoView.getTileResolution(e.key);\n\n        await this.updateTileSource(e, {\n          source: t,\n          symbolizerParams: this._symbolizerParams,\n          globalSymbolizerParams: this._globalSymbolizerParams,\n          suspended: l,\n          bandIds: r,\n          coords: o,\n          resolution: h\n        }), e.once(\"attach\", () => this.layerView.requestUpdate()), this.container.addChild(e);\n      } catch (s) {\n        a(s) || i.getLogger(this.declaredClass).error(s);\n      }\n\n      this.layerView.requestUpdate();\n    }\n  }\n\n  async _redrawImage(e) {\n    if (0 === this.container.children.length) return;\n    await this.layer.updateRenderer(), this.layerView.hasTilingEffects ? await this._updateGlobalSymbolizerParams(e) : (this._updateSymbolizerParams(), this._globalSymbolizerParams = null);\n    const t = this.container.children.map(async e => this.updateTileSymbolizerParameters(e, {\n      local: this._symbolizerParams,\n      global: this._globalSymbolizerParams\n    }));\n    await o(t), this.container.requestRender();\n  }\n\n  async _updateGlobalSymbolizerParams(e) {\n    const t = {\n      srcResolution: this._srcResolutions[this.previousLOD.level],\n      registryId: this._blockCacheRegistryId,\n      signal: e\n    },\n          i = await this.layer.fetchPixels(this.layerView.view.extent, this.layerView.view.width, this.layerView.view.height, t);\n    if (!i || !i.pixelBlock) return;\n    const s = this.layer.symbolizer.generateWebGLParameters({\n      pixelBlock: _(i.pixelBlock, this.layer.bandIds),\n      isGCS: this.layerView.view.spatialReference.isGeographic,\n      resolution: {\n        x: this.previousLOD.resolution,\n        y: this.previousLOD.resolution\n      },\n      bandIds: this.layer.bandIds\n    });\n    !this.canUseWebGLForProcessing() && s && \"stretch\" === s.type && this.layer.renderer && \"raster-stretch\" === this.layer.renderer.type && (s.factor = s.factor.map(e => 255 * e), s.outMin = Math.round(255 * s.outMin), s.outMax = Math.round(255 * s.outMax)), this._globalSymbolizerParams = s;\n  }\n\n  _updateSymbolizerParams() {\n    this._symbolizerParams = this.layer.symbolizer.generateWebGLParameters({\n      pixelBlock: null,\n      isGCS: this.layerView.view.spatialReference.isGeographic,\n      resolution: {\n        x: this.previousLOD.resolution,\n        y: this.previousLOD.resolution\n      },\n      bandIds: this.layer.bandIds\n    });\n  }\n\n  _updateBlockCacheRegistry(e = !1) {\n    const {\n      url: t,\n      rasterInfo: i,\n      raster: s\n    } = this.layer,\n          {\n      multidimensionalDefinition: r\n    } = this.layer.normalizeRasterFetchOptions({\n      multidimensionalDefinition: this.layer.multidimensionalDefinition,\n      timeExtent: this.layerView.timeExtent\n    }),\n          l = i?.multidimensionalInfo ? s.getSliceIndex(r) : null,\n          a = m(t, l);\n\n    if (a !== this._blockCacheRegistryUrl) {\n      if (null != this._blockCacheRegistryUrl && d(this._blockCacheRegistryUrl, this._blockCacheRegistryId), this._blockCacheRegistryId = g(a, this.layer.raster.rasterInfo), e) {\n        const e = this._tileInfoView.getClosestInfoForScale(this.layerView.view.scale),\n              t = this._srcResolutions[e.level];\n\n        y(a, this._blockCacheRegistryId, this.layerView.view.extent, this.layerView.view.resolution, t, this.layer.raster.ioConfig.sampling);\n      }\n\n      this._blockCacheRegistryUrl = a;\n    }\n  }\n\n  async doRefresh() {\n    if (!this.attached) return;\n    await this.layer.updateRenderer(), this.layerView.hasTilingEffects || this._updateSymbolizerParams(), this._updateBlockCacheRegistry(!0), this._fetchQueue.reset();\n    const e = [];\n    this._globalUpdateRequested = this.layerView.hasTilingEffects || !this.useProgressiveUpdate, this._tileStrategy.tiles.forEach(t => e.push(this._enqueueTileFetch(t))), await o(e);\n  }\n\n};\ne([h()], T.prototype, \"_fetchQueue\", void 0), e([h()], T.prototype, \"_globalUpdateRequested\", void 0), e([h()], T.prototype, \"attached\", void 0), e([h()], T.prototype, \"container\", void 0), e([h()], T.prototype, \"layer\", void 0), e([h()], T.prototype, \"layerView\", void 0), e([h()], T.prototype, \"type\", void 0), e([h()], T.prototype, \"useWebGLForProcessing\", null), e([h()], T.prototype, \"useProgressiveUpdate\", null), e([h()], T.prototype, \"timeExtent\", void 0), e([h()], T.prototype, \"updating\", null), T = e([n(\"esri.views.2d.layers.imagery.BaseImageryTileSubView2D\")], T);\nexport { T as BaseImageryTileSubView2D };","map":{"version":3,"names":["_","e","HandleOwner","t","i","isSome","s","unwrap","r","debounce","l","isAbortError","a","eachAlways","o","property","h","subclass","n","c","u","p","update","y","unregister","d","register","g","getRasterId","m","extractBands","getWorldWidth","f","computeProjectedScales","b","w","P","C","getWebGLCapabilities","I","R","v","T","constructor","arguments","_emptyTilePixelBlock","_tileStrategy","_tileInfoView","_fetchQueue","_blockCacheRegistryUrl","_blockCacheRegistryId","_srcResolutions","previousLOD","_needBlockCacheUpdate","_globalSymbolizerParams","_symbolizerParams","_abortController","_isCustomTilingScheme","_globalUpdateRequested","attached","container","layer","timeExtent","redrawOrRefetch","layerView","suspended","Promise","resolve","updatingHandles","addPromise","doRefresh","_redrawImage","useWebGLForProcessing","_get","_set","useProgressiveUpdate","destroy","removeAllChildren","_getCacheSize","cachePolicy","acquireTile","releaseTile","cacheSize","tileInfoView","requestUpdate","pause","state","resume","extent","resolution","scale","getClosestInfoForScale","raster","level","toJSON","fromJSON","ioConfig","sampling","hasTilingEffects","_updateSymbolizerParams","updateCacheSize","moveEnd","abort","AbortController","length","signal","then","updating","attach","supportsTextureFloat","_initializeTileInfo","tileInfo","fullExtent","_computeFetchConcurrency","concurrency","process","_fetchTile1","_updateBlockCacheRegistry","detach","clear","createTile","_enqueueTileFetch","key","id","removeChild","once","createEmptyTilePixelBlock","join","size","width","height","pixels","Uint8Array","mask","pixelType","canUseWebGLForProcessing","isWrappable","view","spatialReference","allowPartialFill","datumTransformation","interpolation","registryId","requestRawData","srcResolution","disableWrapAround","fetchTile","x","xmin","ymax","scales","srcResolutions","isCustomTilingScheme","rasterInfo","create","origin","set","blockBoundary","storageInfo","maxCol","minCol","maxRow","minRow","_enqueueTileFetch1","has","push","bandIds","moving","getLogger","declaredClass","error","type","getTileCoords","getTileResolution","updateTileSource","source","symbolizerParams","globalSymbolizerParams","coords","addChild","children","updateRenderer","_updateGlobalSymbolizerParams","map","updateTileSymbolizerParameters","local","global","requestRender","fetchPixels","pixelBlock","symbolizer","generateWebGLParameters","isGCS","isGeographic","renderer","factor","outMin","Math","round","outMax","url","multidimensionalDefinition","normalizeRasterFetchOptions","multidimensionalInfo","getSliceIndex","reset","tiles","forEach","prototype","BaseImageryTileSubView2D"],"sources":["E:/各个学科/论文/毕业论文/Atmosphere/eco-friendly/node_modules/@arcgis/core/views/2d/layers/imagery/BaseImageryTileSubView2D.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import\"../../../../geometry.js\";import{HandleOwner as t}from\"../../../../core/HandleOwner.js\";import i from\"../../../../core/Logger.js\";import{isSome as s,unwrap as r}from\"../../../../core/maybe.js\";import{debounce as l,isAbortError as a,eachAlways as o}from\"../../../../core/promiseUtils.js\";import{property as h}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/arrayUtils.js\";import\"../../../../core/accessorSupport/ensureType.js\";import{subclass as n}from\"../../../../core/accessorSupport/decorators/subclass.js\";import c from\"../../../../geometry/Point.js\";import u from\"../../../../layers/support/PixelBlock.js\";import p from\"../../../../layers/support/TileInfo.js\";import{update as y,unregister as d,register as g,getRasterId as m}from\"../../../../layers/support/rasterDatasets/RawBlockCache.js\";import{extractBands as _}from\"../../../../layers/support/rasterFunctions/pixelUtils.js\";import{getWorldWidth as f,computeProjectedScales as b}from\"../../../../layers/support/rasterFunctions/rasterProjectionHelper.js\";import\"../../tiling/PagedTileQueue.js\";import w from\"../../tiling/TileInfoView.js\";import\"../../tiling/TileKey.js\";import P from\"../../tiling/TileQueue.js\";import C from\"../../tiling/TileStrategy.js\";import{getWebGLCapabilities as I}from\"../../../webgl/capabilities.js\";import R from\"../../../../geometry/Extent.js\";const v=[0,0];let T=class extends t{constructor(){super(...arguments),this._emptyTilePixelBlock=null,this._tileStrategy=null,this._tileInfoView=null,this._fetchQueue=null,this._blockCacheRegistryUrl=null,this._blockCacheRegistryId=null,this._srcResolutions=null,this.previousLOD=null,this._needBlockCacheUpdate=!1,this._globalSymbolizerParams=null,this._symbolizerParams=null,this._abortController=null,this._isCustomTilingScheme=!1,this._globalUpdateRequested=!1,this.attached=!1,this.container=null,this.layer=null,this.timeExtent=null,this.redrawOrRefetch=l(((e,t)=>!this.previousLOD||this.layerView.suspended?Promise.resolve():e?this.updatingHandles.addPromise(this.doRefresh()):this.updatingHandles.addPromise(this._redrawImage(t))))}get useWebGLForProcessing(){return this._get(\"useWebGLForProcessing\")??!0}set useWebGLForProcessing(e){this._set(\"useWebGLForProcessing\",e)}get useProgressiveUpdate(){return null==this._get(\"useProgressiveUpdate\")||this._get(\"useProgressiveUpdate\")}set useProgressiveUpdate(e){if(this._tileStrategy&&this.useProgressiveUpdate!==e){this._tileStrategy.destroy(),this.container.removeAllChildren();const t=this._getCacheSize(e);this._tileStrategy=new C({cachePolicy:\"purge\",acquireTile:e=>this.acquireTile(e),releaseTile:e=>this.releaseTile(e),cacheSize:t,tileInfoView:this._tileInfoView}),this._set(\"useProgressiveUpdate\",e),this.layerView.requestUpdate()}}update(e){this._fetchQueue.pause(),this._fetchQueue.state=e.state,this._tileStrategy.update(e),this._fetchQueue.resume();const{extent:t,resolution:i,scale:s}=e.state,r=this._tileInfoView.getClosestInfoForScale(s);if(this.layer.raster){if(!this.useProgressiveUpdate||this._needBlockCacheUpdate){const e=this._srcResolutions[r.level],s=t.toJSON?t:R.fromJSON(t);y(this._blockCacheRegistryUrl,this._blockCacheRegistryId,s,i,e,this.layer.raster.ioConfig.sampling)}this._needBlockCacheUpdate=!1,this.previousLOD?.level!==r.level&&(this.previousLOD=r,null==this._symbolizerParams||this.layerView.hasTilingEffects||this._updateSymbolizerParams(),this._tileStrategy.updateCacheSize(0))}}moveEnd(){!this.layerView.hasTilingEffects&&this.useProgressiveUpdate||(this._abortController&&this._abortController.abort(),this._abortController=new AbortController,0===this._fetchQueue.length&&this._redrawImage(this._abortController.signal).then((()=>{this._globalUpdateRequested=!1,this.layerView.requestUpdate()})));const e=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy.updateCacheSize(e),this.layerView.requestUpdate()}get updating(){return this._fetchQueue?.updating||this._globalUpdateRequested||!(!this.updatingHandles||!this.updatingHandles.updating)}attach(){I(\"2d\").supportsTextureFloat||(this.useWebGLForProcessing=!1),this._initializeTileInfo(),this._tileInfoView=new w(this.layerView.tileInfo,this.layerView.fullExtent);const e=this._computeFetchConcurrency();this._fetchQueue=new P({tileInfoView:this._tileInfoView,concurrency:e,process:(e,t)=>this._fetchTile1(e,t)});const t=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy=new C({cachePolicy:\"purge\",acquireTile:e=>this.acquireTile(e),releaseTile:e=>this.releaseTile(e),cacheSize:t,tileInfoView:this._tileInfoView}),this._updateBlockCacheRegistry()}detach(){this._tileStrategy.destroy(),this._fetchQueue.clear(),this.container.removeAllChildren(),this._fetchQueue=this._tileStrategy=this._tileInfoView=null,d(this._blockCacheRegistryUrl,this._blockCacheRegistryId),this._blockCacheRegistryUrl=this._blockCacheRegistryId=null}acquireTile(e){const t=this.container.createTile(e);return this._enqueueTileFetch(t),this.layerView.requestUpdate(),this._needBlockCacheUpdate=!0,this._globalUpdateRequested=this.layerView.hasTilingEffects||!this.useProgressiveUpdate,t}releaseTile(e){this._fetchQueue.abort(e.key.id),this.container.removeChild(e),e.once(\"detach\",(()=>{e.destroy(),this.layerView.requestUpdate()})),this.layerView.requestUpdate()}createEmptyTilePixelBlock(e=null){const t=null==e||e.join(\",\")===this._tileInfoView.tileInfo.size.join(\",\");if(t&&s(this._emptyTilePixelBlock))return this._emptyTilePixelBlock;e=e||this._tileInfoView.tileInfo.size;const[i,r]=e,l=new u({width:i,height:r,pixels:[new Uint8Array(i*r)],mask:new Uint8Array(i*r),pixelType:\"u8\"});return t&&(this._emptyTilePixelBlock=l),l}_fetchTile1(e,t){const i=s(t)&&t.signal,l=this.canUseWebGLForProcessing(),{layerView:a}=this,o=!a.tileInfo.isWrappable&&s(f(a.view.spatialReference)),h={allowPartialFill:!0,datumTransformation:a.datumTransformation,interpolation:l?\"nearest\":this.layer.interpolation,registryId:this._blockCacheRegistryId,requestRawData:l,signal:r(i),srcResolution:this._srcResolutions[e.level],timeExtent:a.timeExtent,tileInfo:a.tileInfo,disableWrapAround:o};return this.fetchTile(e,h)}_getCacheSize(e){return e?40:0}_initializeTileInfo(){const e=this.layerView.view.spatialReference,t=new c({x:this.layerView.fullExtent.xmin,y:this.layerView.fullExtent.ymax,spatialReference:e}),{scales:i,srcResolutions:s,isCustomTilingScheme:r}=b(this.layer.rasterInfo,e),l=p.create({spatialReference:e,size:512,scales:i});(0===l.origin.x||l.origin.x>t.x)&&(l.origin=t),this._isCustomTilingScheme=r,this.layerView.set(\"tileInfo\",l),this._srcResolutions=s??[]}_computeFetchConcurrency(){const{blockBoundary:e}=this.layer.rasterInfo.storageInfo,t=e[e.length-1];return(t.maxCol-t.minCol+1)*(t.maxRow-t.minRow+1)>64?2:10}async _enqueueTileFetch(e,t){this.updatingHandles.addPromise(this._enqueueTileFetch1(e,t))}async _enqueueTileFetch1(e,t){if(!this._fetchQueue.has(e.key.id)){try{const t=await this._fetchQueue.push(e.key),{bandIds:r}=this.layer;let l=!this.useProgressiveUpdate||this.layerView.hasTilingEffects&&!this._globalSymbolizerParams;if(this._globalUpdateRequested&&!this.layerView.moving&&0===this._fetchQueue.length){l=!1;try{await this._redrawImage(this._abortController&&this._abortController.signal)}catch(s){a(s)&&i.getLogger(this.declaredClass).error(s)}this._globalUpdateRequested=!1}!this.canUseWebGLForProcessing()&&\"rasterVF\"!==this.type||this.layerView.hasTilingEffects||null!=this._symbolizerParams||this._updateSymbolizerParams();const o=this._tileInfoView.getTileCoords(v,e.key),h=this._tileInfoView.getTileResolution(e.key);await this.updateTileSource(e,{source:t,symbolizerParams:this._symbolizerParams,globalSymbolizerParams:this._globalSymbolizerParams,suspended:l,bandIds:r,coords:o,resolution:h}),e.once(\"attach\",(()=>this.layerView.requestUpdate())),this.container.addChild(e)}catch(s){a(s)||i.getLogger(this.declaredClass).error(s)}this.layerView.requestUpdate()}}async _redrawImage(e){if(0===this.container.children.length)return;await this.layer.updateRenderer(),this.layerView.hasTilingEffects?await this._updateGlobalSymbolizerParams(e):(this._updateSymbolizerParams(),this._globalSymbolizerParams=null);const t=this.container.children.map((async e=>this.updateTileSymbolizerParameters(e,{local:this._symbolizerParams,global:this._globalSymbolizerParams})));await o(t),this.container.requestRender()}async _updateGlobalSymbolizerParams(e){const t={srcResolution:this._srcResolutions[this.previousLOD.level],registryId:this._blockCacheRegistryId,signal:e},i=await this.layer.fetchPixels(this.layerView.view.extent,this.layerView.view.width,this.layerView.view.height,t);if(!i||!i.pixelBlock)return;const s=this.layer.symbolizer.generateWebGLParameters({pixelBlock:_(i.pixelBlock,this.layer.bandIds),isGCS:this.layerView.view.spatialReference.isGeographic,resolution:{x:this.previousLOD.resolution,y:this.previousLOD.resolution},bandIds:this.layer.bandIds});!this.canUseWebGLForProcessing()&&s&&\"stretch\"===s.type&&this.layer.renderer&&\"raster-stretch\"===this.layer.renderer.type&&(s.factor=s.factor.map((e=>255*e)),s.outMin=Math.round(255*s.outMin),s.outMax=Math.round(255*s.outMax)),this._globalSymbolizerParams=s}_updateSymbolizerParams(){this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null,isGCS:this.layerView.view.spatialReference.isGeographic,resolution:{x:this.previousLOD.resolution,y:this.previousLOD.resolution},bandIds:this.layer.bandIds})}_updateBlockCacheRegistry(e=!1){const{url:t,rasterInfo:i,raster:s}=this.layer,{multidimensionalDefinition:r}=this.layer.normalizeRasterFetchOptions({multidimensionalDefinition:this.layer.multidimensionalDefinition,timeExtent:this.layerView.timeExtent}),l=i?.multidimensionalInfo?s.getSliceIndex(r):null,a=m(t,l);if(a!==this._blockCacheRegistryUrl){if(null!=this._blockCacheRegistryUrl&&d(this._blockCacheRegistryUrl,this._blockCacheRegistryId),this._blockCacheRegistryId=g(a,this.layer.raster.rasterInfo),e){const e=this._tileInfoView.getClosestInfoForScale(this.layerView.view.scale),t=this._srcResolutions[e.level];y(a,this._blockCacheRegistryId,this.layerView.view.extent,this.layerView.view.resolution,t,this.layer.raster.ioConfig.sampling)}this._blockCacheRegistryUrl=a}}async doRefresh(){if(!this.attached)return;await this.layer.updateRenderer(),this.layerView.hasTilingEffects||this._updateSymbolizerParams(),this._updateBlockCacheRegistry(!0),this._fetchQueue.reset();const e=[];this._globalUpdateRequested=this.layerView.hasTilingEffects||!this.useProgressiveUpdate,this._tileStrategy.tiles.forEach((t=>e.push(this._enqueueTileFetch(t)))),await o(e)}};e([h()],T.prototype,\"_fetchQueue\",void 0),e([h()],T.prototype,\"_globalUpdateRequested\",void 0),e([h()],T.prototype,\"attached\",void 0),e([h()],T.prototype,\"container\",void 0),e([h()],T.prototype,\"layer\",void 0),e([h()],T.prototype,\"layerView\",void 0),e([h()],T.prototype,\"type\",void 0),e([h()],T.prototype,\"useWebGLForProcessing\",null),e([h()],T.prototype,\"useProgressiveUpdate\",null),e([h()],T.prototype,\"timeExtent\",void 0),e([h()],T.prototype,\"updating\",null),T=e([n(\"esri.views.2d.layers.imagery.BaseImageryTileSubView2D\")],T);export{T as BaseImageryTileSubView2D};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}