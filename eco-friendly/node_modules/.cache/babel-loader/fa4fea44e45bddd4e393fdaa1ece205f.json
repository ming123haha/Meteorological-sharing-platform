{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport has from \"../../../../../core/has.js\";\nimport { throwIfAborted as e, isAbortError as t } from \"../../../../../core/promiseUtils.js\";\nimport { BaseFeatureSource as r } from \"./BaseFeatureSource.js\";\nconst s = has(\"esri-mobile\"),\n      i = {\n  maxDrillLevel: s ? 1 : 4,\n  maxRecordCountFactor: s ? 1 : 3\n};\n\nclass a extends r {\n  constructor(e) {\n    super(e);\n  }\n\n  async _fetchDataTile(r) {\n    const s = this._serviceInfo.capabilities.query.supportsMaxRecordCountFactor,\n          a = this._subscriptions.get(r.key.id),\n          o = a.signal,\n          n = r.getQuantizationParameters();\n\n    let c = 0;\n\n    const d = async (u, l) => {\n      const p = this._queryInfo,\n            m = this.createTileQuery(u, {\n        maxRecordCountFactor: s ? i.maxRecordCountFactor : void 0,\n        returnExceededLimitFeatures: !1,\n        quantizationParameters: n\n      });\n      c++;\n\n      try {\n        const t = await this._queue.push({\n          tile: r,\n          query: m,\n          signal: o,\n          depth: l\n        });\n        if (c--, e(o), !t) return;\n        if (p !== this._queryInfo) return void d(u, l);\n\n        if (t.exceededTransferLimit && l < i.maxDrillLevel) {\n          for (const e of u.createChildTiles()) d(e, l + 1);\n\n          return;\n        }\n\n        const s = {\n          id: r.id,\n          addOrUpdate: t,\n          end: 0 === c,\n          type: \"append\"\n        };\n        a.add({\n          query: m,\n          message: s\n        }), this._onMessage(s);\n      } catch (h) {\n        t(h) || this._onMessage({\n          id: r.id,\n          addOrUpdate: null,\n          end: !0,\n          type: \"append\"\n        });\n      }\n    };\n\n    d(r, 0);\n  }\n\n}\n\nexport { a as DrillDownFeatureSource };","map":{"version":3,"names":["has","throwIfAborted","e","isAbortError","t","BaseFeatureSource","r","s","i","maxDrillLevel","maxRecordCountFactor","a","constructor","_fetchDataTile","_serviceInfo","capabilities","query","supportsMaxRecordCountFactor","_subscriptions","get","key","id","o","signal","n","getQuantizationParameters","c","d","u","l","p","_queryInfo","m","createTileQuery","returnExceededLimitFeatures","quantizationParameters","_queue","push","tile","depth","exceededTransferLimit","createChildTiles","addOrUpdate","end","type","add","message","_onMessage","h","DrillDownFeatureSource"],"sources":["E:/各个学科/论文/毕业论文/Atmosphere/eco-friendly/node_modules/@arcgis/core/views/2d/layers/features/sources/DrillDownFeatureSource.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport has from\"../../../../../core/has.js\";import{throwIfAborted as e,isAbortError as t}from\"../../../../../core/promiseUtils.js\";import{BaseFeatureSource as r}from\"./BaseFeatureSource.js\";const s=has(\"esri-mobile\"),i={maxDrillLevel:s?1:4,maxRecordCountFactor:s?1:3};class a extends r{constructor(e){super(e)}async _fetchDataTile(r){const s=this._serviceInfo.capabilities.query.supportsMaxRecordCountFactor,a=this._subscriptions.get(r.key.id),o=a.signal,n=r.getQuantizationParameters();let c=0;const d=async(u,l)=>{const p=this._queryInfo,m=this.createTileQuery(u,{maxRecordCountFactor:s?i.maxRecordCountFactor:void 0,returnExceededLimitFeatures:!1,quantizationParameters:n});c++;try{const t=await this._queue.push({tile:r,query:m,signal:o,depth:l});if(c--,e(o),!t)return;if(p!==this._queryInfo)return void d(u,l);if(t.exceededTransferLimit&&l<i.maxDrillLevel){for(const e of u.createChildTiles())d(e,l+1);return}const s={id:r.id,addOrUpdate:t,end:0===c,type:\"append\"};a.add({query:m,message:s}),this._onMessage(s)}catch(h){t(h)||this._onMessage({id:r.id,addOrUpdate:null,end:!0,type:\"append\"})}};d(r,0)}}export{a as DrillDownFeatureSource};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}