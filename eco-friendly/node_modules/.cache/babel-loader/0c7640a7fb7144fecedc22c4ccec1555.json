{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport { handlesGroup as e } from \"../handleUtils.js\";\nimport t from \"../Logger.js\";\nimport { isPromiseLike as s, createAbortError as n, createDeferred as i, throwIfAborted as o } from \"../promiseUtils.js\";\nimport r from \"../Queue.js\";\nimport l from \"./RemoteClient.js\";\nconst h = t.getLogger(\"esri.core.workers.Connection\");\n\nclass c {\n  constructor() {\n    this._inUseClients = new Array(), this._clients = new Array(), this._clientPromises = new Array(), this._ongoingJobsQueue = new r();\n  }\n\n  destroy() {\n    this.close();\n  }\n\n  get closed() {\n    return !this._clients || !this._clients.length;\n  }\n\n  open(e, t) {\n    return new Promise((n, i) => {\n      let r = !0;\n\n      const h = e => {\n        o(t.signal), r && (r = !1, e());\n      };\n\n      this._clients.length = e.length, this._clientPromises.length = e.length, this._inUseClients.length = e.length;\n\n      for (let o = 0; o < e.length; ++o) {\n        const r = e[o];\n        s(r) ? this._clientPromises[o] = r.then(e => (this._clients[o] = new l(e, t, () => this._ongoingJobsQueue.pop()), h(n), this._clients[o]), () => (h(i), null)) : (this._clients[o] = new l(r, t, () => this._ongoingJobsQueue.pop()), this._clientPromises[o] = Promise.resolve(this._clients[o]), h(n));\n      }\n    });\n  }\n\n  broadcast(e, t, s) {\n    const n = new Array(this._clientPromises.length);\n\n    for (let i = 0; i < this._clientPromises.length; ++i) {\n      const o = this._clientPromises[i];\n      n[i] = o.then(n => n.invoke(e, t, s));\n    }\n\n    return n;\n  }\n\n  close() {\n    let e;\n\n    for (; e = this._ongoingJobsQueue.pop();) e.deferred.reject(n(`Worker closing, aborting job calling '${e.methodName}'`));\n\n    for (const t of this._clientPromises) t.then(e => e.close());\n\n    this._clients.length = 0, this._clientPromises.length = 0;\n  }\n\n  invoke(e, t, s) {\n    let n = null;\n    Array.isArray(s) ? (h.warn(\"invoke()\", \"The transferList parameter is deprecated, use the options object instead\"), n = {\n      transferList: s\n    }) : n = s;\n    const o = i();\n\n    this._ongoingJobsQueue.push({\n      methodName: e,\n      data: t,\n      invokeOptions: n,\n      deferred: o\n    });\n\n    for (let i = 0; i < this._clientPromises.length; i++) {\n      const e = this._clients[i];\n      e ? e.jobAdded() : this._clientPromises[i].then(e => e.jobAdded());\n    }\n\n    return o.promise;\n  }\n\n  on(t, s) {\n    return Promise.all(this._clientPromises).then(() => e(this._clients.map(e => e.on(t, s))));\n  }\n\n  openPorts() {\n    return new Promise(e => {\n      const t = new Array(this._clientPromises.length);\n      let s = t.length;\n\n      for (let n = 0; n < this._clientPromises.length; ++n) {\n        this._clientPromises[n].then(i => {\n          t[n] = i.openPort(), 0 == --s && e(t);\n        });\n      }\n    });\n  }\n\n  get test() {\n    return {\n      numClients: this._clients.length\n    };\n  }\n\n}\n\nexport { c as default };","map":{"version":3,"names":["handlesGroup","e","t","isPromiseLike","s","createAbortError","n","createDeferred","i","throwIfAborted","o","r","l","h","getLogger","c","constructor","_inUseClients","Array","_clients","_clientPromises","_ongoingJobsQueue","destroy","close","closed","length","open","Promise","signal","then","pop","resolve","broadcast","invoke","deferred","reject","methodName","isArray","warn","transferList","push","data","invokeOptions","jobAdded","promise","on","all","map","openPorts","openPort","test","numClients","default"],"sources":["C:/Users/hp/Desktop/eco-friendly atmosphere/Atmosphere/eco-friendly/node_modules/@arcgis/core/core/workers/Connection.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport{handlesGroup as e}from\"../handleUtils.js\";import t from\"../Logger.js\";import{isPromiseLike as s,createAbortError as n,createDeferred as i,throwIfAborted as o}from\"../promiseUtils.js\";import r from\"../Queue.js\";import l from\"./RemoteClient.js\";const h=t.getLogger(\"esri.core.workers.Connection\");class c{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new r}destroy(){this.close()}get closed(){return!this._clients||!this._clients.length}open(e,t){return new Promise(((n,i)=>{let r=!0;const h=e=>{o(t.signal),r&&(r=!1,e())};this._clients.length=e.length,this._clientPromises.length=e.length,this._inUseClients.length=e.length;for(let o=0;o<e.length;++o){const r=e[o];s(r)?this._clientPromises[o]=r.then((e=>(this._clients[o]=new l(e,t,(()=>this._ongoingJobsQueue.pop())),h(n),this._clients[o])),(()=>(h(i),null))):(this._clients[o]=new l(r,t,(()=>this._ongoingJobsQueue.pop())),this._clientPromises[o]=Promise.resolve(this._clients[o]),h(n))}}))}broadcast(e,t,s){const n=new Array(this._clientPromises.length);for(let i=0;i<this._clientPromises.length;++i){const o=this._clientPromises[i];n[i]=o.then((n=>n.invoke(e,t,s)))}return n}close(){let e;for(;e=this._ongoingJobsQueue.pop();)e.deferred.reject(n(`Worker closing, aborting job calling '${e.methodName}'`));for(const t of this._clientPromises)t.then((e=>e.close()));this._clients.length=0,this._clientPromises.length=0}invoke(e,t,s){let n=null;Array.isArray(s)?(h.warn(\"invoke()\",\"The transferList parameter is deprecated, use the options object instead\"),n={transferList:s}):n=s;const o=i();this._ongoingJobsQueue.push({methodName:e,data:t,invokeOptions:n,deferred:o});for(let i=0;i<this._clientPromises.length;i++){const e=this._clients[i];e?e.jobAdded():this._clientPromises[i].then((e=>e.jobAdded()))}return o.promise}on(t,s){return Promise.all(this._clientPromises).then((()=>e(this._clients.map((e=>e.on(t,s))))))}openPorts(){return new Promise((e=>{const t=new Array(this._clientPromises.length);let s=t.length;for(let n=0;n<this._clientPromises.length;++n){this._clientPromises[n].then((i=>{t[n]=i.openPort(),0==--s&&e(t)}))}}))}get test(){return{numClients:this._clients.length}}}export{c as default};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}