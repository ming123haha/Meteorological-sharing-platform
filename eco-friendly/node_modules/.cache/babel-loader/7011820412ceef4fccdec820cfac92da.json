{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../chunks/tslib.es6.js\";\nimport t from \"../../../Color.js\";\nimport r from \"../../../core/Evented.js\";\nimport i from \"../../../core/Handles.js\";\nimport { destroyMaybe as s, isSome as n, isNone as o, mapOr as a } from \"../../../core/maybe.js\";\nimport { after as h } from \"../../../core/promiseUtils.js\";\nimport { watch as c, sync as d, syncAndInitial as l } from \"../../../core/reactiveUtils.js\";\nimport { property as p } from \"../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../core/arrayUtils.js\";\nimport \"../../../core/has.js\";\nimport \"../../../core/accessorSupport/ensureType.js\";\nimport { subclass as _ } from \"../../../core/accessorSupport/decorators/subclass.js\";\nimport { s as u, g as m, c as f, h as g } from \"../../../chunks/vec3.js\";\nimport { c as P, f as v } from \"../../../chunks/vec3f64.js\";\nimport { b, f as w } from \"../../../chunks/vec4f64.js\";\nimport { canProjectToWGS84ComparableLonLat as C, projectPointToWGS84ComparableLonLat as y } from \"../../../geometry/projection.js\";\nimport { isEarth as U } from \"../../../geometry/support/spatialReferenceUtils.js\";\nimport { ViewingMode as T } from \"../../ViewingMode.js\";\nimport { EnvironmentRenderer as R } from \"./EnvironmentRenderer.js\";\nimport { positionToTimezoneInfo as S } from \"../support/earthUtils.js\";\nimport { computeColorAndIntensity as M, ColorAndIntensity as H, computeShadowsEnabled as W } from \"../support/sunUtils.js\";\nimport { MainLight as G, AmbientLight as j, FillLight as k } from \"../webgl-engine/lighting/Lightsources.js\";\nimport E from \"../../../webscene/background/ColorBackground.js\";\nlet L = class extends r.EventedAccessor {\n  constructor() {\n    super(), this._referencePointUpdateDelay = 200, this._referencePointUpdateInterval = 3e3, this._referencePointUpdateDistThreshold = 1e6, this._referencePosUpdateQuery = null, this._referencePosMapCoordsRequested = null, this._viewHandles = new i(), this._preserveAbsoluteDateTime = !1, this._trackingEnabled = !1, this._referencePosResetPreserveAbsoluteTime = !1, this._referencePosUpdateTimer = null, this._referencePosMapCoords = null, this._mainLight = new G(), this._ambientLight = new j(), this._moonLight = new k(), this.disableQueries = !1, this._disableWeather = !1, this._renderer = null, this._referencePosWGS84Comparable = null, this._resetReferencePosition();\n  }\n\n  destroy() {\n    this.disconnectView(), this._viewHandles.destroy();\n  }\n\n  get _view() {\n    return this._renderer?.view;\n  }\n\n  get updating() {\n    return !((this.disableQueries || !this._referencePosUpdateQuery && !this._referencePosMapCoordsRequested) && !this._renderer?.updating);\n  }\n\n  get weatherEnabled() {\n    return this._view?.environment.atmosphereEnabled && !this._disableWeather && this._view?.state?.viewingMode === T.Global && U(this._view.spatialReference);\n  }\n\n  get weatherVisible() {\n    return this.weatherEnabled && this._renderer?.weatherVisible;\n  }\n\n  get referencePositionWGS84Comparable() {\n    return this._referencePosWGS84Comparable;\n  }\n\n  connectView(e) {\n    if (this._renderer) return;\n    this._renderer = new R({\n      view: e\n    });\n\n    const t = () => this._updateRenderParameters(),\n          r = () => this._cameraHandler(),\n          i = () => this._updateLighting();\n\n    this._viewHandles.add([c(() => e.environment.lighting, e => this._updateLightingHandler(e), d), c(() => \"sun\" === e.environment.lighting.type ? e.environment.lighting.date : null, e => this._lightingDateHandler(e), d), c(() => e.stationary, () => this._interactingStationaryHandler()), c(() => e.environment.lighting.directShadowsEnabled, t, d), c(() => e.environment.lighting.ambientOcclusionEnabled, t, d), c(() => e.environment.lighting.waterReflectionEnabled, t, d), c(() => e.environment.background?.color, t, d), c(() => e.spatialReference, () => this._resetReferencePosition(!0), d), c(() => e.environment.weather.type, i, d), c(() => this.weatherEnabled, i, d), c(() => e.viewingMode, () => this._resetReferencePosition(!0), l), c(() => \"sun\" === e.environment.lighting.type && e.environment.lighting.cameraTrackingEnabled, e => this._updateCameraTracking(e), l), c(() => e.state.camera, r, l), c(() => this.disableQueries, r)]), this._updateRenderParameters(), this._updateLighting(), this._cameraHandler(), this.notifyChange(\"updating\");\n  }\n\n  disconnectView() {\n    this._viewHandles.removeAll(), this._resetReferencePosition(), this._renderer = s(this._renderer);\n  }\n\n  _updateLightingHandler(e) {\n    this._updateCameraTracking(\"sun\" === e.type && e.cameraTrackingEnabled), this._lightingDateHandler(\"sun\" === e.type ? e.date : null), this._updateRenderParameters();\n  }\n\n  _updateCameraTracking(e) {\n    if (this._trackingEnabled = e, e) this._cameraHandler();else {\n      const e = this._view.environment.lighting;\n      \"sun\" === e?.type && (e.positionTimezoneInfo.autoUpdated = !1);\n    }\n  }\n\n  _lightingDateHandler(e) {\n    const t = this._view.environment.lighting;\n\n    if (\"virtual\" !== t?.type) {\n      if (e) {\n        if (!t.positionTimezoneInfo.autoUpdated) {\n          this._preserveAbsoluteDateTime = !0;\n          const r = this._view.spatialReference;\n\n          if (!C(r)) {\n            const e = this._view.camera.position;\n            if (!this._referencePosMapCoords || !this._referencePosMapCoords.equals(e)) return void this._requestReferencePositionUpdate(e);\n          }\n\n          if (this._preupdateTracking(e), n(this._referencePosWGS84Comparable)) {\n            const e = S(this._referencePosWGS84Comparable, A);\n            n(e) && (t.autoUpdate(null, e), this._trackingEnabled && (t.positionTimezoneInfo.autoUpdated = !0));\n          }\n        }\n\n        this._updateLighting(e);\n      }\n    } else this._updateLighting();\n  }\n\n  _preupdateTracking(e) {\n    !this._trackingEnabled && \"sun\" === this._view.environment.lighting.type && this._view.environment.lighting.cameraTrackingEnabled && this._cameraHandler(e);\n  }\n\n  _cameraHandler(e = null) {\n    const t = this._view;\n    if (!t.ready) return;\n    const r = t.stateManager.camera;\n    r && (this._cameraHandlerClientSide(r, e) || this._cameraHandlerServerSide(r));\n  }\n\n  _cameraHandlerClientSide(e, t) {\n    const r = U(this._view.spatialReference);\n    if (r && !C(this._view.spatialReference)) return !1;\n    const i = e.position;\n    return o(this._referencePosWGS84Comparable) && (this._referencePosWGS84Comparable = P()), r ? y(i, this._referencePosWGS84Comparable) : u(this._referencePosWGS84Comparable, i.longitude, i.latitude, i.z), this.notifyChange(\"referencePositionWGS84Comparable\"), this._autoUpdateTimezone(this._referencePosWGS84Comparable, t) || this._updateLighting(t), !0;\n  }\n\n  _cameraHandlerServerSide(e) {\n    const t = e.position;\n    (!this._referencePosMapCoords || this._referencePosMapCoordsRequested || this._exceedsReferencePosDistThreshold(t)) && this._requestReferencePositionUpdate(t, !0), this._view.mapCoordsHelper && this._referencePosWGS84Comparable && (this._referencePosWGS84Comparable[2] = t.z * this._view.mapCoordsHelper.unitInMeters, this._referencePosChanged());\n  }\n\n  _interactingStationaryHandler() {\n    this._view.stationary && this._executePendingReferencePositionUpdate();\n  }\n\n  _updateLighting(e) {\n    const t = this._view,\n          r = e || (\"sun\" === t.environment.lighting.type ? t.environment.lighting.date : null),\n          i = this._referencePosWGS84Comparable,\n          s = n(i) ? Q : D;\n\n    if (n(i)) {\n      const e = this.weatherVisible ? t.environment.weather.type : \"disabled\";\n      M(r, i, t.state.viewingMode, e, t.state.camera, t.environment.lighting.type, s);\n    }\n\n    const o = this._mainLight,\n          a = s.direct;\n    m(o.intensity, a.color, a.intensity * Math.PI), f(o.direction, a.directionToLightSource), o.specularStrength = s.specularStrength, o.environmentStrength = s.environmentStrength;\n    const h = this._ambientLight;\n    m(h.intensity, s.ambient.color, s.ambient.intensity);\n    const c = this._moonLight;\n    g(c.intensity, V, I, s.globalFactor);\n    const d = (1 - .5 * s.globalFactor) * (1 - .4 * s.noonFactor * (1 - s.globalFactor));\n    m(c.intensity, c.intensity, d), f(c.direction, a.directionToLightSource), t._stage.renderView.updateLightSources([o, h, c], 1 - s.noonFactor, s.globalFactor), this._updateRenderParameters();\n  }\n\n  _autoUpdateTimezone(e, t = null) {\n    if (\"virtual\" === this._view.environment.lighting.type || !this._view.environment.lighting.cameraTrackingEnabled || o(e)) return !1;\n    const r = q;\n    r.setTime((t || this._view.environment.lighting.date).getTime());\n    const i = S(e, A);\n    if (o(i)) return !1;\n    let s = this._view.environment.lighting.positionTimezoneInfo;\n\n    if (s.autoUpdated) {\n      if (s.hours === i.hours && s.minutes === i.minutes && s.seconds === i.seconds) return !1;\n    } else s = i;\n\n    const n = r.getUTCHours() - (i.hours - s.hours),\n          a = r.getUTCMinutes() - (i.minutes - s.minutes),\n          h = r.getUTCSeconds() - (i.seconds - s.seconds);\n    return r.setUTCHours(n), r.setUTCMinutes(a), r.setUTCSeconds(h), !t && this._view.environment.lighting.autoUpdate(r, i);\n  }\n\n  _updateRenderParameters() {\n    const e = this._view._stage;\n    if (!e) return;\n    const r = a(this._referencePosWGS84Comparable, !0, e => W(e[2], this._view.state.viewingMode)),\n          i = this._view.environment.background,\n          s = i instanceof E ? {\n      type: \"color\",\n      color: b(t.toUnitRGBA(i.color))\n    } : {\n      type: \"color\",\n      color: w(0, 0, 0, 1)\n    };\n    e.renderView.setRenderParameters({\n      shadowMap: this._view.environment.lighting.directShadowsEnabled && r,\n      background: s,\n      environment: this._view.environment,\n      weatherVisible: this._view.environmentManager.weatherVisible\n    });\n  }\n\n  _resetReferencePosition(e = !1) {\n    this._cancelReferencePosUpdates(), this._referencePosMapCoords = null, this._referencePosMapCoordsRequested = null, this._referencePosResetPreserveAbsoluteTime = null, this._referencePosWGS84Comparable = null, this.notifyChange(\"updating\"), e && this._cameraHandler();\n  }\n\n  _requestReferencePositionUpdate(e, t = !1) {\n    if (!this.disableQueries && (this._referencePosMapCoordsRequested ? this._referencePosMapCoordsRequested.copy(e) : this._referencePosMapCoordsRequested = e.clone(), this._referencePosResetPreserveAbsoluteTime = !!t, !this._referencePosUpdateQuery && !this._referencePosUpdateTimer && this._view.stationary)) {\n      const e = this._referencePosUpdateQuery = h(this._referencePointUpdateDelay).then(() => {\n        if (this._referencePosUpdateQuery === e) {\n          const t = () => this._referencePosUpdateQuery !== e;\n\n          return this._doReferencePositionUpdateQuery(t);\n        }\n      }).catch(e => {\n        \"mapcoordshelper:missing-geometry-service\" === e.name && (this.disableQueries = !0);\n      }).then(() => {\n        this._referencePosUpdateQuery === e && (this._referencePosUpdateQuery = null, this._referencePosUpdateTimer || this._executePendingReferencePositionUpdate(), this.notifyChange(\"updating\"));\n      }),\n            t = this._referencePosUpdateTimer = h(this._referencePointUpdateInterval).then(() => {\n        this._referencePosUpdateTimer === t && (this._referencePosUpdateTimer = null, this._referencePosUpdateQuery || this._executePendingReferencePositionUpdate());\n      });\n      this.notifyChange(\"updating\");\n    }\n  }\n\n  async _doReferencePositionUpdateQuery(e) {\n    this._referencePosResetPreserveAbsoluteTime && (this._preserveAbsoluteDateTime = !1), this._referencePosMapCoords ? this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested) : this._referencePosMapCoords = this._referencePosMapCoordsRequested.clone(), this._referencePosResetPreserveAbsoluteTime = null, this._referencePosMapCoordsRequested = null;\n    const t = await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);\n\n    if (!e() && !isNaN(t[0]) && !isNaN(t[1])) {\n      const e = this._referencePosMapCoords.z * this._view.mapCoordsHelper.unitInMeters;\n      this._referencePosWGS84Comparable ? (this._referencePosWGS84Comparable[0] = t[0], this._referencePosWGS84Comparable[1] = t[1], this._referencePosWGS84Comparable[2] = e) : this._referencePosWGS84Comparable = [t[0], t[1], e], this._referencePosChanged();\n    }\n  }\n\n  _executePendingReferencePositionUpdate() {\n    const e = this._referencePosMapCoordsRequested;\n    e && this._requestReferencePositionUpdate(e, this._referencePosResetPreserveAbsoluteTime);\n  }\n\n  _referencePosChanged() {\n    this._preserveAbsoluteDateTime ? this._updateLighting() : this._autoUpdateTimezone(this._referencePosWGS84Comparable) || this._updateLighting(), this.notifyChange(\"referencePositionWGS84Comparable\");\n  }\n\n  _exceedsReferencePosDistThreshold(e) {\n    if (this._referencePosMapCoords) {\n      let t = this._referencePosMapCoords.distance(e);\n\n      return this._view.mapCoordsHelper && (t *= this._view.mapCoordsHelper.unitInMeters), t > this._referencePointUpdateDistThreshold;\n    }\n\n    return !0;\n  }\n\n  _cancelReferencePosUpdates() {\n    const e = !!this._referencePosUpdateQuery;\n    return this._referencePosUpdateQuery = null, this._referencePosUpdateTimer = null, e;\n  }\n\n  get test() {\n    const e = this;\n    return {\n      get renderer() {\n        return e._renderer;\n      },\n\n      set referencePointUpdateInterval(t) {\n        e._referencePointUpdateInterval = t;\n      },\n\n      set referencePointUpdateDistThreshold(t) {\n        e._referencePointUpdateDistThreshold = t;\n      },\n\n      set referencePosUpdateTimer(t) {\n        e._referencePosUpdateTimer = t;\n      },\n\n      set referencePointUpdateDelay(t) {\n        e._referencePointUpdateDelay = t;\n      },\n\n      set disableWeather(t) {\n        e._disableWeather = t;\n      }\n\n    };\n  }\n\n};\ne([p({\n  type: Boolean,\n  readOnly: !0\n})], L.prototype, \"updating\", null), e([p()], L.prototype, \"disableQueries\", void 0), e([p()], L.prototype, \"_disableWeather\", void 0), e([p()], L.prototype, \"weatherEnabled\", null), e([p()], L.prototype, \"weatherVisible\", null), e([p()], L.prototype, \"referencePositionWGS84Comparable\", null), e([p()], L.prototype, \"_renderer\", void 0), e([p()], L.prototype, \"_referencePosWGS84Comparable\", void 0), L = e([_(\"esri.views.3d.environment.SceneViewEnvironmentManager\")], L);\nconst Q = new H(),\n      D = new H(),\n      q = new Date(),\n      A = {\n  hours: 0,\n  minutes: 0,\n  seconds: 0\n},\n      V = v(.22, .22, .33),\n      I = v(.22, .22, .22);\nexport { L as SceneViewEnvironmentManager };","map":{"version":3,"names":["_","e","t","r","i","destroyMaybe","s","isSome","n","isNone","o","mapOr","a","after","h","watch","c","sync","d","syncAndInitial","l","property","p","subclass","u","g","m","f","P","v","b","w","canProjectToWGS84ComparableLonLat","C","projectPointToWGS84ComparableLonLat","y","isEarth","U","ViewingMode","T","EnvironmentRenderer","R","positionToTimezoneInfo","S","computeColorAndIntensity","M","ColorAndIntensity","H","computeShadowsEnabled","W","MainLight","G","AmbientLight","j","FillLight","k","E","L","EventedAccessor","constructor","_referencePointUpdateDelay","_referencePointUpdateInterval","_referencePointUpdateDistThreshold","_referencePosUpdateQuery","_referencePosMapCoordsRequested","_viewHandles","_preserveAbsoluteDateTime","_trackingEnabled","_referencePosResetPreserveAbsoluteTime","_referencePosUpdateTimer","_referencePosMapCoords","_mainLight","_ambientLight","_moonLight","disableQueries","_disableWeather","_renderer","_referencePosWGS84Comparable","_resetReferencePosition","destroy","disconnectView","_view","view","updating","weatherEnabled","environment","atmosphereEnabled","state","viewingMode","Global","spatialReference","weatherVisible","referencePositionWGS84Comparable","connectView","_updateRenderParameters","_cameraHandler","_updateLighting","add","lighting","_updateLightingHandler","type","date","_lightingDateHandler","stationary","_interactingStationaryHandler","directShadowsEnabled","ambientOcclusionEnabled","waterReflectionEnabled","background","color","weather","cameraTrackingEnabled","_updateCameraTracking","camera","notifyChange","removeAll","positionTimezoneInfo","autoUpdated","position","equals","_requestReferencePositionUpdate","_preupdateTracking","A","autoUpdate","ready","stateManager","_cameraHandlerClientSide","_cameraHandlerServerSide","longitude","latitude","z","_autoUpdateTimezone","_exceedsReferencePosDistThreshold","mapCoordsHelper","unitInMeters","_referencePosChanged","_executePendingReferencePositionUpdate","Q","D","direct","intensity","Math","PI","direction","directionToLightSource","specularStrength","environmentStrength","ambient","V","I","globalFactor","noonFactor","_stage","renderView","updateLightSources","q","setTime","getTime","hours","minutes","seconds","getUTCHours","getUTCMinutes","getUTCSeconds","setUTCHours","setUTCMinutes","setUTCSeconds","toUnitRGBA","setRenderParameters","shadowMap","environmentManager","_cancelReferencePosUpdates","copy","clone","then","_doReferencePositionUpdateQuery","catch","name","toGeographic","isNaN","distance","test","renderer","referencePointUpdateInterval","referencePointUpdateDistThreshold","referencePosUpdateTimer","referencePointUpdateDelay","disableWeather","Boolean","readOnly","prototype","Date","SceneViewEnvironmentManager"],"sources":["C:/Users/hp/Desktop/eco-friendly atmosphere/Atmosphere/eco-friendly/node_modules/@arcgis/core/views/3d/environment/SceneViewEnvironmentManager.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import t from\"../../../Color.js\";import r from\"../../../core/Evented.js\";import i from\"../../../core/Handles.js\";import{destroyMaybe as s,isSome as n,isNone as o,mapOr as a}from\"../../../core/maybe.js\";import{after as h}from\"../../../core/promiseUtils.js\";import{watch as c,sync as d,syncAndInitial as l}from\"../../../core/reactiveUtils.js\";import{property as p}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/arrayUtils.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import{subclass as _}from\"../../../core/accessorSupport/decorators/subclass.js\";import{s as u,g as m,c as f,h as g}from\"../../../chunks/vec3.js\";import{c as P,f as v}from\"../../../chunks/vec3f64.js\";import{b,f as w}from\"../../../chunks/vec4f64.js\";import{canProjectToWGS84ComparableLonLat as C,projectPointToWGS84ComparableLonLat as y}from\"../../../geometry/projection.js\";import{isEarth as U}from\"../../../geometry/support/spatialReferenceUtils.js\";import{ViewingMode as T}from\"../../ViewingMode.js\";import{EnvironmentRenderer as R}from\"./EnvironmentRenderer.js\";import{positionToTimezoneInfo as S}from\"../support/earthUtils.js\";import{computeColorAndIntensity as M,ColorAndIntensity as H,computeShadowsEnabled as W}from\"../support/sunUtils.js\";import{MainLight as G,AmbientLight as j,FillLight as k}from\"../webgl-engine/lighting/Lightsources.js\";import E from\"../../../webscene/background/ColorBackground.js\";let L=class extends r.EventedAccessor{constructor(){super(),this._referencePointUpdateDelay=200,this._referencePointUpdateInterval=3e3,this._referencePointUpdateDistThreshold=1e6,this._referencePosUpdateQuery=null,this._referencePosMapCoordsRequested=null,this._viewHandles=new i,this._preserveAbsoluteDateTime=!1,this._trackingEnabled=!1,this._referencePosResetPreserveAbsoluteTime=!1,this._referencePosUpdateTimer=null,this._referencePosMapCoords=null,this._mainLight=new G,this._ambientLight=new j,this._moonLight=new k,this.disableQueries=!1,this._disableWeather=!1,this._renderer=null,this._referencePosWGS84Comparable=null,this._resetReferencePosition()}destroy(){this.disconnectView(),this._viewHandles.destroy()}get _view(){return this._renderer?.view}get updating(){return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!this._renderer?.updating)}get weatherEnabled(){return this._view?.environment.atmosphereEnabled&&!this._disableWeather&&this._view?.state?.viewingMode===T.Global&&U(this._view.spatialReference)}get weatherVisible(){return this.weatherEnabled&&this._renderer?.weatherVisible}get referencePositionWGS84Comparable(){return this._referencePosWGS84Comparable}connectView(e){if(this._renderer)return;this._renderer=new R({view:e});const t=()=>this._updateRenderParameters(),r=()=>this._cameraHandler(),i=()=>this._updateLighting();this._viewHandles.add([c((()=>e.environment.lighting),(e=>this._updateLightingHandler(e)),d),c((()=>\"sun\"===e.environment.lighting.type?e.environment.lighting.date:null),(e=>this._lightingDateHandler(e)),d),c((()=>e.stationary),(()=>this._interactingStationaryHandler())),c((()=>e.environment.lighting.directShadowsEnabled),t,d),c((()=>e.environment.lighting.ambientOcclusionEnabled),t,d),c((()=>e.environment.lighting.waterReflectionEnabled),t,d),c((()=>e.environment.background?.color),t,d),c((()=>e.spatialReference),(()=>this._resetReferencePosition(!0)),d),c((()=>e.environment.weather.type),i,d),c((()=>this.weatherEnabled),i,d),c((()=>e.viewingMode),(()=>this._resetReferencePosition(!0)),l),c((()=>\"sun\"===e.environment.lighting.type&&e.environment.lighting.cameraTrackingEnabled),(e=>this._updateCameraTracking(e)),l),c((()=>e.state.camera),r,l),c((()=>this.disableQueries),r)]),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange(\"updating\")}disconnectView(){this._viewHandles.removeAll(),this._resetReferencePosition(),this._renderer=s(this._renderer)}_updateLightingHandler(e){this._updateCameraTracking(\"sun\"===e.type&&e.cameraTrackingEnabled),this._lightingDateHandler(\"sun\"===e.type?e.date:null),this._updateRenderParameters()}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{const e=this._view.environment.lighting;\"sun\"===e?.type&&(e.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){const t=this._view.environment.lighting;if(\"virtual\"!==t?.type){if(e){if(!t.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;const r=this._view.spatialReference;if(!C(r)){const e=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(e))return void this._requestReferencePositionUpdate(e)}if(this._preupdateTracking(e),n(this._referencePosWGS84Comparable)){const e=S(this._referencePosWGS84Comparable,A);n(e)&&(t.autoUpdate(null,e),this._trackingEnabled&&(t.positionTimezoneInfo.autoUpdated=!0))}}this._updateLighting(e)}}else this._updateLighting()}_preupdateTracking(e){!this._trackingEnabled&&\"sun\"===this._view.environment.lighting.type&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){const t=this._view;if(!t.ready)return;const r=t.stateManager.camera;r&&(this._cameraHandlerClientSide(r,e)||this._cameraHandlerServerSide(r))}_cameraHandlerClientSide(e,t){const r=U(this._view.spatialReference);if(r&&!C(this._view.spatialReference))return!1;const i=e.position;return o(this._referencePosWGS84Comparable)&&(this._referencePosWGS84Comparable=P()),r?y(i,this._referencePosWGS84Comparable):u(this._referencePosWGS84Comparable,i.longitude,i.latitude,i.z),this.notifyChange(\"referencePositionWGS84Comparable\"),this._autoUpdateTimezone(this._referencePosWGS84Comparable,t)||this._updateLighting(t),!0}_cameraHandlerServerSide(e){const t=e.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(t))&&this._requestReferencePositionUpdate(t,!0),this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=t.z*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&this._executePendingReferencePositionUpdate()}_updateLighting(e){const t=this._view,r=e||(\"sun\"===t.environment.lighting.type?t.environment.lighting.date:null),i=this._referencePosWGS84Comparable,s=n(i)?Q:D;if(n(i)){const e=this.weatherVisible?t.environment.weather.type:\"disabled\";M(r,i,t.state.viewingMode,e,t.state.camera,t.environment.lighting.type,s)}const o=this._mainLight,a=s.direct;m(o.intensity,a.color,a.intensity*Math.PI),f(o.direction,a.directionToLightSource),o.specularStrength=s.specularStrength,o.environmentStrength=s.environmentStrength;const h=this._ambientLight;m(h.intensity,s.ambient.color,s.ambient.intensity);const c=this._moonLight;g(c.intensity,V,I,s.globalFactor);const d=(1-.5*s.globalFactor)*(1-.4*s.noonFactor*(1-s.globalFactor));m(c.intensity,c.intensity,d),f(c.direction,a.directionToLightSource),t._stage.renderView.updateLightSources([o,h,c],1-s.noonFactor,s.globalFactor),this._updateRenderParameters()}_autoUpdateTimezone(e,t=null){if(\"virtual\"===this._view.environment.lighting.type||!this._view.environment.lighting.cameraTrackingEnabled||o(e))return!1;const r=q;r.setTime((t||this._view.environment.lighting.date).getTime());const i=S(e,A);if(o(i))return!1;let s=this._view.environment.lighting.positionTimezoneInfo;if(s.autoUpdated){if(s.hours===i.hours&&s.minutes===i.minutes&&s.seconds===i.seconds)return!1}else s=i;const n=r.getUTCHours()-(i.hours-s.hours),a=r.getUTCMinutes()-(i.minutes-s.minutes),h=r.getUTCSeconds()-(i.seconds-s.seconds);return r.setUTCHours(n),r.setUTCMinutes(a),r.setUTCSeconds(h),!t&&this._view.environment.lighting.autoUpdate(r,i)}_updateRenderParameters(){const e=this._view._stage;if(!e)return;const r=a(this._referencePosWGS84Comparable,!0,(e=>W(e[2],this._view.state.viewingMode))),i=this._view.environment.background,s=i instanceof E?{type:\"color\",color:b(t.toUnitRGBA(i.color))}:{type:\"color\",color:w(0,0,0,1)};e.renderView.setRenderParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&r,background:s,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible})}_resetReferencePosition(e=!1){this._cancelReferencePosUpdates(),this._referencePosMapCoords=null,this._referencePosMapCoordsRequested=null,this._referencePosResetPreserveAbsoluteTime=null,this._referencePosWGS84Comparable=null,this.notifyChange(\"updating\"),e&&this._cameraHandler()}_requestReferencePositionUpdate(e,t=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(e):this._referencePosMapCoordsRequested=e.clone(),this._referencePosResetPreserveAbsoluteTime=!!t,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const e=this._referencePosUpdateQuery=h(this._referencePointUpdateDelay).then((()=>{if(this._referencePosUpdateQuery===e){const t=()=>this._referencePosUpdateQuery!==e;return this._doReferencePositionUpdateQuery(t)}})).catch((e=>{\"mapcoordshelper:missing-geometry-service\"===e.name&&(this.disableQueries=!0)})).then((()=>{this._referencePosUpdateQuery===e&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange(\"updating\"))})),t=this._referencePosUpdateTimer=h(this._referencePointUpdateInterval).then((()=>{this._referencePosUpdateTimer===t&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())}));this.notifyChange(\"updating\")}}async _doReferencePositionUpdateQuery(e){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosResetPreserveAbsoluteTime=null,this._referencePosMapCoordsRequested=null;const t=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);if(!e()&&!isNaN(t[0])&&!isNaN(t[1])){const e=this._referencePosMapCoords.z*this._view.mapCoordsHelper.unitInMeters;this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=t[0],this._referencePosWGS84Comparable[1]=t[1],this._referencePosWGS84Comparable[2]=e):this._referencePosWGS84Comparable=[t[0],t[1],e],this._referencePosChanged()}}_executePendingReferencePositionUpdate(){const e=this._referencePosMapCoordsRequested;e&&this._requestReferencePositionUpdate(e,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLighting(),this.notifyChange(\"referencePositionWGS84Comparable\")}_exceedsReferencePosDistThreshold(e){if(this._referencePosMapCoords){let t=this._referencePosMapCoords.distance(e);return this._view.mapCoordsHelper&&(t*=this._view.mapCoordsHelper.unitInMeters),t>this._referencePointUpdateDistThreshold}return!0}_cancelReferencePosUpdates(){const e=!!this._referencePosUpdateQuery;return this._referencePosUpdateQuery=null,this._referencePosUpdateTimer=null,e}get test(){const e=this;return{get renderer(){return e._renderer},set referencePointUpdateInterval(t){e._referencePointUpdateInterval=t},set referencePointUpdateDistThreshold(t){e._referencePointUpdateDistThreshold=t},set referencePosUpdateTimer(t){e._referencePosUpdateTimer=t},set referencePointUpdateDelay(t){e._referencePointUpdateDelay=t},set disableWeather(t){e._disableWeather=t}}}};e([p({type:Boolean,readOnly:!0})],L.prototype,\"updating\",null),e([p()],L.prototype,\"disableQueries\",void 0),e([p()],L.prototype,\"_disableWeather\",void 0),e([p()],L.prototype,\"weatherEnabled\",null),e([p()],L.prototype,\"weatherVisible\",null),e([p()],L.prototype,\"referencePositionWGS84Comparable\",null),e([p()],L.prototype,\"_renderer\",void 0),e([p()],L.prototype,\"_referencePosWGS84Comparable\",void 0),L=e([_(\"esri.views.3d.environment.SceneViewEnvironmentManager\")],L);const Q=new H,D=new H,q=new Date,A={hours:0,minutes:0,seconds:0},V=v(.22,.22,.33),I=v(.22,.22,.22);export{L as SceneViewEnvironmentManager};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}