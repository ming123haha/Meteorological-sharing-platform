{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport { _ as t } from \"../../../chunks/tslib.es6.js\";\nimport e from \"../../../Graphic.js\";\nimport o from \"../../../core/Accessor.js\";\nimport { HandleOwnerMixin as r } from \"../../../core/HandleOwner.js\";\nimport { watch as n, initial as s } from \"../../../core/reactiveUtils.js\";\nimport { throttle as i } from \"../../../core/throttle.js\";\nimport { property as l } from \"../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../core/arrayUtils.js\";\nimport \"../../../core/accessorSupport/ensureType.js\";\nimport { subclass as p } from \"../../../core/accessorSupport/decorators/subclass.js\";\nimport \"../../../popup/content/AttachmentsContent.js\";\nimport \"../../../popup/content/Content.js\";\nimport \"../../../popup/content/CustomContent.js\";\nimport \"../../../popup/content/ExpressionContent.js\";\nimport a from \"../../../popup/content/FieldsContent.js\";\nimport c from \"../../../popup/content/MediaContent.js\";\nimport \"../../../popup/content/RelationshipContent.js\";\nimport m from \"../../../popup/content/TextContent.js\";\nimport h from \"../../../popup/ElementExpressionInfo.js\";\nimport u from \"../FeatureContent/FeatureContentViewModel.js\";\nimport d from \"../FeatureFields/FeatureFieldsViewModel.js\";\nimport f from \"../FeatureMedia/FeatureMediaViewModel.js\";\nimport { loadArcadeUtils as y, createCompiledExpression as _ } from \"../support/arcadeFeatureUtils.js\";\nconst w = 1;\nlet j = class extends r(o) {\n  constructor(t) {\n    super(t), this._abortController = null, this.expressionInfo = null, this.graphic = null, this.contentElement = null, this.contentElementViewModel = null, this.interceptor = null, this.view = null, this._cancelQuery = () => {\n      const {\n        _abortController: t\n      } = this;\n      t && t.abort(), this._abortController = null;\n    }, this._createVM = () => {\n      const t = this.contentElement?.type;\n      this.contentElementViewModel?.destroy();\n      const e = \"fields\" === t ? new d() : \"media\" === t ? new f() : \"text\" === t ? new u() : null;\n\n      this._set(\"contentElementViewModel\", e);\n    }, this._compile = async () => {\n      this._cancelQuery();\n\n      const t = new AbortController();\n      this._abortController = t, await this._compileExpression(), this._abortController === t && (this._abortController = null);\n    }, this._compileThrottled = i(this._compile, w, this), this._compileExpression = async () => {\n      const {\n        expressionInfo: t,\n        graphic: e,\n        interceptor: o,\n        spatialReference: r,\n        map: n,\n        view: s,\n        _abortController: i\n      } = this;\n      if (!(t && e && r && n)) return void this._set(\"contentElement\", null);\n      const l = await y();\n      if (i !== this._abortController) return;\n      const p = await _({\n        arcadeUtils: l,\n        expressionInfo: t,\n        graphic: e,\n        interceptor: o,\n        map: n,\n        spatialReference: r,\n        view: s\n      });\n      if (!p || \"esri.arcade.Dictionary\" !== p.declaredClass) return void this._set(\"contentElement\", null);\n      const h = await p.castAsJsonAsync(i.signal),\n            u = h?.type,\n            d = \"media\" === u ? c.fromJSON(h) : \"text\" === u ? m.fromJSON(h) : \"fields\" === u ? a.fromJSON(h) : null;\n\n      this._set(\"contentElement\", d);\n    }, this.handles.add([n(() => [this.expressionInfo, this.graphic, this.map, this.spatialReference, this.view], () => this._compileThrottled(), s), n(() => [this.contentElement], () => this._createVM(), s)]);\n  }\n\n  destroy() {\n    this._cancelQuery(), this.contentElementViewModel?.destroy(), this._set(\"contentElementViewModel\", null), this._set(\"contentElement\", null);\n  }\n\n  get spatialReference() {\n    return this.view?.spatialReference ?? null;\n  }\n\n  set spatialReference(t) {\n    this._override(\"spatialReference\", t);\n  }\n\n  get state() {\n    const {\n      _abortController: t,\n      contentElement: e,\n      contentElementViewModel: o\n    } = this;\n    return t ? \"loading\" : e || o ? \"ready\" : \"disabled\";\n  }\n\n  get map() {\n    return this.view?.map ?? null;\n  }\n\n  set map(t) {\n    this._override(\"map\", t);\n  }\n\n};\nt([l()], j.prototype, \"_abortController\", void 0), t([l({\n  type: h\n})], j.prototype, \"expressionInfo\", void 0), t([l({\n  type: e\n})], j.prototype, \"graphic\", void 0), t([l({\n  readOnly: !0\n})], j.prototype, \"contentElement\", void 0), t([l({\n  readOnly: !0\n})], j.prototype, \"contentElementViewModel\", void 0), t([l()], j.prototype, \"interceptor\", void 0), t([l()], j.prototype, \"spatialReference\", null), t([l({\n  readOnly: !0\n})], j.prototype, \"state\", null), t([l()], j.prototype, \"map\", null), t([l()], j.prototype, \"view\", void 0), j = t([p(\"esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel\")], j);\nconst C = j;\nexport { C as default };","map":{"version":3,"names":["_","t","e","o","HandleOwnerMixin","r","watch","n","initial","s","throttle","i","property","l","subclass","p","a","c","m","h","u","d","f","loadArcadeUtils","y","createCompiledExpression","w","j","constructor","_abortController","expressionInfo","graphic","contentElement","contentElementViewModel","interceptor","view","_cancelQuery","abort","_createVM","type","destroy","_set","_compile","AbortController","_compileExpression","_compileThrottled","spatialReference","map","arcadeUtils","declaredClass","castAsJsonAsync","signal","fromJSON","handles","add","_override","state","prototype","readOnly","C","default"],"sources":["E:/各个学科/论文/毕业论文/Atmosphere/eco-friendly/node_modules/@arcgis/core/widgets/Feature/FeatureExpression/FeatureExpressionViewModel.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../../chunks/tslib.es6.js\";import e from\"../../../Graphic.js\";import o from\"../../../core/Accessor.js\";import{HandleOwnerMixin as r}from\"../../../core/HandleOwner.js\";import{watch as n,initial as s}from\"../../../core/reactiveUtils.js\";import{throttle as i}from\"../../../core/throttle.js\";import{property as l}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/arrayUtils.js\";import\"../../../core/accessorSupport/ensureType.js\";import{subclass as p}from\"../../../core/accessorSupport/decorators/subclass.js\";import\"../../../popup/content/AttachmentsContent.js\";import\"../../../popup/content/Content.js\";import\"../../../popup/content/CustomContent.js\";import\"../../../popup/content/ExpressionContent.js\";import a from\"../../../popup/content/FieldsContent.js\";import c from\"../../../popup/content/MediaContent.js\";import\"../../../popup/content/RelationshipContent.js\";import m from\"../../../popup/content/TextContent.js\";import h from\"../../../popup/ElementExpressionInfo.js\";import u from\"../FeatureContent/FeatureContentViewModel.js\";import d from\"../FeatureFields/FeatureFieldsViewModel.js\";import f from\"../FeatureMedia/FeatureMediaViewModel.js\";import{loadArcadeUtils as y,createCompiledExpression as _}from\"../support/arcadeFeatureUtils.js\";const w=1;let j=class extends(r(o)){constructor(t){super(t),this._abortController=null,this.expressionInfo=null,this.graphic=null,this.contentElement=null,this.contentElementViewModel=null,this.interceptor=null,this.view=null,this._cancelQuery=()=>{const{_abortController:t}=this;t&&t.abort(),this._abortController=null},this._createVM=()=>{const t=this.contentElement?.type;this.contentElementViewModel?.destroy();const e=\"fields\"===t?new d:\"media\"===t?new f:\"text\"===t?new u:null;this._set(\"contentElementViewModel\",e)},this._compile=async()=>{this._cancelQuery();const t=new AbortController;this._abortController=t,await this._compileExpression(),this._abortController===t&&(this._abortController=null)},this._compileThrottled=i(this._compile,w,this),this._compileExpression=async()=>{const{expressionInfo:t,graphic:e,interceptor:o,spatialReference:r,map:n,view:s,_abortController:i}=this;if(!(t&&e&&r&&n))return void this._set(\"contentElement\",null);const l=await y();if(i!==this._abortController)return;const p=await _({arcadeUtils:l,expressionInfo:t,graphic:e,interceptor:o,map:n,spatialReference:r,view:s});if(!p||\"esri.arcade.Dictionary\"!==p.declaredClass)return void this._set(\"contentElement\",null);const h=await p.castAsJsonAsync(i.signal),u=h?.type,d=\"media\"===u?c.fromJSON(h):\"text\"===u?m.fromJSON(h):\"fields\"===u?a.fromJSON(h):null;this._set(\"contentElement\",d)},this.handles.add([n((()=>[this.expressionInfo,this.graphic,this.map,this.spatialReference,this.view]),(()=>this._compileThrottled()),s),n((()=>[this.contentElement]),(()=>this._createVM()),s)])}destroy(){this._cancelQuery(),this.contentElementViewModel?.destroy(),this._set(\"contentElementViewModel\",null),this._set(\"contentElement\",null)}get spatialReference(){return this.view?.spatialReference??null}set spatialReference(t){this._override(\"spatialReference\",t)}get state(){const{_abortController:t,contentElement:e,contentElementViewModel:o}=this;return t?\"loading\":e||o?\"ready\":\"disabled\"}get map(){return this.view?.map??null}set map(t){this._override(\"map\",t)}};t([l()],j.prototype,\"_abortController\",void 0),t([l({type:h})],j.prototype,\"expressionInfo\",void 0),t([l({type:e})],j.prototype,\"graphic\",void 0),t([l({readOnly:!0})],j.prototype,\"contentElement\",void 0),t([l({readOnly:!0})],j.prototype,\"contentElementViewModel\",void 0),t([l()],j.prototype,\"interceptor\",void 0),t([l()],j.prototype,\"spatialReference\",null),t([l({readOnly:!0})],j.prototype,\"state\",null),t([l()],j.prototype,\"map\",null),t([l()],j.prototype,\"view\",void 0),j=t([p(\"esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel\")],j);const C=j;export{C as default};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}