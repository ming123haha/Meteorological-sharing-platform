{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport e from \"../../../core/Error.js\";\nimport t from \"../../../core/Logger.js\";\nimport { isSome as r, unwrap as s } from \"../../../core/maybe.js\";\nimport { throwIfAborted as a, createTask as i, isAbortError as o } from \"../../../core/promiseUtils.js\";\nimport { equals as n, WGS84 as u } from \"../../../geometry/support/spatialReferenceUtils.js\";\nimport { convertFromGeometry as p, convertToGeometry as h } from \"../featureConversionUtils.js\";\nimport y from \"../data/FeatureStore.js\";\nimport { project as c, checkProjectionSupport as m } from \"../data/projectionSupport.js\";\nimport { QueryEngine as l } from \"../data/QueryEngine.js\";\nimport { validateGeoJSON as g, createOptimizedFeatures as _ } from \"./geojson/geojson.js\";\nimport { mixAttributes as f } from \"./support/sourceUtils.js\";\nimport { getFeature as d } from \"../../ogc/wfsUtils.js\";\nimport w from \"../../support/FieldsIndex.js\";\n\nclass E {\n  constructor() {\n    this._queryEngine = null, this._customParameters = null, this._snapshotFeatures = async e => {\n      const {\n        objectIdField: t\n      } = this._queryEngine,\n            s = await d(this._getFeatureUrl, this._featureType.typeName, this._getFeatureOutputFormat, {\n        customParameters: this._customParameters,\n        dateFields: this._queryEngine.fieldsIndex.dateFields.map(e => e.name),\n        signal: e\n      });\n      await g(s), a(e);\n\n      const i = _(s, {\n        geometryType: this._queryEngine.geometryType,\n        hasZ: !1,\n        objectIdField: t\n      });\n\n      if (!n(this._queryEngine.spatialReference, u)) for (const a of i) r(a.geometry) && (a.geometry = p(c(h(a.geometry, this._queryEngine.geometryType, !1, !1), u, this._queryEngine.spatialReference)));\n      let o = 1;\n\n      for (const r of i) {\n        const e = {};\n        f(this._fieldsIndex, e, r.attributes, !0), r.attributes = e, null == r.attributes[t] && (r.objectId = r.attributes[t] = o++);\n      }\n\n      return i;\n    };\n  }\n\n  destroy() {\n    this._queryEngine?.destroy(), this._queryEngine = null;\n  }\n\n  async load(e, t) {\n    const {\n      getFeatureUrl: r,\n      getFeatureOutputFormat: i,\n      spatialReference: o,\n      fields: n,\n      geometryType: u,\n      featureType: p,\n      objectIdField: h,\n      customParameters: c\n    } = e;\n    this._featureType = p, this._customParameters = c, this._getFeatureUrl = r, this._getFeatureOutputFormat = i, this._fieldsIndex = new w(n), await this._checkProjection(o), a(t), this._queryEngine = new l({\n      fields: n,\n      geometryType: u,\n      hasM: !1,\n      hasZ: !1,\n      objectIdField: h,\n      spatialReference: o,\n      timeInfo: null,\n      featureStore: new y({\n        geometryType: u,\n        hasM: !1,\n        hasZ: !1\n      })\n    });\n    const m = await this._snapshotFeatures(s(t.signal));\n    return this._queryEngine.featureStore.addMany(m), {\n      extent: this._queryEngine.fullExtent\n    };\n  }\n\n  async applyEdits() {\n    throw new e(\"wfs-source:editing-not-supported\", \"applyEdits() is not supported on WFSLayer\");\n  }\n\n  async queryFeatures(e = {}, t = {}) {\n    return await this._waitSnapshotComplete(), this._queryEngine.executeQuery(e, t.signal);\n  }\n\n  async queryFeatureCount(e = {}, t = {}) {\n    return await this._waitSnapshotComplete(), this._queryEngine.executeQueryForCount(e, t.signal);\n  }\n\n  async queryObjectIds(e = {}, t = {}) {\n    return await this._waitSnapshotComplete(), this._queryEngine.executeQueryForIds(e, t.signal);\n  }\n\n  async queryExtent(e = {}, t = {}) {\n    return await this._waitSnapshotComplete(), this._queryEngine.executeQueryForExtent(e, t.signal);\n  }\n\n  async querySnapping(e, t = {}) {\n    return await this._waitSnapshotComplete(), this._queryEngine.executeQueryForSnapping(e, t.signal);\n  }\n\n  async refresh(r) {\n    return this._customParameters = r, this._snapshotTask?.abort(), this._snapshotTask = i(this._snapshotFeatures), this._snapshotTask.promise.then(e => {\n      this._queryEngine.featureStore.clear(), e && this._queryEngine.featureStore.addMany(e);\n    }, r => {\n      this._queryEngine.featureStore.clear(), o(r) || t.getLogger(\"esri.layers.WFSLayer\").error(new e(\"wfs-layer:getfeature-error\", \"An error occurred during the GetFeature request\", {\n        error: r\n      }));\n    }), await this._waitSnapshotComplete(), {\n      extent: this._queryEngine.fullExtent\n    };\n  }\n\n  async _waitSnapshotComplete() {\n    if (this._snapshotTask && !this._snapshotTask.finished) {\n      try {\n        await this._snapshotTask.promise;\n      } catch {}\n\n      return this._waitSnapshotComplete();\n    }\n  }\n\n  async _checkProjection(t) {\n    try {\n      await m(u, t);\n    } catch {\n      throw new e(\"unsupported-projection\", \"Projection not supported\", {\n        spatialReference: t\n      });\n    }\n  }\n\n}\n\nexport { E as default };","map":{"version":3,"names":["e","t","isSome","r","unwrap","s","throwIfAborted","a","createTask","i","isAbortError","o","equals","n","WGS84","u","convertFromGeometry","p","convertToGeometry","h","y","project","c","checkProjectionSupport","m","QueryEngine","l","validateGeoJSON","g","createOptimizedFeatures","_","mixAttributes","f","getFeature","d","w","E","constructor","_queryEngine","_customParameters","_snapshotFeatures","objectIdField","_getFeatureUrl","_featureType","typeName","_getFeatureOutputFormat","customParameters","dateFields","fieldsIndex","map","name","signal","geometryType","hasZ","spatialReference","geometry","_fieldsIndex","attributes","objectId","destroy","load","getFeatureUrl","getFeatureOutputFormat","fields","featureType","_checkProjection","hasM","timeInfo","featureStore","addMany","extent","fullExtent","applyEdits","queryFeatures","_waitSnapshotComplete","executeQuery","queryFeatureCount","executeQueryForCount","queryObjectIds","executeQueryForIds","queryExtent","executeQueryForExtent","querySnapping","executeQueryForSnapping","refresh","_snapshotTask","abort","promise","then","clear","getLogger","error","finished","default"],"sources":["C:/Users/hp/Desktop/eco-friendly atmosphere/Atmosphere/eco-friendly/node_modules/@arcgis/core/layers/graphics/sources/WFSSourceWorker.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport e from\"../../../core/Error.js\";import t from\"../../../core/Logger.js\";import{isSome as r,unwrap as s}from\"../../../core/maybe.js\";import{throwIfAborted as a,createTask as i,isAbortError as o}from\"../../../core/promiseUtils.js\";import{equals as n,WGS84 as u}from\"../../../geometry/support/spatialReferenceUtils.js\";import{convertFromGeometry as p,convertToGeometry as h}from\"../featureConversionUtils.js\";import y from\"../data/FeatureStore.js\";import{project as c,checkProjectionSupport as m}from\"../data/projectionSupport.js\";import{QueryEngine as l}from\"../data/QueryEngine.js\";import{validateGeoJSON as g,createOptimizedFeatures as _}from\"./geojson/geojson.js\";import{mixAttributes as f}from\"./support/sourceUtils.js\";import{getFeature as d}from\"../../ogc/wfsUtils.js\";import w from\"../../support/FieldsIndex.js\";class E{constructor(){this._queryEngine=null,this._customParameters=null,this._snapshotFeatures=async e=>{const{objectIdField:t}=this._queryEngine,s=await d(this._getFeatureUrl,this._featureType.typeName,this._getFeatureOutputFormat,{customParameters:this._customParameters,dateFields:this._queryEngine.fieldsIndex.dateFields.map((e=>e.name)),signal:e});await g(s),a(e);const i=_(s,{geometryType:this._queryEngine.geometryType,hasZ:!1,objectIdField:t});if(!n(this._queryEngine.spatialReference,u))for(const a of i)r(a.geometry)&&(a.geometry=p(c(h(a.geometry,this._queryEngine.geometryType,!1,!1),u,this._queryEngine.spatialReference)));let o=1;for(const r of i){const e={};f(this._fieldsIndex,e,r.attributes,!0),r.attributes=e,null==r.attributes[t]&&(r.objectId=r.attributes[t]=o++)}return i}}destroy(){this._queryEngine?.destroy(),this._queryEngine=null}async load(e,t){const{getFeatureUrl:r,getFeatureOutputFormat:i,spatialReference:o,fields:n,geometryType:u,featureType:p,objectIdField:h,customParameters:c}=e;this._featureType=p,this._customParameters=c,this._getFeatureUrl=r,this._getFeatureOutputFormat=i,this._fieldsIndex=new w(n),await this._checkProjection(o),a(t),this._queryEngine=new l({fields:n,geometryType:u,hasM:!1,hasZ:!1,objectIdField:h,spatialReference:o,timeInfo:null,featureStore:new y({geometryType:u,hasM:!1,hasZ:!1})});const m=await this._snapshotFeatures(s(t.signal));return this._queryEngine.featureStore.addMany(m),{extent:this._queryEngine.fullExtent}}async applyEdits(){throw new e(\"wfs-source:editing-not-supported\",\"applyEdits() is not supported on WFSLayer\")}async queryFeatures(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQuery(e,t.signal)}async queryFeatureCount(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForCount(e,t.signal)}async queryObjectIds(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForIds(e,t.signal)}async queryExtent(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForExtent(e,t.signal)}async querySnapping(e,t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForSnapping(e,t.signal)}async refresh(r){return this._customParameters=r,this._snapshotTask?.abort(),this._snapshotTask=i(this._snapshotFeatures),this._snapshotTask.promise.then((e=>{this._queryEngine.featureStore.clear(),e&&this._queryEngine.featureStore.addMany(e)}),(r=>{this._queryEngine.featureStore.clear(),o(r)||t.getLogger(\"esri.layers.WFSLayer\").error(new e(\"wfs-layer:getfeature-error\",\"An error occurred during the GetFeature request\",{error:r}))})),await this._waitSnapshotComplete(),{extent:this._queryEngine.fullExtent}}async _waitSnapshotComplete(){if(this._snapshotTask&&!this._snapshotTask.finished){try{await this._snapshotTask.promise}catch{}return this._waitSnapshotComplete()}}async _checkProjection(t){try{await m(u,t)}catch{throw new e(\"unsupported-projection\",\"Projection not supported\",{spatialReference:t})}}}export{E as default};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}