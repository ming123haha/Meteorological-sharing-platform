{"version":3,"file":"static/js/3962.a255bb7d.js","mappings":"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","sources":["webpack://eco-friendly/./node_modules/@arcgis/core/views/interactive/snapping/featureSources/sceneLayerSource/SceneLayerSnappingSourceWorker.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../../chunks/tslib.es6.js\";import{isNone as t,unwrapOr as s}from\"../../../../../core/maybe.js\";import{throwIfAborted as o}from\"../../../../../core/promiseUtils.js\";import\"../../../../../core/Logger.js\";import\"../../../../../core/accessorSupport/ensureType.js\";import\"../../../../../core/arrayUtils.js\";import\"../../../../../core/has.js\";import\"../../../../../core/accessorSupport/set.js\";import{subclass as n}from\"../../../../../core/accessorSupport/decorators/subclass.js\";import{C as i,a as r,i as d}from\"../../../../../chunks/vec3.js\";import{c,a}from\"../../../../../chunks/vec3f64.js\";import{create as p,fromPoints as u,projectPoint as m}from\"../../../../../geometry/support/lineSegment.js\";import{g as h,m as g,c as l}from\"../../../../../chunks/sphere.js\";import{SnappingTypes as f}from\"../../../../../layers/graphics/data/QueryEngineResult.js\";import _ from\"../../../../3d/webgl-engine/lib/Octree.js\";import{extractComponentsEdgeLocationsLayout as b}from\"../../../../3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker.js\";let j=class{constructor(){this._idToComponent=new Map,this._components=new _((e=>e.bounds)),this._edges=new _((e=>e.bounds)),this._tmpLineSegment=p(),this._tmpP1=c(),this._tmpP2=c(),this._tmpP3=c(),this.remoteClient=null}async fetchCandidates(e,t){await Promise.resolve(),o(t),await this._ensureEdgeLocations(e,t);const s=[];return this._edges.forEachNeighbor((t=>this._addCandidates(e,t,s)),e.bounds),{result:{candidates:s}}}async _ensureEdgeLocations(e,o){const n=[];if(this._components.forEachNeighbor((e=>{if(t(e.info)){const{id:t,uid:s}=e;n.push({id:t,uid:s})}}),e.bounds),!n.length)return;const i={components:n},r=await this.remoteClient.invoke(\"fetchAllEdgeLocations\",i,s(o,{}));for(const t of r.components)this._setFetchEdgeLocations(t)}async add(e){const t=new C(e.id,e.bounds);return this._idToComponent.set(t.id,t),this._components.add([t]),{result:{}}}async remove(e){const t=this._idToComponent.get(e.id);if(t){const e=[];this._edges.forEachNeighbor((s=>{s.component===t&&e.push(s)}),t.bounds),this._edges.remove(e),this._components.remove([t]),this._idToComponent.delete(t.id)}return{result:{}}}_setFetchEdgeLocations(e){const s=this._idToComponent.get(e.id);if(t(s)||e.uid!==s.uid)return;const o=b.createView(e.locations),n=new Array(o.count),a=c(),p=c();for(let t=0;t<o.count;t++){const c=l(),u=h(c);o.position0.getVec(t,a),o.position1.getVec(t,p),i(u,u,a,.5),i(u,u,p,.5),r(u,u,e.origin),c[3]=d(u,a);const m=new E(s,t,c);n[t]=m}this._edges.add(n);const{objectIds:u,origin:m}=e;s.info={locations:o,objectIds:u,origin:m}}_addCandidates(e,t,s){const{locations:o,origin:n,objectIds:i}=t.component.info,d=o.position0.getVec(t.index,this._tmpP1),c=o.position1.getVec(t.index,this._tmpP2);r(d,d,n),r(c,c,n);const a=i[o.componentIndex.get(t.index)];this._addEdgeCandidate(e,a,d,c,s),this._addVertexCandidate(e,a,d,s),this._addVertexCandidate(e,a,c,s)}_addEdgeCandidate(e,t,s,o,n){if(!(e.types&f.EDGE))return;const i=h(e.bounds),r=u(s,o,this._tmpLineSegment),c=m(r,i,this._tmpP3);if(!g(e.bounds,c))return null;n.push({type:\"edge\",objectId:t,target:a(c),distance:d(i,c),start:a(s),end:a(o)})}_addVertexCandidate(e,t,s,o){if(!(e.types&f.VERTEX))return;const n=h(e.bounds);if(!g(e.bounds,s))return null;o.push({type:\"vertex\",objectId:t,target:a(s),distance:d(n,s)})}};function y(){return new j}j=e([n(\"esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorker\")],j);class C{constructor(e,t){this.id=e,this.bounds=t,this.info=null,this.uid=++C.uid}}C.uid=0;class E{constructor(e,t,s){this.component=e,this.index=t,this.bounds=s}}export{j as SceneLayerSnappingSourceWorker,y as default};\n"],"names":["j","constructor","this","_idToComponent","Map","_components","_","e","bounds","_edges","_tmpLineSegment","p","_tmpP1","c","_tmpP2","_tmpP3","remoteClient","t","Promise","resolve","o","_ensureEdgeLocations","s","forEachNeighbor","_addCandidates","result","candidates","n","info","id","uid","push","length","i","components","r","invoke","_setFetchEdgeLocations","C","set","add","get","component","remove","delete","b","locations","Array","count","a","l","u","h","position0","getVec","position1","origin","d","m","E","objectIds","index","componentIndex","_addEdgeCandidate","_addVertexCandidate","types","f","g","type","objectId","target","distance","start","end","y"],"sourceRoot":""}