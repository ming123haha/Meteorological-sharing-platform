"use strict";(self["webpackChunkeco_friendly"]=self["webpackChunkeco_friendly"]||[]).push([[8633],{17950:function(e,t,i){i.d(t,{I:function(){return m},b:function(){return w}});var a=i(8693),n=i(12686),s=i(15626),r=i(36315),o=i(26616),l=i(97195),c=i(50213),u=i(56606),d=i(70516),h=i(8953),p=i(73893),g=i(65982),y=i(63914),f=i(84970),v=i(81789),_=i(30150);function w(e){const t=new y.kG;(0,d.S)(t,e),t.include(o.w),t.attributes.add(_.T.POSITION,"vec3"),t.attributes.add(_.T.UV0,"vec2"),t.varyings.add("vpos","vec3"),e.hasMultipassTerrain&&t.varyings.add("depth","float");const{vertex:i,fragment:w}=t;return i.uniforms.add(new h.A("textureCoordinateScaleFactor",(e=>(0,a.pC)(e.texture)&&(0,a.pC)(e.texture.descriptor.textureCoordinateScaleFactor)?e.texture.descriptor.textureCoordinateScaleFactor:n.O))),i.code.add(g.H`
    void main(void) {
      vpos = position;
      ${e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
      vTexCoord = uv0 * textureCoordinateScaleFactor;
      gl_Position = transformPosition(proj, view, vpos);
    }
  `),t.include(r.f5,e),t.include(l.l,e),w.uniforms.add([new f.A("tex",(e=>e.texture)),new p.p("opacity",(e=>e.opacity))]),t.varyings.add("vTexCoord","vec2"),e.output===s.H.Alpha?w.code.add(g.H`
    void main() {
      discardBySlice(vpos);
      ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

      float alpha = texture2D(tex, vTexCoord).a * opacity;
      if (alpha  < ${g.H.float(c.F)}) {
        discard;
      }

      gl_FragColor = vec4(alpha);
    }
    `):(w.include(u.Y),w.code.add(g.H`
    void main() {
      discardBySlice(vpos);
      ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
      gl_FragColor = texture2D(tex, vTexCoord) * opacity;

      if (gl_FragColor.a < ${g.H.float(c.F)}) {
        discard;
      }

      gl_FragColor = highlightSlice(gl_FragColor, vpos);
      ${e.transparencyPassType===v.Am.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    }
    `)),t}const m=Object.freeze(Object.defineProperty({__proto__:null,build:w},Symbol.toStringTag,{value:"Module"}))},17489:function(e,t,i){i.d(t,{S:function(){return u},b:function(){return c}});var a=i(70516),n=i(87035),s=i(73893),r=i(65982),o=i(63914),l=i(30150);function c(e){const t=new o.kG;return t.extensions.add("GL_OES_standard_derivatives"),(0,a.S)(t,e),t.attributes.add(l.T.POSITION,"vec3"),t.attributes.add(l.T.UV0,"vec2"),t.varyings.add("vUV","vec2"),t.vertex.code.add(r.H`void main(void) {
vUV = uv0;
gl_Position = proj * view * vec4(position, 1.0);
}`),t.fragment.uniforms.add([new n.N("backgroundColor",(e=>e.backgroundColor)),new n.N("gridColor",(e=>e.gridColor)),new s.p("gridWidth",(e=>e.gridWidth))]),t.fragment.code.add(r.H`void main() {
const float LINE_WIDTH = 1.0;
vec2 uvScaled = vUV * gridWidth;
vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);
grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);
float gridFade = max(grid.x, grid.y);
float gridAlpha = gridColor.a * gridFade;
gl_FragColor =
vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
vec4(gridColor.rgb, 1.0) * gridAlpha;
}`),t}const u=Object.freeze(Object.defineProperty({__proto__:null,build:c},Symbol.toStringTag,{value:"Module"}))},78553:function(e,t,i){i.d(t,{B:function(){return _}});var a=i(8693),n=i(47604),s=i(99659),r=i(72158),o=i(39177),l=i(60549),c=i(58006);function u(e){return p[d(e)]||y}function d(e){return e instanceof Blob?e.type:h(e.url)}function h(e){const t=(0,s.Ml)(e);return f[t]||g}const p={},g="text/plain",y=p[g],f={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip"};for(const E in f)p[f[E]]=E;var v=i(36067);function _(e){const t=(0,a.pC)(e)&&e.origins?e.origins:[void 0];return(i,a)=>{const n=w(e,i,a);for(const e of t){const t=(0,c.CJ)(i,e,a);for(const e in n)t[e]=n[e]}}}function w(e,t,i){if((0,a.pC)(e)&&"resource"===e.type)return m(e,t,i);switch((0,a.pC)(e)&&e.type?e.type:"other"){case"other":return{read:!0,write:!0};case"url":{const{read:e,write:t}=v.p;return{read:e,write:t}}}}function m(e,t,i){const r=(0,o.VZ)(t,i);return{type:String,read:(e,t,i)=>{const a=(0,v.r)(e,t,i);return r.type===String?a:"function"==typeof r.type?new r.type({url:a}):void 0},write:{writer(t,o,c,u){if(!u||!u.resources)return"string"==typeof t?void(o[c]=(0,v.t)(t,u)):void(o[c]=t.write({},u));const d=T(t),h=d?(0,v.t)(d,{...u,verifyItemRelativeUrls:u&&u.verifyItemRelativeUrls?{writtenUrls:u.verifyItemRelativeUrls.writtenUrls,rootPath:null}:null},v.M.NO):null,p=r.type!==String&&(!(0,n.l)(this)||u&&u.origin&&this.originIdOf(i)>(0,l.M9)(u.origin));u&&u.portalItem&&(0,a.pC)(h)&&!(0,s.YP)(h)?p?b(this,i,t,h,o,c,u,e):D(h,o,c,u):u&&u.portalItem&&((0,a.Wi)(h)||(0,a.pC)((0,v.i)(h))||(0,s.jc)(h)||p)?P(this,i,t,h,o,c,u,e):o[c]=h}}}}function P(e,t,i,n,o,l,c,d){const h=(0,r.D)(),p=M(i,n,c),g=(0,s.v_)((0,a.U2)(d,"prefix"),h),y=`${g}.${u(p)}`,f=c.portalItem.resourceFromPath(y);(0,s.jc)(n)&&c.resources.pendingOperations.push(A(n).then((e=>{f.path=`${g}.${u(e)}`,o[l]=f.itemRelativeUrl})).catch((()=>{}))),C(e,t,f,p,c.resources.toAdd),o[l]=f.itemRelativeUrl}function b(e,t,i,a,n,r,o,l){const c=o.portalItem.resourceFromPath(a),d=M(i,a,o);u(d)===(0,s.Ml)(c.path)?(C(e,t,c,d,o.resources.toUpdate),n[r]=a):P(e,t,i,a,n,r,o,l)}function D(e,t,i,a){a.resources.toKeep.push({resource:a.portalItem.resourceFromPath(e)}),t[i]=e}function C(e,t,i,a,n){n.push({resource:i,content:a,finish:i=>{V(e,t,i)}})}function M(e,t,i){return"string"==typeof e?{url:t}:new Blob([JSON.stringify(e.toJSON(i))],{type:"application/json"})}async function A(e){const t=(await Promise.resolve().then(i.bind(i,94848))).default,{data:a}=await t(e,{responseType:"blob"});return a}function T(e){return(0,a.Wi)(e)?null:"string"==typeof e?e:e.url}function V(e,t,i){"string"==typeof e[t]?e[t]=i.url:e[t].url=i.url}},47604:function(e,t,i){function a(e){return e&&"getAtOrigin"in e&&"originOf"in e}i.d(t,{l:function(){return a}})},98406:function(e,t,i){i.d(t,{T:function(){return r}});var a=i(94848),n=i(22130),s=i(8693);async function r(e,t,i,r,o,l){let c=null;if((0,s.pC)(i)){const t=`${e}/nodepages/`,n=t+Math.floor(i.rootIndex/i.nodesPerPage);try{return{type:"page",rootPage:(await(0,a["default"])(n,{query:{f:"json",token:r},responseType:"json",signal:l})).data,rootIndex:i.rootIndex,pageSize:i.nodesPerPage,lodMetric:i.lodSelectionMetricType,urlPrefix:t}}catch(h){(0,s.pC)(o)&&o.warn("#fetchIndexInfo()","Failed to load root node page. Falling back to node documents.",n,h),c=h}}if(!t)return null;const u=`${e}/nodes/`,d=u+(t&&t.split("/").pop());try{return{type:"node",rootNode:(await(0,a["default"])(d,{query:{f:"json",token:r},responseType:"json",signal:l})).data,urlPrefix:u}}catch(h){throw new n.Z("sceneservice:root-node-missing","Root node missing.",{pageError:c,nodeError:h,url:d})}}},25011:function(e,t,i){i.r(t),i.d(t,{default:function(){return xi}});var a=i(61445),n=i(92698),s=i(8693),r=i(58006),o=(i(15055),i(81653)),l=i(94315),c=i(77623),u=i(30709),d=(i(26699),i(21703),i(80388),i(26589)),h=i(82291),p=i(60931),g=i(4524),y=i(78553),f=i(49304);let v=class extends((0,d.J)(p.wq)){constructor(e){super(e),this.type="plane",this.position=null,this.heading=0,this.tilt=0,this.width=10,this.height=10}equals(e){return this.heading===e.heading&&this.tilt===e.tilt&&(0,s._W)(this.position,e.position)&&this.width===e.width&&this.height===e.height}};(0,a._)([(0,r.Cb)({readOnly:!0,json:{read:!1,write:!0}})],v.prototype,"type",void 0),(0,a._)([(0,r.Cb)({type:f.Z}),(0,y.B)()],v.prototype,"position",void 0),(0,a._)([(0,r.Cb)({type:Number,nonNullable:!0,range:{min:0,max:360}}),(0,y.B)(),(0,g.p)((e=>h.BV.normalize((0,l.q9)(e),0,!0)))],v.prototype,"heading",void 0),(0,a._)([(0,r.Cb)({type:Number,nonNullable:!0,range:{min:0,max:360}}),(0,y.B)(),(0,g.p)((e=>h.BV.normalize((0,l.q9)(e),0,!0)))],v.prototype,"tilt",void 0),(0,a._)([(0,r.Cb)({type:Number,nonNullable:!0}),(0,y.B)()],v.prototype,"width",void 0),(0,a._)([(0,r.Cb)({type:Number,nonNullable:!0}),(0,y.B)()],v.prototype,"height",void 0),v=(0,a._)([(0,c.j)("esri.analysis.SlicePlane")],v);const _=v;var w=i(50816),m=i(93622),P=i(18105),b=i(92786),D=i(36421),C=i(4170),M=(i(48675),i(3462),i(37380),i(1118),i(67752)),A=i(30524),T=i(51802),V=i(94370),E=i(44420),S=i(65554),O=i(74674),I=i(47608),R=i(4155),W=i(54550),x=i(23573),k=i(94377),L=i(62069),H=i(85381);const N=(0,o.Z)("mac")?"Meta":"Control",z="Shift",G=2,U=1.15,F=1.15,B=1.1,j=2500,Q=.02,q=Math.cos((0,M.Vl)(45)),Z=Math.cos((0,M.Vl)(5)),Y=.95,K=.3,X=.7,J=(0,O.f)(1,.5,0),$=2,ee=1,te=(0,H.b)([...J,X]),ie=[0,0,0,.04],ae=(0,H.b)([...J,.5]),ne=(0,H.b)([...J,1]),se=(0,H.f)(1,1,1,1),re=(0,H.f)(1,.8,.6,1),oe=(0,H.f)(1,.93,.86,1),le=(0,H.b)([...J,1]),ce=(0,H.b)([...J,1]),ue=3,de=11,he=22.5,pe=40,ge=48,ye=2.25,fe=(0,H.b)([...J,1]),ve=4,_e=1,we=.3,me=6,Pe=4,be=12,De=40,Ce=27,Me=1600,Ae=.4;var Te=i(58627),Ve=i(31663),Ee=i(69113),Se=i(33216),Oe=i(97848),Ie=i(9871),Re=i(59546),We=i(31728),xe=i(15626),ke=i(33274),Le=i(79961),He=i(75633),Ne=i(38306),ze=i(34590),Ge=i(65982),Ue=i(68205),Fe=i(20572),Be=i(85018),je=i(7436),Qe=i(17489),qe=i(17923),Ze=i(9408);class Ye extends Ge.K{constructor(){super(...arguments),this.backgroundColor=(0,H.f)(1,0,0,.5),this.gridColor=(0,H.f)(0,1,0,.5),this.gridWidth=4}}class Ke extends Fe.A{initializeProgram(e){const t=Ke.shader.get().build(this.configuration);return new je.$(e.rctx,t,Be.i)}initializePipeline(){return(0,Ze.sm)({blending:(0,Ze.wK)(qe.zi.ONE,qe.zi.ONE,qe.zi.ONE_MINUS_SRC_ALPHA,qe.zi.ONE_MINUS_SRC_ALPHA),depthTest:{func:qe.wb.LESS},colorWrite:Ze.BK})}}Ke.shader=new Ue.J(Qe.S,(()=>i.e(7971).then(i.bind(i,27971))));class Xe extends We.F5{constructor(e){super(e,new $e),this._config=new ke.m}intersect(e,t,i,a,n,s,r){return(0,ze.Bw)(e,t,a,n,s,void 0,r)}createBufferWriter(){return new Ne.G_(Ne.W1)}requiresSlot(e){return e===He.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL}createGLMaterial(e){return e.output===xe.H.Color?new Je(e):null}getConfiguration(){return this._config}}class Je extends Le.Z{constructor(e){super(e),this.ensureTechnique(Ke,null)}beginSlot(){return(0,s.Wg)(this.technique)}}class $e extends Ye{constructor(){super(...arguments),this.renderOccluded=We.yD.Occlude}}class et extends Ie._{constructor(e){super(e),this._material=null,this._renderOccluded=We.yD.OccludeAndTransparent,this._gridWidth=1,this._gridColor=(0,H.f)(1,0,0,1),this._backgroundColor=(0,H.f)(1,0,0,1),this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get gridWidth(){return this._gridWidth}set gridWidth(e){this._gridWidth!==e&&(this._gridWidth=e,this._updateMaterial())}get gridColor(){return this._gridColor}set gridColor(e){(0,Oe.c)(this._gridColor,e),this._updateMaterial()}get backgroundColor(){return this._backgroundColor}set backgroundColor(e){(0,Oe.c)(this._backgroundColor,e),this._updateMaterial()}createExternalResources(){this._material=new Xe(this.materialParameters)}destroyExternalResources(){this._material=null}forEachExternalMaterial(e){(0,s.pC)(this._material)&&e(this._material)}createGeometries(e){if((0,s.pC)(this._material)){const t=Re.Z.createSquareGeometry();e.addGeometry(t,this._material)}}get materialParameters(){return{backgroundColor:this._backgroundColor,gridWidth:this._gridWidth,gridColor:this._gridColor,renderOccluded:this._renderOccluded}}_updateMaterial(){(0,s.pC)(this._material)&&this._material.setParameters(this.materialParameters)}}var tt=i(550),it=i(90290),at=i(81789),nt=i(23168),st=i(30150),rt=i(88865),ot=i(21151),lt=i(54492),ct=i(66084),ut=i(25849);i(50157);const dt=m.Z.getLogger("esri.views.3d.interactive.analysisTools.slice.sliceToolUtils");function ht(e,t,i,a,n,s,r,o){return pt(t,r.worldUpAtPosition(e,L.WM.get()),n,s,o.basis1,o.basis2),(0,S.g)(o.basis1,o.basis1,i),(0,S.g)(o.basis2,o.basis2,a),(0,S.c)(o.origin,e),(0,W.my)(o.basis2,o.basis1,o.origin,o.plane),o}function pt(e,t,i,a,n,s){const r=(0,S.e)(e,t),o=L.WM.get(),l=L.WM.get();switch(a===qt.HORIZONTAL_OR_VERTICAL?Math.abs(r)>q?qt.HORIZONTAL:qt.VERTICAL:a){case qt.VERTICAL:{const a=Math.abs(r)<=Z?e:i.viewUp;(0,S.f)(o,a,t),(0,S.c)(l,t);break}case qt.HORIZONTAL:(0,S.f)(o,i.viewUp,t),(0,S.f)(l,t,o);break;case qt.TILTED:{const a=Math.abs(r)<=Z?t:i.viewUp;(0,S.f)(o,a,e),(0,S.f)(l,e,o);break}}const c=(0,S.f)(L.WM.get(),o,l);(0,S.e)(c,i.viewForward)>0&&(0,S.g)(l,l,-1),(0,S.n)(n,o),(0,S.n)(s,l)}function gt(e,t,i){const a=t.worldUpAtPosition(e.origin,L.WM.get()),n=e.basis1,s=zt(e,a),r=Math.round(s/Kt)*Kt;return(0,b.r)(e,r-s,n,i)}function yt(e,t,i,a,n,s){const r=(0,S.c)(L.WM.get(),n.origin);(0,S.a)(r,r,(0,S.g)(L.WM.get(),n.basis1,e.direction[0]<0?1:-1)),(0,S.a)(r,r,(0,S.g)(L.WM.get(),n.basis2,e.direction[1]<0?1:-1));const o=(0,S.l)(n.basis1),l=(0,S.l)(n.basis2),c=(0,S.b)(L.WM.get(),i,r),u=(0,S.b)(L.WM.get(),t,r);let d=0,h=0;if(St(e)){const t=Et(n),i=Et(s);d=o-.5*e.direction[0]*(0,S.e)(n.basis1,u)/o,h=l-.5*e.direction[1]*(0,S.e)(n.basis2,u)/l;const a=i/t;d*=a,h*=a}const p=d+.5*e.direction[0]*(0,S.e)(n.basis1,c)/o,g=h+.5*e.direction[1]*(0,S.e)(n.basis2,c)/l,y=(0,S.g)(L.WM.get(),n.basis1,p/o),f=(0,S.g)(L.WM.get(),n.basis2,g/l);(p<=0||Tt(s.origin,y,a)<=Me)&&(0,S.c)(y,s.basis1),(g<=0||Tt(s.origin,f,a)<=Me)&&(0,S.c)(f,s.basis2);const v=(0,S.c)(L.WM.get(),r);return(0,S.a)(v,v,(0,S.g)(L.WM.get(),y,e.direction[0]<0?-1:1)),(0,S.a)(v,v,(0,S.g)(L.WM.get(),f,e.direction[1]<0?-1:1)),(0,b.f)(v,y,f,s)}function ft(e,t){return Ae*Math.min(t.width,t.height)*t.computeRenderPixelSizeAt(e)}function vt(e,t,i,a){const n=(0,S.f)(L.WM.get(),t,i);return(0,S.f)(n,n,t),(0,W.Yq)(e,n,a)}function _t(e,t){return(0,Ee.Aq)(e.basis1,e.basis2,e.origin,t)}function wt(e,t,i,a){const n=t.worldUpAtPosition(e.origin,L.WM.get()),s=L.WM.get();switch(i){case Qt.HEADING:(0,S.c)(s,n);break;case Qt.TILT:(0,S.c)(s,e.basis1)}return(0,W.Yq)(e.origin,s,a)}function mt(e,t,i,a){const n=At(i,Mt.NEGATIVE_X),s=L.MP.get();(0,T.g)(s,t,n.edge*Math.PI/2);const r=(0,S.n)(L.WM.get(),n.basis);let o=(0,S.g)(L.WM.get(),r,n.direction*a.computeScreenPixelSizeAt(n.position)*pe);(0,S.a)(o,o,n.position);const l=a.projectToRenderScreen(o,(0,A.Wv)(L.WM.get())),c=Pt(a,l);(0,it.Bh)(a,l,Yt),(0,S.n)(Yt.direction,Yt.direction);const u=L.WM.get();!c&&(0,b.i)(i,Yt,u)&&(o=u),s[12]=0,s[13]=0,s[14]=0,e.modelTransform=s,e.renderLocation=(0,O.a)(o),c?e.state|=Zt:e.state&=~Zt}function Pt(e,t){const[i,a,n,s]=e.viewport,r=Math.min(n,s)/16;let o=!0;return t[0]<i+r?(t[0]=i+r,o=!1):t[0]>i+n-r&&(t[0]=i+n-r,o=!1),t[1]<a+r?(t[1]=a+r,o=!1):t[1]>a+s-r&&(t[1]=a+s-r,o=!1),o}function bt(e,t,i,a){const n=(0,S.l)(a.basis1),s=(0,S.l)(a.basis2),r=Vt(a),o=Et(a),l=(0,S.s)(L.WM.get(),0,0,0);(0,S.a)(l,(0,S.g)(L.WM.get(),a.basis1,t.direction[0]),(0,S.g)(L.WM.get(),a.basis2,t.direction[1])),(0,S.a)(l,a.origin,l);let c=0,u=1;if(St(t))1===t.direction[0]&&-1===t.direction[1]?c=Kt:1===t.direction[0]&&1===t.direction[1]?c=Math.PI:-1===t.direction[0]&&1===t.direction[1]&&(c=3*Math.PI/2),u=o;else{const e=0!==t.direction[0]?1:2;c=1===e?Kt:0,u=(1===e?s:n)-r}const d=(0,T.b)(L.MP.get(),c);(0,T.h)(d,d,(0,S.s)(L.WM.get(),u,u,u)),(0,T.m)(d,i,d),d[12]=0,d[13]=0,d[14]=0,e.modelTransform=d,e.renderLocation=l}function Dt(e,t,i,a){const n=a.worldUpAtPosition(i.origin,L.WM.get()),s=At(i,Mt.POSITIVE_X),r=(0,T.b)(L.MP.get(),s.edge*Math.PI/2);(0,T.r)(r,r,-zt(i,n)),(0,T.m)(r,t,r),r[12]=0,r[13]=0,r[14]=0,e.modelTransform=r,e.renderLocation=s.position}function Ct(e,t,i){const a=At(i,Mt.POSITIVE_Y),n=(0,T.b)(L.MP.get(),a.edge*Math.PI/2);(0,T.r)(n,n,Kt),(0,T.m)(n,t,n),n[12]=0,n[13]=0,n[14]=0,e.modelTransform=n,e.renderLocation=a.position}var Mt;function At(e,t){switch(t){case Mt.POSITIVE_X:return{basis:e.basis1,direction:1,position:(0,S.a)(L.WM.get(),e.origin,e.basis1),edge:t};case Mt.POSITIVE_Y:return{basis:e.basis2,direction:1,position:(0,S.a)(L.WM.get(),e.origin,e.basis2),edge:t};case Mt.NEGATIVE_X:return{basis:e.basis1,direction:-1,position:(0,S.b)(L.WM.get(),e.origin,e.basis1),edge:t};case Mt.NEGATIVE_Y:return{basis:e.basis2,direction:-1,position:(0,S.b)(L.WM.get(),e.origin,e.basis2),edge:t}}}function Tt(e,t,i){const a=i.projectToRenderScreen((0,S.a)(L.WM.get(),e,t),(0,A.Wv)(L.WM.get())),n=i.projectToRenderScreen((0,S.b)(L.WM.get(),e,t),(0,A.Wv)(L.WM.get()));return(0,S.p)((0,S.b)(a,a,n))}function Vt(e){const t=(0,S.l)(e.basis1),i=(0,S.l)(e.basis2);return we*Math.min(t,i)}function Et(e){return Vt(e)}function St(e){return 0!==e.direction[0]&&0!==e.direction[1]}function Ot(e,t=$t.CENTER_ON_ARROW){const i=t===$t.CENTER_ON_CALLOUT?pe:0,a=[(0,O.f)(i,0,-ge/2),(0,O.f)(i,0,ge/2)],n=Ht(a,!0),s=(e,t)=>kt(a,a,{tubeRadius:ue,tipRadius:de,tipLength:he,tubeFocusMultiplier:U,tipFocusMultiplier:F,padding:e,bothEnds:!0,flat:null,focusTipLength:!0,addCap:t}),r=s(0,!1),o=s(ye,!0),l=new rt.E({color:se,cullFace:at.Vr.Back,renderOccluded:We.yD.Opaque}),c=new rt.E({color:re,cullFace:at.Vr.Back,renderOccluded:We.yD.Opaque}),u=new rt.E({color:oe,cullFace:at.Vr.Back,renderOccluded:We.yD.Opaque}),d=new rt.E({color:ce,transparent:!0,writeDepth:!1,cullFace:at.Vr.Front,renderOccluded:We.yD.Transparent}),h=Re.Z.createPolylineGeometry([[i,0,0],[i-pe,0,0]]),p=Re.Z.createPolylineGeometry([[i,0,0],[i-pe,0,0]]),g=new lt.Y({color:le,renderOccluded:We.yD.OccludeAndTransparent});return new Ve.Z({view:e,renderObjects:[...r.normal.map((({part:e,geometry:t,transform:i})=>({geometry:t,material:"tip"===e?l:"cap"===e?c:u,transform:i,stateMask:ut.Q9.Unfocused|jt}))),...o.normal.map((({geometry:e,transform:t})=>({geometry:e,material:d,transform:t,stateMask:ut.Q9.Unfocused|jt}))),{geometry:h,material:g,stateMask:ut.Q9.Unfocused|jt|Zt},...r.focused.map((({part:e,geometry:t,transform:i})=>({geometry:t,material:"tip"===e?l:"cap"===e?c:u,transform:i,stateMask:ut.Q9.Focused|jt}))),...o.focused.map((({geometry:e,transform:t})=>({geometry:e,material:d,transform:t,stateMask:ut.Q9.Focused|jt}))),{geometry:p,material:g,stateMask:ut.Q9.Focused|jt|Zt}],autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[n]},collisionPriority:1,radius:de,state:jt})}function It(e,t){const i=new ot.j({transparent:!0,writeDepth:!1,textureId:t.id,renderOccluded:We.yD.Opaque}),a=De,n=Ce,s=n*B,r=e=>{const t=new Uint32Array([0,1,2,2,3,0]);return new nt.Z([[st.T.POSITION,{size:3,data:[a-e,-e,0,a+e,-e,0,a+e,e,0,a-e,e,0],exclusive:!0}],[st.T.UV0,{size:2,data:[0,0,1,0,1,1,0,1]}]],[[st.T.POSITION,t],[st.T.UV0,t]])},o=Re.Z.createPolylineGeometry([[0,0,0],[a-n,0,0]]),l=Re.Z.createPolylineGeometry([[0,0,0],[a-s,0,0]]),c=new lt.Y({color:ne,renderOccluded:We.yD.OccludeAndTransparent}),u=[{geometry:r(n),material:i,stateMask:ut.Q9.Unfocused|jt},{geometry:o,material:c,stateMask:ut.Q9.Unfocused|jt},{geometry:r(s),material:i,stateMask:ut.Q9.Focused|jt},{geometry:l,material:c,stateMask:ut.Q9.Focused|jt}];return new Ve.Z({view:e,renderObjects:u,autoScaleRenderObjects:!1,collisionType:{type:"disc",direction:[0,0,1],offset:[a,0,0]},collisionPriority:1,radius:n/2,state:jt})}function Rt(e){const t=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0],[-1,-1,0]];return new Se.r({view:e,attached:!0,color:te,width:ee,writeDepthEnabled:!1,renderOccluded:We.yD.OccludeAndTransparent,geometry:[t]})}function Wt(e){return new et({view:e,attached:!0,backgroundColor:[...ie],gridColor:ae,gridWidth:4,renderOccluded:We.yD.OccludeAndTransparent})}function xt(e,t){const i=St(t),a=i?[(0,O.f)(1,0,0),(0,O.f)(0,0,0),(0,O.f)(0,1,0)]:[(0,O.f)(1,0,0),(0,O.f)(-1,0,0)],n=Re.Z.createPolylineGeometry(a),s=fe,r=e=>new ct.U({color:s,width:e,renderOccluded:We.yD.OccludeAndTransparent}),o=()=>new lt.Y({color:s,renderOccluded:We.yD.OccludeAndTransparent}),l=i?ve:_e,c=l*G,u=_e,d=e=>e>1?r(e):o(),h=[{geometry:n,material:d(l),stateMask:ut.Q9.Unfocused|Xt},{geometry:n,material:d(c),stateMask:ut.Q9.Focused|Xt},{geometry:n,material:d(u),stateMask:Jt}],p=new Ve.Z({view:e,renderObjects:h,collisionType:{type:"line",paths:[a]},autoScaleRenderObjects:!1,worldSized:!0,radius:i?me:Pe});return p.state=Xt,p}function kt(e,t,i){const a=a=>{const n=(a?t:e).slice(0),r=(0,S.b)(L.WM.get(),n[0],n[1]);(0,S.n)(r,r);const o=(0,S.b)(L.WM.get(),n[n.length-1],n[n.length-2]);if((0,S.n)(o,o),i.padding>0){const e=(0,S.g)((0,O.c)(),o,-i.padding);if(n[n.length-1]=(0,S.a)(e,e,n[n.length-1]),i.bothEnds){const e=(0,S.g)((0,O.c)(),r,-i.padding);n[0]=(0,S.a)(e,e,n[0])}}const l=a?i.tipFocusMultiplier:1,c=i.tipLength*(i.focusTipLength?l:1),u=i.tipRadius*l,d=(0,T.i)(L.MP.get());if(i.padding>0){const e=c/4,t=(0,S.s)(L.WM.get(),0,e,0),a=1+i.padding/e;(0,T.j)(d,d,t),(0,T.h)(d,d,(0,S.s)(L.WM.get(),a,a,a)),(0,T.j)(d,d,(0,S.g)(t,t,-1/a))}const h=(0,T.i)((0,V.c)()),p=(0,O.f)(0,1,0),g=(0,T.k)((0,V.c)(),(0,E.r)(L.vD.get(),p,o));g[12]=n[n.length-1][0],g[13]=n[n.length-1][1],g[14]=n[n.length-1][2],(0,T.m)(g,g,d);const y=[{part:"tube",geometry:Lt(i.tubeRadius*(a?i.tubeFocusMultiplier:1)+i.padding,i.flat,n),transform:h}];let f,v;if((0,s.pC)(i.flat)?f=Re.Z.createExtrudedTriangle(c,u,u,i.flat.thickness):(f=Re.Z.createConeGeometry(c,u,24,!1,!1,!0),v=Re.Z.createConeGeometry(c,u,24,!1,!0,!1)),y.push({part:"tip",geometry:f,transform:g}),v&&y.push({part:"cap",geometry:v,transform:g}),i.bothEnds){const e=(0,T.k)((0,V.c)(),(0,E.r)(L.vD.get(),p,r));e[12]=n[0][0],e[13]=n[0][1],e[14]=n[0][2],(0,T.m)(e,e,d),y.push({part:"tip",geometry:f,transform:e}),v&&y.push({part:"cap",geometry:v,transform:e})}return y};return{normal:a(!1),focused:a(!0)}}function Lt(e,t,i){const a=[];if((0,s.pC)(t))a.push([e,t.thickness/2],[-e,t.thickness/2],[-e,-t.thickness/2],[e,-t.thickness/2]);else{const t=12;for(let i=0;i<t;i++){const n=i/t*2*Math.PI;a.push([Math.cos(n)*e,Math.sin(n)*e])}}return Re.Z.createPathExtrusionGeometry(a,i,[],[],!1)}function Ht(e,t){const i=(0,S.b)((0,O.c)(),e[e.length-1],e[e.length-2]);if((0,S.n)(i,i),(0,S.g)(i,i,be),(0,S.a)(i,i,e[e.length-1]),t){const t=(0,S.b)((0,O.c)(),e[0],e[1]);return(0,S.n)(t,t),(0,S.g)(t,t,be),(0,S.a)(t,t,e[0]),[t,...e,i]}return[...e,i]}function Nt(e,t,i,a=new _){if((0,s.Wi)(e))return null;const{renderCoordsHelper:n}=t,r=n.fromRenderCoords(e.origin,t.spatialReference);if((0,s.Wi)(r))return null;const o=(0,I.fM)(r,i);if((0,s.Wi)(o))return null;a.position=o;const l=n.worldUpAtPosition(e.origin,L.WM.get()),c=n.worldBasisAtPosition(e.origin,R.R.Y,L.WM.get()),u=2*(0,S.l)(e.basis1),d=2*(0,S.l)(e.basis2),h=tt.Z.renderUnitScaleFactor(t.spatialReference,i);return a.width=u*h,a.height=d*h,a.tilt=(0,M.BV)(zt(e,l)),a.heading=(0,M.BV)(Gt(e,l,c)),a}function zt(e,t){return(0,k.cp)(t,e.basis2,e.basis1)+Kt}function Gt(e,t,i){return(0,k.cp)(e.basis1,i,t)-Kt}function Ut(e,t,i,a,n,s,r=(0,b.c)()){return s.toRenderCoords(e,r.origin)?(s.worldBasisAtPosition(r.origin,R.R.X,r.basis1),s.worldBasisAtPosition(r.origin,R.R.Y,r.basis2),(0,W.my)(r.basis2,r.basis1,r.origin,r.plane),(0,b.r)(r,-(0,M.Vl)(t),(0,b.n)(r),r),(0,b.r)(r,(0,M.Vl)(i),r.basis1,r),(0,S.g)(r.basis1,r.basis1,a/2),(0,S.g)(r.basis2,r.basis2,n/2),(0,b.u)(r),r):(dt.error(`Failed to project slice plane position, projection from ${e.spatialReference.wkid} is not supported`),null)}function Ft(e,t){if((0,s.Wi)(e)||(0,s.Wi)(e.position))return null;const i=(0,Te.G)(e.position,t.spatialReference,t.elevationProvider);if((0,s.Wi)(i))return null;const a=tt.Z.renderUnitScaleFactor(e.position.spatialReference,t.spatialReference),n=e.width*a,r=e.height*a;return{position:i,heading:e.heading,tilt:e.tilt,renderWidth:n,renderHeight:r}}function Bt(e,t,i,a=(0,b.c)()){if((0,s.Wi)(e))return null;const n=Ut(e.position,e.heading,e.tilt,e.renderWidth,e.renderHeight,t.renderCoordsHelper,a);return!i.tiltEnabled&&(0,s.pC)(n)&&gt(n,t.renderCoordsHelper,n),n}!function(e){e[e.POSITIVE_X=0]="POSITIVE_X",e[e.POSITIVE_Y=1]="POSITIVE_Y",e[e.NEGATIVE_X=2]="NEGATIVE_X",e[e.NEGATIVE_Y=3]="NEGATIVE_Y"}(Mt||(Mt={}));const jt=ut.jg.Custom1;var Qt,qt;!function(e){e[e.HEADING=1]="HEADING",e[e.TILT=2]="TILT"}(Qt||(Qt={})),function(e){e[e.HORIZONTAL_OR_VERTICAL=0]="HORIZONTAL_OR_VERTICAL",e[e.HORIZONTAL=1]="HORIZONTAL",e[e.VERTICAL=2]="VERTICAL",e[e.TILTED=3]="TILTED"}(qt||(qt={}));const Zt=ut.jg.Custom2,Yt=(0,x.Ue)(),Kt=Math.PI/2,Xt=ut.jg.Custom1,Jt=ut.jg.Custom2;var $t;function ei(e){const t="building-scene-3d"===e.type?e:null;return(0,s.pC)(t)}!function(e){e[e.CENTER_ON_CALLOUT=0]="CENTER_ON_CALLOUT",e[e.CENTER_ON_ARROW=1]="CENTER_ON_ARROW"}($t||($t={}));var ti=i(64293);const ii=m.Z.getLogger("esri.views.3d.analysis.Slice.SliceController");let ai=class extends n.Z{constructor(e){super(e),this._handles=new w.Z,this._internalChange=!1,this._currentSlicePlane=null,this.state="ready"}get ready(){return"ready"===this.state}initialize(){this._handles.add(this.analysis.excludedLayers.on("before-add",(e=>{const t=e.item;null!=t&&(t instanceof D.Z||t instanceof C.Z)?t instanceof D.Z&&(0,ti.xk)(t)?(ii.error("excludedLayers",`Layer '${t.title}, id:${t.id}' of type '${t.type}' can not be individually excluded from slicing. Use 'excludeGroundSurface' instead.`),e.preventDefault()):this.analysis.excludedLayers.includes(t)&&e.preventDefault():(ii.error("excludedLayers","Invalid layer type, layer must derive from Layer or BuildingComponentSublayer"),e.preventDefault())}))),oi(this.view,this),this._handles.add([(0,P.YP)((()=>this.analysisViewData.plane),(()=>{this._internalChange||this._updateSlicePlaneFromBoundedPlane(),this._updateLayerViews()}),{sync:!0}),(0,P.YP)((()=>this.analysis.excludeGroundSurface),(()=>this._updateLayerViews()),{sync:!0}),this.analysis.excludedLayers.on("change",(()=>this._updateLayerViews())),(0,P.YP)((()=>[this.analysisViewData.active,this.analysisViewData.visible]),(()=>{this._updateActiveController(),this._updateViewSlicePlane()}),{sync:!0}),(0,P.YP)((()=>this._allLayerAndSubLayerViews),(()=>this._updateLayerViews()))]),this._handles.add([(0,P.YP)((()=>this.analysis.shape),(()=>{this._internalChange||(this._updateBoundedPlaneFromSlicePlane(),this._updateViewSlicePlane())}),{sync:!0})],"analysis"),this._set("state","ready"),this._updateActiveController(),this._updateBoundedPlaneFromSlicePlane(),this._updateViewSlicePlane()}destroy(){"destroyed"!==this.state&&(this.analysisViewData.active&&(this.analysisViewData.active=!1,this.view.slicePlane=null),ci(this.view,this),this._handles.destroy(),this.set("view",null),this._set("state","destroyed"))}async whenReady(){return await(0,P.N1)((()=>this.ready)),this}get _allLayerAndSubLayerViews(){const e=this.view.allLayerViews.items;return e.concat(e.filter(ei).flatMap((({sublayerViews:e})=>e.items)))}_updateBoundedPlaneFromSlicePlane(){const e=this.analysis.shape,t=this._currentSlicePlane;if((0,s.Wi)(t)&&(0,s.Wi)(e)||(0,s.pC)(t)&&(0,s.pC)(e)&&e.equals(t))return;let i=null,a=null;if((0,s.pC)(e)&&(0,s.pC)(e.position)){const t=e.position.spatialReference,n=Ft(e,this.view);(0,s.Wi)(n)&&(0,Te.e)(this.analysis,t,ii),i=Bt(n,this.view,{tiltEnabled:this.analysis.tiltEnabled},(0,b.c)()),(0,s.pC)(i)&&(a={heading:e.heading,tilt:e.tilt,position:e.position,width:e.width,height:e.height})}this._currentSlicePlane=a,this._internalChange=!0,this.analysisViewData.plane=i,this._internalChange=!1}_updateSlicePlaneFromBoundedPlane(){const e=this.analysisViewData.plane,t=Nt(e,this.view,this.view.spatialReference,new _);let i=null;(0,s.pC)(t)&&(i={heading:t.heading,tilt:t.tilt,position:t.position,width:t.width,height:t.height}),this._currentSlicePlane=i,this._internalChange=!0,this.analysis.shape=t,this._internalChange=!1,this._updateViewSlicePlane()}_updateActiveController(){if(si)return;const e=li(this.view);if(this.analysisViewData.active)(0,s.pC)(e.activeController)&&e.activeController!==this?(si=!0,e.activeController.analysisViewData.active=!1,si=!1):(0,s.pC)(e.activeController)&&e.activeController,this._updateLayerViews(),e.activeController=this;else{if((0,s.pC)(e.activeController)&&e.activeController!==this)return;(0,s.pC)(e.activeController)&&e.activeController===this&&(e.activeController=null,this._updateLayerViews())}}_updateViewSlicePlane(){"ready"===this.state&&ri(this.view)}_updateLayerViews(){const e=(0,s.pC)(this.analysisViewData.plane)&&this.analysisViewData.visible&&this.analysisViewData.active,t=[],i=e=>{"layers"in e?e.layers.forEach(i):t.push(e)};this.analysis.excludedLayers.forEach(i),this.view.allLayerViews.forEach((i=>{i.destroyed||("slicePlaneEnabled"in i&&(i.slicePlaneEnabled=e&&!t.includes(i.layer)),"sublayerViews"in i&&i.sublayerViews.forEach((i=>{i.slicePlaneEnabled=e&&!t.includes(i.sublayer)})))})),null!=this.view.basemapTerrain&&(this.view.basemapTerrain.slicePlaneEnabled=e&&!this.analysis.excludeGroundSurface)}};(0,a._)([(0,r.Cb)({readOnly:!0})],ai.prototype,"state",void 0),(0,a._)([(0,r.Cb)()],ai.prototype,"view",void 0),(0,a._)([(0,r.Cb)()],ai.prototype,"analysis",void 0),(0,a._)([(0,r.Cb)()],ai.prototype,"analysisViewData",void 0),(0,a._)([(0,r.Cb)()],ai.prototype,"ready",null),(0,a._)([(0,r.Cb)()],ai.prototype,"_allLayerAndSubLayerViews",null),ai=(0,a._)([(0,c.j)("esri.views.3d.analysis.Slice.SliceController")],ai);const ni=new Map;let si=!1;function ri(e){const t=li(e).activeController;(0,s.pC)(t)&&(0,s.pC)(t.analysisViewData.plane)&&t.analysisViewData.visible?e.slicePlane=t.analysisViewData.plane:e.slicePlane=null}function oi(e,t){ni.has(e)||ni.set(e,{all:[],activeController:null}),ni.get(e).all.push(t)}function li(e){return ni.get(e)}function ci(e,t){if(!ni.has(e))throw new Error("view expected in global slice register");const i=ni.get(e),a=i.all.lastIndexOf(t);if(-1===a)throw new Error("controller expected in global slice register");i.all.splice(a,1),0===i.all.length&&ni.delete(e)}var ui=i(84212),di=i(3047);const hi="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAAAnFBMVEUAAAD/gAD/gAD/cAD/gAD/eAD/gAD/eQD/gAD/egD/gAD/ewD/gAD/fAD/gAD/fAD/gAD/fAD/fQD/fQD/fQD/fQD/fQD/fgD/jR7/mjn/mjf/p1H/plH/smf/sWb/vHr/u3n/xYz/xIv/zZz/zJv/zJr/1Kv/1Kr/06r/06n/27n/27f/4cX/4cT/59D/7dr/8uX/9u7/+/f////u2EN0AAAAM3RSTlMACBAQICAoKDAwODhAQEhIUFBYYGhweICIkJCXmJ+gp6ivsLe4uL+/wMDHx8/P19/n7/cWvjXwAAACeUlEQVR42tWX3XqiMBCGY2pbtbrUnzhhdak/lHWliJD7v7fdJ+KG5AMhh30P8zCTmS+TycDaeBoHi5Wgf4jVYvbKmRfPgSAHMX9mPRnM1tSIGHM/c2QddLp4c8wxCvYIvqROBPfbHlm/sRYC6smMNTKn3sxZAyvyYNW1v38MM/IkcPQnZHPMLtciz9P9hhqwzoLD+cnfpTIUaYinyZlBkE2YKZcMXCyN/YhsPkuFlMfWJLiwo89VMxfpJDForMCwuG+Zx7ttGO2S/w4LJ42ZURDty5M0a4dqsZAQAihQfXqWdlhnpcmdEPAI0tv2EbnsbsKmdgi6/1GN7T1XJLx5sF0P9SWABMC+co5JBE4Ge/1NTM3EGIJgjFONXCdAbeQYwhN7pRrRV20LJNIhWOczdu+xPFzIBiQ62iIsyIOTvlZUY+HXySLQaMUEeSC1CPYxENIlwk+q8e0clFAIfiKG+qpaIvod4wfU8sqvkDLda+xCCqgDaAk7uyeNqD+feFlfGCcg3Hzsk+xS7Nz1Aq4CcauhhMc0uxaqIgcFsF0J+1WQyoCN7Y9ezeCVH5LhSxmyRvsihKbK1m7LafpSpkpj6yJgtsiVBh6AX5UyCVmMbrNpcwj5/h6DPN79JjAiQAhXVeN6SZI0q5bQnn4wBiHEqpUybp1ZJzWxStVCHhKhAhVLp/Emh6trHpGLaB6yZHk7wu3Z+ChOxhwUNEmYYjpUvqJDksSHraQmJm2DdqQK6sGUObybYtpSN+8Phm3pN2xjDH33R6b0CKxAZNLvl8foD3BBnSw5e8RI+G2P8GD9wHw6YN3wkfA0R4Zz8CGCIfOCv8zM738walXuLw6nXBvPr8wvAAAAAElFTkSuQmCC",pi="data:image/png;base64,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";var gi=i(49162);const yi={mipmap:!0,preMultiplyAlpha:!0,width:64,height:64};function fi(e){return e.fromData(hi,(()=>new gi.x(hi,yi)))}function vi(e){return e.fromData(pi,(()=>new gi.x(pi,yi)))}var _i,wi=i(23204),mi=i(57979),Pi=i(4275),bi=i(93226),Di=i(50209),Ci=i(39569);let Mi=_i=class extends bi.f{constructor(e){super(e),this.clock=ui.m,this._previewPlaneOpacity=1,this.removeIncompleteOnCancel=!1,this.layersMode="none",this.shiftManipulator=null,this.rotateHeadingManipulator=null,this.rotateTiltManipulator=null,this.resizeManipulators=null,this._handles=new w.Z,this._viewHandles=new w.Z,this._frameTask=null,this._pointerMoveTimerMs=j,this._prevPointerMoveTimeout=null,this._previewPlaneGridVisualElement=null,this._previewPlaneOutlineVisualElement=null,this._startPlane=(0,b.c)(),this._previewPlane=null,this._activeKeyModifiers={},this._lastCursorPosition=(0,A.vW)(),this._resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],this._intersector=(0,mi.Z8)(e.view.state.viewingMode),this._intersector.options.store=Pi.eC.MIN}initialize(){if(null==this.analysis)throw new Error("SliceTool requires valid analysis, but null was provided.");this.rotateHeadingImage=fi(this.view.toolViewManager.textures),this.rotateTiltImage=vi(this.view.toolViewManager.textures);const e=e=>{this._updateManipulatorsInteractive(e),e.grabbing||((0,s.pC)(this.analysisViewData.plane)&&(0,b.a)(this.analysisViewData.plane,this._startPlane),this.inputState=null)};this.shiftManipulator=Ot(this.view),this.manipulators.add(this.shiftManipulator),this.shiftManipulator.events.on("grab-changed",(t=>{this._onShiftGrab(t),e(this.shiftManipulator)})),this._handles.add(this._createShiftDragPipeline(this.shiftManipulator)),this.rotateHeadingManipulator=It(this.view,this.rotateHeadingImage.texture),this.manipulators.add(this.rotateHeadingManipulator),this.rotateHeadingManipulator.events.on("grab-changed",(t=>{this._onRotateHeadingGrab(t),e(this.rotateHeadingManipulator)})),this._handles.add(this._createRotateHeadingDragPipeline(this.rotateHeadingManipulator)),this.rotateTiltManipulator=It(this.view,this.rotateTiltImage.texture),this.manipulators.add(this.rotateTiltManipulator),this.rotateTiltManipulator.events.on("grab-changed",(t=>{this._onRotateTiltGrab(t),e(this.rotateTiltManipulator)})),this._handles.add(this._createRotateTiltDragPipeline(this.rotateTiltManipulator)),this.resizeManipulators=this._resizeHandles.map(((t,i)=>{const a=xt(this.view,t);return a.events.on("grab-changed",(t=>{this._onResizeGrab(t,i),e(a)})),this._handles.add(this._createResizeDragPipeline(a)),a})),this.manipulators.addMany(this.resizeManipulators),this._previewPlaneGridVisualElement=Wt(this.view),this._previewPlaneOutlineVisualElement=Rt(this.view),this._previewPlaneOutlineVisualElement.width=$,this._handles.add((0,P.YP)((()=>this.analysisViewData.plane),(()=>this._updateManipulators()),P.Z_));const t=(0,P.YP)((()=>this.state),(e=>{"sliced"===e&&this.finishToolCreation()}),P.tX);this._handles.add([t,(0,P.YP)((()=>this.view.state.camera),(()=>this._onCameraChange()))])}destroy(){this.rotateHeadingImage=(0,s.RY)(this.rotateHeadingImage),this.rotateTiltImage=(0,s.RY)(this.rotateTiltImage),this._handles=(0,s.SC)(this._handles),this._viewHandles=(0,s.SC)(this._viewHandles),this._removeFrameTask(),this._clearPointerMoveTimeout(),this._previewPlaneOutlineVisualElement=(0,s.SC)(this._previewPlaneOutlineVisualElement),this._previewPlaneGridVisualElement=(0,s.SC)(this._previewPlaneGridVisualElement)}get state(){const e=!!this.analysisViewData.plane,t=!!this.inputState;return e?e&&t?"slicing":e&&!t?"sliced":"ready":"ready"}get cursor(){return this._isPlacingSlicePlane||"exclude"===this.layersMode?"crosshair":(0,s.pC)(this._creatingPointerId)?"grabbing":null}set analysis(e){if(null==e)throw new Error("SliceTool requires valid analysis, but null was provided.");this._handles.remove("analysis"),this._set("analysis",e)}get inputState(){return this._get("inputState")}set inputState(e){this._set("inputState",e),this.analysisViewData.showGrid=(0,s.pC)(e)&&"resize"===e.type,this._updateMaterials()}get _isPlacingSlicePlane(){return!this.inputState&&!this.analysisViewData.plane&&this.active}get _creatingPointerId(){return(0,s.pC)(this.inputState)&&"shift"===this.inputState.type?this.inputState.creatingPointerId:null}enterExcludeLayerMode(){(0,s.Wi)(this.analysisViewData.plane)||(this._set("layersMode","exclude"),this.active||(this.view.activeTool=this))}exitExcludeLayerMode(){(0,s.Wi)(this.analysisViewData.plane)||(this._set("layersMode","none"),this.active&&(this.view.activeTool=null))}onDeactivate(){this._set("layersMode","none"),this._updatePreviewPlane(null)}onShow(){this._updateVisibility(!0)}onHide(){this._updateVisibility(!1)}_updateVisibility(e){this.shiftManipulator&&(this._updateManipulators(),e||this._clearPointerMoveTimeout())}onInputEvent(e){switch(e.type){case"pointer-drag":if(!Ti(e))return;this._isPlacingSlicePlane?this._onClickPlacePlane(e)&&e.stopPropagation():this._onPointerDrag(e)&&e.stopPropagation();break;case"pointer-move":this._onPointerMove(e);break;case"pointer-up":this._onPointerUp(e)&&e.stopPropagation();break;case"immediate-click":if(!Ti(e))return;this._onClickPlacePlane(e)&&e.stopPropagation();break;case"click":if(!Ti(e))return;this._onClickExcludeLayer(e)&&e.stopPropagation();break;case"drag":this.inputState&&e.stopPropagation();break;case"key-down":this._onKeyDown(e)&&e.stopPropagation();break;case"key-up":this._onKeyUp(e)&&e.stopPropagation()}}onEditableChange(){this.analysisViewData.editable=this.editable}_onPointerDrag(e){const t=this.inputState;if(e.pointerId===this._creatingPointerId&&(0,s.pC)(t)&&"shift"===t.type){const i=(0,Ci.vT)(e);return this.shiftManipulator.events.emit("drag",{action:t.hasBeenDragged?"update":"start",pointerType:e.pointerType,start:i,screenPoint:i}),t.hasBeenDragged=!0,!0}return!1}_onPointerMove(e){this._lastCursorPosition.x=e.x,this._lastCursorPosition.y=e.y,this._resetPointerMoveTimeout(),"touch"!==e.pointerType&&this._updatePreviewPlane((0,Ci.vT)(e),this._activeKeyModifiers)}_onCameraChange(){this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),this._updateManipulators()}_onPointerUp(e){if(e.pointerId===this._creatingPointerId&&(0,s.pC)(this.analysisViewData.plane)){const t=(0,Ci.vT)(e);return this.shiftManipulator.events.emit("drag",{action:"end",start:t,screenPoint:t}),(0,b.a)(this.analysisViewData.plane,this._startPlane),this.inputState=null,!0}return!1}_onClickPlacePlane(e){if("exclude"===this.layersMode)return!1;if(this._isPlacingSlicePlane){const t=(0,Ci.vT)(e),i=(0,b.c)();if(this._pickPlane(t,!1,this._activeKeyModifiers,i)){if((0,b.a)(i,this._startPlane),this.analysis.shape=Nt(i,this.view,this.view.spatialReference,new _),"pointer-drag"===e.type){const a=this._calculatePickRay(t);this.inputState=Ai(a,e.pointerId,i.origin,i)}return!0}}return!1}_onClickExcludeLayer(e){return!("exclude"!==this.layersMode||!this.created)&&(this.view.hitTest((0,Ci.vT)(e)).then((e=>{if(e.results.length){const t=e.results[0],i="graphic"===t?.type&&t.graphic;if(i){const e=i.sourceLayer||i.layer;e&&this.analysis.excludedLayers.push(e)}}else e.ground.layer?this.analysis.excludedLayers.push(e.ground.layer):this.analysis.excludeGroundSurface=!0})),this._set("layersMode","none"),this.active&&(this.view.activeTool=null),!0)}_onKeyDown(e){return(e.key===z||e.key===N)&&(this._activeKeyModifiers[e.key]=!0,(0,s.pC)(this._previewPlane)&&this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),!0)}_onKeyUp(e){return!(e.key!==z&&e.key!==N||!this._activeKeyModifiers[e.key])&&(delete this._activeKeyModifiers[e.key],(0,s.pC)(this._previewPlane)&&this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),!0)}_onShiftGrab(e){if("start"!==e.action||(0,s.Wi)(this.analysisViewData.plane))return;const t=this._calculatePickRay(e.screenPoint);(0,b.a)(this.analysisViewData.plane,this._startPlane),this.inputState=Ai(t,null,this.shiftManipulator.renderLocation,this.analysisViewData.plane)}_createShiftDragPipeline(e){return(0,Di.Xd)(e,((e,t,i)=>{const a=this.inputState;if((0,s.Wi)(a)||"shift"!==a.type)return;const n=(0,s.pC)(this.analysisViewData.plane)?(0,b.a)(this.analysisViewData.plane,(0,b.c)()):null;t.next((0,wi._N)(this.view,a.shiftPlane)).next(this._shiftDragAdjustSensitivity(a)).next(this._shiftDragUpdatePlane(a)),i.next((()=>{(0,s.pC)(n)&&this._updateBoundedPlane(n)}))}))}_shiftDragAdjustSensitivity(e){return t=>{if((0,s.Wi)(this.analysisViewData.plane))return null;const i=.001,a=Math.min((1-Math.abs((0,S.e)((0,b.n)(this.analysisViewData.plane),t.ray.direction)/(0,S.l)(t.ray.direction)))/i,1),n=-(0,W.jH)(this._startPlane.plane,t.renderEnd),r=-(0,W.jH)(this._startPlane.plane,e.startPoint);return e.depth=e.depth*(1-a)+n*a-r,t}}_shiftDragUpdatePlane(e){return()=>{if((0,s.Wi)(this.analysisViewData.plane))return;const t=(0,S.c)(L.WM.get(),this._startPlane.origin),i=(0,S.c)(L.WM.get(),(0,b.n)(this._startPlane));(0,S.g)(i,i,-e.depth),(0,S.a)(i,i,t);const a=(0,b.f)(i,this.analysisViewData.plane.basis1,this.analysisViewData.plane.basis2,(0,b.c)());this._updateBoundedPlane(a)}}_onRotateHeadingGrab(e){if("start"!==e.action||(0,s.Wi)(this.analysisViewData.plane))return;const t=wt(this.analysisViewData.plane,this.view.renderCoordsHelper,Qt.HEADING,(0,W.Ue)()),i=this._calculatePickRay(e.screenPoint),a=(0,O.c)();(0,W.BR)(t,i,a)&&((0,b.a)(this.analysisViewData.plane,this._startPlane),this.inputState={type:"rotate",rotatePlane:t,startPoint:a})}_createRotateHeadingDragPipeline(e){return(0,Di.Xd)(e,((e,t,i)=>{const a=this.inputState;if((0,s.Wi)(a)||"rotate"!==a.type)return;const n=(0,s.pC)(this.analysisViewData.plane)?(0,b.a)(this.analysisViewData.plane,(0,b.c)()):null;t.next((0,wi._N)(this.view,a.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(a)).next(this._rotateDragUpdatePlaneFromRotate()),i.next((()=>{(0,s.pC)(n)&&this._updateBoundedPlane(n)}))}))}_onRotateTiltGrab(e){if("start"!==e.action||(0,s.Wi)(this.analysisViewData.plane))return;const t=wt(this.analysisViewData.plane,this.view.renderCoordsHelper,Qt.TILT,(0,W.Ue)()),i=this._calculatePickRay(e.screenPoint),a=(0,O.c)();(0,W.BR)(t,i,a)&&((0,b.a)(this.analysisViewData.plane,this._startPlane),this.inputState={type:"rotate",rotatePlane:t,startPoint:a})}_createRotateTiltDragPipeline(e){return(0,Di.Xd)(e,((e,t,i)=>{const a=this.inputState;if((0,s.Wi)(a)||"rotate"!==a.type)return;const n=(0,s.pC)(this.analysisViewData.plane)?(0,b.a)(this.analysisViewData.plane,(0,b.c)()):null;t.next((0,wi._N)(this.view,a.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(a)).next(this._rotateDragUpdatePlaneFromRotate()),i.next((()=>{(0,s.pC)(n)&&this._updateBoundedPlane(n)}))}))}_rotateDragRenderPlaneToRotate(e){return t=>{if((0,s.Wi)(this.analysisViewData.plane))return null;const i=(0,W.mJ)(e.rotatePlane),a=(0,Ee.Gd)(e.startPoint,t.renderEnd,this.analysisViewData.plane.origin,i);return{...t,rotateAxis:i,rotateAngle:a}}}_rotateDragUpdatePlaneFromRotate(){return e=>{if((0,s.Wi)(this.analysisViewData.plane))return;const t=(0,T.d)(L.MP.get(),e.rotateAngle,e.rotateAxis);if((0,s.Wi)(t))return;const i=(0,S.m)(L.WM.get(),this._startPlane.basis1,t),a=(0,S.m)(L.WM.get(),this._startPlane.basis2,t),n=(0,b.f)(this.analysisViewData.plane.origin,i,a,(0,b.c)());this._updateBoundedPlane(n)}}_onResizeGrab(e,t){if("start"!==e.action||(0,s.Wi)(this.analysisViewData.plane))return;const i=this._calculatePickRay(e.screenPoint),a=L.WM.get();(0,W.BR)(this.analysisViewData.plane.plane,i,a)&&((0,b.a)(this.analysisViewData.plane,this._startPlane),this.inputState={type:"resize",activeHandleIdx:t,startPoint:(0,O.a)(a)})}_createResizeDragPipeline(e){return(0,Di.Xd)(e,((e,t,i)=>{const a=this.inputState;if((0,s.Wi)(a)||"resize"!==a.type||(0,s.Wi)(this.analysisViewData.plane))return;const n=(0,b.a)(this.analysisViewData.plane,(0,b.c)());t.next((0,wi._N)(this.view,this.analysisViewData.plane.plane)).next(this._resizeDragUpdatePlane(a)),i.next((()=>{this._updateBoundedPlane(n)}))}))}_resizeDragUpdatePlane(e){return t=>{if((0,s.Wi)(this.analysisViewData.plane))return;const i=this._resizeHandles[e.activeHandleIdx],a=yt(i,e.startPoint,t.renderEnd,this.view.state.camera,this._startPlane,(0,b.a)(this.analysisViewData.plane));this._updateBoundedPlane(a)}}_updateBoundedPlane(e){const t=this.analysisViewData;if(!(0,s.pC)(t))throw new Error("valid internal object expected");t.plane=e}_updatePreviewPlane(e,t={}){let i=this._previewPlane;if(this._previewPlane=null,(0,s.Wi)(e))return this._removeFrameTask(),void this._updateManipulators();if(!this.analysisViewData.plane&&this.active){const a=(0,s.pC)(i)?i:(0,b.c)();if(i=(0,s.pC)(i)?(0,b.a)(i,Vi):null,this._pickPlane(e,!0,t,a)){const e=Y;let t=!1;(0,s.pC)(i)&&(t=(0,S.e)(i.plane,a.plane)<e||(0,S.e)((0,S.n)(L.WM.get(),i.basis1),(0,S.n)(L.WM.get(),a.basis1))<e),t&&(this._previewPlaneOpacity=0),this._previewPlane=a}}(0,s.pC)(this._previewPlane)&&(0,s.Wi)(this._frameTask)&&0===this._previewPlaneOpacity?this._frameTask=(0,di.A)({update:({deltaTime:e})=>{this._previewPlaneOpacity=Math.min(this._previewPlaneOpacity+e/(1e3*K),1),this._updateManipulators(),1===this._previewPlaneOpacity&&this._removeFrameTask()}}):(0,s.Wi)(this._previewPlane)&&(0,s.pC)(this._frameTask)?this._removeFrameTask():(0,s.pC)(this._previewPlane)&&this._updateManipulators()}_removeFrameTask(){this._frameTask=(0,s.hw)(this._frameTask)}_calculatePickRay(e){const t=(0,x.Ue)(),i=(0,A.md)(e,Ei);return(0,it.u4)(this.view.state.camera,i,t),(0,S.n)(t.direction,t.direction),t}_pickMinResult(e){const t=(0,A.md)(e,L.qW.get());return this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(t,this._intersector),this._intersector.results.min}_pickPlane(e,t,i,a){const n=this._pickMinResult(e),s=L.WM.get();if(!n.getIntersectionPoint(s))return!1;const r=n.getTransformedNormal(L.WM.get()),o=this.view.state.camera;(0,S.e)(r,o.viewForward)>0&&(0,S.g)(r,r,-1);const l=ft(s,o),c=(t?1:-1)*l*Q,u=(0,S.g)(L.WM.get(),r,c);(0,S.a)(u,u,s);const d=this.analysis.tiltEnabled?qt.TILTED:qt.HORIZONTAL_OR_VERTICAL,h=i[z]?qt.VERTICAL:i[N]?qt.HORIZONTAL:d;return ht(u,r,l,l,o,h,this.view.renderCoordsHelper,a),!0}_clearPointerMoveTimeout(){this._prevPointerMoveTimeout=(0,s.hw)(this._prevPointerMoveTimeout)}_resetPointerMoveTimeout(){this._clearPointerMoveTimeout(),this.shiftManipulator.state|=jt,this.rotateHeadingManipulator.state|=jt,this.rotateTiltManipulator.state|=jt,this._prevPointerMoveTimeout=this.clock.setTimeout((()=>{this.shiftManipulator.state&=~jt,this.rotateHeadingManipulator.state&=~jt,this.rotateTiltManipulator.state&=~jt}),this._pointerMoveTimerMs)}_updateManipulators(){if(_i.disableEngineLayers)return;let e=null,t=!1;if((0,s.pC)(this.analysisViewData.plane))e=this.analysisViewData.plane,t=!1;else{if(!(0,s.pC)(this._previewPlane))return this.shiftManipulator.available=!1,this.rotateHeadingManipulator.available=!1,this.rotateTiltManipulator.available=!1,this.resizeManipulators.forEach((e=>e.available=!1)),this._previewPlaneOutlineVisualElement.visible=!1,void(this._previewPlaneGridVisualElement.visible=!1);e=this._previewPlane,t=!0}const i=_t(e,L.MP.get());t?(this.shiftManipulator.available=!1,this.rotateHeadingManipulator.available=!1,this.rotateTiltManipulator.available=!1,this.resizeManipulators.forEach((e=>e.available=!1)),this._previewPlaneOutlineVisualElement.visible=!0,this._previewPlaneGridVisualElement.visible=!0):(this.shiftManipulator.available=!0,this.rotateHeadingManipulator.available=!0,this.rotateTiltManipulator.available=this.analysis.tiltEnabled,this.resizeManipulators.forEach((e=>e.available=!0)),mt(this.shiftManipulator,i,e,this.view.state.camera),Dt(this.rotateHeadingManipulator,i,e,this.view.renderCoordsHelper),Ct(this.rotateTiltManipulator,i,e),this.resizeManipulators.forEach(((t,a)=>bt(t,this._resizeHandles[a],i,e))),this._previewPlaneOutlineVisualElement.visible=!1,this._previewPlaneGridVisualElement.visible=!1);const a=(0,S.s)(L.WM.get(),(0,S.l)(e.basis1),(0,S.l)(e.basis2),1),n=(0,T.u)(L.MP.get(),a),r=(0,T.m)(n,i,n);this._previewPlaneOutlineVisualElement.transform=r,this._previewPlaneGridVisualElement.transform=r,this._updateMaterials()}_updateMaterials(){const e=[te[0],te[1],te[2],te[3]*this._previewPlaneOpacity];this._previewPlaneOutlineVisualElement.color=e;const t=[ie[0],ie[1],ie[2],ie[3]*this._previewPlaneOpacity],i=[0,0,0,0];this._previewPlaneGridVisualElement.backgroundColor=t,this._previewPlaneGridVisualElement.gridColor=i}_updateManipulatorsInteractive(e){if(!e.grabbing)return this.shiftManipulator.interactive=!0,this.rotateHeadingManipulator.interactive=!0,this.rotateTiltManipulator.interactive=!0,void this.resizeManipulators.forEach((e=>{e.interactive=!0}));this.shiftManipulator.interactive=this.shiftManipulator===e,this.rotateHeadingManipulator.interactive=this.rotateHeadingManipulator===e,this.rotateTiltManipulator.interactive=this.rotateTiltManipulator===e,this.resizeManipulators.forEach((t=>{t.interactive=t===e}))}testData(){return{plane:this.analysisViewData.plane,setPointerMoveTimerMs:e=>{this._pointerMoveTimerMs=e}}}};function Ai(e,t,i,a){const n=vt(i,(0,b.n)(a),e.direction,(0,W.Ue)()),s=(0,O.c)();return(0,W.BR)(n,e,s)?{type:"shift",creatingPointerId:t,hasBeenDragged:!1,shiftPlane:n,depth:0,startPoint:s}:null}function Ti(e){return"mouse"!==e.pointerType||0===e.button}Mi.disableEngineLayers=!1,(0,a._)([(0,r.Cb)()],Mi.prototype,"clock",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0})],Mi.prototype,"view",void 0),(0,a._)([(0,r.Cb)()],Mi.prototype,"analysisViewData",void 0),(0,a._)([(0,r.Cb)({readOnly:!0})],Mi.prototype,"state",null),(0,a._)([(0,r.Cb)({readOnly:!0})],Mi.prototype,"cursor",null),(0,a._)([(0,r.Cb)()],Mi.prototype,"analysis",null),(0,a._)([(0,r.Cb)()],Mi.prototype,"removeIncompleteOnCancel",void 0),(0,a._)([(0,r.Cb)({readOnly:!0})],Mi.prototype,"layersMode",void 0),(0,a._)([(0,r.Cb)({value:null})],Mi.prototype,"inputState",null),(0,a._)([(0,r.Cb)()],Mi.prototype,"_isPlacingSlicePlane",null),(0,a._)([(0,r.Cb)()],Mi.prototype,"_creatingPointerId",null),Mi=_i=(0,a._)([(0,c.j)("esri.views.3d.analysis.Slice.SliceTool")],Mi);const Vi=(0,b.c)(),Ei=(0,A.s1)(),Si=Mi;var Oi=i(40920);let Ii=class extends n.Z{constructor(e){super(e),this._handles=new w.Z,this._gridVisualElement=null,this._outlineVisualElement=null,this.state="pending",this.showGrid=!1,this.preview=!0}get ready(){return"ready"===this.state}initialize(){this._initialize()}async _initialize(){if("destroyed"===this.state||"ready"===this.state)return;await(0,P.N1)((()=>this.view.ready));const e=this.analysisViewData;if((0,s.Wi)(e))throw new Error("expected internal object to be valid");this._gridVisualElement=Wt(this.view),this._outlineVisualElement=Rt(this.view),this._handles.add([(0,P.YP)((()=>({visible:(0,s.pC)(e.plane)&&this.analysisViewData.visible,active:this.analysisViewData.active,preview:this.preview,showGrid:this.showGrid})),(e=>this._updateMaterials(e)),P.tX),(0,P.YP)((()=>e.plane),(e=>this._updatePlane(e)),P.tX)],"internal"),this._set("state","ready")}destroy(){"destroyed"!==this.state&&"pending"!==this.state&&(this._handles.destroy(),this._gridVisualElement=(0,s.SC)(this._gridVisualElement),this._outlineVisualElement=(0,s.SC)(this._outlineVisualElement),this.set("view",null),this._set("state","destroyed"))}async whenReady(){await(0,P.N1)((()=>this.view.ready))}_updatePlane(e){if((0,s.Wi)(e))return;const t=(0,S.s)(L.WM.get(),(0,S.l)(e.basis1),(0,S.l)(e.basis2),1),i=(0,T.u)(L.MP.get(),t),a=_t(e,L.MP.get()),n=(0,T.m)(i,a,i);this._outlineVisualElement.transform=n,this._gridVisualElement.transform=n}_updateMaterials({visible:e,active:t,preview:i,showGrid:a}){this._outlineVisualElement.color=te,this._outlineVisualElement.width=i?$:ee,this._outlineVisualElement.stipplePattern=t?null:(0,Oi.z5)(5),this._gridVisualElement.backgroundColor=ie,this._gridVisualElement.gridColor=a?ae:H.Z,this._gridVisualElement.visible=e,this._outlineVisualElement.visible=e}};(0,a._)([(0,r.Cb)({readOnly:!0})],Ii.prototype,"state",void 0),(0,a._)([(0,r.Cb)()],Ii.prototype,"view",void 0),(0,a._)([(0,r.Cb)()],Ii.prototype,"analysis",void 0),(0,a._)([(0,r.Cb)()],Ii.prototype,"analysisViewData",void 0),(0,a._)([(0,r.Cb)()],Ii.prototype,"ready",null),(0,a._)([(0,r.Cb)()],Ii.prototype,"showGrid",void 0),(0,a._)([(0,r.Cb)()],Ii.prototype,"preview",void 0),Ii=(0,a._)([(0,c.j)("esri.views.3d.analysis.Slice.SliceVisualization")],Ii);var Ri=i(60874);let Wi=class extends((0,u.p)(n.Z)){constructor(e){super(e),this.type="slice-view-3d",this.analysis=null,this.tool=null,this.analysisVisualization=null,this.analysisController=null,this.plane=null,this.active=!0,this.showGrid=!1}initialize(){this.analysisVisualization=new Ii({view:this.view,analysis:this.analysis,analysisViewData:this}),this.analysisController=new ai({view:this.view,analysis:this.analysis,analysisViewData:this}),this.own((0,Ri.Lp)(this,Si))}destroy(){(0,Ri.Yq)(this),this.analysisVisualization=(0,s.SC)(this.analysisVisualization),this.analysisController=(0,s.SC)(this.analysisController)}get editable(){return!this.analysisVisualization.preview}set editable(e){this.analysisVisualization.preview=!e}async when(){return await this.analysisVisualization.whenReady(),await this.analysisController.whenReady(),this}get testData(){return{visualization:this.analysisVisualization,controller:this.analysisController,tool:(0,s.Wg)(this.tool)}}};(0,a._)([(0,r.Cb)({readOnly:!0})],Wi.prototype,"type",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0,nonNullable:!0})],Wi.prototype,"analysis",void 0),(0,a._)([(0,r.Cb)()],Wi.prototype,"tool",void 0),(0,a._)([(0,r.Cb)()],Wi.prototype,"plane",void 0),(0,a._)([(0,r.Cb)()],Wi.prototype,"active",void 0),(0,a._)([(0,r.Cb)({aliasOf:"analysisVisualization.showGrid"})],Wi.prototype,"showGrid",void 0),(0,a._)([(0,r.Cb)()],Wi.prototype,"editable",null),Wi=(0,a._)([(0,c.j)("esri.views.3d.analysis.SliceAnalysisView3D")],Wi);const xi=Wi},58627:function(e,t,i){i.d(t,{G:function(){return r},e:function(){return o}});var a=i(8693),n=i(47608),s=i(67765);function r(e,t,i,r=!1){const o=(0,n.fM)(e,t);return(0,a.Wi)(o)?null:(o.hasZ&&!r||!(0,a.pC)(i)||(o.z=(0,a.Pt)((0,s.KO)(i,o),0)),o)}function o(e,t,i){i.warnOnce(`Failed to project analysis geometry (id: '${e.id}'), projection from spatial reference (wkid: '${t.wkid}') to view spatial reference is not supported. Projection may be possible after calling projection.load().`)}},23204:function(e,t,i){i.d(t,{J4:function(){return f},_N:function(){return g},gv:function(){return v}});var a,n=i(8693),s=i(30524),r=(i(65554),i(74674)),o=(i(47608),i(54550)),l=i(23573),c=(i(94377),i(62069)),u=(i(88141),i(90290)),d=i(57979),h=i(4275),p=i(93700);i(50209);function g(e,t){return y(e,(()=>t))}function y(e,t){const i=(0,r.c)(),a=(0,r.c)();let l=!1;return r=>{const d=t(r);if("start"===r.action){const t=(0,s.md)(r.screenStart,(0,s.c$)(c.qW.get())),a=(0,u.u4)(e.state.camera,t,_);(0,n.pC)(a)&&(l=(0,o.BR)(d,a,i))}if(!l)return null;const h=(0,s.md)(r.screenEnd,(0,s.c$)(c.qW.get())),p=(0,u.u4)(e.state.camera,h,_);return(0,n.Wi)(p)?null:(0,o.BR)(d,p,a)?{...r,renderStart:i,renderEnd:a,plane:d,ray:p}:null}}function f(e){let t=null;return i=>{switch(i.action){case"start":t=e.disableDisplay();break;case"end":case"cancel":(0,n.pC)(t)&&(t.remove(),t=null)}return i}}function v(e,t=null){const i=(0,d.Z8)(e.state.viewingMode);i.options.selectionMode=!0,i.options.store=h.eC.MIN,i.options.hud=!1;const o=(0,s.s1)(),l={requiresGroundFeedback:!0,enableDraped:!0,exclude:new Set},c=(0,r.c)(),u=(0,n.Pt)(t,e.spatialReference),g=t=>{e.map.ground&&e.map.ground.opacity<1?l.exclude.add(p.cy):l.exclude.delete(p.cy),e.sceneIntersectionHelper.intersectIntersectorScreen((0,s.md)(t,o),i,l);const n=i.results.min;let r;if(n.getIntersectionPoint(c))r=n.intersector===h.q7.TERRAIN?a.GROUND:a.OTHER;else{if(!i.results.ground.getIntersectionPoint(c))return null;r=a.GROUND}return{location:e.renderCoordsHelper.fromRenderCoords(c,u),surfaceType:r}};let y;return e=>{if("start"===e.action){const t=g(e.screenStart);y=(0,n.pC)(t)?t.location:null}if((0,n.Wi)(y))return null;const t=g(e.screenEnd);return(0,n.pC)(t)&&(0,n.pC)(t.location)?{...e,mapStart:y,mapEnd:t.location,surfaceType:t.surfaceType}:null}}!function(e){e[e.GROUND=0]="GROUND",e[e.OTHER=1]="OTHER"}(a||(a={}));(0,r.c)(),(0,r.c)();const _=(0,l.Ue)()},21151:function(e,t,i){i.d(t,{j:function(){return A}});var a=i(15626),n=i(81789),s=i(22677),r=i(59753),o=i(31728),l=i(25749),c=i(75633),u=i(38306),d=i(34590),h=i(61445),p=(i(65982),i(68205)),g=i(20572),y=i(33274),f=i(85018),v=i(7436),_=i(96350),w=i(79326),m=i(17950),P=i(17923),b=i(9408);class D extends g.A{initializeProgram(e){const t=D.shader.get().build(this.configuration);return new v.$(e.rctx,t,f.i)}_setPipelineState(e,t){const i=this.configuration,s=e===n.Am.NONE,r=e===n.Am.FrontFace;return(0,b.sm)({blending:i.output!==a.H.Color&&i.output!==a.H.Alpha||!i.transparent?null:s?C:(0,l.j7)(e),culling:(0,b.zp)(i.cullFace),depthTest:{func:(0,l.Bh)(e)},depthWrite:s?i.writeDepth&&b.LZ:(0,l.K5)(e),colorWrite:b.BK,stencilWrite:i.hasOccludees?_.s3:null,stencilTest:i.hasOccludees?t?_.eD:_.RY:null,polygonOffset:s||r?null:(0,l.je)(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,t){return t?this._occludeePipelineState:super.getPipelineState(e,t)}}D.shader=new p.J(m.I,(()=>i.e(3334).then(i.bind(i,23334))));const C=(0,b["if"])(P.zi.ONE,P.zi.ONE_MINUS_SRC_ALPHA);class M extends w.W{constructor(){super(...arguments),this.output=a.H.Color,this.cullFace=n.Vr.None,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=n.Am.NONE,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}(0,h._)([(0,y.o)({count:a.H.COUNT})],M.prototype,"output",void 0),(0,h._)([(0,y.o)({count:n.Vr.COUNT})],M.prototype,"cullFace",void 0),(0,h._)([(0,y.o)()],M.prototype,"hasSlicePlane",void 0),(0,h._)([(0,y.o)()],M.prototype,"transparent",void 0),(0,h._)([(0,y.o)()],M.prototype,"enableOffset",void 0),(0,h._)([(0,y.o)()],M.prototype,"writeDepth",void 0),(0,h._)([(0,y.o)()],M.prototype,"hasOccludees",void 0),(0,h._)([(0,y.o)({count:n.Am.COUNT})],M.prototype,"transparencyPassType",void 0),(0,h._)([(0,y.o)()],M.prototype,"hasMultipassTerrain",void 0),(0,h._)([(0,y.o)()],M.prototype,"cullAboveGround",void 0);class A extends o.F5{constructor(e){super(e,new V),this.supportsEdges=!0,this.techniqueConfig=new M}getConfiguration(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.parameters.cullFace,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.hasOccludees=this.parameters.hasOccludees,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.enableOffset=t.camera.relativeElevation<l.ve,this.techniqueConfig.hasMultipassTerrain=t.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=t.multipassTerrain.cullAboveGround,this.techniqueConfig}intersect(e,t,i,a,n,s,r){(0,d.Bw)(e,t,a,n,s,void 0,r)}requiresSlot(e,t){return e===c.r.DRAPED_MATERIAL||((0,s.S)(t)===a.H.Highlight?e===c.r.OPAQUE_MATERIAL:e===(this.parameters.transparent?this.parameters.writeDepth?c.r.TRANSPARENT_MATERIAL:c.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:c.r.OPAQUE_MATERIAL))}createGLMaterial(e){return e.output===a.H.Color||e.output===a.H.Alpha||e.output===a.H.Highlight?new T(e):void 0}createBufferWriter(){return new u.G_(u.W1)}}class T extends r.F{constructor(e){super({...e,...e.material.parameters})}_updateParameters(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(D,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&(this._material.setParameters({hasOccludees:e.hasOccludees}),this._updateParameters(e))}beginSlot(e){return this._output!==a.H.Color&&this._output!==a.H.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}}class V extends o.Mt{constructor(){super(...arguments),this.transparent=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=n.Vr.None,this.hasOccludees=!1,this.opacity=1,this.textureId=null,this.initTextureTransparent=!0}}}}]);
//# sourceMappingURL=8633.6e811bfb.js.map