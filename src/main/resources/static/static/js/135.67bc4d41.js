"use strict";(self["webpackChunkeco_friendly"]=self["webpackChunkeco_friendly"]||[]).push([[135],{50135:function(t,e,r){r.r(e),r.d(e,{default:function(){return p}});r(48675),r(3462),r(37380),r(1118),r(21703);var a=r(8693),n=r(928),f=r(44420),o=r(51654),i=r(65554),s=r(64680),u=r(47608),l=r(87429),b=r(53835);class c{transform(t){const e=this._transform(t),r=[e.points.buffer,e.rgb.buffer];(0,a.pC)(e.pointIdFilterMap)&&r.push(e.pointIdFilterMap.buffer);for(const a of e.attributes)"buffer"in a.values&&(0,n.eP)(a.values.buffer)&&a.values.buffer!==e.rgb.buffer&&r.push(a.values.buffer);return Promise.resolve({result:e,transferList:r})}_transform(t){const e=(0,b.Ym)(t.schema,t.geometryBuffer);let r=e.length/3,n=null;const f=[],o=(0,b.dH)(t.primaryAttributeData,e,r);(0,a.pC)(t.primaryAttributeData)&&o&&f.push({attributeInfo:t.primaryAttributeData.attributeInfo,values:o});const i=(0,b.dH)(t.modulationAttributeData,e,r);(0,a.pC)(t.modulationAttributeData)&&i&&f.push({attributeInfo:t.modulationAttributeData.attributeInfo,values:i});let s=(0,b.aE)(t.rendererInfo,o,i,r);if(t.filterInfo&&t.filterInfo.length>0&&(0,a.pC)(t.filterAttributesData)){const a=t.filterAttributesData.map((t=>{const a=(0,b.dH)(t,e,r),n={attributeInfo:t.attributeInfo,values:a};return f.push(n),n}));n=new Uint32Array(r),r=(0,b.hv)(e,s,n,t.filterInfo,a)}for(const a of t.userAttributesData){const t=(0,b.dH)(a,e,r);f.push({attributeInfo:a.attributeInfo,values:t})}3*r<s.length&&(s=new Uint8Array(s.buffer.slice(0,3*r))),this._applyElevationOffsetInPlace(e,r,t.elevationOffset);const u=this._transformCoordinates(e,r,t.obb,l.Z.fromJSON(t.inSR),l.Z.fromJSON(t.outSR));return{obb:t.obb,points:u,rgb:s,attributes:f,pointIdFilterMap:n}}_transformCoordinates(t,e,r,a,n){if(!(0,u.CM)(t,a,0,t,n,0,e))throw Error("Can't reproject");const o=(0,s.f)(r.center[0],r.center[1],r.center[2]),l=(0,s.c)(),b=(0,s.c)();(0,f.c)(h,r.quaternion);const c=new Float32Array(3*e);for(let f=0;f<e;f++)l[0]=t[3*f]-o[0],l[1]=t[3*f+1]-o[1],l[2]=t[3*f+2]-o[2],(0,i.q)(b,l,h),r.halfSize[0]=Math.max(r.halfSize[0],Math.abs(b[0])),r.halfSize[1]=Math.max(r.halfSize[1],Math.abs(b[1])),r.halfSize[2]=Math.max(r.halfSize[2],Math.abs(b[2])),c[3*f]=l[0],c[3*f+1]=l[1],c[3*f+2]=l[2];return c}_applyElevationOffsetInPlace(t,e,r){if(0!==r)for(let a=0;a<e;a++)t[3*a+2]+=r}}const h=(0,o.c)();function p(){return new c}}}]);
//# sourceMappingURL=135.67bc4d41.js.map