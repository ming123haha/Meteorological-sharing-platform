"use strict";(self["webpackChunkeco_friendly"]=self["webpackChunkeco_friendly"]||[]).push([[1532],{54511:function(e,t,i){i.d(t,{M:function(){return c},b:function(){return d}});var s=i(70516),n=i(87035),r=i(73893),a=i(65982),o=i(63914),l=i(30150);function d(e){const t=new o.kG;(0,s.S)(t,e),t.vertex.uniforms.add(new r.p("width",(e=>e.width))),t.attributes.add(l.T.POSITION,"vec3"),t.attributes.add(l.T.NORMAL,"vec3"),t.attributes.add(l.T.UV0,"vec2"),t.attributes.add(l.T.AUXPOS1,"float"),t.varyings.add("vtc","vec2"),t.varyings.add("vlength","float"),t.varyings.add("vradius","float"),t.vertex.code.add(a.H`void main(void) {
vec3 bitangent = normal;
vtc = uv0;
vlength = auxpos1;
vradius = 0.5 * width;
vec4 pos = view * vec4(position + vradius * bitangent * uv0.y, 1.0);
gl_Position = proj * pos;
}`),t.fragment.uniforms.add([new r.p("outlineSize",(e=>e.outlineSize)),new n.N("outlineColor",(e=>e.outlineColor)),new r.p("stripeLength",(e=>e.stripeLength)),new n.N("stripeEvenColor",(e=>e.stripeEvenColor)),new n.N("stripeOddColor",(e=>e.stripeOddColor))]);const i=1/Math.sqrt(2);return t.fragment.code.add(a.H`
    const float INV_SQRT2 = ${a.H.float(i)};

    vec4 arrowColor(vec2 tc, float len) {
      float d = INV_SQRT2 * (tc.x - abs(tc.y));
      d = min(d, INV_SQRT2 * (len - tc.x - abs(tc.y)));
      d = min(d, 1.0 - abs(tc.y));

      if (d < 0.0) {
        return vec4(0.0);
      } else if (d < outlineSize) {
        return outlineColor;
      } else {
        return fract(0.5 / stripeLength * tc.x * vradius) >= 0.5 ? stripeOddColor : stripeEvenColor;
      }
    }

    void main(void) {
      vec2 ntc = vec2(vtc.x / vradius, vtc.y);
      vec4 color = arrowColor(ntc, vlength / vradius);
      if (color.a == 0.0) {
        discard;
      }
      gl_FragColor = color;
    }
  `),t}const c=Object.freeze(Object.defineProperty({__proto__:null,build:d},Symbol.toStringTag,{value:"Module"}))},21532:function(e,t,i){i.r(t),i.d(t,{default:function(){return Ie}});var s=i(61445),n=i(92698),r=i(8693),a=i(58006),o=(i(15055),i(81653),i(94315),i(77623)),l=i(85210),d=i(30709),c=i(18640),h=i(50816),u=i(93622),_=i(44679),p=i(18105),g=i(65554),m=i(74674),v=i(85341),y=i(43564),b=i(47608),w=i(3399),C=i(90311),S=i(58627),P=i(97678);const f=u.Z.getLogger("esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementController"),O=1e5;let L=class extends n.Z{constructor(e){super(e),this._unitNormalizer=new P.D,this._handles=new h.Z,this._tempStartPosition=(0,m.c)(),this._tempEndPosition=(0,m.c)(),this._tempCornerPosition=(0,m.c)()}initialize(){this._handles.add((0,p.gx)((()=>this.view?.ready),(()=>this._initialize()),{once:!0,sync:!0,initial:!0}))}destroy(){this._handles=(0,r.SC)(this._handles)}_initialize(){const e=this.view.spatialReference,t=(0,w.rS)(e),i=t===w.GG?w.wY:t;this._sphericalPCPF=i;const s=(0,b.Up)(e,i);this._unitNormalizer.spatialReference=s?i:e,this._handles.add([(0,p.YP)((()=>({viewData:this.viewData,startPoint:this.analysis.startPoint})),(({viewData:e,startPoint:t})=>{e.elevationAlignedStartPoint=this._applyProjectionAndElevationAlignment(t)}),p.tX),(0,p.YP)((()=>({viewData:this.viewData,endPoint:this.analysis.endPoint})),(({viewData:e,endPoint:t})=>{e.elevationAlignedEndPoint=this._applyProjectionAndElevationAlignment(t)}),p.tX),(0,p.YP)((()=>({result:this._computedResult,viewData:this.viewData})),(({result:e,viewData:t})=>{t.result=e}),p.tX)])}_applyProjectionAndElevationAlignment(e){if((0,r.Wi)(e))return e;const t=(0,S.G)(e,this.view.spatialReference,this.view.elevationProvider);return(0,r.Wi)(t)?((0,S.e)(this.analysis,e.spatialReference,f),null):t}get _computedResult(){const{elevationAlignedStartPoint:e,elevationAlignedEndPoint:t,measurementMode:i}=this.viewData;if((0,r.Wi)(e)||(0,r.Wi)(t))return null;const s=this._euclideanDistances(e,t),n=this._geodesicDistance(e,t,s.horizontal.value),a=i===c.e.Geodesic||i===c.e.Auto&&s.horizontal.value>O?"geodesic":"euclidean";return{mode:a,distance:"euclidean"===a?s.direct:n,directDistance:s.direct,horizontalDistance:s.horizontal,verticalDistance:s.vertical,geodesicDistance:n}}_euclideanDistances(e,t){const i=e.clone();i.z=t.z;const s=this._tempStartPosition,n=this._tempEndPosition,r=this._tempCornerPosition,a=this.view.spatialReference,o=this._sphericalPCPF,l=(0,b.Up)(a,o)?o:a;(0,b.KC)(e,s,l),(0,b.KC)(t,n,l),(0,b.KC)(i,r,l);const d=(0,g.i)(s,n),c=(0,g.i)(r,n),h=Math.abs(t.z-e.z),u=e=>this._unitNormalizer.normalizeDistance(e),p=u(d),m=u(c),v=u(h);return{direct:(0,_.EV)(p,"meters"),horizontal:(0,_.EV)(m,"meters"),vertical:(0,_.EV)(v,"meters")}}_geodesicDistance(e,t,i){const s=e.spatialReference,n=new y.Z({spatialReference:s});n.addPath([e,t]);const a=s.isGeographic&&(0,C.Gb)(s)?(0,C.Jf)([n],"meters")[0]:s.isWebMercator?(0,v.geodesicLength)(n,"meters"):null,o=(0,r.pC)(a)?a:this._fallbackGeodesicDistance(e,t,i);return(0,_.EV)(o,"meters")}_fallbackGeodesicDistance(e,t,i){if((0,b.UY)(e,z)&&(0,b.UY)(t,M)){const e={distance:0};return(0,C.cA)(e,z,M),e.distance}return i}};(0,s._)([(0,a.Cb)()],L.prototype,"view",void 0),(0,s._)([(0,a.Cb)()],L.prototype,"analysis",void 0),(0,s._)([(0,a.Cb)()],L.prototype,"viewData",void 0),(0,s._)([(0,a.Cb)()],L.prototype,"_computedResult",null),L=(0,s._)([(0,o.j)("esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementController")],L);const z=(0,m.c)(),M=(0,m.c)();i(6131);var E,A,V=i(67752),D=i(22189),T=i(30524),x=i(61293),G=i(47001),R=i(86163);!function(e){e[e.None=0]="None",e[e.Direct=1]="Direct",e[e.Triangle=2]="Triangle",e[e.ProjectedGeodesic=3]="ProjectedGeodesic"}(E||(E={})),function(e){e[e.Auto=0]="Auto",e[e.AboveSegment=1]="AboveSegment",e[e.BelowSegment=2]="BelowSegment"}(A||(A={}));var W=i(24783),j=i(34307),N=i(33216),q=i(94370),H=i(85381),I=i(62069),U=i(9871),k=i(59546),Q=i(31728),F=i(96884),Z=i(15626),B=i(81789),X=i(79961),Y=i(75633),$=i(30150),K=i(68205),J=i(20572),ee=i(33274),te=i(85018),ie=i(25749),se=i(7436),ne=i(79326),re=i(54511),ae=i(17923),oe=i(9408);class le extends J.A{constructor(e,t,i){super(e,t,i)}initializeProgram(e){const t=le.shader.get().build(this.configuration);return new se.$(e.rctx,t,te.i)}_setPipelineState(e){const t=e===B.Am.NONE,i=this.configuration;return(0,oe.sm)({blending:i.transparent?t?ie.wu:(0,ie.j7)(e):null,polygonOffset:this.configuration.polygonOffsetEnabled&&{factor:0,units:-4},depthTest:{func:ae.wb.LESS},depthWrite:oe.LZ,colorWrite:oe.BK})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return ae.MX.TRIANGLE_STRIP}}le.shader=new K.J(re.M,(()=>i.e(4571).then(i.bind(i,24571))));class de extends ne.W{constructor(){super(...arguments),this.polygonOffsetEnabled=!1,this.transparent=!1,this.transparencyPassType=B.Am.NONE}}(0,s._)([(0,ee.o)()],de.prototype,"polygonOffsetEnabled",void 0),(0,s._)([(0,ee.o)()],de.prototype,"transparent",void 0),(0,s._)([(0,ee.o)({count:B.Am.COUNT})],de.prototype,"transparencyPassType",void 0);class ce extends Q.F5{constructor(e){super(e,new ue),this.techniqueConfig=new de}getConfiguration(e,t){return this.techniqueConfig.polygonOffsetEnabled=this.parameters.polygonOffset,this.techniqueConfig.transparent=this.parameters.stripeEvenColor[3]<1||this.parameters.stripeOddColor[3]<1||this.parameters.outlineColor[3]<1,this.techniqueConfig.transparencyPassType=t?.transparencyPassType??B.Am.NONE,this.techniqueConfig}dispose(){}intersect(){}requiresSlot(e){return e===Y.r.OPAQUE_MATERIAL}createGLMaterial(e){return e.output===Z.H.Color?new he(e):null}createBufferWriter(){return new be}}class he extends X.Z{beginSlot(e){return this.ensureTechnique(le,e)}}class ue extends Q.Mt{constructor(){super(...arguments),this.width=32,this.outlineSize=.2,this.outlineColor=[1,.5,0,1],this.stripeLength=1,this.stripeEvenColor=[1,1,1,1],this.stripeOddColor=[1,.5,0,1],this.polygonOffset=!1}}const _e=(0,F.U$)().vec3f($.T.POSITION).vec3f($.T.NORMAL).vec2f($.T.UV0).f32($.T.AUXPOS1),pe=(0,m.c)(),ge=(0,m.c)(),me=(0,m.c)(),ve=(0,m.c)(),ye=(0,m.c)();class be{constructor(){this.vertexBufferLayout=_e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return 2*(e.indices.get($.T.POSITION).length/2+1)}write(e,t,i,s){const n=t.vertexAttributes.get($.T.POSITION).data,r=t.vertexAttributes.get($.T.NORMAL).data,a=n.length/3,o=t&&t.indices&&t.indices.get($.T.POSITION);o&&o.length!==2*(a-1)&&console.warn("MeasurementArrowMaterial does not support indices");const l=pe,d=ge,c=me,h=ve,u=ye,_=e.transformation,p=e.invTranspTransformation,m=i.position,v=i.normal,y=i.uv0;let b=0;for(let C=0;C<a;++C){const e=3*C;if((0,g.s)(l,n[e],n[e+1],n[e+2]),C<a-1){const e=3*(C+1);(0,g.s)(d,n[e],n[e+1],n[e+2]),(0,g.s)(u,r[e],r[e+1],r[e+2]),(0,g.n)(u,u),(0,g.b)(c,d,l),(0,g.n)(c,c),(0,g.f)(h,u,c),(0,g.n)(h,h)}const t=(0,g.i)(l,d);_&&p&&((0,g.m)(l,l,_),(0,g.m)(d,d,_),(0,g.m)(h,h,p));const i=s+2*C,o=i+1;m.setVec(i,l),m.setVec(o,l),v.setVec(i,h),v.setVec(o,h),y.set(i,0,b),y.set(i,1,-1),y.set(o,0,b),y.set(o,1,1),C<a-1&&(b+=t)}const w=i.auxpos1;for(let g=0;g<2*a;++g)w.set(s+g,b)}}class we extends U._{constructor(e){super(e),this._parameters=Ce,this._handles=null,this._origin=(0,m.c)(),this._originTransform=(0,q.c)(),this._arrowCenter=(0,m.c)(),this._renderOccluded=Q.yD.OccludeAndTransparent,this._geometry=null,this._stripeLength=1,this._stripesEnabled=!0,this._opacity=1,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._arrowMaterial&&this._arrowMaterial.setParameters({renderOccluded:e}))}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this._geometryChanged()}get stripeLength(){return this._stripeLength}set stripeLength(e){this._stripeLength=e,this.attached&&this._arrowMaterial.setParameters({stripeLength:this._stripeLength})}get stripesEnabled(){return this._stripesEnabled}set stripesEnabled(e){if(this._stripesEnabled=e,this.attached){const e=this.opacity,{arrowStripeEvenColor:t,arrowStripeOddColor:i}=this._parameters,s=(0,V.H)(Se,this._stripesEnabled?t:i,e);this._arrowMaterial.setParameters({stripeEvenColor:s})}}get opacity(){return this._opacity}set opacity(e){e!==this._opacity&&(this._opacity=e,this._updateArrowOpacity())}createExternalResources(){const{arrowStripeEvenColor:e,arrowStripeOddColor:t,arrowOutlineColor:i}=this._parameters,s=this._stripesEnabled?e:t;this._arrowMaterial=new ce({outlineColor:i,stripeEvenColor:s,stripeOddColor:t,renderOccluded:this.renderOccluded,polygonOffset:!0}),this._handles=new h.Z,this._handles.add((0,p.YP)((()=>this.view.state.camera),(()=>{this._viewChanged()})))}destroyExternalResources(){this._arrowMaterial=null,this._handles.destroy(),this._handles=null}forEachExternalMaterial(e){e(this._arrowMaterial)}createGeometries(e){if((0,r.Wi)(this._geometry)||(0,r.Wi)(this._geometry.startRenderSpace)||(0,r.Wi)(this._geometry.endRenderSpace))return;const t=this._createArrowGeometry(this._geometry.startRenderSpace,this._geometry.endRenderSpace,this._origin,this._geometry);e.addGeometry(t,this._arrowMaterial,this._originTransform),this._viewChanged()}_createArrowGeometry(e,t,i,s){const n=this.view.renderCoordsHelper,r=[],a=[],o=(e,t)=>{const s=I.WM.get();(0,g.b)(s,e,i),r.push(s),a.push(t)};if("euclidean"===s.type){s.eval(.5,this._arrowCenter);const i=I.WM.get();n.worldUpAtPosition(this._arrowCenter,i),o(e,i),o(t,i)}else{s.eval(.5,this._arrowCenter);const e=this._parameters.arrowSubdivisions+1&-2;for(let t=0;t<e;++t){const i=t/(e-1),r=I.WM.get(),a=I.WM.get();s.eval(i,r),n.worldUpAtPosition(r,a),o(r,a)}}return k.Z.createPolylineGeometry(r,a)}_geometryChanged(){this.recreateGeometry()}_viewChanged(){if(this.view.ready&&this.attached&&(0,r.pC)(this._geometry)){const e=this.view.state.camera.computeScreenPixelSizeAt(this._arrowCenter);this._arrowMaterial.setParameters({width:this._parameters.arrowWidth*e})}}_updateArrowOpacity(){const e=this.opacity,{arrowStripeEvenColor:t,arrowStripeOddColor:i,arrowOutlineColor:s}=this._parameters,n=(0,V.H)(Se,this._stripesEnabled?t:i,e),r=(0,V.H)(Pe,s,e),a=(0,V.H)(fe,i,e);this._arrowMaterial.setParameters({stripeEvenColor:n,outlineColor:r,stripeOddColor:a})}}const Ce={arrowWidth:16,arrowOutlineColor:[1,.5,0,1],arrowOutlineWidth:.2,arrowStripeEvenColor:[1,1,1,1],arrowStripeOddColor:[1,.5,0,1],arrowStripeLength:16,arrowSubdivisions:128},Se=(0,H.c)(),Pe=(0,H.c)(),fe=(0,H.c)();var Oe,Le=i(60638),ze=i(70556),Me=i(40920),Ee=i(50833),Ae=i(22655);!function(e){e[e.Pending=0]="Pending",e[e.Ready=1]="Ready",e[e.Destroyed=2]="Destroyed"}(Oe||(Oe={}));let Ve=class extends n.Z{constructor(e){super(e),this._params={...xe},this._handles=new h.Z,this._segmentVisualElement=null,this._triangleVisualElement=null,this._rightAngleQuad=null,this._projectedGeodesicLine=null,this._geodesicStartHint=null,this._geodesicEndHint=null,this._segmentLabel=null,this._verticalLabel=null,this._horizontalLabel=null,this._startPosition=(0,m.c)(),this._endPosition=(0,m.c)(),this._cornerPosition=(0,m.c)(),this._startPositionAtSeaLevel=(0,m.c)(),this._endPositionAtSeaLevel=(0,m.c)(),this._triangleOrientationOverride=null,this.messages=null,this.loadingMessages=!0,this.visualElementOrientation=A.Auto,this.triangleCollapseRatioThreshold=.03}get visible(){return this.analysisView.visible}get viewMode(){const{elevationAlignedStartPoint:e,elevationAlignedEndPoint:t}=this.analysisView;if((0,r.Wi)(e)||(0,r.Wi)(t)||e.equals(t))return E.None;const i=this.analysisView.result;if((0,r.Wi)(i))return E.Direct;if("geodesic"===i.mode)return this._requiresGeodesicGuideAt(this._startPosition)||this._requiresGeodesicGuideAt(this._endPosition)?E.ProjectedGeodesic:E.Direct;const{verticalDistance:s,horizontalDistance:n}=i,a=s.value,o=n.value;return Math.min(a/o,o/a)<this.triangleCollapseRatioThreshold?E.Direct:E.Triangle}get actualVisualizedMeasurement(){if((0,r.Wi)(this.analysisView.result))switch(this.analysisView.measurementMode){case c.e.Auto:case c.e.Euclidean:default:return"euclidean";case c.e.Geodesic:return"geodesic"}return this.analysisView.result.mode}get allowVisualElementsOrientationChange(){return(0,r.Wi)(this._triangleOrientationOverride)}set allowVisualElementsOrientationChange(e){(0,r.Wi)(this._triangleOrientationOverride)!==e&&((0,r.Wi)(this._triangleOrientationOverride)?this._triangleOrientationOverride=this._actualVisualElementsOrientation:this._triangleOrientationOverride=null)}get labels(){const e="geodesic"===this.actualVisualizedMeasurement;return{direct:this._segmentLabel,horizontal:e?this._segmentLabel:this._horizontalLabel,vertical:this._verticalLabel}}initialize(){const e=this._params,t={attached:!0,view:this.view};this._segmentVisualElement=new we({...t,geometry:null,renderOccluded:Q.yD.OccludeAndTransparent}),this._triangleVisualElement=new N.r({...t,width:e.triangleLineWidth,color:e.triangleColor,renderOccluded:Q.yD.OccludeAndTransparent}),this._rightAngleQuad=new Le.R({...t,color:Te,renderOccluded:Q.yD.OccludeAndTransparent});const i={...t,polygonOffset:!0,renderOccluded:Q.yD.OccludeAndTransparent};this._projectedGeodesicLine=new N.r({...i,width:e.geodesicProjectionLineWidth,color:e.geodesicProjectionLineColor,stipplePattern:(0,Me.z5)(e.guideStippleLengthPixels)}),this._geodesicStartHint=new N.r({...i,width:e.guideLineWidth,color:e.geodesicProjectionLineColor,stipplePattern:(0,Me.z5)(e.guideStippleLengthPixels)}),this._geodesicEndHint=new N.r({...i,width:e.guideLineWidth,color:e.geodesicProjectionLineColor,stipplePattern:(0,Me.z5)(e.guideStippleLengthPixels)}),this._segmentLabel=new j.Kc({...t,fontSize:e.direcLabelFontSize}),this._verticalLabel=new j.Kc({...t,fontSize:e.verticalLabelFontSize}),this._horizontalLabel=new j.Kc({...t,fontSize:e.horizontalLabelFontSize}),this._handles.add([(0,p.YP)((()=>{const{elevationAlignedStartPoint:e,elevationAlignedEndPoint:t}=this.analysisView,i=this.view;return{view:i,camera:i.state.camera,viewMode:this.viewMode,elevationAlignedStartPoint:e,elevationAlignedEndPoint:t,orientation:this._actualVisualElementsOrientation,visualizedMeasurement:this.actualVisualizedMeasurement,stripeLength:this._measurementArrowStripeLength}}),(e=>this._updateGeometryAndViewMode(e)),p.tX),(0,p.YP)((()=>({visible:this.visible,viewMode:this.viewMode})),(e=>this._updateVisualElementVisibility(e)),p.tX),(0,p.YP)((()=>({text:this._labelsText,visualizedMeasurement:this.actualVisualizedMeasurement})),(e=>this._updateLabelText(e)),p.tX),(0,p.YP)((()=>({visible:this.visible,viewMode:this.viewMode})),(e=>this._updateLabelVisibility(e)),p.tX),(0,p.YP)((()=>this._measurementArrowStripeLength),(e=>this._updateSegmentStripeLength(e)),p.tX),(0,Ee.qe)((async()=>this._updateMessageBundle()))]),this._updateMessageBundle()}destroy(){this._handles=(0,r.SC)(this._handles),this._segmentVisualElement=(0,r.SC)(this._segmentVisualElement),this._triangleVisualElement=(0,r.SC)(this._triangleVisualElement),this._rightAngleQuad=(0,r.SC)(this._rightAngleQuad),this._projectedGeodesicLine=(0,r.SC)(this._projectedGeodesicLine),this._geodesicStartHint=(0,r.SC)(this._geodesicStartHint),this._geodesicEndHint=(0,r.SC)(this._geodesicEndHint),this._segmentLabel=(0,r.SC)(this._segmentLabel),this._verticalLabel=(0,r.SC)(this._verticalLabel),this._horizontalLabel=(0,r.SC)(this._horizontalLabel),this.set("view",null)}_updateVisualElementVisibility({visible:e,viewMode:t}){if(this._segmentVisualElement.visible=!1,this._triangleVisualElement.visible=!1,this._rightAngleQuad.visible=!1,this._projectedGeodesicLine.visible=!1,this._geodesicStartHint.visible=!1,this._geodesicEndHint.visible=!1,e)switch(t){case E.None:break;case E.Direct:this._segmentVisualElement.visible=!0;break;case E.Triangle:this._segmentVisualElement.visible=!0,this._triangleVisualElement.visible=!0,this._rightAngleQuad.visible=!0;break;case E.ProjectedGeodesic:this._segmentVisualElement.visible=!0,this._projectedGeodesicLine.visible=!0,this._geodesicStartHint.visible=!0,this._geodesicEndHint.visible=!0}}_updateGeometryAndViewMode({view:e,camera:t,viewMode:i,elevationAlignedStartPoint:s,elevationAlignedEndPoint:n,orientation:a,visualizedMeasurement:o,stripeLength:l}){const d=e.renderCoordsHelper;if((0,r.Wi)(d)||(0,r.Wi)(s)||(0,r.Wi)(n)||s.equals(n))return;let c=this._startPosition,h=this._endPosition;d.toRenderCoords(s,c),d.toRenderCoords(n,h);const u=a===A.AboveSegment?1:-1,_=u*(d.getAltitude(h)-d.getAltitude(c));_<0&&(c=this._endPosition,h=this._startPosition);const p="geodesic"===o?new ze.u4(this._startPosition,this._endPosition,d.spatialReference):new ze.y$(this._startPosition,this._endPosition);switch(this._segmentVisualElement.geometry=p,this._updateSegmentStripeLength(l),i){case E.Direct:this._updateSegment(p,a);break;case E.Triangle:this._updateSegmentAndTriangle({view:e,camera:t,segment:p,orientation:a,startPosition:c,endPosition:h,deltaSign:u,altitudeDelta:_});break;case E.ProjectedGeodesic:this._updateSegmentAndProjection({view:e,orientation:a,startPosition:c,endPosition:h})}}_updateSegment(e,t){this._segmentLabel.anchor=t===A.AboveSegment?"top":"bottom",this._segmentLabel.geometry={type:"segment",segment:e,sampleLocation:"center"}}_updateSegmentAndTriangle({view:{renderCoordsHelper:e},camera:t,segment:i,orientation:s,startPosition:n,endPosition:r,deltaSign:a,altitudeDelta:o}){const l=this._cornerPosition;e.worldUpAtPosition(n,l),(0,g.g)(l,l,a*Math.abs(o)),(0,g.a)(l,l,n),this._triangleVisualElement.geometry=[[[n[0],n[1],n[2]],[l[0],l[1],l[2]],[r[0],r[1],r[2]]]],this._rightAngleQuad.geometry={previous:n,center:l,next:r};const d=new ze.y$(n,l),c=new ze.y$(l,r),h=De(n,r,l,s,t);this._segmentLabel.anchor=h.segment,this._segmentLabel.geometry={type:"segment",segment:i,sampleLocation:"center"},this._verticalLabel.geometry={type:"segment",segment:d,sampleLocation:"center"},this._verticalLabel.anchor=h.vertical,this._horizontalLabel.geometry={type:"segment",segment:c,sampleLocation:"center"},this._horizontalLabel.anchor=h.horizontal}_updateSegmentAndProjection({view:{renderCoordsHelper:e},orientation:t,startPosition:i,endPosition:s}){e.setAltitude(this._startPositionAtSeaLevel,0,i),e.setAltitude(this._endPositionAtSeaLevel,0,s);const n=new ze.u4(this._startPositionAtSeaLevel,this._endPositionAtSeaLevel,e.spatialReference);this._projectedGeodesicLine.setGeometryFromSegment(n),this._geodesicStartHint.setGeometryFromSegment(new ze.y$(this._startPositionAtSeaLevel,i)),this._geodesicEndHint.setGeometryFromSegment(new ze.y$(this._endPositionAtSeaLevel,s)),this._segmentLabel.geometry={type:"segment",segment:n,sampleLocation:"center"},this._segmentLabel.anchor=t===A.AboveSegment?"top":"bottom"}_updateLabelText({text:e,visualizedMeasurement:t}){(0,r.pC)(e)?(this._segmentLabel.text="euclidean"===t?e.euclideanDistance:e.geodesicDistance,this._horizontalLabel.text=e.horizontalDistance,this._verticalLabel.text=e.verticalDistance):(this._segmentLabel.text=null,this._horizontalLabel.text=null,this._verticalLabel.text=null),this.notifyChange("labels")}_updateLabelVisibility({visible:e,viewMode:t}){const i=this._segmentLabel,s=this._horizontalLabel,n=this._verticalLabel;if(i.visible=!1,s.visible=!1,n.visible=!1,e)switch(t){case E.Direct:i.visible=!0;break;case E.Triangle:i.visible=!0,s.visible=!0,n.visible=!0;break;case E.ProjectedGeodesic:i.visible=!0;case E.None:}}get _labelsText(){if(this.destroyed)return null;const e=this.messages,t=this.analysisView.result;if((0,r.Wi)(t)||(0,r.Wi)(e))return null;const{directDistance:i,horizontalDistance:s,verticalDistance:n,geodesicDistance:a}=t,o=this.analysisView.unit,l=e=>({euclideanDistance:"",geodesicDistance:"",horizontalDistance:"",verticalDistance:"",...e});switch(o){case"metric":return l({euclideanDistance:i&&(0,D.Rd)(e,i),geodesicDistance:a&&(0,D.Rd)(e,a),horizontalDistance:s&&(0,D.Rd)(e,s),verticalDistance:n&&(0,D.Wv)(e,n)});case"imperial":return l({euclideanDistance:i&&(0,D.Ud)(e,i),geodesicDistance:a&&(0,D.Ud)(e,a),horizontalDistance:s&&(0,D.Ud)(e,s),verticalDistance:n&&(0,D.Zv)(e,n)});default:return l({euclideanDistance:i&&(0,D.VG)(e,i,o),geodesicDistance:a&&(0,D.VG)(e,a,o),horizontalDistance:s&&(0,D.VG)(e,s,o),verticalDistance:n&&(0,D.VG)(e,n,o)})}}_updateSegmentStripeLength(e){const t=this._segmentVisualElement;(0,r.pC)(e)?(t.stripeLength=e,t.stripesEnabled=!0):t.stripesEnabled=!1}get _actualVisualElementsOrientation(){if((0,r.pC)(this._triangleOrientationOverride))return this._triangleOrientationOverride;const e=this.visualElementOrientation;return e===A.Auto?this.view.state.camera.aboveGround?A.AboveSegment:A.BelowSegment:e}_requiresGeodesicGuideAt(e){const t=this.view;if(!t?.state)return!1;const i=t.state.camera,s=t.renderCoordsHelper,n=i.computeScreenPixelSizeAt(e);return s.getAltitude(e)/n>=10}get _measurementArrowStripeLength(){const{result:e,unit:t}=this.analysisView;if((0,r.Wi)(e))return null;let i=null;const s=e.directDistance;switch(t){case"metric":i=s&&(0,_.nn)(s,"meters");break;case"imperial":i=s&&(0,_.nn)(s,(0,x.FN)(s.value,s.unit));break;default:i=s&&(0,_.nn)(s,t)}return(0,r.Wi)(i)?null:(0,V.sk)(i.value/30)*(0,x.En)(1,i.unit,"meters")}_updateMessageBundle(){this.loadingMessages=!0,(0,Ae.ME)("esri/core/t9n/Units").then((e=>{this.messages=e})).finally((()=>{this.loadingMessages=!1}))}get testData(){return{labels:this.labels,stripeLength:this._segmentVisualElement?.stripeLength}}};function De(e,t,i,s,n){const r=Re,a=We;n.projectToRenderScreen(i,r),n.projectToRenderScreen(t,a);const o={segment:"bottom",horizontal:"top",vertical:r[0]<a[0]?"left":"right"};{const s=je,r=Ne;if((0,W.c)(e,i,s,n),(0,W.c)(e,t,r,n),(0,G.h)(s,r)>=Ge){const e=Math.sign(s[1])===Math.sign(r[1]);o.segment=e?(0,j.jB)(o.vertical):o.vertical}else{const e=qe;(0,W.c)(i,t,e,n),(0,G.h)(e,r)>=Ge&&(o.segment=Math.sign(e[0])===Math.sign(r[0])?(0,j.jB)(o.horizontal):o.horizontal)}}if(s===A.BelowSegment){const e=e=>"top"===e?"bottom":"top";o.segment=e(o.segment),o.horizontal=e(o.horizontal),o.vertical=e(o.vertical)}return o}(0,s._)([(0,a.Cb)()],Ve.prototype,"_triangleOrientationOverride",void 0),(0,s._)([(0,a.Cb)()],Ve.prototype,"messages",void 0),(0,s._)([(0,a.Cb)()],Ve.prototype,"view",void 0),(0,s._)([(0,a.Cb)()],Ve.prototype,"analysis",void 0),(0,s._)([(0,a.Cb)()],Ve.prototype,"analysisView",void 0),(0,s._)([(0,a.Cb)()],Ve.prototype,"loadingMessages",void 0),(0,s._)([(0,a.Cb)()],Ve.prototype,"visible",null),(0,s._)([(0,a.Cb)()],Ve.prototype,"viewMode",null),(0,s._)([(0,a.Cb)()],Ve.prototype,"actualVisualizedMeasurement",null),(0,s._)([(0,a.Cb)()],Ve.prototype,"visualElementOrientation",void 0),(0,s._)([(0,a.Cb)()],Ve.prototype,"triangleCollapseRatioThreshold",void 0),(0,s._)([(0,a.Cb)()],Ve.prototype,"allowVisualElementsOrientationChange",null),(0,s._)([(0,a.Cb)()],Ve.prototype,"labels",null),(0,s._)([(0,a.Cb)()],Ve.prototype,"_labelsText",null),(0,s._)([(0,a.Cb)()],Ve.prototype,"_actualVisualElementsOrientation",null),(0,s._)([(0,a.Cb)()],Ve.prototype,"_measurementArrowStripeLength",null),Ve=(0,s._)([(0,o.j)("esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementVisualization")],Ve);const Te=(0,R.f)(1,.5,0,.75),xe={laserLineGlowColor:[1,.5,0],laserLineGlowWidth:8,laserLineGlowFalloff:8,laserLineInnerColor:[1,1,1],laserLineInnerWidth:.75,laserLineGlobalAlpha:.75,laserLineEnabled:!0,handleColor:[1,.5,0],handleOpacity:.5,handleRadius:5,triangleColor:Te,triangleLineWidth:3,triangleCornerSize:32,triangleSubdivisions:128,arrowWidth:16,arrowOutlineColor:[1,.5,0,1],arrowOutlineWidth:.2,arrowStripeEvenColor:[1,1,1,1],arrowStripeOddColor:[1,.5,0,1],arrowStripeLength:16,arrowSubdivisions:128,geodesicProjectionLineWidth:2,geodesicProjectionLineColor:Te,guideLineWidth:2,guideLineColor:Te,guideStippleLengthPixels:6,labelDistance:25,direcLabelFontSize:16,horizontalLabelFontSize:12,verticalLabelFontSize:12},Ge=Math.cos((0,V.Vl)(12)),Re=(0,T.J$)(),We=(0,T.J$)(),je=(0,T.gX)(),Ne=(0,T.gX)(),qe=(0,T.gX)();let He=class extends((0,d.p)(n.Z)){constructor(e){super(e),this.type="direct-line-measurement-view-3d",this.analysis=null,this.result=null,this.measurementMode=c.e.Auto,this.elevationAlignedStartPoint=null,this.elevationAlignedEndPoint=null}initialize(){const e=this.view,t=this.analysis;this._analysisVisualization=new Ve({view:e,analysis:t,analysisView:this}),this._analysisController=new L({view:e,analysis:t,viewData:this})}destroy(){this._analysisController=(0,r.SC)(this._analysisController),this._analysisVisualization=(0,r.SC)(this._analysisVisualization)}get updating(){return!!this._analysisVisualization?.loadingMessages}get viewMode(){return this._analysisVisualization.viewMode}get actualVisualizedMeasurement(){return this._analysisVisualization.actualVisualizedMeasurement}get visualElementOrientation(){return this._analysisVisualization.visualElementOrientation}set visualElementOrientation(e){this._analysisVisualization.visualElementOrientation=e}get allowVisualElementsOrientationChange(){return this._analysisVisualization.allowVisualElementsOrientationChange}set allowVisualElementsOrientationChange(e){this._analysisVisualization.allowVisualElementsOrientationChange=e}get triangleCollapseRatioThreshold(){return this._analysisVisualization.triangleCollapseRatioThreshold}set triangleCollapseRatioThreshold(e){this._analysisVisualization.triangleCollapseRatioThreshold=e}get directLabelText(){return this._analysisVisualization.labels.direct.text}get horizontalLabelText(){return this._analysisVisualization.labels.horizontal.text}get verticalLabelText(){return this._analysisVisualization.labels.vertical.text}get unit(){return(0,r.Pt)(this.analysis.unit,this._defaultUnit)}get testData(){return this.destroyed?{labels:null,stripeLength:null,visualization:null,controller:null}:{...this._analysisVisualization?.testData,visualization:this._analysisVisualization,controller:this._analysisController}}};(0,s._)([(0,a.Cb)()],He.prototype,"updating",null),(0,s._)([(0,a.Cb)({readOnly:!0})],He.prototype,"type",void 0),(0,s._)([(0,a.Cb)({constructOnly:!0,nonNullable:!0})],He.prototype,"analysis",void 0),(0,s._)([(0,a.Cb)()],He.prototype,"result",void 0),(0,s._)([(0,a.Cb)()],He.prototype,"measurementMode",void 0),(0,s._)([(0,a.Cb)()],He.prototype,"elevationAlignedStartPoint",void 0),(0,s._)([(0,a.Cb)()],He.prototype,"elevationAlignedEndPoint",void 0),(0,s._)([(0,a.Cb)({readOnly:!0})],He.prototype,"viewMode",null),(0,s._)([(0,a.Cb)({readOnly:!0})],He.prototype,"actualVisualizedMeasurement",null),(0,s._)([(0,a.Cb)()],He.prototype,"visualElementOrientation",null),(0,s._)([(0,a.Cb)()],He.prototype,"allowVisualElementsOrientationChange",null),(0,s._)([(0,a.Cb)()],He.prototype,"triangleCollapseRatioThreshold",null),(0,s._)([(0,a.Cb)({readOnly:!0})],He.prototype,"directLabelText",null),(0,s._)([(0,a.Cb)({readOnly:!0})],He.prototype,"horizontalLabelText",null),(0,s._)([(0,a.Cb)({readOnly:!0})],He.prototype,"verticalLabelText",null),(0,s._)([(0,a.Cb)()],He.prototype,"_analysisVisualization",void 0),(0,s._)([(0,a.Cb)()],He.prototype,"_analysisController",void 0),(0,s._)([(0,a.Cb)()],He.prototype,"unit",null),(0,s._)([(0,a.Cb)(l.Y)],He.prototype,"_defaultUnit",void 0),He=(0,s._)([(0,o.j)("esri.views.3d.analysis.DirectLineMeasurementAnalysisView3D")],He);const Ie=He},60638:function(e,t,i){i.d(t,{R:function(){return w}});i(48675),i(3462),i(37380),i(1118);var s=i(50816),n=i(8693),r=i(18105),a=i(51802),o=i(94370),l=i(65554),d=i(74674),c=i(97848),h=i(86163),u=i(62069),_=i(9871),p=i(23168),g=i(59546),m=i(31728),v=i(30150),y=i(88865),b=i(66084);class w extends _._{constructor(e){super(e),this._handles=new s.Z,this._quadMaterial=null,this._outlineMaterial=null,this._maxSize=0,this._position=(0,d.c)(),this._up=(0,d.c)(),this._right=(0,d.c)(),this._renderOccluded=m.yD.OccludeAndTransparent,this._color=(0,h.f)(1,0,0,1),this._outlineColor=(0,h.f)(0,0,0,1),this._outlineSize=0,this._size=32,this._outlineRenderOccluded=m.yD.Opaque,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}get color(){return this._color}set color(e){(0,c.c)(this._color,e),this._updateQuadMaterial()}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,c.c)(this._outlineColor,e),this._updateOutlineMaterial()}get outlineSize(){return this._outlineSize}set outlineSize(e){const t=0===this._outlineSize!=(0===e);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateTransform())}get outlineRenderOccluded(){return this._outlineRenderOccluded}set outlineRenderOccluded(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}set geometry({previous:e,center:t,next:i}){this._maxSize=Math.min((0,l.i)(t,e),(0,l.i)(t,i))/3,(0,l.n)(this._up,(0,l.b)(this._up,e,t)),(0,l.n)(this._right,(0,l.b)(this._right,i,t)),(0,l.c)(this._position,t),this.recreateGeometry()}createExternalResources(){this._quadMaterial=new y.E(this.quadMaterialParameters),this._outlineMaterial=new b.U(this.outlineMaterialParameters),this._handles.add((0,r.YP)((()=>this.view.state.camera),(()=>this._updateTransform())))}destroyExternalResources(){this._quadMaterial=null,this._outlineMaterial=null,this._handles.removeAll()}forEachExternalMaterial(e){e(this._quadMaterial),e(this._outlineMaterial)}createGeometries(e){this._createQuadGeometry(e),this._createOutlineGeometry(e),this._updateTransform(e)}_createQuadGeometry(e){const t=this._quadGeometryData(this._up,this._right);e.addGeometry(t,this._quadMaterial)}_createOutlineGeometry(e){if(0===this._outlineSize)return;const t=(0,l.a)(u.WM.get(),this._up,this._right),i=g.Z.createPolylineGeometry([this._up,t,this._right]);e.addGeometry(i,this._outlineMaterial)}_updateTransform(e=this.object){const t=this.view.state.camera,i=this._size*t.computeScreenPixelSizeAt(this._position),s=Math.min(this._maxSize,i);(0,a.f)(C,this._position),(0,a.h)(C,C,[s,s,s]),(0,n.pC)(e)&&(e.transformation=C)}_quadGeometryData(e,t){const i=(0,l.a)(u.WM.get(),e,t);return new p.Z([[v.T.POSITION,{size:3,data:[0,0,0,...t,...e,...i],exclusive:!0}]],[[v.T.POSITION,new Uint16Array([0,1,2,1,2,3])]])}get quadMaterialParameters(){return{color:this._color,transparent:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded}}_updateQuadMaterial(){this._quadMaterial&&this._quadMaterial.setParameters(this.quadMaterialParameters)}get outlineMaterialParameters(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded}}_updateOutlineMaterial(){this._outlineMaterial&&this._outlineMaterial.setParameters(this.outlineMaterialParameters)}}const C=(0,o.c)()}}]);
//# sourceMappingURL=1532.3387aa7d.js.map