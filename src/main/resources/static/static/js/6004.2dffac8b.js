"use strict";(self["webpackChunkeco_friendly"]=self["webpackChunkeco_friendly"]||[]).push([[6004],{26004:function(e,t,i){i.r(t),i.d(t,{default:function(){return u}});i(21703);var a=i(61445),s=i(8693),n=i(92454),r=i(18105),o=(i(93622),i(94315),i(15055),i(81653),i(10771),i(77623)),l=i(53047),p=i(14350);let d=class extends((0,p.Z)(l.Z)){constructor(){super(...arguments),this.type="imagery-3d",this.redrawDebounced=(0,n.Ds)((async e=>{this.redraw(((e,t)=>this._redrawImage(e,t)),e)}),2e3)}initialize(){this.handles.add([(0,r.gx)((()=>this.view.basemapTerrain.ready),(()=>this._initializeMaximumDataResolution()),{once:!0,initial:!0}),this.layer.on("redraw",(()=>this.updatingHandles.addPromise(this.redrawDebounced())))]),this.updatingHandles.add((()=>this.layer?.exportImageServiceParameters?.version),(()=>{this.updatingHandles.addPromise(this.refreshDebounced())})),this.updatingHandles.add((()=>this.timeExtent),(()=>this.updatingHandles.addPromise(this.refreshDebounced())))}_initializeMaximumDataResolution(){const e=this.view.basemapTerrain.spatialReference,t=this.layer.fullExtent;!t||e.equals(t.spatialReference),this.maximumDataResolution={x:this.layer.pixelSizeX,y:this.layer.pixelSizeY}}getFetchOptions(){return{timeExtent:this.timeExtent}}async processResult(e,t,i){t.imageElement?e.image=t.imageElement:(e.image=document.createElement("canvas"),e.pixelData=t.pixelData,await this._redrawImage(e,i))}async _redrawImage(e,t){if(!(e.image instanceof HTMLCanvasElement)||(0,s.Wi)(e.pixelData))throw new Error;const i=e.image,a=i.getContext("2d"),n=await this.layer.applyRenderer(e.pixelData,{signal:t}),r=this.layer.applyFilter(n).pixelBlock;if((0,s.Wi)(r))throw new Error;i.width=r.width,i.height=r.height;const o=a.createImageData(r.width,r.height);o.data.set(r.getAsRGBA()),a.putImageData(o,0,0)}};d=(0,a._)([(0,o.j)("esri.views.3d.layers.ImageryLayerView3D")],d);const u=d},14350:function(e,t,i){i.d(t,{Z:function(){return h}});var a=i(61445),s=i(22130),n=i(8693),r=i(58006),o=(i(15055),i(81653),i(94315),i(77623)),l=i(49304),p=i(12799),d=i(21755),u=i(23319);const h=e=>{let t=class extends e{constructor(){super(...arguments),this.view=null}async fetchPopupFeatures(e,t){const{layer:i}=this;if(!e)throw new s.Z("imagerylayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:i});const{popupEnabled:a}=i,r=(0,u.V)(i,t);if(!a||(0,n.Wi)(r))throw new s.Z("imagerylayerview:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:a,popupTemplate:r});const o=await r.getRequiredFields(),p=new d.Z;p.timeExtent=this.timeExtent,p.geometry=e,p.outFields=o,p.outSpatialReference=e.spatialReference;const h=this.view.resolution,c="2d"===this.view.type?new l.Z(h,h,this.view.spatialReference):new l.Z(.5*h,.5*h,this.view.spatialReference),{returnTopmostRaster:m,showNoDataRecords:w}=r.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1},f={returnDomainValues:!0,returnTopmostRaster:m,pixelSize:c,showNoDataRecords:w,signal:(0,n.pC)(t)?t.signal:null};return i.queryVisibleRasters(p,f).then((e=>e))}canResume(){return!!super.canResume()&&!this.timeExtent?.isEmpty}};return(0,a._)([(0,r.Cb)()],t.prototype,"layer",void 0),(0,a._)([(0,r.Cb)()],t.prototype,"suspended",void 0),(0,a._)([(0,r.Cb)(p.qG)],t.prototype,"timeExtent",void 0),(0,a._)([(0,r.Cb)()],t.prototype,"view",void 0),t=(0,a._)([(0,o.j)("esri.views.layers.ImageryLayerView")],t),t}},23319:function(e,t,i){i.d(t,{V:function(){return r},e:function(){return n}});i(26699);var a=i(8693),s=i(10523);async function n(e,t=e.popupTemplate){if((0,a.Wi)(t))return[];const i=await t.getRequiredFields(e.fieldsIndex),{lastEditInfoEnabled:n}=t,{objectIdField:r,typeIdField:o,globalIdField:l,relationships:p}=e;if(i.includes("*"))return["*"];const d=n?await(0,s.CH)(e):[],u=(0,s.Q0)(e.fieldsIndex,[...i,...d]);return o&&u.push(o),u&&r&&e.fieldsIndex.has(r)&&!u.includes(r)&&u.push(r),u&&l&&e.fieldsIndex.has(l)&&!u.includes(l)&&u.push(l),p&&p.forEach((t=>{const{keyField:i}=t;u&&i&&e.fieldsIndex.has(i)&&!u.includes(i)&&u.push(i)})),u}function r(e,t){return e.popupTemplate?e.popupTemplate:(0,a.pC)(t)&&t.defaultPopupTemplateEnabled&&(0,a.pC)(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}}}]);
//# sourceMappingURL=6004.2dffac8b.js.map