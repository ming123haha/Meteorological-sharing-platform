"use strict";(self["webpackChunkeco_friendly"]=self["webpackChunkeco_friendly"]||[]).push([[9257],{90356:function(e,t,i){i.d(t,{G:function(){return h}});var s=i(92162),r=i(17923);class h extends s.Z{constructor(){super(...arguments),this.requiresDedicatedFBO=!1}dispose(){}doRender(e){const t=this.createRenderParams(e),{context:i,painter:s,profiler:h}=t;this._prevFBO=i.getBoundFramebufferObject(),h.recordContainerStart(this.name);const n=this._getFbo(t),a=s.getRenderTarget();i.bindFramebuffer(n),s.setRenderTarget(n),i.setDepthWriteEnabled(!0),i.setColorMask(!0,!0,!0,!0),i.setClearColor(0,0,0,0),i.setClearDepth(1),i.clear(i.gl.COLOR_BUFFER_BIT|i.gl.DEPTH_BUFFER_BIT),i.setDepthWriteEnabled(!1);for(const r of this.children)r.beforeRender(e);for(const r of this.children)r.processRender(t);for(const r of this.children)r.afterRender(e);s.setRenderTarget(a),s.releaseFbo(n),i.bindFramebuffer(this._prevFBO),s.beforeRenderLayer(t,this._clippingInfos?255:0,this.computedOpacity),i.setStencilTestEnabled(!1),i.setStencilWriteMask(0),s.blitTexture(i,n.colorTexture,r.cw.NEAREST),s.compositeLayer(t,this.computedOpacity),h.recordContainerEnd()}createRenderParams(e){return{...super.createRenderParams(e),blendMode:this.blendMode,effects:this.computedEffects,globalOpacity:1}}_getFbo(e){const{context:t,painter:i}=e,{width:s,height:r}=t.getViewport();return i.acquireFbo(s,r)}}},72577:function(e,t,i){i.r(t),i.d(t,{default:function(){return b}});var s=i(61445),r=i(39264),h=i(86662),n=i(8693),a=i(18105),o=(i(93622),i(94315),i(15055),i(81653),i(10771),i(77623)),c=i(32988),d=i(90356),l=i(54572),p=i(57914),g=i(7839),u=i(31698);const f="sublayers",_="layerView",w=Object.freeze({remove(){},pause(){},resume(){}});let y=class extends((0,l.y)(u.Z)){constructor(){super(...arguments),this._highlightIds=new Map,this.container=new d.G}async fetchPopupFeatures(e){return Array.from(this.graphicsViews(),(t=>t.hitTest(e).filter((e=>!!e.popupTemplate)))).flat()}*graphicsViews(){(0,n.pC)(this._graphicsViewsFeatureCollectionMap)?yield*this._graphicsViewsFeatureCollectionMap.keys():(0,n.pC)(this._graphicsViews)?yield*this._graphicsViews:yield*[]}async hitTest(e,t){return Array.from(this.graphicsViews(),(t=>{const i=t.hitTest(e);if((0,n.pC)(this._graphicsViewsFeatureCollectionMap)){const e=this._graphicsViewsFeatureCollectionMap.get(t);for(const t of i)!t.popupTemplate&&e.popupTemplate&&(t.popupTemplate=e.popupTemplate)}return i})).flat().map((t=>({type:"graphic",graphic:t,layer:this.layer,mapPoint:e})))}highlight(e){let t;return"number"==typeof e?t=[e]:e instanceof r.Z?t=[e.uid]:Array.isArray(e)&&e.length>0?t="number"==typeof e[0]?e:e.map((e=>e&&e.uid)):h.Z.isCollection(e)&&(t=e.map((e=>e&&e.uid)).toArray()),t=t.filter((e=>null!=e)),t.length?(this._addHighlight(t),{remove:()=>{this._removeHighlight(t)}}):w}update(e){for(const t of this.graphicsViews())t.processUpdate(e)}attach(){const e=this.view,t=()=>this.requestUpdate(),i=this.layer.featureCollections;if((0,n.pC)(i)&&i.length){this._graphicsViewsFeatureCollectionMap=new Map;for(const s of i){const i=new p.Z(this.view.featuresTilingScheme);i.fadeTransitionEnabled=!0;const r=new g.Z({view:e,graphics:s.source,renderer:s.renderer,requestUpdateCallback:t,container:i});this._graphicsViewsFeatureCollectionMap.set(r,s),this.container.addChild(r.container),this.handles.add([(0,a.YP)((()=>s.visible),(e=>r.container.visible=e),a.nn),(0,a.YP)((()=>r.updating),(()=>this.notifyChange("updating")),a.nn)],_)}this._updateHighlight()}else(0,n.pC)(this.layer.sublayers)&&this.handles.add((0,a.on)((()=>this.layer.sublayers),"change",(()=>this._createGraphicsViews()),{onListenerAdd:()=>this._createGraphicsViews(),onListenerRemove:()=>this._destroyGraphicsViews()}),f)}detach(){this._destroyGraphicsViews(),this.handles.remove(f)}moveStart(){}moveEnd(){}viewChange(){for(const e of this.graphicsViews())e.viewChange()}isUpdating(){for(const e of this.graphicsViews())if(e.updating)return!0;return!1}_destroyGraphicsViews(){this.container.removeAllChildren(),this.handles.remove(_);for(const e of this.graphicsViews())e.destroy();this._graphicsViews=null,this._graphicsViewsFeatureCollectionMap=null}_createGraphicsViews(){if(this._destroyGraphicsViews(),(0,n.Wi)(this.layer.sublayers))return;const e=[],t=this.view,i=()=>this.requestUpdate();for(const s of this.layer.sublayers){const r=new c.W,h=new p.Z(this.view.featuresTilingScheme);h.fadeTransitionEnabled=!0;const n=new g.Z({view:t,graphics:s.graphics,requestUpdateCallback:i,container:h});this.handles.add([s.on("graphic-update",n.graphicUpdateHandler),(0,a.YP)((()=>s.visible),(e=>n.container.visible=e),a.nn),(0,a.YP)((()=>n.updating),(()=>this.notifyChange("updating")),a.nn)],_),r.addChild(n.container),this.container.addChild(r),e.push(n)}this._graphicsViews=e,this._updateHighlight()}_addHighlight(e){for(const t of e)if(this._highlightIds.has(t)){const e=this._highlightIds.get(t);this._highlightIds.set(t,e+1)}else this._highlightIds.set(t,1);this._updateHighlight()}_removeHighlight(e){for(const t of e)if(this._highlightIds.has(t)){const e=this._highlightIds.get(t)-1;0===e?this._highlightIds.delete(t):this._highlightIds.set(t,e)}this._updateHighlight()}_updateHighlight(){const e=Array.from(this._highlightIds.keys());for(const t of this.graphicsViews())t.setHighlight(e)}};y=(0,s._)([(0,o.j)("esri.views.2d.layers.MapNotesLayerView2D")],y);const b=y},57914:function(e,t,i){i.d(t,{Z:function(){return h}});var s=i(34150),r=i(21486);class h extends r.Z{renderChildren(e){this.attributeView.bindTextures(e.context,!1),this.children.some((e=>e.hasData))&&(super.renderChildren(e),e.drawPhase===s.jx.MAP&&this._renderChildren(e),this.hasHighlight()&&e.drawPhase===s.jx.HIGHLIGHT&&this._renderHighlight(e),this._boundsRenderer&&this._boundsRenderer.doRender(e))}_renderHighlight(e){const{painter:t}=e,i=t.effects.highlight;i.bind(e),this._renderChildren(e,i.defines),i.draw(e),i.unbind()}}}}]);
//# sourceMappingURL=9257.11679859.js.map