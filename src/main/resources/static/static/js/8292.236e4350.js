"use strict";(self["webpackChunkeco_friendly"]=self["webpackChunkeco_friendly"]||[]).push([[8292],{19134:function(e,t,s){s.d(t,{A:function(){return h}});var i=s(61445),a=s(2323),r=s(92454),o=s(18105),l=s(58006),n=(s(15055),s(81653),s(94315),s(77623)),d=s(73228);const h=e=>{let t=class extends e{constructor(){super(...arguments),this.slicePlaneEnabled=!1,this.supportsHeightUnitConversion=!1}postscript(e){super.postscript(e),(0,d.qC)(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())}async _validateHeightModelInfo(){const e=new AbortController,t=e.signal;this.handles.add((0,a.kB)((()=>e.abort()))),await(0,o.N1)((()=>this.view.defaultsFromMap?.heightModelInfoReady),t),(0,r.k_)(t);const s=(0,d.Wt)(this.layer,this.view.heightModelInfo,this.supportsHeightUnitConversion);if(s)throw s}canResume(){const e=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return super.canResume()&&(!e||!e.minScale||!e.maxScale||e.minScale>=e.maxScale)}getSuspendInfo(){const e=super.getSuspendInfo(),t=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return t&&t.minScale&&t.maxScale&&t.minScale<t.maxScale&&(e.outsideScaleRange=!0),e}};return(0,i._)([(0,l.Cb)()],t.prototype,"view",void 0),(0,i._)([(0,l.Cb)()],t.prototype,"slicePlaneEnabled",void 0),t=(0,i._)([(0,n.j)("esri.views.3d.layers.LayerView3D")],t),t}},38292:function(e,t,s){s.r(t),s.d(t,{default:function(){return f}});var i,a=s(61445),r=s(22130),o=s(50816),l=s(93622),n=s(8693),d=s(18105),h=s(58006),u=(s(15055),s(81653),s(94315),s(77623)),p=s(54597),c=s(19134),y=s(31698),g=s(24522);!function(e){e[e.API=1]="API",e[e.VerboseAPI=2]="VerboseAPI",e[e.Error=3]="Error"}(i||(i={}));const v=l.Z.getLogger(" esri.views.3d.layers.VoxelLayerView3D");let m=class extends((0,c.A)(y.Z)){constructor(){super(...arguments),this._usedMemory=0,this._futureMemory=0,this.type="voxel-3d",this._wasmLayerId=-1,this._handles=new o.Z,this._dbgFlags=new Set}get wasmLayerId(){return this._wasmLayerId}initialize(){if("local"!==this.view.viewingMode)throw new r.Z("voxel:unsupported-viewingMode","Voxel layers support local viewingMode only.",{});if(this.view._stage.renderView.renderingContext.type!==g.zO.WEBGL2)throw new r.Z("voxel:unsupported-context","Voxel layers are supported in WebGL2 rendering contexts only.",{});if(!this.view._stage.renderView.renderingContext.capabilities.colorBufferFloat?.textureFloat)throw new r.Z("voxel:missing-color-buffer-float","Voxel layers require the WebGL2 extension EXT_color_buffer_float",{});const e=this.layer.spatialReference;if(!(0,p.fS)(e,this.view.spatialReference))throw new r.Z("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});const t=this.layer.currentVariableId,s=this.layer.getVolume(t),i=this.layer.getVariable(t);if((0,n.pC)(s)&&(0,n.pC)(i)){const e=s.dimensions[0],t=s.dimensions[1],a=s.getZDimension();if(a>1){const r=s.dimensions[a],o=e.size*t.size*r.size;let l=1;switch(i.renderingFormat.type){case"Int16":case"UInt16":l=2;break;case"Int32":case"UInt32":case"Float32":l=4}this._futureMemory=l*o}}const a=this.view.addVoxelLayerViewToWasm(this).then((e=>{this._wasmLayerId=e,this._suspendedHandle=(0,d.YP)((()=>this.suspended),(e=>{const t=this.view.voxelWasm;(0,n.pC)(t)&&t.setEnabled(this,!e)}),d.nn),this._handles.add([(0,d.YP)((()=>this.layer.renderMode),(e=>this._pushRenderModeToWasm(e))),(0,d.YP)((()=>this.layer.currentVariableId),(e=>this._pushCurrentVariableIdToWasm(e))),(0,d.YP)((()=>this.layer.getDynamicSections()),(e=>this._pushDynamicSectionsToWasm(e))),(0,d.YP)((()=>this.layer.getSlices()),(e=>this._pushSlicesToWasm(e))),(0,d.YP)((()=>this.layer.getSections()),(e=>this._pushSectionsToWasm(e))),(0,d.YP)((()=>this.layer.getVerticalExaggeration()),(e=>this._pushVerticalExaggerationToWasm(e))),(0,d.YP)((()=>this.layer.getVerticalOffset()),(e=>this._pushVerticalOffsetToWasm(e)))])})).catch((e=>{if(this.view.removeVoxelLayerViewFromWasm(this),this._wasmLayerId=-1,-1===e)throw new r.Z("voxel:addLayer-failure","The voxel layer description was invalid.",{});if(-2===e)throw new r.Z("voxel:addLayer-failure","The voxel layer web assembly module failed to download.",{})}));this.addResolvingPromise(a)}destroy(){this.view.removeVoxelLayerViewFromWasm(this),this._suspendedHandle&&(this._suspendedHandle.remove(),this._suspendedHandle=null),this._handles=(0,n.SC)(this._handles)}isUpdating(){const e=this.view.voxelWasm;return!(this._wasmLayerId<0||!(0,n.pC)(e))&&e.isUpdating(this._wasmLayerId)}updatingFlagChanged(){this.notifyChange("updating")}getUsedMemory(){return this._usedMemory}getUnloadedMemory(){return this._futureMemory}ignoresMemoryFactor(){return!0}get performanceInfo(){return{nodes:0,displayedNumberOfFeatures:0,maximumNumberOfFeatures:0,totalNumberOfFeatures:0,core:null}}setUsedMemory(e){this._usedMemory=e,this._futureMemory=0}captureFrustum(){const e=this.view.voxelWasm;(0,n.pC)(e)&&e.captureFrustum()}toggleFullVolumeExtentDraw(){const e=this.view.voxelWasm;(0,n.pC)(e)&&e.toggleFullVolumeExtentDraw(this)}_pushRenderModeToWasm(e){const t=this.view.voxelWasm;this._dbg(i.VerboseAPI,"VoxelLayerView3D._pushRenderModeToWasm() called, "+((0,n.pC)(t)?"have WASM":"don't have WASM!!!")),(0,n.pC)(t)&&t.setRenderMode(this,e)||this._dbg(i.Error,"VoxelLayerView3D._pushRenderModeToWasm() failed!")}_pushSlicesToWasm(e){const t=this.view.voxelWasm;this._dbg(i.VerboseAPI,"VoxelLayerView3D._pushSlicesToWasm() called, "+((0,n.pC)(t)?"have WASM":"don't have WASM!!!")),(0,n.pC)(t)&&t.setSlices(this,e)||this._dbg(i.Error,"VoxelLayerView3D._pushSlicesToWasm() failed!")}_pushSectionsToWasm(e){const t=this.view.voxelWasm;this._dbg(i.VerboseAPI,"VoxelLayerView3D._pushSectionsToWasm() called, "+((0,n.pC)(t)?"have WASM":"don't have WASM!!!")),(0,n.pC)(t)&&t.setStaticSections(this,e)||this._dbg(i.Error,"VoxelLayerView3D._pushSectionsToWasm() failed!")}_pushDynamicSectionsToWasm(e){const t=this.view.voxelWasm;this._dbg(i.VerboseAPI,"VoxelLayerView3D._pushDynamicSectionsToWasm() called, "+((0,n.pC)(t)?"have WASM":"don't have WASM!!!")),(0,n.pC)(t)&&t.setDynamicSections(this,e)||this._dbg(i.Error,"VoxelLayer._updateDynamicSections() failed!")}_pushCurrentVariableIdToWasm(e){const t=this.view.voxelWasm;this._dbg(i.VerboseAPI,"VoxelLayerView3D._pushCurrentVariableIdToWasm() called!, "+((0,n.pC)(t)?"have WASM":"don't have WASM!!!")),(0,n.pC)(t)&&t.setCurrentVariable(this,e)||this._dbg(i.Error,"VoxelLayerView3D._pushCurrentVariableIdToWasm() failed!")}_pushVerticalExaggerationToWasm(e){const t=this.layer.getVolumeStyle(null),s=this.view.voxelWasm;this._dbg(i.VerboseAPI,`VoxelLayerView3D._pushVerticalExaggerationToWasm() called, ${(0,n.pC)(s)?"have WASM":"don't have WASM!!!"}, ${(0,n.pC)(t)?"have style":"don't have style!!!"}`),(0,n.Wi)(t)||(0,n.pC)(s)&&s.setVerticalExaggerationAndOffset(this,t.volumeId,e,t.verticalOffset)||this._dbg(i.Error,"VoxelLayerView3D._pushVerticalExaggerationToWasm() failed!")}_pushVerticalOffsetToWasm(e){const t=this.layer.getVolumeStyle(null),s=this.view.voxelWasm;this._dbg(i.VerboseAPI,`VoxelLayerView3D._pushVerticalOffsetToWasm() called, ${(0,n.pC)(s)?"have WASM":"don't have WASM!!!"}, ${(0,n.pC)(t)?"have style":"don't have style!!!"}`),(0,n.Wi)(t)||(0,n.pC)(s)&&s.setVerticalExaggerationAndOffset(this,t.volumeId,t.verticalExaggeration,e)||this._dbg(i.Error,"VoxelLayerView3D._pushVerticalOffsetToWasm() failed!")}_dbg(e,t){this._dbgFlags.has(e)&&(e===i.Error?v.error(t):v.warn(t))}};(0,a._)([(0,h.Cb)()],m.prototype,"layer",void 0),(0,a._)([(0,h.Cb)({readOnly:!0,aliasOf:"layer.parsedUrl.path"})],m.prototype,"baseUrl",void 0),m=(0,a._)([(0,u.j)("esri.views.3d.layers.VoxelLayerView3D")],m);const f=m},31698:function(e,t,s){s.d(t,{Z:function(){return y}});var i=s(61445),a=s(92698),r=s(96545),o=s(30374),l=s(68650),n=s(93622),d=s(8693),h=s(66144),u=s(58006),p=(s(15055),s(81653),s(94315),s(77623));let c=class extends((0,o.p)((0,l.IG)((0,h.v)(r.Z.EventedMixin(a.Z))))){constructor(e){super(e),this.layer=null,this.parent=null}initialize(){this.when().catch((e=>{if("layerview:create-error"!==e.name){const t=this.layer&&this.layer.id||"no id",s=this.layer&&this.layer.title||"no title";n.Z.getLogger(this.declaredClass).error("#resolve()",`Failed to resolve layer view (layer title: '${s}', id: '${t}')`,e)}}))}get fullOpacity(){return(0,d.Pt)(this.get("layer.opacity"),1)*(0,d.Pt)(this.get("parent.fullOpacity"),1)}get suspended(){return!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){return!this.suspended&&!0===this.layer?.legendEnabled}get updating(){return!(!this.updatingHandles?.updating&&!this.isUpdating())}get updatingProgress(){return this.updating?0:1}get visible(){return!0===this.layer?.visible}set visible(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")}canResume(){return this.visible&&this.layer?.loaded&&!this.parent?.suspended&&this.view?.ready||!1}getSuspendInfo(){const e=this.parent&&this.parent.suspended?this.parent.suspendInfo:{},t=this;return t.view&&t.view.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0),this.visible||(e.layerInvisible=!0),e}isUpdating(){return!1}};(0,i._)([(0,u.Cb)()],c.prototype,"fullOpacity",null),(0,i._)([(0,u.Cb)()],c.prototype,"layer",void 0),(0,i._)([(0,u.Cb)()],c.prototype,"parent",void 0),(0,i._)([(0,u.Cb)({readOnly:!0})],c.prototype,"suspended",null),(0,i._)([(0,u.Cb)({readOnly:!0})],c.prototype,"suspendInfo",null),(0,i._)([(0,u.Cb)({readOnly:!0})],c.prototype,"legendEnabled",null),(0,i._)([(0,u.Cb)({type:Boolean,readOnly:!0})],c.prototype,"updating",null),(0,i._)([(0,u.Cb)({readOnly:!0})],c.prototype,"updatingProgress",null),(0,i._)([(0,u.Cb)()],c.prototype,"visible",null),(0,i._)([(0,u.Cb)()],c.prototype,"view",void 0),c=(0,i._)([(0,p.j)("esri.views.layers.LayerView")],c);const y=c}}]);
//# sourceMappingURL=8292.236e4350.js.map