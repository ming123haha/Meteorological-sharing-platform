"use strict";(self["webpackChunkeco_friendly"]=self["webpackChunkeco_friendly"]||[]).push([[3962],{53962:function(t,e,n){n.r(e),n.d(e,{SceneLayerSnappingSourceWorker:function(){return _},default:function(){return m}});var o=n(61445),i=n(8693),s=n(92454),d=(n(93622),n(94315),n(15055),n(81653),n(10771),n(77623)),c=n(65554),r=n(74674),a=n(16160),u=n(4717),h=n(48079),p=n(88367),g=n(75937);let _=class{constructor(){this._idToComponent=new Map,this._components=new p.Z((t=>t.bounds)),this._edges=new p.Z((t=>t.bounds)),this._tmpLineSegment=(0,a.Ue)(),this._tmpP1=(0,r.c)(),this._tmpP2=(0,r.c)(),this._tmpP3=(0,r.c)(),this.remoteClient=null}async fetchCandidates(t,e){await Promise.resolve(),(0,s.k_)(e),await this._ensureEdgeLocations(t,e);const n=[];return this._edges.forEachNeighbor((e=>this._addCandidates(t,e,n)),t.bounds),{result:{candidates:n}}}async _ensureEdgeLocations(t,e){const n=[];if(this._components.forEachNeighbor((t=>{if((0,i.Wi)(t.info)){const{id:e,uid:o}=t;n.push({id:e,uid:o})}}),t.bounds),!n.length)return;const o={components:n},s=await this.remoteClient.invoke("fetchAllEdgeLocations",o,(0,i.Pt)(e,{}));for(const i of s.components)this._setFetchEdgeLocations(i)}async add(t){const e=new l(t.id,t.bounds);return this._idToComponent.set(e.id,e),this._components.add([e]),{result:{}}}async remove(t){const e=this._idToComponent.get(t.id);if(e){const t=[];this._edges.forEachNeighbor((n=>{n.component===e&&t.push(n)}),e.bounds),this._edges.remove(t),this._components.remove([e]),this._idToComponent.delete(e.id)}return{result:{}}}_setFetchEdgeLocations(t){const e=this._idToComponent.get(t.id);if((0,i.Wi)(e)||t.uid!==e.uid)return;const n=g.extractComponentsEdgeLocationsLayout.createView(t.locations),o=new Array(n.count),s=(0,r.c)(),d=(0,r.c)();for(let i=0;i<n.count;i++){const r=(0,u.c)(),a=(0,u.g)(r);n.position0.getVec(i,s),n.position1.getVec(i,d),(0,c.C)(a,a,s,.5),(0,c.C)(a,a,d,.5),(0,c.a)(a,a,t.origin),r[3]=(0,c.i)(a,s);const h=new f(e,i,r);o[i]=h}this._edges.add(o);const{objectIds:a,origin:h}=t;e.info={locations:n,objectIds:a,origin:h}}_addCandidates(t,e,n){const{locations:o,origin:i,objectIds:s}=e.component.info,d=o.position0.getVec(e.index,this._tmpP1),r=o.position1.getVec(e.index,this._tmpP2);(0,c.a)(d,d,i),(0,c.a)(r,r,i);const a=s[o.componentIndex.get(e.index)];this._addEdgeCandidate(t,a,d,r,n),this._addVertexCandidate(t,a,d,n),this._addVertexCandidate(t,a,r,n)}_addEdgeCandidate(t,e,n,o,i){if(!(t.types&h.r.EDGE))return;const s=(0,u.g)(t.bounds),d=(0,a.zk)(n,o,this._tmpLineSegment),p=(0,a.nF)(d,s,this._tmpP3);if(!(0,u.m)(t.bounds,p))return null;i.push({type:"edge",objectId:e,target:(0,r.a)(p),distance:(0,c.i)(s,p),start:(0,r.a)(n),end:(0,r.a)(o)})}_addVertexCandidate(t,e,n,o){if(!(t.types&h.r.VERTEX))return;const i=(0,u.g)(t.bounds);if(!(0,u.m)(t.bounds,n))return null;o.push({type:"vertex",objectId:e,target:(0,r.a)(n),distance:(0,c.i)(i,n)})}};function m(){return new _}_=(0,o._)([(0,d.j)("esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorker")],_);class l{constructor(t,e){this.id=t,this.bounds=e,this.info=null,this.uid=++l.uid}}l.uid=0;class f{constructor(t,e,n){this.component=t,this.index=e,this.bounds=n}}}}]);
//# sourceMappingURL=3962.a255bb7d.js.map