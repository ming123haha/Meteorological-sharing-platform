"use strict";(self["webpackChunkeco_friendly"]=self["webpackChunkeco_friendly"]||[]).push([[4142],{74142:function(e,t,i){i.r(t),i.d(t,{default:function(){return hi}});var n=i(61445),s=i(92698),r=i(86662),o=i(8693),a=i(18105),l=i(58006),d=(i(15055),i(81653),i(94315)),c=i(77623),h=i(30709),p=i(2323),u=i(62069),g=i(36945);i(80388);const _=["horizontal","vertical","direct"];var f=i(26589),y=i(82291),m=i(4524),v=i(50157),w=i(49304);let x=class extends f.j{constructor(e){super(e),this.type="length",this.startPoint=null,this.endPoint=null,this.axis="horizontal",this.offset=0,this.heading=0}get extent(){if((0,o.Wi)(this.startPoint))return null;const e=v.Z.fromPoint(this.startPoint);return(0,o.pC)(this.endPoint)&&e.union(v.Z.fromPoint(this.endPoint)),e}};(0,n._)([(0,l.Cb)({type:["length"]})],x.prototype,"type",void 0),(0,n._)([(0,l.Cb)({type:w.Z})],x.prototype,"startPoint",void 0),(0,n._)([(0,l.Cb)({type:w.Z})],x.prototype,"endPoint",void 0),(0,n._)([(0,l.Cb)({type:_,nonNullable:!0})],x.prototype,"axis",void 0),(0,n._)([(0,l.Cb)({type:Number,nonNullable:!0})],x.prototype,"offset",void 0),(0,n._)([(0,l.Cb)({type:Number,nonNullable:!0}),(0,m.p)((e=>y.BV.normalize((0,d.q9)(e),0,!0)))],x.prototype,"heading",void 0),(0,n._)([(0,l.Cb)({readOnly:!0})],x.prototype,"extent",null),x=(0,n._)([(0,c.j)("esri.analysis.LengthDimension")],x);const b=x;var C=i(30374),S=i(50816),E=i(92454),P=i(90910),T=i(30524);const O={main:new g.Z([255,127,0])};class R{constructor(){this.color=O.main,this.opacity=.5,this.radius=5}}class M{constructor(){this.fontSize=14}get height(){return 1.5*(0,T.F2)(this.fontSize)}get offset(){return this.height+20}}class H{constructor(){this.pointManipulators=new R,this.labels=new M}}const V=new H;var L=i(69113),I=i(65554),z=i(74674),D=(i(48675),i(3462),i(37380),i(1118),i(97848)),k=i(86163),N=i(81692),G=i(70054),A=i(16160),j=i(23573),W=i(95615),F=i(9871),q=i(59546),Z=i(31728),U=i(30150),X=i(66084);class Y extends F._{constructor(e){super(e),this._ray=(0,j.Ue)(),this._externalResources=null,this._handles=new S.Z,this._isWorldDown=!1,this._start=(0,z.c)(),this._end=(0,z.f)(1,0,0),this._width=1,this._color=(0,k.f)(1,0,1,1),this._polygonOffset=!1,this._writeDepthEnabled=!0,this._innerWidth=0,this._innerColor=(0,k.f)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._stipplePreferContinuous=!0,this._falloff=0,this._extensionType=J.LINE,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=Z.yD.OccludeAndTransparent,this._fadedExtensions=te,this.applyProps(e)}createExternalResources(){const e=new X.U(this.materialParameters);this._handles.add((0,a.YP)((()=>this.view.state.camera),(()=>{this._updateGeometry()})));const t=new W.W({view:this.view,attached:this._laserlineEnabled});this._externalResources={material:e,laserline:t}}destroyExternalResources(){(0,o.pC)(this._externalResources)&&this._externalResources.laserline.destroy(),this._externalResources=null,this._handles.removeAll()}forEachExternalMaterial(e){(0,o.pC)(this._externalResources)&&e(this._externalResources.material)}createGeometries(e){const t=[(0,z.c)(),(0,z.c)()],i=this.extensionType===J.FADED;i&&t.push((0,z.c)(),(0,z.c)());const n=i?new Float32Array([1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]):null,s=q.Z.createPolylineGeometry(t,null,n);e.addGeometry(s,(0,o.Wg)(this._externalResources).material),this._updateVertices(e)}updateVisibility(e){super.updateVisibility(e),(0,o.pC)(this._externalResources)&&(this._externalResources.laserline.visible=e)}setStartEndFromWorldDownAtLocation(e){this._isWorldDown=!0,(0,I.c)(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),(0,I.b)(this._end,e,this._end),(0,j.zk)(this._start,this._end,this._ray),this._updateGeometry()}get start(){return this._start}set start(e){this._isWorldDown=!1,(0,I.k)(this._start,e)||((0,I.c)(this._start,e),(0,j.zk)(this._start,this._end,this._ray),this._updateGeometry())}get end(){return this._end}set end(e){this._isWorldDown=!1,(0,I.k)(this._end,e)||((0,I.c)(this._end,e),(0,j.zk)(this._start,this._end,this._ray),this._updateGeometry())}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){(0,D.g)(e,this._color)||((0,D.c)(this._color,e),this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){(0,D.g)(e,this._innerColor)||((0,D.c)(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=(0,o.pC)(e)!==(0,o.pC)(this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){((0,o.Wi)(e)||(0,o.Wi)(this._stippleOffColor)||!(0,D.g)(e,this._stippleOffColor))&&(this._stippleOffColor=(0,o.pC)(e)?(0,k.a)(e):null,this._updateMaterial())}get stipplePreferContinuous(){return this._stipplePreferContinuous}set stipplePreferContinuous(e){e!==this._stipplePreferContinuous&&(this._stipplePreferContinuous=e,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get extensionType(){return this._extensionType}set extensionType(e){e!==this._extensionType&&(this._extensionType=e,this._updateGeometry())}get _laserlineAttached(){return this._laserlineEnabled&&(0,o.pC)(this._laserlineStyle)}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,(0,o.pC)(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached,(0,o.pC)(e)&&(this._externalResources.laserline.style=e))}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,(0,o.pC)(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached))}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get fadedExtensions(){return this._fadedExtensions}set fadedExtensions(e){this._fadedExtensions=(0,o.Pt)(e,te),this.recreateGeometry()}_updateMaterial(){(0,o.Wi)(this._externalResources)||this._externalResources.material.setParameters(this.materialParameters)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,hasPolygonOffset:this._polygonOffset,renderOccluded:this._renderOccluded,writeDepth:this._writeDepthEnabled}}_updateGeometry(){(0,o.pC)(this.object)&&this._updateVertices(this.object)}_updateVertices(e){const t=this._extensionType===J.FADED?this._updateLineSegmentFinite(K):this._updateLineSegmentInfinite(this._extensionType,K);this._updateVertexAttributes(e,t),(0,o.pC)(this._externalResources)&&(this._externalResources.laserline.intersectsLine=t)}_updateLineSegmentFinite(e){return(0,A.zk)(this._start,this._end,e)}_updateLineSegmentInfinite(e,t){const i=this.view.state.camera;switch((0,N.iL)(this._ray,B),e){case J.LINE:B.c0=-Number.MAX_VALUE;break;case J.RAY:case J.GROUND_RAY:{const e=this._ray.origin,t=(0,o.Pt)(this.view.elevationProvider.getElevation(e[0],e[1],e[2],this.view.renderCoordsHelper.spatialReference,"ground"),0),i=this.view.renderCoordsHelper.getAltitude(e);this._isWorldDown&&i<t&&(0,I.o)(B.ray.direction,B.ray.direction),this._extensionType===J.GROUND_RAY&&null!=t&&(B.c1=Math.abs(i-t));break}}if(!(0,G.zq)(i.frustum,B))return(0,A.zk)(this._start,this._end,t);const n=(0,N.Ws)(B,$),s=(0,N.S$)(B,Q);return(0,A.zk)(n,s,t)}_updateVertexAttributes(e,t){const i=e.geometries[0].getMutableAttribute(U.T.POSITION).data;if(this.extensionType===J.FADED){const e=(0,A.KU)(t,-this.fadedExtensions.start,$);i[0]=e[0],i[1]=e[1],i[2]=e[2];const n=(0,A.KU)(t,0,$);i[3]=n[0],i[4]=n[1],i[5]=n[2];const s=(0,A.KU)(t,1,$);i[6]=s[0],i[7]=s[1],i[8]=s[2];const r=(0,A.KU)(t,1+this.fadedExtensions.end,$);i[9]=r[0],i[10]=r[1],i[11]=r[2]}else{const e=(0,A.KU)(t,0,$);i[0]=e[0],i[1]=e[1],i[2]=e[2];const n=(0,A.KU)(t,1,$);i[3]=n[0],i[4]=n[1],i[5]=n[2]}e.geometryVertexAttrsUpdated(e.geometryRecords[0])}}const B=(0,N.Ue)(),$=(0,z.c)(),Q=(0,z.c)(),K=(0,A.Ue)();var J;!function(e){e[e.LINE=0]="LINE",e[e.RAY=1]="RAY",e[e.GROUND_RAY=2]="GROUND_RAY",e[e.FADED=3]="FADED"}(J||(J={}));const ee=1/3,te={start:ee,end:ee};var ie=i(47001);class ne extends F._{constructor(e){super(e),this._handles=new S.Z,this._location=(0,z.c)(),this._direction=(0,z.f)(1,0,0),this._width=1,this._offset=1,this._length=18,this._color=(0,k.f)(1,0,1,1),this._renderOccluded=Z.yD.OccludeAndTransparent,this.applyProps(e)}get location(){return this._location}set location(e){(0,I.k)(this._location,e)||((0,I.c)(this._location,e),this._updateGeometry())}get direction(){return this._direction}set direction(e){(0,I.k)(this._direction,e)||((0,I.c)(this._direction,e),this._updateGeometry())}setDirectionFromPoints(e,t){(0,I.n)(this._direction,(0,I.b)(this._direction,t,e)),this._updateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get offset(){return this._offset}set offset(e){e!==this._offset&&(this._offset=e,this._updateGeometry())}get length(){return this._length}set length(e){e!==this._length&&(this._length=e,this._updateGeometry())}get color(){return this._color}set color(e){(0,D.g)(e,this._color)||((0,D.c)(this._color,e),this._updateMaterial())}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}createExternalResources(){const e=new X.U(this.materialParameters);this._handles.add((0,a.YP)((()=>this.view.state.camera),(()=>{this._updateGeometry()}))),this._externalResources={material:e}}destroyExternalResources(){this._handles.removeAll(),this._externalResources=null}createGeometries(e){const t=q.Z.createPolylineGeometry([(0,z.c)(),(0,z.c)()]),i=q.Z.createPolylineGeometry([(0,z.c)(),(0,z.c)()]),n=(0,o.Wg)(this._externalResources).material;e.addGeometry(t,n),e.addGeometry(i,n),this._updateVertices(e)}forEachExternalMaterial(e){(0,o.pC)(this._externalResources)&&e(this._externalResources.material)}_updateMaterial(){(0,o.Wi)(this._externalResources)||this._externalResources.material.setParameters(this.materialParameters)}get materialParameters(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded}}_updateGeometry(){const e=this.object;(0,o.Wi)(e)||this._updateVertices(e)}_updateVertices(e){const t=this.view.state.camera;t.projectToScreen(this.location,re),(0,I.a)(se,this.location,this.direction),t.projectToScreen(se,oe),(0,ie.i)(oe,(0,ie.g)(oe,oe,re)),this._updateVertexAttributes(t,e,0,re,oe,1),this._updateVertexAttributes(t,e,1,re,oe,-1)}_updateVertexAttributes(e,t,i,n,s,r){const o=t.geometryRecords[i],a=o.geometry.getMutableAttribute(U.T.POSITION).data,l=(0,ie.f)(ae,(0,ie.a)(ae,s[1]*r,s[0]*-r),this.offset+this.width/2),d=(0,ie.b)(le,(0,ie.b)(le,(0,ie.b)(le,n,(0,ie.f)(le,s,this.length/2)),l),l),c=(0,ie.b)(de,d,(0,ie.f)(de,s,-this.length));e.unprojectFromScreen(d,se),a[0]=se[0],a[1]=se[1],a[2]=se[2],e.unprojectFromScreen(c,se),a[3]=se[0],a[4]=se[1],a[5]=se[2],t.geometryVertexAttrsUpdated(o)}}const se=(0,z.c)(),re=(0,T.s1)(),oe=(0,T.s1)(),ae=(0,T.s1)(),le=(0,T.s1)(),de=(0,T.s1)();var ce=i(76102),he=i(60638),pe=i(39801),ue=i(79397),ge=i(8677);class _e extends ge.r{constructor(e,t){super(t),this.intersectionPoint=e}equals(e){return e instanceof _e&&(0,ue.Xv)(this.intersectionPoint,e.intersectionPoint)}}var fe=i(80654),ye=i(93622);ye.Z.getLogger("esri.views.interactive.snapping.hints.ParallelSnappingHint");class me extends ge.r{constructor(e,t,i){super(i),this.lineStart=e,this.lineEnd=t}equals(e){return e instanceof me&&(0,ue.Xv)(this.lineStart,e.lineStart)&&(0,ue.Xv)(this.lineEnd,e.lineEnd)}}var ve=i(76952);ye.Z.getLogger("esri.views.interactive.snapping.hints.RightAngleSnappingHint");class we extends ge.r{constructor(e,t,i,n){super(n),this.previousVertex=e,this.centerVertex=t,this.nextVertex=i}equals(e){return e instanceof we&&(0,ue.Xv)(this.previousVertex,e.previousVertex)&&(0,ue.Xv)(this.centerVertex,e.centerVertex)&&(0,ue.Xv)(this.nextVertex,e.nextVertex)}}class xe{draw(e,t){const i=this._getUniqueHints(e),n=[];for(const s of i)s instanceof _e&&n.push(this.visualizeIntersectionPoint(s,t)),s instanceof fe.w&&n.push(this.visualizeLine(s,t)),s instanceof me&&n.push(this.visualizeParallelSign(s,t)),s instanceof we&&n.push(this.visualizeRightAngleQuad(s,t)),s instanceof ve.n&&n.push(this.visualizePoint(s,t));return(0,p.AL)(n)}_getUniqueHints(e){const t=[];for(const i of e){let e=!0;for(const n of t)if(i.equals(n)){e=!1;break}e&&t.push(i)}return t}}var be=i(54205);class Ce extends xe{visualizeIntersectionPoint(e,t){const{coordinateHelper:i,view:n}=t;return(0,p.ed)(new ce.L({view:n,primitive:"circle",geometry:i.vectorToPoint(e.intersectionPoint),elevationInfo:(0,o.Pt)(e.elevationInfo,t.elevationInfo),size:20,outlineSize:2,color:[0,0,0,0],outlineColor:g.Z.toUnitRGBA(pe.c.orange),pixelSnappingEnabled:!1}))}visualizePoint(e,t){const{coordinateHelper:i,view:n}=t;return(0,p.ed)(new ce.L({view:n,primitive:"circle",geometry:i.vectorToPoint(e.point),elevationInfo:(0,o.Pt)(e.elevationInfo,t.elevationInfo),size:20,outlineSize:2,color:[0,0,0,0],outlineColor:g.Z.toUnitRGBA(pe.c.orange),pixelSnappingEnabled:!1}))}visualizeLine(e,t){const{coordinateHelper:i,view:n}=t;return(0,p.ed)(this._createLineSegmentHintFromMap(e.type,e.lineStart,e.lineEnd,i,(0,o.Pt)(e.elevationInfo,t.elevationInfo),n,e.fadeLeft,e.fadeRight))}visualizeParallelSign(e,t){const{coordinateHelper:i,view:n}=t,s=(0,o.Pt)(e.elevationInfo,t.elevationInfo),r=(0,be.$r)(e.lineStart,i,s,t.view),a=(0,be.$r)(e.lineEnd,i,s,t.view),l=(0,I.h)(a,r,a,.5),d=new ne({view:n,attached:!1,offset:pe.c.parallelLineHintOffset,length:pe.c.parallelLineHintLength,width:pe.c.parallelLineHintWidth,color:g.Z.toUnitRGBA(pe.c.orange),location:l,renderOccluded:Z.yD.Opaque});return d.setDirectionFromPoints(r,l),d.attached=!0,(0,p.ed)(d)}visualizeRightAngleQuad(e,t){const{coordinateHelper:i,view:n}=t,s=(0,o.Pt)(e.elevationInfo,t.elevationInfo);return(0,p.ed)(new he.R({view:n,attached:!0,color:g.Z.toUnitRGBA(pe.c.orange),renderOccluded:Z.yD.Transparent,outlineRenderOccluded:Z.yD.Opaque,outlineColor:g.Z.toUnitRGBA(pe.c.orange),outlineSize:pe.c.rightAngleHintOutlineSize,size:pe.c.rightAngleHintSize,geometry:{previous:(0,be.$r)(e.previousVertex,i,s,n),center:(0,be.$r)(e.centerVertex,i,s,n),next:(0,be.$r)(e.nextVertex,i,s,n)}}))}_createLineSegmentHintFromMap(e,t,i,n,s,r,o=!0,a=!0){const l=(0,z.c)(),d=(0,z.c)();return(0,be.By)(t,i,n,s,r,l,d),this._createLineSegmentHint(e,r,l,d,o,a)}_createLineSegmentHint(e,t,i,n,s=!0,r=!0){const o=new Y({view:t,extensionType:J.FADED,start:i,end:n,color:g.Z.toUnitRGBA(pe.c.orange),renderOccluded:Z.yD.Opaque});switch(e){case ue.ze.TARGET:o.width=pe.c.lineHintWidthTarget,o.fadedExtensions={start:0,end:pe.c.lineHintFadedExtensions};break;case ue.ze.REFERENCE_EXTENSION:o.width=pe.c.lineHintWidthReference,o.fadedExtensions={start:0,end:0};break;case ue.ze.REFERENCE:o.width=pe.c.lineHintWidthReference,o.fadedExtensions={start:s?pe.c.lineHintFadedExtensions:0,end:r?pe.c.lineHintFadedExtensions:0}}return o.attached=!0,o}}var Se=i(23204),Ee=i(9518),Pe=i(50209),Te=i(73529),Oe=i(75418),Re=i(96475),Me=i(48079);let He=class extends s.Z{constructor(e){super(e),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1}};(0,n._)([(0,l.Cb)({constructOnly:!0})],He.prototype,"layer",void 0),(0,n._)([(0,l.Cb)()],He.prototype,"enabled",void 0),(0,n._)([(0,l.Cb)()],He.prototype,"updating",void 0),(0,n._)([(0,l.Cb)()],He.prototype,"availability",void 0),He=(0,n._)([(0,c.j)("esri.views.interactive.snapping.SnappingLayerSource")],He);const Ve=He;i(21703);var Le=i(61950),Ie=i(83161),ze=i(4717),De=i(88141),ke=i(23007),Ne=i(83186);let Ge=class extends C.r{constructor(e){super(e),this.availability=0,this._ids=new Set,this.tmpP=(0,z.c)()}destroy(){this.workerHandle.destroy(),this.workerHandle=null}initialize(){this.workerHandle=new Ae(this.schedule,{fetchAllEdgeLocations:(e,t)=>this._fetchAllEdgeLocations(e,t)})}async fetchCandidates(e,t){const i=e.coordinateHelper.toXYZ(e.point);this.view.renderCoordsHelper.toRenderCoords(i,e.coordinateHelper.spatialReference,i);const n="number"==typeof e.distance?e.distance:e.distance.pixelSize,s=await this.workerHandle.invoke({bounds:(0,ze.f)(i[0],i[1],i[2],n),types:e.types},t),r=e.coordinateHelper;return s.candidates.sort(((e,t)=>e.distance-t.distance)),s.candidates.map((e=>this._convertCandidate(r,e)))}async add(e,t){this._ids.add(e.id),await this.workerHandle.invokeMethod("add",e,t)}async remove(e,t){this._ids.delete(e.id),await this.workerHandle.invokeMethod("remove",e,t)}_convertCandidate(e,t){switch(t.type){case"edge":return new ke.L({coordinateHelper:e,objectId:t.objectId,targetPoint:this._convertRenderCoordinate(e,t.target),edgeStart:this._convertRenderCoordinate(e,t.start),edgeEnd:this._convertRenderCoordinate(e,t.end),elevationInfo:De.jG});case"vertex":return new Ne.x({coordinateHelper:e,objectId:t.objectId,targetPoint:this._convertRenderCoordinate(e,t.target),elevationInfo:De.jG})}}_convertRenderCoordinate(e,t){return this.view.renderCoordsHelper.fromRenderCoords(t,this.tmpP,e.spatialReference),e.fromXYZ(this.tmpP)}async _fetchAllEdgeLocations(e,t){const i=[],n=[];for(const{id:s,uid:r}of e.components)this._ids.has(s)&&i.push((async()=>{const e=await this.fetchEdgeLocations(s,t.signal);return n.push(e.locations.buffer),{id:s,uid:r,objectIds:e.objectIds,locations:e.locations.buffer,origin:e.origin,type:e.type}})());return{result:{components:(await Promise.all(i)).filter((({id:e})=>this._ids.has(e)))},transferList:n}}};(0,n._)([(0,l.Cb)({constructOnly:!0})],Ge.prototype,"view",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0})],Ge.prototype,"fetchEdgeLocations",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0})],Ge.prototype,"schedule",void 0),(0,n._)([(0,l.Cb)({readOnly:!0})],Ge.prototype,"availability",void 0),Ge=(0,n._)([(0,c.j)("esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorker")],Ge);class Ae extends Ie.q{constructor(e,t){super("SceneLayerSnappingSourceWorker","fetchCandidates",{},e,{strategy:"dedicated",client:t})}}let je=class extends C.r{constructor(e){super(e),this.availability=1,this.abortController=new AbortController}get updating(){return this.updatingHandles.updating}get layer(){return this.layerSource.layer}destroy(){this.abortController=(0,o.IM)(this.abortController)}initialize(){const e=this.view.resourceController;this.edgeWorker=new Le.Z((t=>e.schedule(t))),this.workerHandle=new Ge({view:this.view,schedule:t=>e.schedule(t),fetchEdgeLocations:async(e,t)=>{if((0,o.Wi)(this.tracker))throw new Error("tracker-not-initialized");return this.tracker.fetchEdgeLocations(e,this.edgeWorker,t)}}),this.updatingHandles.addPromise(this._setupLayerView()),this.handles.add([(0,p.ed)(this.workerHandle),(0,p.ed)(this.edgeWorker)])}async fetchCandidates(e,t){return this.workerHandle.fetchCandidates(e,t)}refresh(){}async _setupLayerView(){const e=await this.view.whenLayerView(this.layer);if("scene-layer-graphics-3d"===e.type)return;const t={add:(e,t)=>this.updatingHandles.addPromise(this.workerHandle.add({id:e,bounds:t},this.abortController.signal)),remove:e=>this.updatingHandles.addPromise(this.workerHandle.remove({id:e},this.abortController.signal))};this.tracker=e.trackSnappingSources(t),this.handles.add(this.tracker)}};(0,n._)([(0,l.Cb)({constructOnly:!0})],je.prototype,"layerSource",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0})],je.prototype,"view",void 0),(0,n._)([(0,l.Cb)({readOnly:!0})],je.prototype,"updating",null),(0,n._)([(0,l.Cb)({readOnly:!0})],je.prototype,"availability",void 0),je=(0,n._)([(0,c.j)("esri.views.interactive.snapping.featureSources.SceneLayerSnappingSource")],je);let We=class extends s.Z{constructor(e){super(e),this.options=null,this._snappingSources=new r.Z}initialize(){this.own([this.view.on("layerview-create",(({layerView:e})=>this._createSource(e))),this.view.on("layerview-destroy",(({layerView:e})=>this._removeSource(e)))]);for(const e of this.view.allLayerViews.items)this._createSource(e)}destroy(){this.options=null,this._snappingSources.drain((e=>e.destroy()))}get updating(){return this._snappingSources.some((e=>e.updating))}get _types(){return Me.r.EDGE|Me.r.VERTEX}async fetchCandidates(e,t,i){const{view:n,options:s}=this,{coordinateHelper:r,elevationInfo:a}=t,l=(0,o.pC)(s)?s.distance:1,d=(0,be.$r)(e,r,a,n,u.WM.get()),c=l*n.state.camera.computeScreenPixelSizeAt(d),h=this._types,p=this._snappingSources.items.map((t=>t.fetchCandidates({point:e,coordinateHelper:r,distance:c,types:h},i))),g=(await Promise.all(p)).flat();return(0,ue.lQ)(e,g),g}_createSource(e){if("scene-layer-3d"!==e.type)return;const t=new je({layerSource:new Ve({layer:e.layer}),view:this.view});this._snappingSources.push(t)}_removeSource(e){const t=this._snappingSources.findIndex((t=>t.layerSource.layer===e.layer));-1!==t&&this._snappingSources.removeAt(t).destroy()}};(0,n._)([(0,l.Cb)({constructOnly:!0})],We.prototype,"view",void 0),(0,n._)([(0,l.Cb)()],We.prototype,"updating",null),(0,n._)([(0,l.Cb)()],We.prototype,"options",void 0),(0,n._)([(0,l.Cb)()],We.prototype,"_snappingSources",void 0),We=(0,n._)([(0,c.j)("esri.views.interactive.snapping.SceneSnappingEngine")],We);var Fe,qe=i(96545),Ze=i(67322),Ue=i(40182),Xe=i(95074),Ye=i(30621);class Be extends Ye.j{constructor({coordinateHelper:e,targetPoint:t,constraint:i,previousVertex:n,otherVertex:s,otherVertexType:r,objectId:o,elevationInfo:a}){super(e,t,i,a),this.previousVertex=n,this.otherVertex=s,this.otherVertexType=r,this.objectId=o}get hints(){const e=this.previousVertex,t=this.otherVertexType===Fe.CENTER?this.otherVertex:this.targetPoint,i=this.otherVertexType===Fe.CENTER?this.targetPoint:this.otherVertex,n=this.elevationInfo;return[new fe.w(ue.ze.TARGET,t,i,n),new fe.w(ue.ze.REFERENCE,e,t,n),new we(this.previousVertex,t,i,n)]}}!function(e){e[e.NEXT=0]="NEXT",e[e.CENTER=1]="CENTER"}(Fe||(Fe={}));let $e=class extends C.r{constructor(e){super(e),this.options=null,this.sourceModules={featureService:{module:null,loader:null},featureCollection:{module:null,loader:null},graphics:{module:null,loader:null}}}get updating(){return(0,Ze.oE)(this.snappingSources,(({snappingSource:e})=>e.updating))||this.updatingHandles.updating}get snappingSources(){const e=this._get("snappingSources")||new Map,t=new Map;if((0,o.pC)(this.options)&&(0,o.pC)(this.options.featureSources))for(const i of this.options.featureSources.items){const n=i.layer.uid,s=e.get(n);if(s){e.delete(n),t.set(n,s);continue}if(!i.layer.loaded){this.updatingHandles.addPromise(i.layer.load());continue}const r=this._createSourceInfo(i);(0,o.pC)(r)&&t.set(n,r)}for(const[,i]of e)i.destroy();return t}initialize(){this.updatingHandles.add((()=>this.snappingSources),(()=>this.notifyChange("updating")),a.Z_),(0,o.pC)(this.view)&&this.handles.add([this.view.on("layerview-create",(e=>this._updateLayerView(e.layer,e.layerView))),this.view.on("layerview-destroy",(e=>this._updateLayerView(e.layer,null)))])}_updateLayerView(e,t){for(const[,i]of this.snappingSources)i.snappingSource.layerSource.layer===e&&(i.layerView=t)}destroy(){this._set("options",null);for(const[,e]of this.snappingSources)e.destroy()}async fetchCandidates(e,t,i){if((0,o.Wi)(this.options)||!this.options.effectiveFeatureEnabled)return[];const n=[],s=this._computeScreeenSizeDistanceParameters(e,t),r={distance:s,point:e,coordinateHelper:t.coordinateHelper,types:this.types,filter:null};for(const[,{snappingSource:l,layerView:d}]of this.snappingSources)!l.layerSource.enabled||(0,o.pC)(d)&&d.suspended||n.push(l.fetchCandidates(r,i).then((e=>e.filter((e=>!this._candidateIsExcluded(l,e,t.excludeFeature))))));const a=(await(0,E.WW)(n)).flat();return this._addRightAngleCandidates(a,e,s,t),(0,E.k_)(i),(0,ue.lQ)(e,a),a}_addRightAngleCandidates(e,t,i,n){const s=(0,o.pC)(n.vertexHandle)?n.vertexHandle.rightEdge?.rightVertex?.pos:(0,o.pC)(n.editGeometryOperations)&&"polygon"===n.editGeometryOperations.data.type?(0,o.Wg)(n.editGeometryOperations.data.components[0]?.getFirstVertex())?.pos:null,r=(0,o.pC)(n.vertexHandle)?n.vertexHandle.leftEdge?.leftVertex?.pos:(0,o.pC)(n.editGeometryOperations)?(0,o.Wg)(n.editGeometryOperations.data.components[0]?.getLastVertex())?.pos:null,a=e.length;for(let o=0;o<a;o++)this._addRightAngleCandidate(e[o],r,t,i,n,e),this._addRightAngleCandidate(e[o],s,t,i,n,e)}_addRightAngleCandidate(e,t,i,n,s,r){if((0,o.Wi)(t)||!(e instanceof ke.L))return;const a=e.constraint.closestTo(t),l=(a[0]-i[0])/n.x,d=(a[1]-i[1])/n.y;if(l*l+d*d<=1){const i=s.coordinateHelper;r.push(new Be({coordinateHelper:i,targetPoint:a,otherVertex:t,otherVertexType:Fe.NEXT,previousVertex:e.constraint.start,constraint:new Ue.yG(i,t,a),objectId:e.objectId,elevationInfo:e.elevationInfo}))}}_computeScreeenSizeDistanceParameters(e,t){const i=(0,o.pC)(this.options)?this.options.distance*("touch"===t.pointer?this.options.touchSensitivityMultiplier:1):0;if((0,o.Wi)(this.view))return{x:i,y:i,pixelSize:i};if("2d"===this.view.type){const e=i*this.view.resolution;return{x:e,y:e,pixelSize:e}}return this._computeScreenSizeDistanceParameters3D(e,i,this.view,t)}_computeScreenSizeDistanceParameters3D(e,t,i,n){const{coordinateHelper:s,elevationInfo:r}=n,o=i.state.camera.computeScreenPixelSizeAt((0,be.$r)(e,s,r,i,Ke)),a=o*i.renderCoordsHelper.unitInMeters/i.mapCoordsHelper.unitInMeters,l=t*a;return{x:l/this._computeScreenMagnitudeOfMapOffset(e,a,0,i,n),y:l/this._computeScreenMagnitudeOfMapOffset(e,0,a,i,n),pixelSize:o}}_computeScreenMagnitudeOfMapOffset(e,t,i,n,{coordinateHelper:s,elevationInfo:r}){const o=s.clone(e);o[0]+=t,o[1]+=i;const a=(0,be.a7)(e,s,r,n),l=(0,be.a7)(o,s,r,n),d=l.x-a.x,c=l.y-a.y;return Math.sqrt(d*d+c*c)}get types(){return Me.r.EDGE|Me.r.VERTEX}_candidateIsExcluded(e,t,i){if((0,o.Wi)(i))return!1;const n=this._getCandidateObjectId(t);if((0,o.Wi)(n))return!1;const s=e.layerSource.layer;return"graphics"===s.type?i.uid===n:i.sourceLayer===s&&!(!i.attributes||!("objectIdField"in s))&&i.attributes[s.objectIdField]===n}_getCandidateObjectId(e){return e instanceof Xe.a?e.objectId:null}_createSourceInfo(e){const t=this._createFeatureSnappingSourceType(e);if((0,o.Wi)(t))return null;if("loading"in t)return this.updatingHandles.addPromise(t.loading.then((()=>{this.destroyed||this.notifyChange("snappingSources")}))),null;const i=(0,o.pC)(this.view)?this.view.allLayerViews.find((t=>t.layer===e.layer)):null;return new Qe(t.source,i)}_createFeatureSnappingSourceType(e){switch(e.layer.type){case"feature":case"geojson":case"csv":case"subtype-group":case"wfs":return this._createFeatureSnappingSourceFeatureLayer(e);case"graphics":return this._createFeatureSnappingSourceGraphicsLayer(e)}return null}_createFeatureSnappingSourceFeatureLayer(e){switch(e.layer.source.type){case"feature-layer":{const t=this._getSourceModule("featureService");return(0,o.pC)(t.module)?{source:new t.module.FeatureServiceSnappingSource({spatialReference:this.spatialReference,view:this.view,layerSource:e})}:{loading:t.loader}}case"memory":case"csv":case"geojson":case"wfs":{if("mesh"===e.layer.geometryType)return null;const t=this._getSourceModule("featureCollection");return(0,o.pC)(t.module)?{source:new t.module.FeatureCollectionSnappingSource({layerSource:e})}:{loading:t.loader}}}return null}_createFeatureSnappingSourceGraphicsLayer(e){const t=this._getSourceModule("graphics");return(0,o.pC)(t.module)?{source:new t.module.GraphicsSnappingSource({spatialReference:this.spatialReference,view:this.view,layerSource:e})}:{loading:t.loader}}_getSourceModule(e){const t=this.sourceModules[e];if((0,o.Wi)(t.loader)){const i=this._loadSourceModule(e).then((e=>{t.module=e}));return t.loader=i,{module:t.module,loader:i}}return{module:t.module,loader:t.loader}}_loadSourceModule(e){switch(e){case"featureService":return this.updatingHandles.addPromise(i.e(6078).then(i.bind(i,96078)));case"featureCollection":return this.updatingHandles.addPromise(i.e(4267).then(i.bind(i,64267)));case"graphics":return this.updatingHandles.addPromise(Promise.all([i.e(427),i.e(565)]).then(i.bind(i,90565)))}return null}};(0,n._)([(0,l.Cb)({constructOnly:!0})],$e.prototype,"spatialReference",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0})],$e.prototype,"view",void 0),(0,n._)([(0,l.Cb)()],$e.prototype,"options",void 0),(0,n._)([(0,l.Cb)({readOnly:!0})],$e.prototype,"updating",null),(0,n._)([(0,l.Cb)({readOnly:!0})],$e.prototype,"snappingSources",null),$e=(0,n._)([(0,c.j)("esri.views.interactive.snapping.FeatureSnappingEngine")],$e);class Qe{constructor(e,t){this.snappingSource=e,this.layerView=t,this.handles=new S.Z;const i=this.snappingSource.layerSource.layer;if("refresh"in i){const t=i;this.handles.add(t.on("refresh",(()=>e.refresh())))}this.handles.add([(0,a.YP)((()=>e.updating),(t=>e.layerSource.updating=t),a.tX),(0,a.YP)((()=>e.availability),(t=>e.layerSource.availability=t),a.tX)])}destroy(){this.snappingSource.destroy(),this.handles.destroy()}}const Ke=(0,z.c)();var Je=i(12686);class et{constructor(e,t){this.view=e,this.options=t,this.squaredShortLineThreshold=pe.c.shortLineThreshold*pe.c.shortLineThreshold}snap(e,t){return(0,o.pC)(t.vertexHandle)?"vertex"!==t.vertexHandle.type?[]:this.snapExistingVertex(e,t):this.snapNewVertex(e,t)}edgeExceedsShortLineThreshold(e,t){return this.exceedsShortLineThreshold(e.leftVertex.pos,e.rightVertex.pos,t)}exceedsShortLineThreshold(e,t,{elevationInfo:i,editGeometryOperations:n}){const s=n.data.coordinateHelper;return 0===this.squaredShortLineThreshold||(0,ue.tp)((0,be.a7)(t,s,i,this.view),(0,be.a7)(e,s,i,this.view))>this.squaredShortLineThreshold}squaredProximityTreshold(e){return"touch"===e?this.squaredTouchProximityThreshold:this.squaredMouseProximityTreshold}get squaredMouseProximityTreshold(){return this.options.distance*this.options.distance}get squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,i=e*t;return i*i}}class tt extends Ye.j{constructor({coordinateHelper:e,lineStart:t,lineEnd:i,targetPoint:n,elevationInfo:s}){super(e,n,new Ue.ku(e,t,i),s),this.referenceLineHint=new fe.w(ue.ze.REFERENCE_EXTENSION,t,i,s)}get hints(){return[this.referenceLineHint,new fe.w(ue.ze.TARGET,this._lineEndClosestToTarget(),this.targetPoint,this.elevationInfo)]}_lineEndClosestToTarget(){const e=this.constraint.start,t=this.constraint.end;return Math.sign((0,ie.h)((0,ie.g)(nt,t,e),(0,ie.g)(it,this.targetPoint,e)))>0?t:e}}const it=(0,Je.a)(),nt=(0,Je.a)();var st=i(91555);class rt extends et{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],n=i.edges.length,s=[];if(n<1)return s;const r=t.coordinateHelper,o=(0,be.a7)(e,r,t.elevationInfo,this.view),a=i.edges[n-1];let l=a;do{this.edgeExceedsShortLineThreshold(l,t)&&this._processCandidateProposal(l.leftVertex.pos,l.rightVertex.pos,e,o,t,s),l=l.leftVertex.leftEdge}while(l&&l!==a);return s}snapExistingVertex(e,t){const i=[],n=(0,o.Wg)(t.vertexHandle),s=n.component;if(s.edges.length<2)return i;const r=t.coordinateHelper,a=(0,be.a7)(e,r,t.elevationInfo,this.view),l=n.leftEdge,d=n.rightEdge;l&&d&&this.edgeExceedsShortLineThreshold(l,t)&&this.edgeExceedsShortLineThreshold(d,t)&&this._processCandidateProposal(l.leftVertex.pos,d.rightVertex.pos,e,a,t,i);const c=s.edges[0];let h=c;do{h!==n.leftEdge&&h!==n.rightEdge&&this.edgeExceedsShortLineThreshold(h,t)&&this._processCandidateProposal(h.leftVertex.pos,h.rightVertex.pos,e,a,t,i),h=h.rightVertex.rightEdge}while(h&&h!==c);return i}_processCandidateProposal(e,t,i,n,s,r){const o=(0,st.k0)((0,Je.a)(),i,e,t),{coordinateHelper:a,elevationInfo:l,pointer:d}=s,c=a.fromXYZ(o,a.getZ(i,0));(0,ue.tp)(n,(0,be.a7)(c,a,l,this.view))<this.squaredProximityTreshold(d)&&r.push(new tt({coordinateHelper:a,lineStart:e,lineEnd:t,targetPoint:c,elevationInfo:l}))}}class ot extends Ye.j{constructor({coordinateHelper:e,referenceLine:t,lineStart:i,targetPoint:n,elevationInfo:s}){const r=e.clone(i);(0,ie.g)(r,(0,ie.b)(r,r,t.rightVertex.pos),t.leftVertex.pos),super(e,n,new Ue.ku(e,i,r),s),this._referenceLines=[{edge:t,fadeLeft:!0,fadeRight:!0}]}get hints(){const e=this.elevationInfo;return[new fe.w(ue.ze.TARGET,this.constraint.start,this.targetPoint,e),new me(this.constraint.start,this.targetPoint,e),...this._referenceLines.map((t=>new fe.w(ue.ze.REFERENCE,t.edge.leftVertex.pos,t.edge.rightVertex.pos,e,t.fadeLeft,t.fadeRight)))]}addReferenceLine(e){const t={edge:e,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach((i=>{e.rightVertex.rightEdge===i.edge&&(i.fadeLeft=!1,t.fadeRight=!1),e.leftVertex.leftEdge===i.edge&&(i.fadeRight=!1,t.fadeLeft=!1)})),this._referenceLines.push(t)}}class at extends et{constructor(){super(...arguments),this._tmpProjection=(0,Je.a)()}snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],n=i.edges.length,s=i.vertices.length,r=[];if(n<2)return r;const o=(0,be.a7)(e,t.coordinateHelper,t.elevationInfo,this.view),a=i.vertices[s-1],l=i.vertices[0],d=i.edges[n-1];let c=d;do{this.edgeExceedsShortLineThreshold(c,t)&&(this._checkEdgeForParalleLines(c,a.pos,e,o,t,r),this._checkEdgeForParalleLines(c,l.pos,e,o,t,r)),c=c.leftVertex.leftEdge}while(c&&c!==d);return r}snapExistingVertex(e,t){const i=[],n=(0,o.Wg)(t.vertexHandle),s=n.component;if(s.edges.length<3)return i;const r=(0,be.a7)(e,t.coordinateHelper,t.elevationInfo,this.view),a=n.leftEdge,l=n.rightEdge,d=s.vertices[0],c=s.vertices.length,h=s.vertices[c-1],p=s.edges[0];let u=p;do{u!==a&&u!==l&&this.edgeExceedsShortLineThreshold(u,t)&&(a&&this._checkEdgeForParalleLines(u,a.leftVertex.pos,e,r,t,i),l&&this._checkEdgeForParalleLines(u,l.rightVertex.pos,e,r,t,i),n===d?this._checkEdgeForParalleLines(u,h.pos,e,r,t,i):n===h&&this._checkEdgeForParalleLines(u,d.pos,e,r,t,i)),u=u.rightVertex.rightEdge}while(u&&u!==p);return i}_checkEdgeForParalleLines(e,t,i,n,s,r){const o=e.leftVertex.pos,a=e.rightVertex.pos;if((0,st.k0)(this._tmpProjection,t,o,a),(0,ie.s)(this._tmpProjection,t)<pe.c.parallelLineThreshold)return;(0,st.k0)(this._tmpProjection,i,o,a,t);const{coordinateHelper:l,elevationInfo:d,pointer:c}=s,h=l.fromXYZ(this._tmpProjection,l.getZ(i,0));if((0,ue.tp)(n,(0,be.a7)(h,l,d,this.view))<this.squaredProximityTreshold(c)){if(this._parallelToPreviousCandidate(e,r))return;r.push(new ot({coordinateHelper:l,referenceLine:e,lineStart:t,targetPoint:h,elevationInfo:d}))}}_parallelToPreviousCandidate(e,t){const i=e.leftVertex.pos,n=e.rightVertex.pos;for(const s of t)if((0,st.k0)(this._tmpProjection,n,s.constraint.start,s.constraint.end,i),(0,ie.s)(this._tmpProjection,n)<pe.c.parallelLineThreshold)return s.addReferenceLine(e),!0;return!1}}class lt extends et{constructor(){super(...arguments),this._tmp=(0,Je.a)()}snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],n=i.vertices.length,s=[];if(n<2)return s;const r=(0,be.a7)(e,t.coordinateHelper,t.elevationInfo,this.view),o=i.vertices[n-1];this._checkForSnappingCandidate(s,o.leftEdge,o.pos,e,o.leftEdge.leftVertex.pos,o.pos,t,e,r);const a=i.vertices[0];return this._checkForSnappingCandidate(s,a.rightEdge,a.pos,e,a.rightEdge.rightVertex.pos,a.pos,t,e,r),s}snapExistingVertex(e,t){const i=[],n=(0,o.Wg)(t.vertexHandle),s=n.component,r=s.vertices.length;if(r<3)return i;const a=(0,be.a7)(e,t.coordinateHelper,t.elevationInfo,this.view),l=n.leftEdge,d=n.rightEdge,c=s.vertices[0],h=s.vertices[r-1];if(!l)return this._checkForSnappingCandidate(i,c.rightEdge.rightVertex.rightEdge,c.rightEdge.rightVertex.pos,e,c.rightEdge.rightVertex.rightEdge.rightVertex.pos,c.rightEdge.rightVertex.pos,t,e,a),i;if(!d)return this._checkForSnappingCandidate(i,h.leftEdge.leftVertex.leftEdge,h.leftEdge.leftVertex.pos,e,h.leftEdge.leftVertex.leftEdge.leftVertex.pos,h.leftEdge.leftVertex.pos,t,e,a),i;if(l&&l.leftVertex.leftEdge){const n=l.leftVertex.leftEdge;this._checkForSnappingCandidate(i,n,l.leftVertex.pos,e,n.leftVertex.pos,l.leftVertex.pos,t,e,a)}if(d&&d.rightVertex.rightEdge){const n=d.rightVertex.rightEdge;this._checkForSnappingCandidate(i,n,d.rightVertex.pos,e,n.rightVertex.pos,d.rightVertex.pos,t,e,a)}return i}_checkForSnappingCandidate(e,t,i,n,s,r,o,a,l){if(!this.edgeExceedsShortLineThreshold(t,o))return;(0,ie.g)(this._tmp,t.rightVertex.pos,t.leftVertex.pos);const d=(0,Je.f)(this._tmp[1],-this._tmp[0]),c=(0,ie.h)(d,(0,ie.g)(this._tmp,n,i))/(0,ie.u)(d),{coordinateHelper:h,elevationInfo:p,pointer:u}=o,g=h.fromXYZ((0,ie.v)((0,Je.a)(),r,d,c),h.getZ(a,0));(0,ue.tp)(l,(0,be.a7)(g,h,p,this.view))<this.squaredProximityTreshold(u)&&e.push(new Be({coordinateHelper:h,targetPoint:g,constraint:new Ue.yG(h,r,(0,ie.v)(h.createVector(),r,d,Math.sign(c))),previousVertex:s,otherVertex:r,otherVertexType:Fe.CENTER,elevationInfo:p}))}}class dt extends Ye.j{constructor({coordinateHelper:e,targetPoint:t,point1:i,point2:n,elevationInfo:s}){super(e,t,new Ue.UL(e,(0,ie.l)(ct,i,n,.5),.5*(0,ie.j)(i,n)),s),this.p1=i,this.p2=n}get hints(){const e=this.elevationInfo;return[new fe.w(ue.ze.REFERENCE,this.targetPoint,this.p1,e),new fe.w(ue.ze.REFERENCE,this.targetPoint,this.p2,e),new we(this.p1,this.targetPoint,this.p2,e)]}}const ct=(0,Je.a)();class ht extends et{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],n=[],s=i.vertices.length;if("polygon"!==t.editGeometryOperations.data.type||s<2)return n;const r=i.vertices[0],o=i.vertices[s-1];return this._processCandidateProposal(r.pos,o.pos,e,t,n),n}snapExistingVertex(e,t){const i=[],n=(0,o.Wg)(t.vertexHandle),s=n.component;return s.edges.length<2?i:"polyline"!==t.editGeometryOperations.data.type||0!==n.index&&n.index!==s.vertices.length-1?(this._processCandidateProposal(n.leftEdge.leftVertex.pos,n.rightEdge.rightVertex.pos,e,t,i),i):i}_processCandidateProposal(e,t,i,n,s){if(!this.exceedsShortLineThreshold(e,t,n))return;const r=(0,ie.l)((0,Je.a)(),e,t,.5),o=.5*(0,ie.j)(e,t),a=(0,st.xO)((0,Je.a)(),i,r,o),{coordinateHelper:l,elevationInfo:d,pointer:c}=n,h=l.fromXYZ(a,l.getZ(i,0)),p=(0,be.a7)(i,l,d,this.view);(0,ue.tp)(p,(0,be.a7)(h,l,d,this.view))<this.squaredProximityTreshold(c)&&s.push(new dt({coordinateHelper:l,targetPoint:h,point1:e,point2:t,elevationInfo:d}))}}let pt=class extends s.Z{constructor(e){super(e),this.updating=!1,this._snappers=new r.Z}initialize(){this._snappers.push(new at(this.view,this.options),new rt(this.view,this.options),new lt(this.view,this.options),new ht(this.view,this.options))}set options(e){this._set("options",e);for(const t of this._snappers)t.options=e}async fetchCandidates(e,t){if(!this.options.effectiveSelfEnabled)return[];const i=[];for(const n of this._snappers.items)i.push(...n.snap(e,t));return(0,ue.lQ)(e,i),i}};function ut(e,t){return[new pt({view:e,options:t}),new $e({view:e,options:t,spatialReference:e.spatialReference})]}(0,n._)([(0,l.Cb)({readOnly:!0})],pt.prototype,"updating",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0})],pt.prototype,"view",void 0),(0,n._)([(0,l.Cb)()],pt.prototype,"options",null),pt=(0,n._)([(0,c.j)("esri.views.interactive.snapping.SelfSnappingEngine")],pt);let gt=class extends s.Z{constructor(e){super(e),this.enabled=!1,this.enabledToggled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.featureSources=new r.Z,this.distance=pe.c.distance,this.touchSensitivityMultiplier=pe.c.touchSensitivityMultiplier}get effectiveEnabled(){return this.enabledToggled?!this.enabled:this.enabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}};(0,n._)([(0,l.Cb)()],gt.prototype,"enabled",void 0),(0,n._)([(0,l.Cb)()],gt.prototype,"enabledToggled",void 0),(0,n._)([(0,l.Cb)()],gt.prototype,"selfEnabled",void 0),(0,n._)([(0,l.Cb)()],gt.prototype,"featureEnabled",void 0),(0,n._)([(0,l.Cb)({type:r.Z.ofType(Ve)})],gt.prototype,"featureSources",void 0),(0,n._)([(0,l.Cb)()],gt.prototype,"distance",void 0),(0,n._)([(0,l.Cb)()],gt.prototype,"touchSensitivityMultiplier",void 0),(0,n._)([(0,l.Cb)({readOnly:!0})],gt.prototype,"effectiveEnabled",null),(0,n._)([(0,l.Cb)({readOnly:!0})],gt.prototype,"effectiveSelfEnabled",null),(0,n._)([(0,l.Cb)({readOnly:!0})],gt.prototype,"effectiveFeatureEnabled",null),gt=(0,n._)([(0,c.j)("esri.views.interactive.snapping.SnappingOptions")],gt);const _t=gt;class ft extends Ye.j{constructor(e,t,i,n,s){super(e,t,new Ue.Bq(e,t,i.constraint,n.constraint),s),this.first=i,this.second=n}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new _e(this.targetPoint,this.elevationInfo)]}}let yt=class extends(qe.Z.EventedMixin(C.r)){constructor(e){super(e),this.options=new _t,this.snappingEnginesFactory=ut,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[]}initialize(){this.handles.add([(0,a.YP)((()=>{const{effectiveFeatureEnabled:e,effectiveSelfEnabled:t,touchSensitivityMultiplier:i,distance:n}=this.options;return{effectiveFeatureEnabled:e,effectiveSelfEnabled:t,touchSensitivityMultiplier:i,distance:n}}),(()=>{this.doneSnapping(),this.emit("changed")}),a.Z_),(0,a.YP)((()=>this.options),(e=>{for(const t of this._engines)t.options=e}),a.Z_),(0,a.YP)((()=>({viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,snappingEnginesFactory:this.snappingEnginesFactory})),(({viewReady:e,snappingEnginesFactory:t})=>this._recreateEngines(e,t)),a.tX)])}destroy(){this._destroyEngines()}get updating(){return this._engines.some((e=>e.updating))}_recreateEngines(e,t){if(this._destroyEngines(),!e)return;const{view:i,options:n}=this;this._engines=t(i,n)}_destroyEngines(){for(const e of this._engines)e.destroy();this._engines=[]}get squaredMouseProximityTreshold(){return this.options.distance*this.options.distance}get squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,i=e*t;return i*i}async snap(e,t,i){const n=t.coordinateHelper.pointToVector(e),s=await this._fetchCandidates(n,t,i);return{get valid(){return!(0,E.Hc)(i)},apply:()=>{const{snappedPoint:e,hints:i}=this._processCandidates(n,s,t);return this._removeVisualization(),(0,o.pC)(t.visualizer)&&this.handles.add(t.visualizer.draw(i,{coordinateHelper:t.coordinateHelper,elevationInfo:t.elevationInfo,view:this.view}),mt),e}}}update(e,t){this._removeVisualization();let i=e;const n=[];if((0,o.pC)(this._currentMainCandidate)){const s=t.coordinateHelper,r=s.pointToVector(e),o=this._currentMainCandidate.constraint.closestTo(r);if((0,ue.tp)((0,be.a7)(r,s,t.elevationInfo,this.view),(0,be.a7)(o,s,t.elevationInfo,this.view))<this._squaredPointProximityThreshold(t.pointer)){i=s.vectorToDehydratedPoint(o),this._currentMainCandidate.targetPoint=o,n.push(...this._currentMainCandidate.hints);for(const e of this._currentOtherActiveCandidates)e.targetPoint=o,n.push(...e.hints)}else this._currentMainCandidate=null,this._currentOtherActiveCandidates=[]}return(0,o.pC)(t.visualizer)&&this.handles.add(t.visualizer.draw(n,{coordinateHelper:t.coordinateHelper,elevationInfo:t.elevationInfo,view:this.view}),mt),i}doneSnapping(){this._removeVisualization(),this._currentMainCandidate=null,this._currentOtherActiveCandidates=[]}_removeVisualization(){this.handles.remove(mt)}async _fetchCandidates(e,t,i){return(await Promise.all(this._engines.map((n=>n.fetchCandidates(e,t,i))))).flat()}_processCandidates(e,t,i){if(t.length<1)return this.doneSnapping(),{snappedPoint:i.coordinateHelper.vectorToDehydratedPoint(e),hints:[]};(0,ue.lQ)(e,t);const n=this._currentMainCandidate;if((0,o.pC)(n)){const s=this._findOldConstraintInNewCandidates(n,t);if(s>=0){if(!(t[s]instanceof ft))return this._intersectWithOtherCandidates(s,t,e,i);if((0,ie.s)(e,n.targetPoint)<this._squaredPointProximityThreshold(i.pointer))return this._updateSnappingCandidate(n,t,i)}}return this._intersectWithOtherCandidates(0,t,e,i)}_findOldConstraintInNewCandidates(e,t){return e instanceof ft?this._findOldCandidateIndex(t,e.first)>=0&&this._findOldCandidateIndex(t,e.second)>=0?0:-1:this._findOldCandidateIndex(t,e)}_intersectWithOtherCandidates(e,t,i,n){const s=t[e],r=[],o=n.coordinateHelper;for(let a=0;a<t.length;++a){if(a===e)continue;const l=t[a];for(const e of s.constraint.intersect(l.constraint)){const t=o.fromXYZ(e.intersection,s.targetPoint[2]);r.push([new ft(o,t,s,l,l.elevationInfo),(0,ue.tp)((0,be.a7)(i,n.coordinateHelper,n.elevationInfo,this.view),(0,be.a7)(t,n.coordinateHelper,n.elevationInfo,this.view))])}}return r.length>0&&(r.sort(((e,t)=>e[1]-t[1])),r[0][1]<this._squaredPointProximityThreshold(n.pointer))?this._updateSnappingCandidate(r[0][0],t,n):this._updateSnappingCandidate(s,t,n)}_updateSnappingCandidate(e,t,i){this.doneSnapping(),this._currentMainCandidate=e;const n=this._currentMainCandidate.targetPoint,s=[];s.push(...e.hints);for(const r of t){if(e instanceof ft){if(r.constraint.objectEqual(e.first.constraint)||r.constraint.objectEqual(e.second.constraint))continue}else if(r.constraint.objectEqual(e.constraint))continue;r.constraint.check(n)&&(r.targetPoint=n,this._currentOtherActiveCandidates.push(r),s.push(...r.hints))}return{snappedPoint:i.coordinateHelper.vectorToDehydratedPoint(n),hints:s}}_squaredPointProximityThreshold(e){return"touch"===e?this.squaredTouchProximityThreshold:this.squaredMouseProximityTreshold}_findOldCandidateIndex(e,t){let i=-1;for(let n=0;n<e.length;++n)if(t.constraint.objectEqual(e[n].constraint)){i=n;break}return i}get test(){return{visualizationsActive:this.handles.has(mt),engines:this._engines}}};(0,n._)([(0,l.Cb)({constructOnly:!0})],yt.prototype,"view",void 0),(0,n._)([(0,l.Cb)()],yt.prototype,"options",void 0),(0,n._)([(0,l.Cb)({readOnly:!0})],yt.prototype,"updating",null),(0,n._)([(0,l.Cb)()],yt.prototype,"snappingEnginesFactory",void 0),(0,n._)([(0,l.Cb)()],yt.prototype,"_engines",void 0),(0,n._)([(0,l.Cb)()],yt.prototype,"squaredMouseProximityTreshold",null),(0,n._)([(0,l.Cb)()],yt.prototype,"squaredTouchProximityThreshold",null),yt=(0,n._)([(0,c.j)("esri.views.interactive.snapping.SnappingManager")],yt);const mt="visualization-handle",vt=new Map;function wt(e){vt.has(e)||vt.set(e,{referenceCount:0,snappingManager:bt(e)});const t=vt.get(e);t.referenceCount++;const i=(0,p.kB)((()=>xt(e,t)));return{snappingManager:t.snappingManager,...i}}function xt(e,t){t.referenceCount--,t.referenceCount>0||(0,Re.Y)((()=>{0===t.referenceCount&&(t.snappingManager.destroy(),vt.delete(e))}))}function bt(e){return new yt({view:e,snappingEnginesFactory:(t,i)=>[new We({view:e,options:i})]})}class Ct{constructor(e){this.vertexHandle=null,this.excludeFeature=null,this.visualizer=null,this.editGeometryOperations=e.editGeometryOperations,this.elevationInfo=e.elevationInfo,this.pointer=e.pointer,this.vertexHandle=e.vertexHandle,this.excludeFeature=e.excludeFeature,this.visualizer=e.visualizer}get coordinateHelper(){return this.editGeometryOperations.data.coordinateHelper}}var St=i(78630),Et=i(36298);class Pt{constructor(){this.next=new Pe.hM}createSnapDragEventPipelineStep({predicate:e=(()=>!0),cancel:t,snappingManager:i,snappingContext:n,updatingHandles:s}){if((0,o.Wi)(i))return e=>e;let r=null,a=null;const l=()=>{r=(0,o.IM)(r),i.doneSnapping(),(0,o.pC)(a)&&a.frameTask.remove(),a=null};t.next((e=>(l(),e))),this.next=new Pe.hM;const d=(0,E.Ds)((async({frameTask:e,point:t,context:n,event:s,dx:r,dy:o},a)=>{const l=await e.schedule((()=>i.snap(t,n,a)),a);if(l.valid){let d=await e.schedule((()=>l.apply()),a);t!==c&&(d=i.update(c,n)),(0,St.k)(d,h)||(s.mapEnd.x=d.x+r,s.mapEnd.y=d.y+o,this.next.execute(s))}}));let c,h;return t=>{if(!e(t))return t;if("start"===t.action){const e="3d"===i.view.type?i.view.resourceController.scheduler.registerTask(Et.T8.SNAPPING):Et.sq;a={context:new Ct({editGeometryOperations:n.editGeometryOperations,elevationInfo:n.elevationInfo,pointer:n.pointer,vertexHandle:(0,o.pC)(t.info)?t.info.handle:null,excludeFeature:n.excludeFeature,visualizer:n.visualizer}),originalPos:(0,o.pC)(t.snapOrigin)?n.coordinateHelper.vectorToDehydratedPoint(t.snapOrigin):t.mapStart,frameTask:e}}if((0,o.pC)(a)){const e=a.context.coordinateHelper.vectorToDehydratedPoint(a.context.coordinateHelper.arrayToVector([a.originalPos.x,a.originalPos.y,a.originalPos.z]));e.x+=t.mapEnd.x-t.mapStart.x,e.y+=t.mapEnd.y-t.mapStart.y;const n=t.mapStart.x-a.originalPos.x,l=t.mapStart.y-a.originalPos.y,p={...t,action:"update"},u=a.context,g=i.update(e,a.context);if(h=g,t.mapEnd.x=g.x+n,t.mapEnd.y=g.y+l,c=e,"end"!==t.action){const t=a.frameTask;(0,o.pC)(r)||(r=new AbortController),s.addPromise((0,E.R8)(d({frameTask:t,event:p,context:u,point:e,dx:n,dy:l},r.signal)))}}return"end"===t.action&&l(),t}}}let Tt=class extends s.Z{constructor(e){super(e),this.stagedPoint=null,this._abortController=null,this._snap=(0,E.Ds)((async(e,t,i,n)=>{const s=await this._frameTask.schedule((()=>t.snap(e,i,n)),n);s.valid&&await this._frameTask.schedule((()=>{this.stagedPoint=s.apply(),e!==this._snapMapPoint&&(this.stagedPoint=t.update(this._snapMapPoint,i))}),n)}))}initialize(){const e="3d"===this.view.type?this.view?.resourceController?.scheduler:null;this._frameTask=(0,o.pC)(e)?e.registerTask(Et.T8.SNAPPING):Et.sq}destroy(){this._abortController=(0,o.IM)(this._abortController),this._frameTask=(0,o.hw)(this._frameTask)}async snap(e,t,i){return this.stagedPoint=t.update(e,i),this._snapMapPoint=e,(0,o.Wi)(this._abortController)&&(this._abortController=new AbortController),this._snap(e,t,i,this._abortController.signal)}abort(){this._abortController=(0,o.IM)(this._abortController)}};(0,n._)([(0,l.Cb)({constructOnly:!0})],Tt.prototype,"view",void 0),(0,n._)([(0,l.Cb)()],Tt.prototype,"stagedPoint",void 0),Tt=(0,n._)([(0,c.j)("esri.views.interactive.snapping.SnappingOperation")],Tt);let Ot=class extends C.r{constructor(e){super(e),this.stagedDimension=null,this._dimensionManipulators=new Map,this._dimensionHandles=new S.Z,this._snappingPipeline=new Pt,this._snappingManagerResult=wt(e.view),this.own(this._snappingManagerResult)}initialize(){this._snappingOperation=new Tt({view:this.view}),this.own([this._dimensionHandles,(0,a.YP)((()=>this._snappingOperation.stagedPoint),(e=>{(0,o.pC)(this.stagedDimension)&&(this.stagedDimension.endPoint=(0,o.yw)(e,(e=>(0,P.WG)(e,new w.Z))))}),a.Z_)])}destroy(){this._snappingOperation=(0,o.SC)(this._snappingOperation)}get updating(){return this.updatingHandles.updating||this._snappingManager.updating}get _snappingManager(){return this._snappingManagerResult.snappingManager}addDimension(e,t){if(this._dimensionManipulators.has(e))return;const i=this._createPointManipulator(e,{isStart:!0}),n=this._createPointManipulator(e,{isStart:!1}),s={startManipulator:i,endManipulator:n};this._setupDimensionToManipulatorsSync(e,s),this._dimensionManipulators.set(e,s),t.add(i),t.add(n)}removeDimension(e,t){const i=this._dimensionManipulators.get(e);if((0,o.Wi)(i))return;this._dimensionHandles.remove(e);const{startManipulator:n,endManipulator:s}=i;this._dimensionManipulators.delete(e),t.remove(n),t.remove(s)}getManipulatorsForDimension(e){return this._dimensionManipulators.get(e)}onDeactivate(){this._snappingManager.doneSnapping()}onUnstagedClick({mapPoint:e,pointerType:t}){const i=this._snappingContext(t),n=(0,P.WG)(this._snappingManager.update(e,i),new w.Z),s=new b({startPoint:n,endPoint:null});return this.stagedDimension=s,this._snappingManager.doneSnapping(),s}onStagedClick({mapPoint:e,pointerType:t}){if((0,o.Wi)(this.stagedDimension))return;const i=this._snappingContext(t),n=(0,P.WG)(this._snappingManager.update(e,i),new w.Z);this.stagedDimension.endPoint=n,this.stagedDimension=null,this._snappingManager.doneSnapping()}onPointerMove({mapPoint:e,pointerType:t}){const i=this._snappingContext(t);this.updatingHandles.addPromise((0,E.R8)(this._snappingOperation.snap(e,this._snappingManager,i)))}_setupDimensionToManipulatorsSync(e,t){const{startManipulator:i,endManipulator:n}=t;this._dimensionHandles.add([(0,a.YP)((()=>({startPoint:e.startPoint,endPoint:e.endPoint,stagedDimension:this.stagedDimension})),(({startPoint:t,endPoint:s,stagedDimension:r})=>{(0,o.pC)(t)?(i.available=(0,o.Wi)(r)||r===e,i.location=t):i.available=!1,(0,o.pC)(s)?(n.available=(0,o.Wi)(r),n.location=s):n.available=!1}),a.tX)],e)}_createPointManipulator(e,t){const{isStart:i}=t,n=i?"startPoint":"endPoint",s=(0,L.aD)(this.view,g.Z.toUnitRGB(V.pointManipulators.color),V.pointManipulators.opacity);s.available=!1,s.radius=V.pointManipulators.radius;const r=(0,Pe.Xd)(s,((t,i,s,r)=>{const o=(0,Se.J4)(t);i.next(o).next((0,Se.gv)(this.view)).next(this._snappingPipeline.createSnapDragEventPipelineStep({snappingContext:this._snappingContext(r),snappingManager:this._snappingManager,cancel:s,updatingHandles:this.updatingHandles}),this._snappingPipeline.next).next((t=>{const i=(0,P.WG)(t.mapEnd,new w.Z);e[n]=i})),s.next(o).next((0,Pe.di)(e,[n]))}));return this._dimensionHandles.add(r,e),s}_snappingContext(e){return new Ct({elevationInfo:{mode:"absolute-height",offset:0},pointer:e,editGeometryOperations:new Oe.c(new Te.XE("point",(0,Ee.Y6)(!0,!1,this.view.spatialReference))),visualizer:new Ce})}};(0,n._)([(0,l.Cb)({constructOnly:!0,nonNullable:!0})],Ot.prototype,"view",void 0),(0,n._)([(0,l.Cb)({readOnly:!0})],Ot.prototype,"updating",null),(0,n._)([(0,l.Cb)()],Ot.prototype,"stagedDimension",void 0),Ot=(0,n._)([(0,c.j)("esri.views.3d.analysis.Dimensioning.LengthDimensionSubTool")],Ot);var Rt,Mt=i(57979),Ht=i(4275),Vt=i(93226),Lt=i(39569);!function(e){e.Ready="ready",e.Creating="creating",e.Created="created"}(Rt||(Rt={}));let It=class extends Vt.f{constructor(e){super(e),this.preferManipulatorCursor=!0,this.analysisViewData=null}initialize(){this._intersector=(0,Mt.Z8)(this.view.state.viewingMode),this._intersector.options.store=Ht.eC.MIN,this._lengthDimensionSubTool=new Ot({view:this.view}),this.own((0,p.ed)(this._lengthDimensionSubTool));for(const e of this.analysis.dimensions.items)this._addDimension(e);this.own(this.analysis.dimensions.on("change",(e=>{for(const t of e.added)this._addDimension(t);for(const t of e.removed)this._removeDimension(t)}))),this.own((0,a.YP)((()=>this.state),(e=>{e===Rt.Created&&this.finishToolCreation()}),a.tX))}get state(){return this.analysis.dimensions.some((e=>"length"===e.type))?(0,o.pC)(this._activeSubTool)?Rt.Creating:Rt.Created:Rt.Ready}get updating(){return this._lengthDimensionSubTool.updating}get cursor(){return this.active?"crosshair":null}getManipulatorsForDimension(e){return this._lengthDimensionSubTool.getManipulatorsForDimension(e)}onInputEvent(e){switch(e.type){case"immediate-click":this._clickHandler(e);break;case"immediate-double-click":this._doubleClickHandler(e);break;case"pointer-move":this._pointerMoveHandler(e)}}onActivate(){this._activeSubTool=this._lengthDimensionSubTool}onDeactivate(){(0,o.pC)(this._activeSubTool)&&(this._activeSubTool.onDeactivate(),(0,o.pC)(this._activeSubTool.stagedDimension)&&(this.analysis.dimensions.remove(this._activeSubTool.stagedDimension),this._activeSubTool.stagedDimension=null),this._activeSubTool=null)}_clickHandler(e){if((0,o.Wi)(this._activeSubTool))return;const t=this._intersectScreen(e);if(!(0,o.Wi)(t)){if((0,o.Wi)(this._activeSubTool.stagedDimension)){const i=this._activeSubTool.onUnstagedClick({mapPoint:t,pointerType:e.pointerType});this.analysis.dimensions.add(i)}else this._activeSubTool.onStagedClick({mapPoint:t,pointerType:e.pointerType});e.stopPropagation()}}_doubleClickHandler(e){this.view.activeTool=null,e.stopPropagation()}_pointerMoveHandler(e){if((0,o.Wi)(this._activeSubTool))return;if(this.hasFocusedManipulators)return;const t=this._intersectScreen(e);(0,o.Wi)(t)||this._activeSubTool.onPointerMove({mapPoint:t,pointerType:e.pointerType})}_intersectScreen(e){const t=(0,Lt.Sj)(e);this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(t,this._intersector);const i=this._intersector.results.min,n=u.WM.get();return i.getIntersectionPoint(n)?this.view.renderCoordsHelper.fromRenderCoords(n,this.view.spatialReference):null}_addDimension(e){this._lengthDimensionSubTool.addDimension(e,this.manipulators)}_removeDimension(e){this._lengthDimensionSubTool.removeDimension(e,this.manipulators)}};(0,n._)([(0,l.Cb)({constructOnly:!0})],It.prototype,"view",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0})],It.prototype,"analysis",void 0),(0,n._)([(0,l.Cb)({readOnly:!0})],It.prototype,"state",null),(0,n._)([(0,l.Cb)({readOnly:!0})],It.prototype,"updating",null),(0,n._)([(0,l.Cb)({readOnly:!0})],It.prototype,"cursor",null),(0,n._)([(0,l.Cb)({readOnly:!0})],It.prototype,"preferManipulatorCursor",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0})],It.prototype,"analysisViewData",void 0),(0,n._)([(0,l.Cb)()],It.prototype,"_activeSubTool",void 0),(0,n._)([(0,l.Cb)()],It.prototype,"_lengthDimensionSubTool",void 0),It=(0,n._)([(0,c.j)("esri.views.3d.analysis.Dimensioning.DimensioningTool")],It);var zt=i(44679),Dt=i(85381),kt=i(4155),Nt=i(38942),Gt=i(34307),At=i(33216),jt=i(70556),Wt=i(40920);let Ft=class extends s.Z{constructor(e){super(e),this._directSegment=new jt.y$,this._dimensionSegment=new jt.y$,this._offsetAxis=(0,z.c)(),this._startOffsetSegment=new jt.y$(this._directSegment.startRenderSpace,this._dimensionSegment.startRenderSpace),this._endOffsetSegment=new jt.y$(this._directSegment.endRenderSpace,this._dimensionSegment.endRenderSpace),this._labelSegment=new jt.y$,this._hasValidGeometry=!1;const t={view:e.view,attached:!0,width:1,color:(0,Dt.f)(1,.5,0,1),renderOccluded:Z.yD.OccludeAndTransparent},i={...t,stipplePattern:(0,Wt.z5)(5)};this._dimensionVisualElement=new At.r(t),this._startOffsetVisualElement=new At.r(i),this._endOffsetVisualElement=new At.r(i),this._label=new Gt.Kc({view:e.view,attached:!0,distance:0,fontSize:V.labels.fontSize})}initialize(){this.own([(0,p.ed)(this._dimensionVisualElement),(0,p.ed)(this._startOffsetVisualElement),(0,p.ed)(this._endOffsetVisualElement),(0,p.ed)(this._label)]);const{computation:e,view:t}=this,{dimension:i}=e;this.own([(0,a.YP)((()=>({startPoint:i.startPoint,endPoint:i.endPoint,offset:i.offset,axis:i.axis,heading:i.heading})),(e=>{this._updateGeometry(e),this._updateLines(),this._updateLabelGeometry(t.state.camera)}),a.nn),(0,a.YP)((()=>e.length),(e=>this._updateLabelContent(e)),a.nn),(0,a.YP)((()=>t.state.camera),(e=>this._updateLabelGeometry(e)),a.nn)])}get testInfo(){return{dimensionVisualElement:this._dimensionVisualElement,label:this._label}}_updateGeometry({startPoint:e,endPoint:t,offset:i,axis:n}){const{renderCoordsHelper:s}=this.view,r=this._directSegment;if((0,o.Wi)(e)||(0,o.Wi)(t)||!s.toRenderCoords(e,r.startRenderSpace)||!s.toRenderCoords(t,r.endRenderSpace))return void(this._hasValidGeometry=!1);const{startRenderSpace:a,endRenderSpace:l}=r,d=r.eval(.5,u.WM.get()),c=s.worldUpAtPosition(d,u.WM.get()),h=s.worldBasisAtPosition(d,kt.R.X,u.WM.get()),p=this._offsetAxis;qt(p,a,l,c,n,h);const g=i/s.unitInMeters,[_,f]=Zt(a,l,p,g),y=this._dimensionSegment;(0,I.C)(y.startRenderSpace,r.startRenderSpace,p,_),(0,I.C)(y.endRenderSpace,r.endRenderSpace,p,f),this._hasValidGeometry=!0}_updateLines(){if(!this._hasValidGeometry)return this._dimensionVisualElement.visible=!1,this._startOffsetVisualElement.visible=!1,void(this._endOffsetVisualElement.visible=!1);this._dimensionVisualElement.setGeometryFromSegment(this._dimensionSegment),this._startOffsetVisualElement.setGeometryFromSegment(this._startOffsetSegment),this._endOffsetVisualElement.setGeometryFromSegment(this._endOffsetSegment),this._dimensionVisualElement.visible=!0,this._startOffsetVisualElement.visible=!0,this._endOffsetVisualElement.visible=!0}_updateLabelContent(e){if((0,o.Wi)(e)||!this._hasValidGeometry)return this._label.text="",void(this._label.visible=!1);const{value:t}=(0,zt.nn)(e,"meters");this._label.text=`${(0,Nt.uf)(t,{minimumFractionDigits:2,maximumFractionDigits:2})} m`,this._label.visible=!0}_updateLabelGeometry(e){if(!this._hasValidGeometry)return void(this._label.visible=!1);const{offset:t}=this.computation.dimension,i=e.computeRenderPixelSizeAt(this._dimensionSegment.eval(.5,u.WM.get())),n=(Math.sign(t)>=0?1:-1)*V.labels.offset*i;Ut(this._labelSegment,this._dimensionSegment,this._offsetAxis,n),this._label.geometry={type:"segment",sampleLocation:"center",segment:this._labelSegment,callout:!1}}};function qt(e,t,i,n,s,r){switch(s){case"horizontal":return(0,I.c)(e,n);case"vertical":return(0,I.e)(t,n)<(0,I.e)(i,n)?(0,I.v)(e,i,t):(0,I.v)(e,t,i),(0,I.f)(e,e,n),(0,I.z)(e,z.Z)?(0,I.c)(e,r):((0,I.f)(e,e,n),(0,I.n)(e,e),e);case"direct":return(0,I.e)(t,r)>(0,I.e)(i,r)?(0,I.v)(e,i,t):(0,I.v)(e,t,i),(0,I.f)(e,e,n),(0,I.z)(e,z.Z)?(0,I.c)(e,r):((0,I.n)(e,e),e)}}function Zt(e,t,i,n=0){const s=(0,I.e)(t,i),r=(0,I.e)(e,i),o=Math.abs(s-r)+n;return s>r?[o,n]:[n,o]}function Ut(e,t,i,n){(0,I.C)(e.startRenderSpace,t.startRenderSpace,i,n),(0,I.C)(e.endRenderSpace,t.endRenderSpace,i,n)}(0,n._)([(0,l.Cb)({constructOnly:!0,nonNullable:!0})],Ft.prototype,"computation",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0,nonNullable:!0})],Ft.prototype,"view",void 0),Ft=(0,n._)([(0,c.j)("esri.views.3d.analysis.Dimensioning.LengthDimensionVisualization")],Ft);let Xt=class extends s.Z{constructor(e){super(e),this._dimensionVisualizations=new Map}initialize(){for(const e of this.computations)this._addComputation(e);this.own(this.computations.on("change",(({added:e,removed:t})=>{for(const i of t)this._removeComputation(i);for(const i of e)this._addComputation(i)})))}destroy(){this._dimensionVisualizations.forEach((e=>{e.destroy()})),this._dimensionVisualizations.clear()}get testInfo(){return{visualizations:Array.from(this._dimensionVisualizations.values())}}_addComputation(e){this._dimensionVisualizations.has(e)||this._dimensionVisualizations.set(e,new Ft({computation:e,view:this.view}))}_removeComputation(e){const t=this._dimensionVisualizations.get(e);(0,o.Wi)(t)||(t.destroy(),this._dimensionVisualizations.delete(e))}};(0,n._)([(0,l.Cb)({constructOnly:!0,nonNullable:!0})],Xt.prototype,"view",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0,nonNullable:!0})],Xt.prototype,"computations",void 0),Xt=(0,n._)([(0,c.j)("esri.views.3d.analysis.Dimensioning.DimensioningVisualization")],Xt);let Yt=class extends s.Z{constructor(e){super(e),this.dimension=null}};(0,n._)([(0,l.Cb)({constructOnly:!0,nonNullable:!0})],Yt.prototype,"dimension",void 0),Yt=(0,n._)([(0,c.j)("esri.views.3d.analysis.LengthDimensionResult")],Yt);const Bt=Yt;var $t=i(61293),Qt=i(47608),Kt=i(54597),Jt=i(48474);function ei(e,t){const{spatialReference:i}=e;return(0,Kt.fS)(i,t.spatialReference)?(ni[0]=e.x,ni[1]=e.y,ni[2]=e.hasZ?e.z:0,si[0]=t.x,si[1]=t.y,si[2]=t.hasZ?t.z:0,ti(ni,si,i)):null}function ti(e,t,i){const n=ii(e,t,i);return(0,o.pC)(n)?{direct:(0,zt.yG)(n.direct,n.unit),horizontal:(0,zt.yG)(n.horizontal,n.unit),vertical:(0,zt.yG)(n.vertical,n.unit)}:null}function ii(e,t,i,n){const s=(0,Jt.m)(i),r=(0,$t.j5)(s);if((0,o.Wi)(r))return null;const a=t[2]-e[2];if("vertical"===n)return{verticalSigned:a,unit:r};if(!(0,Qt.SH)(e,i,ri,s)||!(0,Qt.SH)(t,i,oi,s))return null;if("direct"===n)return{direct:(0,I.i)(oi,ri),unit:r};if((0,I.s)(ai,e[0],e[1],t[2]),!(0,Qt.SH)(ai,i,ai,s))return null;const l=(0,I.i)(ai,oi);return"horizontal"===n?{horizontal:l,unit:r}:{direct:(0,I.i)(oi,ri),horizontal:l,vertical:Math.abs(a),unit:r}}const ni=(0,z.c)(),si=(0,z.c)(),ri=(0,z.c)(),oi=(0,z.c)(),ai=(0,z.c)();let li=class extends s.Z{constructor(e){super(e)}initialize(){this._set("result",new Bt({dimension:this.dimension}))}get length(){const{startPoint:e,endPoint:t,axis:i}=this.dimension;if((0,o.Wi)(e)||(0,o.Wi)(t))return null;const n=ei(e,t);return(0,o.Wi)(n)?null:n[i]}};(0,n._)([(0,l.Cb)({constructOnly:!0,nonNullable:!0})],li.prototype,"dimension",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0,nonNullable:!0})],li.prototype,"result",void 0),(0,n._)([(0,l.Cb)()],li.prototype,"length",null),li=(0,n._)([(0,c.j)("esri.views.3d.analysis.LengthDimensionComputation")],li);var di=i(60874);let ci=class extends((0,h.p)(s.Z)){constructor(e){super(e),this.type="dimensioning-view-3d",this.tool=null,this._computations=new r.Z,this._dimensionsToResults=new Map,this._placementTask=null}initialize(){this.own([(0,di.Lp)(this,It),(0,a.on)((()=>this.analysis.dimensions),"change",(({added:e,removed:t})=>{for(const i of t)this._removeDimension(i);for(const i of e)this._addDimension(i)}),{onListenerAdd:e=>{for(const t of e)this._addDimension(t)},onListenerRemove:e=>{for(const t of e)this._removeDimension(t)}})]),this._analysisVisualization=new Xt({view:this.view,computations:this._computations})}destroy(){this._placementTask=(0,o.IM)(this._placementTask),this._analysisVisualization=(0,o.SC)(this._analysisVisualization),this._computations.drain((e=>e.destroy())),(0,di.Yq)(this)}get results(){return this.analysis.dimensions.map((e=>this._dimensionsToResults.get(e)))}get testInfo(){return{visualization:this._analysisVisualization}}async createLengthDimensions(e){return this._placementTask=(0,o.IM)(this._placementTask),this._placementTask=(0,di.P9)(this,It,e),this._placementTask.promise}_addDimension(e){const t=this._dimensionsToResults;if(t.has(e))return;const i=this._computations,n=new li({dimension:e});i.add(n),t.set(e,n.result)}_removeDimension(e){const t=this._computations,i=this._dimensionsToResults,n=t.findIndex((t=>t.dimension===e)),s=t.removeAt(n);i.delete(e),(0,o.SC)(s)}};(0,n._)([(0,l.Cb)({readOnly:!0})],ci.prototype,"type",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0,nonNullable:!0})],ci.prototype,"analysis",void 0),(0,n._)([(0,l.Cb)()],ci.prototype,"tool",void 0),(0,n._)([(0,l.Cb)({readOnly:!0})],ci.prototype,"results",null),(0,n._)([(0,l.Cb)()],ci.prototype,"_analysisVisualization",void 0),(0,n._)([(0,l.Cb)()],ci.prototype,"_computations",void 0),(0,n._)([(0,l.Cb)()],ci.prototype,"_dimensionsToResults",void 0),(0,n._)([(0,l.Cb)()],ci.prototype,"_placementTask",void 0),ci=(0,n._)([(0,c.j)("esri.views.3d.analysis.DimensioningAnalysisView3D")],ci);const hi=ci},23204:function(e,t,i){i.d(t,{J4:function(){return f},_N:function(){return g},gv:function(){return y}});var n,s=i(8693),r=i(30524),o=(i(65554),i(74674)),a=(i(47608),i(54550)),l=i(23573),d=(i(94377),i(62069)),c=(i(88141),i(90290)),h=i(57979),p=i(4275),u=i(93700);i(50209);function g(e,t){return _(e,(()=>t))}function _(e,t){const i=(0,o.c)(),n=(0,o.c)();let l=!1;return o=>{const h=t(o);if("start"===o.action){const t=(0,r.md)(o.screenStart,(0,r.c$)(d.qW.get())),n=(0,c.u4)(e.state.camera,t,m);(0,s.pC)(n)&&(l=(0,a.BR)(h,n,i))}if(!l)return null;const p=(0,r.md)(o.screenEnd,(0,r.c$)(d.qW.get())),u=(0,c.u4)(e.state.camera,p,m);return(0,s.Wi)(u)?null:(0,a.BR)(h,u,n)?{...o,renderStart:i,renderEnd:n,plane:h,ray:u}:null}}function f(e){let t=null;return i=>{switch(i.action){case"start":t=e.disableDisplay();break;case"end":case"cancel":(0,s.pC)(t)&&(t.remove(),t=null)}return i}}function y(e,t=null){const i=(0,h.Z8)(e.state.viewingMode);i.options.selectionMode=!0,i.options.store=p.eC.MIN,i.options.hud=!1;const a=(0,r.s1)(),l={requiresGroundFeedback:!0,enableDraped:!0,exclude:new Set},d=(0,o.c)(),c=(0,s.Pt)(t,e.spatialReference),g=t=>{e.map.ground&&e.map.ground.opacity<1?l.exclude.add(u.cy):l.exclude.delete(u.cy),e.sceneIntersectionHelper.intersectIntersectorScreen((0,r.md)(t,a),i,l);const s=i.results.min;let o;if(s.getIntersectionPoint(d))o=s.intersector===p.q7.TERRAIN?n.GROUND:n.OTHER;else{if(!i.results.ground.getIntersectionPoint(d))return null;o=n.GROUND}return{location:e.renderCoordsHelper.fromRenderCoords(d,c),surfaceType:o}};let _;return e=>{if("start"===e.action){const t=g(e.screenStart);_=(0,s.pC)(t)?t.location:null}if((0,s.Wi)(_))return null;const t=g(e.screenEnd);return(0,s.pC)(t)&&(0,s.pC)(t.location)?{...e,mapStart:_,mapEnd:t.location,surfaceType:t.surfaceType}:null}}!function(e){e[e.GROUND=0]="GROUND",e[e.OTHER=1]="OTHER"}(n||(n={}));(0,o.c)(),(0,o.c)();const m=(0,l.Ue)()},60638:function(e,t,i){i.d(t,{R:function(){return w}});i(48675),i(3462),i(37380),i(1118);var n=i(50816),s=i(8693),r=i(18105),o=i(51802),a=i(94370),l=i(65554),d=i(74674),c=i(97848),h=i(86163),p=i(62069),u=i(9871),g=i(23168),_=i(59546),f=i(31728),y=i(30150),m=i(88865),v=i(66084);class w extends u._{constructor(e){super(e),this._handles=new n.Z,this._quadMaterial=null,this._outlineMaterial=null,this._maxSize=0,this._position=(0,d.c)(),this._up=(0,d.c)(),this._right=(0,d.c)(),this._renderOccluded=f.yD.OccludeAndTransparent,this._color=(0,h.f)(1,0,0,1),this._outlineColor=(0,h.f)(0,0,0,1),this._outlineSize=0,this._size=32,this._outlineRenderOccluded=f.yD.Opaque,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}get color(){return this._color}set color(e){(0,c.c)(this._color,e),this._updateQuadMaterial()}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,c.c)(this._outlineColor,e),this._updateOutlineMaterial()}get outlineSize(){return this._outlineSize}set outlineSize(e){const t=0===this._outlineSize!=(0===e);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateTransform())}get outlineRenderOccluded(){return this._outlineRenderOccluded}set outlineRenderOccluded(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}set geometry({previous:e,center:t,next:i}){this._maxSize=Math.min((0,l.i)(t,e),(0,l.i)(t,i))/3,(0,l.n)(this._up,(0,l.b)(this._up,e,t)),(0,l.n)(this._right,(0,l.b)(this._right,i,t)),(0,l.c)(this._position,t),this.recreateGeometry()}createExternalResources(){this._quadMaterial=new m.E(this.quadMaterialParameters),this._outlineMaterial=new v.U(this.outlineMaterialParameters),this._handles.add((0,r.YP)((()=>this.view.state.camera),(()=>this._updateTransform())))}destroyExternalResources(){this._quadMaterial=null,this._outlineMaterial=null,this._handles.removeAll()}forEachExternalMaterial(e){e(this._quadMaterial),e(this._outlineMaterial)}createGeometries(e){this._createQuadGeometry(e),this._createOutlineGeometry(e),this._updateTransform(e)}_createQuadGeometry(e){const t=this._quadGeometryData(this._up,this._right);e.addGeometry(t,this._quadMaterial)}_createOutlineGeometry(e){if(0===this._outlineSize)return;const t=(0,l.a)(p.WM.get(),this._up,this._right),i=_.Z.createPolylineGeometry([this._up,t,this._right]);e.addGeometry(i,this._outlineMaterial)}_updateTransform(e=this.object){const t=this.view.state.camera,i=this._size*t.computeScreenPixelSizeAt(this._position),n=Math.min(this._maxSize,i);(0,o.f)(x,this._position),(0,o.h)(x,x,[n,n,n]),(0,s.pC)(e)&&(e.transformation=x)}_quadGeometryData(e,t){const i=(0,l.a)(p.WM.get(),e,t);return new g.Z([[y.T.POSITION,{size:3,data:[0,0,0,...t,...e,...i],exclusive:!0}]],[[y.T.POSITION,new Uint16Array([0,1,2,1,2,3])]])}get quadMaterialParameters(){return{color:this._color,transparent:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded}}_updateQuadMaterial(){this._quadMaterial&&this._quadMaterial.setParameters(this.quadMaterialParameters)}get outlineMaterialParameters(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded}}_updateOutlineMaterial(){this._outlineMaterial&&this._outlineMaterial.setParameters(this.outlineMaterialParameters)}}const x=(0,a.c)()},39801:function(e,t,i){i.d(t,{c:function(){return c}});var n=i(61445),s=i(36945),r=i(60931),o=i(58006),a=i(77623);let l=class extends r.wq{constructor(){super(...arguments),this.enabled=!0}};(0,n._)([(0,o.Cb)({type:Boolean})],l.prototype,"enabled",void 0),l=(0,n._)([(0,a.j)("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],l);let d=class extends r.wq{constructor(e){super(e),this.lineSnapper=new l,this.parallelLineSnapper=new l,this.rightAngleSnapper=new l,this.rightAngleTriangleSnapper=new l,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new s.Z([255,127,0]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5}};(0,n._)([(0,o.Cb)({type:l,constructOnly:!0,nonNullable:!0,json:{write:!0}})],d.prototype,"lineSnapper",void 0),(0,n._)([(0,o.Cb)({type:l,constructOnly:!0,nonNullable:!0,json:{write:!0}})],d.prototype,"parallelLineSnapper",void 0),(0,n._)([(0,o.Cb)({type:l,constructOnly:!0,nonNullable:!0,json:{write:!0}})],d.prototype,"rightAngleSnapper",void 0),(0,n._)([(0,o.Cb)({type:l,constructOnly:!0,nonNullable:!0,json:{write:!0}})],d.prototype,"rightAngleTriangleSnapper",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],d.prototype,"shortLineThreshold",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],d.prototype,"distance",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],d.prototype,"pointThreshold",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],d.prototype,"intersectionParallelLineThreshold",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],d.prototype,"parallelLineThreshold",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],d.prototype,"touchSensitivityMultiplier",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],d.prototype,"pointOnLineThreshold",void 0),(0,n._)([(0,o.Cb)({type:s.Z,nonNullable:!0})],d.prototype,"orange",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],d.prototype,"lineHintWidthReference",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],d.prototype,"lineHintWidthTarget",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],d.prototype,"lineHintFadedExtensions",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],d.prototype,"parallelLineHintWidth",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],d.prototype,"parallelLineHintLength",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],d.prototype,"parallelLineHintOffset",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],d.prototype,"rightAngleHintSize",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],d.prototype,"rightAngleHintOutlineSize",void 0),d=(0,n._)([(0,a.j)("esri.views.interactive.snapping.Settings.Defaults")],d);const c=new d},40182:function(e,t,i){i.d(t,{Bq:function(){return u},Hk:function(){return d},UL:function(){return g},ku:function(){return p},yG:function(){return h}});var n=i(47001),s=i(12686),r=i(39801),o=i(79397),a=i(91555);class l{constructor(e){this.coordinateHelper=e}}class d extends l{constructor(e,t){super(e),this.point=t}objectEqual(e){return e instanceof d&&(0,o.Xv)(this.point,e.point)}check(e){return(0,n.s)(e,this.point)<r.c.pointThreshold}closestTo(){return this.coordinateHelper.clone(this.point)}intersect(e){const t=[];return e instanceof c?t.push(...(0,a.pk)({start:e.start,end:e.end,type:e instanceof p?a.SP.LINE:a.SP.RAY},this.point)):e instanceof g&&t.push(...(0,a.l0)(e.center,e.radius,this.point)),t.map((t=>new u(this.coordinateHelper,t,this,e)))}}class c extends l{constructor(e,t,i){super(e),this.start=t,this.end=i}objectEqual(e){return e instanceof c&&(0,o.Xv)(this.start,e.start)&&(0,o.Xv)(this.end,e.end)}intersect(e){const t=[];return e instanceof d?t.push(...(0,a.pk)({start:this.start,end:this.end,type:this instanceof p?a.SP.LINE:a.SP.RAY},e.point)):e instanceof c?t.push(...(0,a.dU)({start:this.start,end:this.end,type:this instanceof p?a.SP.LINE:a.SP.RAY},{start:e.start,end:e.end,type:e instanceof p?a.SP.LINE:a.SP.RAY})):e instanceof g&&t.push(...(0,a.UG)({start:this.start,end:this.end,type:this instanceof p?a.SP.LINE:a.SP.RAY},e.center,e.radius)),t.map((t=>new u(this.coordinateHelper,t,this,e)))}}class h extends c{constructor(e,t,i){super(e,t,i),this.dir=(0,s.a)(),this.p=(0,s.a)()}objectEqual(e){return e instanceof h&&super.objectEqual(e)}check(e){return(0,n.g)(this.dir,this.end,this.start),(0,n.g)(this.p,e,this.start),(0,n.h)(this.dir,this.p)>=0&&(0,a.Oy)(e,this.start,this.end)<r.c.pointOnLineThreshold}closestTo(e){const t=this.coordinateHelper.clone(e);return(0,a.aW)(t,e,this.start,this.end),t}}class p extends c{constructor(e,t,i){super(e,t,i)}objectEqual(e){return e instanceof p&&super.objectEqual(e)}check(e){return(0,a.Oy)(e,this.start,this.end)<r.c.pointOnLineThreshold}closestTo(e){const t=this.coordinateHelper.clone(e);return(0,a.k0)(t,e,this.start,this.end),t}}class u extends l{constructor(e,t,i,n){super(e),this.intersection=t,this.first=i,this.second=n}objectEqual(e){return e instanceof u&&this.first.objectEqual(e.first)&&this.second.objectEqual(e.second)}check(){return!1}closestTo(e){const t=this.coordinateHelper.clone(e);return(0,n.c)(t,this.intersection),t}intersect(){return[]}}class g extends l{constructor(e,t,i){super(e),this.center=t,this.radius=i}objectEqual(e){return e instanceof g&&this.center[0]===e.center[0]&&this.center[1]===e.center[1]&&this.radius===e.radius}check(){return!1}closestTo(e){const t=this.coordinateHelper.clone(e);return(0,a.xO)(t,e,this.center,this.radius),t}intersect(e){const t=[];return e instanceof c?t.push(...(0,a.UG)({start:e.start,end:e.end,type:e instanceof p?a.SP.LINE:a.SP.RAY},this.center,this.radius)):e instanceof d&&t.push(...(0,a.l0)(this.center,this.radius,e.point)),t.map((t=>new u(this.coordinateHelper,t,this,e)))}}},23007:function(e,t,i){i.d(t,{L:function(){return a}});var n=i(40182),s=i(79397),r=i(95074),o=i(80654);class a extends r.a{constructor(e){super({...e,constraint:new n.ku(e.coordinateHelper,e.edgeStart,e.edgeEnd)})}get hints(){return[new o.w(s.ze.REFERENCE,this.constraint.start,this.constraint.end,this.elevationInfo)]}}},95074:function(e,t,i){i.d(t,{a:function(){return s}});var n=i(30621);class s extends n.j{constructor({coordinateHelper:e,targetPoint:t,objectId:i,constraint:n,elevationInfo:s}){super(e,t,n,s),this.objectId=i}}},30621:function(e,t,i){i.d(t,{j:function(){return n}});class n{constructor(e,t,i,n){this.coordinateHelper=e,this.targetPoint=t,this.constraint=i,this.elevationInfo=n}}},83186:function(e,t,i){i.d(t,{x:function(){return o}});var n=i(40182),s=i(95074),r=i(76952);class o extends s.a{constructor(e){super({...e,constraint:new n.Hk(e.coordinateHelper,e.targetPoint)})}get hints(){return[new r.n(this.targetPoint,this.elevationInfo)]}}},80654:function(e,t,i){i.d(t,{w:function(){return o}});i(81653);var n=i(93622),s=i(79397),r=i(8677);n.Z.getLogger("esri.views.interactive.snapping.hints.LineSnappingHint");class o extends r.r{constructor(e,t,i,n,s=!0,r=!0){super(n),this.type=e,this.lineStart=t,this.lineEnd=i,this.fadeLeft=s,this.fadeRight=r}equals(e){return e instanceof o&&this.type===e.type&&(0,s.Xv)(this.lineStart,e.lineStart)&&(0,s.Xv)(this.lineEnd,e.lineEnd)&&this.fadeLeft===e.fadeLeft&&this.fadeRight===e.fadeRight}}},76952:function(e,t,i){i.d(t,{n:function(){return r}});var n=i(79397),s=i(8677);class r extends s.r{constructor(e,t){super(t),this.point=e}equals(e){return e instanceof r&&(0,n.Xv)(this.point,e.point)}}},8677:function(e,t,i){i.d(t,{r:function(){return n}});class n{constructor(e){this.elevationInfo=e}}},79397:function(e,t,i){i.d(t,{Xv:function(){return o},lQ:function(){return a},tp:function(){return r},ze:function(){return n}});var n,s=i(47001);function r(e,t){const i=e.x-t.x,n=e.y-t.y;return i*i+n*n}function o(e,t){const i=e.length===t.length&&e[0]===t[0]&&e[1]===t[1];switch(e.length){case 2:return i;case 3:return i&&e[2]===t[2];case 4:return i&&e[3]===t[3]}return!1}function a(e,t){t.sort(((t,i)=>(0,s.s)(t.targetPoint,e)-(0,s.s)(i.targetPoint,e)))}!function(e){e[e.TARGET=0]="TARGET",e[e.REFERENCE=1]="REFERENCE",e[e.REFERENCE_EXTENSION=2]="REFERENCE_EXTENSION"}(n||(n={}))}}]);
//# sourceMappingURL=4142.6218fa30.js.map